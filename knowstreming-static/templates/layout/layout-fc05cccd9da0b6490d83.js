define("layout",["react","react-router-dom","moment","react-dom","lodash","echarts","single-spa"],(function(e,t,a,n,r,i,o){return function(e){function t(t){for(var n,o,c=t[0],l=t[1],s=t[2],m=0,d=[];m<c.length;m++)o=c[m],Object.prototype.hasOwnProperty.call(r,o)&&r[o]&&d.push(r[o][0]),r[o]=0;for(n in l)Object.prototype.hasOwnProperty.call(l,n)&&(e[n]=l[n]);for(u&&u(t);d.length;)d.shift()();return i.push.apply(i,s||[]),a()}function a(){for(var e,t=0;t<i.length;t++){for(var a=i[t],n=!0,c=1;c<a.length;c++){var l=a[c];0!==r[l]&&(n=!1)}n&&(i.splice(t--,1),e=o(o.s=a[0]))}return e}var n={},r={0:0},i=[];function o(t){if(n[t])return n[t].exports;var a=n[t]={i:t,l:!1,exports:{}};return e[t].call(a.exports,a,a.exports,o),a.l=!0,a.exports}o.m=e,o.c=n,o.d=function(e,t,a){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(o.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)o.d(a,n,function(t){return e[t]}.bind(null,n));return a},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="/layout/";var c=window.webpackJsonplayout=window.webpackJsonplayout||[],l=c.push.bind(c);c.push=t,c=c.slice();for(var s=0;s<c.length;s++)t(c[s]);var u=l;return i.push([544,2,1,3]),a()}({0:function(t,a){t.exports=e},149:function(e,t){e.exports=i},23:function(e,t){e.exports=a},28:function(e,t){e.exports=n},294:function(e,t,a){e.exports=a.p+"assets/image/ks-logo.png"},307:function(e,t,a){e.exports=a.p+"assets/image/no-data.png"},377:function(e,t,a){e.exports=a.p+"assets/image/health-unknown.png"},378:function(e,t,a){e.exports=a.p+"assets/image/health-down-emoji.png"},382:function(e,t){e.exports=o},41:function(e,t){e.exports=r},469:function(e,t,a){e.exports=a.p+"assets/image/page403.png"},470:function(e,t,a){e.exports=a.p+"assets/image/page404.png"},471:function(e,t,a){e.exports=a.p+"assets/image/page-no-license.png"},472:function(e,t,a){e.exports=a.p+"assets/image/health-good.png"},473:function(e,t,a){e.exports=a.p+"assets/image/health-medium.png"},474:function(e,t,a){e.exports=a.p+"assets/image/health-poor.png"},475:function(e,t,a){e.exports=a.p+"assets/image/health-down.png"},476:function(e,t,a){e.exports=a.p+"assets/image/health-good-emoji.png"},477:function(e,t,a){e.exports=a.p+"assets/image/health-medium-emoji.png"},478:function(e,t,a){e.exports=a.p+"assets/image/health-poor-emoji.png"},482:function(e,t,a){e.exports=a.p+"assets/image/eg2-content.png"},544:function(e,t,a){e.exports=a(917)},738:function(e,t){},8:function(e,a){e.exports=t},809:function(e){e.exports=JSON.parse('{"name":"layout-clusters-fe","port":"8000","version":"1.0.0","ident":"cluster","description":"多集群管理&amp;layout","author":"joysunchao <joysunchao@didiglobal.com>","keywords":["layout"],"homepage":"","license":"ISC","repository":{"type":"git","url":""},"scripts":{"test":"echo \\"Error: run tests from root\\" && exit 1","start":"cross-env NODE_ENV=development webpack-dev-server","build":"cross-env NODE_ENV=production webpack --max_old_space_size=8000"},"browserslist":{"production":[">0.2%","not dead","not ie <= 11","not op_mini all"],"development":["last 1 chrome version","last 1 firefox version","last 1 safari version"]},"dependencies":{"@ant-design/compatible":"^1.0.8","@ant-design/icons":"^4.6.2","@knowdesign/icons":"^1.0.2","@types/react":"^17.0.39","@types/react-copy-to-clipboard":"^5.0.2","@types/react-dom":"^17.0.11","@types/react-highlight-words":"^0.16.0","@types/react-router":"5.1.18","@types/react-router-dom":"^5.3.3","@types/react-transition-group":"^4.2.2","@types/react-virtualized":"^9.21.13","axios":"^0.21.1","babel-preset-react-app":"^10.0.0","classnames":"^2.2.6","crypto-js":"^4.1.1","dotenv":"^16.0.1","html-webpack-plugin":"^4.0.0","knowdesign":"1.3.7","lodash":"^4.17.21","moment":"^2.24.0","react":"16.12.0","react-copy-to-clipboard":"^5.0.4","react-cron-antd":"^1.1.2","react-dom":"16.12.0","react-intl":"^3.2.1","react-joyride":"^2.5.3","single-spa":"5.9.3","single-spa-react":"2.14.0","webpack-bundle-analyzer":"^4.5.0"},"devDependencies":{"@babel/core":"^7.5.5","@babel/plugin-proposal-class-properties":"^7.4.0","@babel/plugin-proposal-decorators":"^7.4.0","@babel/plugin-proposal-export-default-from":"^7.2.0","@babel/plugin-proposal-export-namespace-from":"^7.5.2","@babel/plugin-proposal-object-rest-spread":"^7.4.3","@babel/plugin-proposal-private-methods":"^7.14.5","@babel/plugin-transform-object-assign":"^7.12.1","@babel/plugin-transform-runtime":"^7.4.3","@babel/polyfill":"^7.12.1","@babel/preset-env":"^7.4.2","@babel/preset-react":"^7.0.0","@babel/preset-typescript":"^7.14.5","@pmmmwh/react-refresh-webpack-plugin":"^0.5.1","@types/crypto-js":"^4.1.0","@types/lodash":"^4.14.171","@types/node":"^12.12.25","@types/pubsub-js":"^1.5.18","@typescript-eslint/eslint-plugin":"4.13.0","@typescript-eslint/parser":"4.13.0","babel-eslint":"10.1.0","babel-loader":"^8.2.2","babel-plugin-import":"^1.12.0","case-sensitive-paths-webpack-plugin":"^2.4.0","clean-webpack-plugin":"^3.0.0","copy-webpack-plugin":"^5.1.2","cross-env":"^7.0.2","css-loader":"^2.1.0","eslint":"^7.30.0","eslint-config-prettier":"8.3.0","eslint-plugin-prettier":"3.4.0","eslint-plugin-react":"7.22.0","eslint-plugin-react-hooks":"4.2.0","file-loader":"^6.0.0","hard-source-webpack-plugin":"^0.13.1","husky":"4.3.7","less":"^3.9.0","less-loader":"^4.1.0","lint-staged":"10.5.3","mini-css-extract-plugin":"^1.3.0","optimize-css-assets-webpack-plugin":"^5.0.1","prettier":"2.3.2","progress-bar-webpack-plugin":"^1.12.1","query-string":"^7.0.1","react-refresh":"^0.10.0","react-router-dom":"5.2.1","ts-loader":"^8.0.11","typescript":"4.6.4","webpack":"^4.40.0","webpack-cli":"^3.2.3","webpack-dev-server":"^3.2.1","webpack-merge":"^4.2.1"},"lint-staged":{"*.{js,tsx}":"eslint"}}')},917:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),i=a(28),o=a.n(i),c=a(3),l=a.n(c),s=(a(546),a(8)),u=a(41),m=a(230),d=a(949),f=a(947),p=a(73),v=a(970),g=a(951),h=a(13),b=a(388),E=a(495),y=a(969),k=a(507);k.a.config({top:16,duration:3});var N=function(e,t){k.a[e](Object.assign({icon:r.a.createElement(h.a,{type:"icon-".concat(e,"-circle")})},t))},O={info:function(e){N("info",e)},success:function(e){N("success",e)},warning:function(e){N("warning",e)},error:function(e){N("error",e)}},C=new(0,m.a.EventBus),S=function(){window.location.pathname.includes("login")||window.history.replaceState({},"","/login?redirect=".concat(window.location.href.slice(window.location.origin.length)))},x=m.a.service;x.interceptors.response.handlers=[],x.interceptors.request.use((function(e){var t=m.a.getCookie("X-SSO-USER"),a=m.a.getCookie("X-SSO-USER-ID");return t&&a?(e.headers["X-SSO-USER"]=t,e.headers["X-SSO-USER-ID"]=a):S(),e}),(function(e){return e})),x.interceptors.response.use((function(e){var t=e.data;if(0!==t.code&&200!==t.code){var a=t.message;throw 1e9===t.code||1000000001===t.code||1000000002===t.code?C.emit("licenseError",a):O.error({message:"错误信息",description:a}),t}return t}),(function(e){var t=null==e?void 0:e.config;if(!t||!t.retryTimes)return I(e);var a=t.__retryCount,n=void 0===a?0:a,r=t.retryDelay,i=void 0===r?300:r,o=t.retryTimes;return t.__retryCount=n,n>=o?I(e):(t.__retryCount++,new Promise((function(e){setTimeout((function(){e()}),i)})).then((function(){return x(t)})))}));var j,I=function(e){if(null==e?void 0:e.response)switch(e.response.status){case 401:S();break;case 403:location.href="/403";break;case 405:O.error({message:"错误",description:"".concat(e.response.data.message||"请求方式错误")});break;case 500:O.error({message:"错误",description:"服务错误，请重试！"});break;case 502:O.error({message:"错误",description:"网络错误，请重试！"});break;default:O.error({message:"连接出错",description:"".concat(e.response.status)})}else O.error({message:"连接超时!",description:"请重试或检查服务"});return Promise.reject(e)},w=a(469),T=a.n(w),P=function(){return r.a.createElement("div",{className:"error-page"},r.a.createElement("img",{width:230,height:150,src:T.a}),r.a.createElement("div",{className:"title"},"抱歉，您没有权限访问该页面～"),r.a.createElement("a",{className:"link",href:"/"},"返回首页"))},L=a(470),M=a.n(L),z=function(){return r.a.createElement("div",{className:"error-page"},r.a.createElement("img",{width:230,height:150,src:M.a}),r.a.createElement("div",{className:"title"},"很抱歉，页面走丢了～"),r.a.createElement("div",{className:"desc"},"请检查页面地址是否正确或刷新页面"),r.a.createElement("a",{className:"link",href:"/"},"返回首页"))},D=a(471),R=a.n(D),F=function(){return r.a.createElement("div",{className:"error-page"},r.a.createElement("img",{width:230,height:150,src:R.a}),r.a.createElement("div",{className:"title"},"license 限制"))},B=a(9),H=a.n(B);function A(e){return"".concat("/ks-km/api/v3").concat(e)}!function(e){e[e.Topic=100]="Topic",e[e.Cluster=101]="Cluster",e[e.Group=102]="Group",e[e.Broker=103]="Broker",e[e.Partition=104]="Partition",e[e.Replication=105]="Replication",e[e.Zookeeper=110]="Zookeeper",e[e.Connect=120]="Connect",e[e.Connectors=121]="Connectors",e[e.Controls=901]="Controls",e[e.MM2=122]="MM2"}(j||(j={}));var V,K={login:"".concat("/logi-security/api/v1","/account/login"),logout:"".concat("/logi-security/api/v1","/account/logout"),getVersionInfo:function(){return A("/self/version")},getUserInfo:function(e){return"".concat("/logi-security/api/v1","/user/").concat(e)},getPermissionTree:"".concat("/logi-security/api/v1","/permission/tree"),getKafkaVersionItems:function(){return A("/kafka-versions-items")},getSupportKafkaVersions:function(e,t){return A("/clusters/".concat(e,"/types/").concat(t,"/support-kafka-versions"))},postClientConsumer:A("/clients/consumer"),postClientProducer:A("/clients/producer"),getBalanceList:function(e){return A("/clusters/".concat(e,"/balance-overview"))},getBrokersMetaList:function(e){return A("/clusters/".concat(e,"/brokers-metadata"))},getTopicMetaList:function(e){return A("/clusters/".concat(e,"/topics-metadata"))},balanceStrategy:function(e){return A("/clusters/".concat(e,"/balance-strategy"))},balancePreview:function(e){return A("/clusters/".concat(e,"/balance-preview"))},getBalanceHistory:function(e){return A("/clusters/".concat(e,"/balance-history"))},getBalanceForm:function(e){return A("/clusters/".concat(e,"/balance-config"))},getBalancePlan:function(e,t){return A("/clusters/".concat(e,"/balance-plan/").concat(t))},getPlatformConfig:function(e,t){return A("/platform-configs/clusters/".concat(e,"/groups/").concat(t,"/configs"))},putPlatformConfig:function(){return A("/platform-configs")},getCartInfo:function(e){return A("/clusters/".concat(e,"/balance-state"))},getTopicsMetaData:function(e,t){return A("/clusters/".concat(t,"/topics/").concat(e,"/metadata"))},getTopicsMetrics:function(e){return A("/clusters/".concat(e,"/topic-metrics"))},getConsumerGroup:function(e,t){return A("/clusters/".concat(t,"/topics/").concat(e,"/groups-basic"))},getTopicMetaData:function(e){return A("/clusters/".concat(e,"/topics-metadata"))},getTopicBrokersList:function(e,t){return A("/clusters/".concat(e,"/topics/").concat(t,"/brokers"))},getPartitionMetricInfo:function(e,t,a,n){return A("/clusters/".concat(e,"/brokers/").concat(a,"/topics/").concat(t,"/partitions/").concat(n,"/latest-metrics"))},phyClustersDashbord:A("/physical-clusters/dashboard"),supportKafkaVersion:A("/support-kafka-versions"),phyClusterState:A("/physical-clusters/state"),phyClusterHealthState:A("/physical-clusters/health-state"),getOperatingStateList:function(e){return A("/clusters/".concat(e,"/groups-overview"))},getGroupTopicList:function(e,t){return A("/clusters/".concat(e,"/groups/").concat(t,"/topics-overview"))},phyCluster:A("/physical-clusters"),getPhyClusterBasic:function(e){return A("/physical-clusters/".concat(e,"/basic"))},getPhyClusterMetrics:function(e){return A("/physical-clusters/".concat(e,"/latest-metrics"))},getClusterBasicExit:function(e){return A("/physical-clusters/".concat(e,"/basic-combine-exist"))},getClustersVersion:A("/physical-clusters/exist-version"),kafkaValidator:A("/utils/kafka-validator"),getClusterHealthyConfigs:function(e){return A("/clusters/".concat(e,"/health-configs"))},putPlatformConfigs:A("/platform-configs"),getClusterChangeLog:function(e){return A("/clusters/".concat(e,"/change-records"))},getTopicGroupMetric:function(e){return A("/clusters/".concat(e.clusterId,"/topics/").concat(e.topicName,"/groups/").concat(e.groupName,"/metric"))},getConsumersMetadata:function(e,t,a){return A("/clusters/".concat(e,"/groups/").concat(t,"/topics/").concat(a,"/metadata-combine-exist"))},getTopicGroupMetricHistory:function(e){return A("/clusters/".concat(e,"/group-metrics"))},getTopicGroupPartitionsHistory:function(e,t){return A("/clusters/".concat(e,"/groups/").concat(t,"/partitions"))},resetGroupOffset:function(){return A("/group-offsets")},getGroupOverview:function(e){return A("/clusters/".concat(e,"/groups-overview"))},getTopicsList:function(e){return A("/clusters/".concat(e,"/topics-overview"))},getReassignmentList:function(){return A("/reassignment/topics-overview")},getTaskPlanData:function(){return A("/reassignment/replicas-change-plan")},addTopic:function(){return A("/topics")},deleteTopic:function(){return A("/topics")},expandPartitions:function(){return A("/topics/expand-partitions")},getDefaultTopicConfig:function(e){return A("/clusters/".concat(e,"/config-topics/default"))},getTopicState:function(e,t){return A("/clusters/".concat(e,"/topics/").concat(t,"/state"))},getTopicMetadata:function(e,t){return A("/clusters/".concat(e,"/topics/").concat(t,"/metadata-combine-exist"))},getMetricPointsLatest:function(e){return A("/physical-clusters/".concat(e,"/latest-metrics"))},getTopicMetricPointsLatest:function(e,t){return A("/clusters/".concat(e,"/topics/").concat(t,"/latest-metrics"))},getMetricPoints:function(e){return A("/physical-clusters/".concat(e,"/metric-points"))},getTopicMetricPoints:function(e,t){return A("/clusters/".concat(e,"/topics/").concat(t,"/metric-points"))},getBrokersList:function(e){return A("/clusters/".concat(e,"/brokers-overview"))},getBrokerMetricPoints:function(e){return A("/physical-clusters/".concat(e,"/latest-metrics"))},getChangeLogList:function(e){return A("/clusters/".concat(e,"/controller-history"))},getBrokersState:function(e){return A("/clusters/".concat(e,"/brokers-state"))},getGroupACLBindingList:function(e){return A("/clusters/".concat(e,"/group-acl-bindings"))},getTopicPartitionsSummary:function(e,t){return A("/clusters/".concat(e,"/topics/").concat(t,"/brokers-partitions-summary"))},getTopicPartitionsDetail:function(e,t){return A("/clusters/".concat(e,"/topics/").concat(t,"/partitions"))},getTopicMessagesList:function(e,t){return A("/clusters/".concat(t,"/topics/").concat(e,"/records"))},getTopicGroupList:function(e,t){return A("/clusters/".concat(t,"/topics/").concat(e,"/groups-overview"))},getTopicMessagesMetadata:function(e,t){return A("/clusters//".concat(t,"/topics/").concat(e,"/metadata"))},getTopicACLsList:function(e,t){return A("/clusters/".concat(t,"/topics/").concat(e,"/acl-Bindings"))},getTopicConfigs:function(e,t){return A("/clusters/".concat(t,"/config-topics/").concat(e,"/configs"))},getTopicEditConfig:function(){return A("/config-topics")},getBrokerConfigs:function(e,t){return A("/clusters/".concat(t,"/config-brokers/").concat(e,"/configs"))},getBrokerDataLogs:function(e,t){return A("/clusters/".concat(t,"/brokers/").concat(e,"/log-dirs"))},getBrokerMetadata:function(e,t){return A("/clusters/".concat(t,"/brokers/").concat(e,"/metadata-combine-exist"))},getBrokerDetailMetricPoints:function(e,t){return A("/clusters/".concat(t,"/brokers/").concat(e,"/latest-metrics"))},getBrokerEditConfig:function(){return A("/config-brokers")},getResourceHealthDetail:function(e,t,a){return A("/clusters/".concat(e,"/dimensions/").concat(t,"/resources/").concat(a,"/health-detail"))},getResourceListHealthDetail:function(e){return A("/clusters/".concat(e,"/health-detail"))},getClusterDefaultMetricData:function(){return A("/physical-clusters/metrics-multi-value")},getClusterMetricDataList:function(){return A("/physical-clusters/metrics")},getDashboardMetadata:function(e,t){return A("/clusters/".concat(e,"/").concat(j[t].toLowerCase(),"s-metadata"))},getDashboardMetricList:function(e,t){return A("/clusters/".concat(e,"/types/").concat(t,"/user-metric-config"))},getDashboardMetricChartData:function(e,t){return A("/clusters/".concat(e,"/").concat(j[t].toLowerCase(),"-metrics"))},getJobsList:function(e){return A("/clusters/".concat(e,"/jobs-overview"))},getJobsState:function(e){return A("/clusters/".concat(e,"/jobs-state"))},getJobDetail:function(e,t){return A("/clusters/".concat(e,"/jobs/").concat(t,"/detail"))},getJobsPlanRebalance:function(e,t){return A("/clusters/".concat(e,"/balance-plan/").concat(t))},getJobsScheduleRebalance:function(e,t){return A("/clusters/".concat(e,"/balance-schedule/").concat(t))},getJobsDelete:function(e,t){return A("/clusters/".concat(e,"/jobs/").concat(t))},getJobTraffic:function(e,t,a){return A("/clusters/".concat(e,"/jobs/").concat(t,"/traffic/").concat(a))},getJobNodeTraffic:function(e,t){return A("/clusters/".concat(e,"/jobs/").concat(t,"/node/traffic"))},getJobPartitionDetail:function(e,t,a){return A("/clusters/".concat(e,"/jobs/").concat(t,"/").concat(a,"/partition-detail"))},getACLs:function(e){return A("/clusters/".concat(e,"/acl-bindings"))},addACL:A("/kafka-acls/batch"),delACLs:A("/kafka-acls"),getKafkaUsers:function(e){return A("/clusters/".concat(e,"/kafka-users"))},kafkaUser:A("/kafka-users"),getKafkaUserToken:function(e,t){return A("/clusters/".concat(e,"/kafka-users/").concat(t,"/token"))},updateKafkaUserToken:A("/kafka-users/token"),createTask:function(e){return A("/clusters/".concat(e,"/jobs"))},getOneTopicMetaData:function(e,t){return A("/clusters/".concat(e,"/topics/").concat(t,"/metadata"))},getMovePlanTaskData:function(){return A("/reassignment/replicas-move-plan")},getJobsTaskData:function(e,t){return A("/clusters/".concat(e,"/jobs/").concat(t,"/modify-detail"))},putJobsTaskData:function(e){return A("/clusters/".concat(e,"/jobs"))},getZookeeperState:function(e){return A("/clusters/".concat(e,"/zookeepers-state"))},getZookeeperList:function(e){return A("/clusters/".concat(e,"/zookeepers-overview"))},getZookeeperNodeChildren:function(e){return A("/clusters/".concat(e,"/znode-children"))},getZookeeperNodeData:function(e){return A("/clusters/".concat(e,"/znode-data"))},getZookeeperMetricsInfo:function(e){return A("/clusters/".concat(e,"/zookeeper-latest-metrics"))},getZookeeperMetrics:function(e){return A("/clusters/".concat(e,"/zookeeper-metrics"))},getConnectState:function(e){return A("/kafka-clusters/".concat(e,"/connect-state"))},getConnectorsList:function(e){return A("/clusters/".concat(e,"/connectors-overview"))},getConnectDetailMetricPoints:function(e,t){return A("/kafka-connect/clusters/".concat(t,"/connectors/").concat(e,"/latest-metrics"))},getConnectDetailTasks:function(e,t){return A("/kafka-connect/clusters/".concat(t,"/connectors/").concat(e,"/tasks"))},getConnectDetailState:function(e,t){return A("/kafka-connect/clusters/".concat(t,"/connectors/").concat(e,"/state"))},optionTasks:function(){return A("/kafka-connect/tasks")},getWorkersList:function(e){return A("/clusters/".concat(e,"/workers-overview"))},getConnectClusters:function(e){return A("/kafka-clusters/".concat(e,"/connect-clusters-basic"))},getConnectClusterMetrics:function(e){return A("/kafka-clusters/".concat(e,"/connect-cluster-metrics"))},getConnectors:function(e){return A("/clusters/".concat(e,"/connectors-basic"))},getConnectorMetrics:function(e){return A("/clusters/".concat(e,"/connectors-metrics"))},getConnectorPlugins:function(e){return A("/kafka-connect/clusters/".concat(e,"/connector-plugins"))},getConnectorPluginConfig:function(e,t){return A("/kafka-connect/clusters/".concat(e,"/connector-plugins/").concat(t,"/config"))},getCurPluginConfig:function(e,t){return A("/kafka-connect/clusters/".concat(e,"/connectors/").concat(t,"/config"))},isConnectorExist:function(e,t){return A("/kafka-connect/clusters/".concat(e,"/connectors/").concat(t,"/basic-combine-exist"))},validateConnectorConfig:A("/kafka-connect/connectors-config/validate"),connectorsOperates:A("/kafka-connect/connectors"),updateConnectorConfig:A("/kafka-connect/connectors-config"),batchConnectClusters:A("/kafka-connect/batch-connect-clusters"),deleteConnectClusters:A("/kafka-connect/connect-clusters"),getConnectClusterBasicExit:function(e,t){return A("/kafka-clusters/".concat(e,"/connect-clusters/").concat(t,"/basic-combine-exist"))},getMirrorMakerList:function(e){return A("/clusters/".concat(e,"/mirror-makers-overview"))},getMirrorMakerState:function(e){return A("/kafka-clusters/".concat(e,"/mirror-makers-state"))},getMirrorMakerMetrics:function(e){return A("/clusters/".concat(e,"/mirror-makers-metrics"))},getMirrorMakerMetadata:function(e){return A("/clusters/".concat(e,"/mirror-makers-basic"))},getMM2DetailTasks:function(e,t){return A("/kafka-mm2/clusters/".concat(t,"/connectors/").concat(e,"/tasks"))},getMM2DetailState:function(e,t){return A("/kafka-mm2/clusters/".concat(t,"/connectors/").concat(e,"/state"))},mirrorMakerOperates:A("/kafka-mm2/mirror-makers"),validateMM2Config:A("/kafka-mm2/mirror-makers-config/validate"),updateMM2Config:A("/kafka-mm2/mirror-makers-config"),getMirrorMakerMetricPoints:function(e,t){return A("/kafka-mm2/clusters/".concat(t,"/connectors/").concat(e,"/latest-metrics"))},getSourceKafkaClusterBasic:A("/physical-clusters/basic"),getGroupBasic:function(e){return A("/clusters/".concat(e,"/groups-basic"))},getMirrorClusterList:function(){return A("/ha-mirror/physical-clusters/basic")},handleTopicMirror:function(){return A("/ha-mirror/topics")},getTopicMirrorList:function(e,t){return A("/ha-mirror/clusters/".concat(e,"/topics/").concat(t,"/mirror-info"))},getMirrorMakerConfig:function(e,t){return A("/kafka-mm2/clusters/".concat(e,"/connectors/").concat(t,"/config"))}};!function(e){e.CLUSTERS_MANAGE="多集群管理",e.CLUSTERS_MANAGE_VIEW="多集群管理查看",e.CLUSTER_ADD="接入集群",e.CLUSTER_DEL="删除集群",e.CLUSTER_CHANGE_HEALTHY="Cluster-修改健康规则",e.CLUSTER_CHANGE_INFO="Cluster-修改集群信息",e.REBALANCE_CYCLE="Cluster-LoadReBalance-周期均衡",e.REBALANCE_IMMEDIATE="Cluster-LoadReBalance-立即均衡",e.REBALANCE_SETTING="Cluster-LoadReBalance-设置集群规格",e.BROKER_CHANGE_CONFIG="Broker-修改Broker配置",e.TOPIC_CHANGE_CONFIG="Topic-修改Topic配置",e.TOPIC_RESET_OFFSET="Topic-重置Offset",e.TOPIC_DEL="Topic-删除Topic",e.TOPIC_EXPOND="Topic-扩分区",e.TOPIC_ADD="Topic-新增Topic",e.TOPIC_MOVE_REPLICA="Topic-迁移副本",e.TOPIC_CHANGE_REPLICA="Topic-扩缩副本",e.TOPIC_REPLICATOR="Topic-新增Topic复制",e.TOPIC_CANCEL_REPLICATOR="Topic-详情-取消Topic复制",e.CONSUMERS_RESET_OFFSET="Consumers-重置Offset",e.TEST_CONSUMER="Test-Consumer",e.TEST_PRODUCER="Test-Producer",e.MM2_ADD="MM2-新增",e.MM2_CHANGE_CONFIG="MM2-编辑",e.MM2_DELETE="MM2-删除",e.MM2_RESTART="MM2-重启",e.MM2_STOP_RESUME="MM2-暂停&恢复"}(V||(V={}));var U=function(){var e=g.a.useGlobalValue(),t=l()(e,2),a=t[0],i=t[1],o=localStorage.getItem("userInfo"),c=function(e){var t=m.a.request(K.getUserInfo(e),{retryTimes:2}),a=m.a.request(K.getPermissionTree,{retryTimes:2});return Promise.all([a,t]).then((function(e){var t=l()(e,2),a=t[0],n=t[1],r=a.childList,c=n.permissionTreeVO.childList.find((function(e){return e.permissionName===V.CLUSTERS_MANAGE})),s=[];c&&c.childList.forEach((function(e){return e.has&&s.push(e.permissionName)}));var u=function(e){return e&&s.includes(e)};i((function(e){return Object.assign(Object.assign({},e),{permissions:r,userPermissions:s,hasPermission:u,userInfo:o})}))})),!0};return Object(n.useLayoutEffect)((function(){var e,t=localStorage.getItem("userInfo");try{if(!(e=JSON.parse(t).id))throw"err"}catch(e){return void S()}a.permissions||c(e),a.metricsDefine||m.a.request(K.getKafkaVersionItems(),{retryTimes:2}).then((function(e){var t=function(t,a){return e["".concat(t,"@").concat(a)]||null};i((function(a){return Object.assign(Object.assign({},a),{metricsDefine:e,getMetricDefine:t})}))}))}),[]),r.a.createElement(r.a.Fragment,null)},G=a(12),q=a.n(G),J=a(944),W=a(316),Z=a(958),Y=a(71),Q=a(292),$=a(935),X=a(508);X.b.config({top:16});var ee,te,ae,ne,re=function(e,t,a,n){!function(e){return"[object Object]"===Object.prototype.toString.call(e)&&!!e.content}(t)?X.b[e]({icon:r.a.createElement(h.a,{type:"icon-".concat(e,"-circle")}),content:t,duration:a,onClose:n}):X.b[e](Object.assign({icon:r.a.createElement(h.a,{type:"icon-".concat(e,"-circle")})},t))},ie={info:function(e,t,a){re("info",e,t,a)},success:function(e,t,a){re("success",e,t,a)},warning:function(e,t,a){re("warning",e,t,a)},error:function(e,t,a){re("error",e,t,a)}},oe=a(23),ce=a.n(oe),le=a(281),se=a(26),ue=a.n(se),me={current:1,pageSize:10,total:0},de="YYYY-MM-DD HH:mm:ss",fe=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return null===e||isNaN(e)?"-":(e=Number(e),Number.isInteger(e)?e:e.toFixed(t))},pe=1024,ve=1048576,ge=1024*ve,he=1024*ge,be=function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;return null==e||isNaN(+e)?{value:null,unit:"",valueWithUnit:"-"}:e<=pe?{value:fe(e,a),unit:""+t,valueWithUnit:fe(e)+""+t}:e>pe&&e<ve?{value:fe(e/pe,a),unit:"K"+t,valueWithUnit:fe(e/pe)+"K"+t}:e>=ve&&e<ge?{value:fe(e/ve,a),unit:"M"+t,valueWithUnit:fe(e/ve)+"M"+t}:e>=ge&&e<he?{value:fe(e/ge,a),unit:"G"+t,valueWithUnit:fe(e/ge)+"G"+t}:e>=he?{value:fe(e/he,a),unit:"T"+t,valueWithUnit:fe(e/he)+"T"+t}:"-"},Ee=function(e){var t={};return e.slice(1).split("&").forEach((function(e){var a=e.split("=");t[a[0]]=a[1]})),t},ye=function(e){},ke="table-header-layout",Ne=a(472),Oe=a.n(Ne),Ce=a(473),Se=a.n(Ce),xe=a(474),je=a.n(xe),Ie=a(475),we=a.n(Ie),Te=a(377),Pe=a.n(Te),Le=a(476),Me=a.n(Le),ze=a(477),De=a.n(ze),Re=a(478),Fe=a.n(Re),Be=a(378),He=a.n(Be);!function(e){e[e.UNKNOWN=-1]="UNKNOWN",e[e.GOOD=0]="GOOD",e[e.MEDIUM=1]="MEDIUM",e[e.POOR=2]="POOR",e[e.DOWN=3]="DOWN"}(ne||(ne={}));var Ae,Ve=(ee={},H()(ee,ne.GOOD,Oe.a),H()(ee,ne.MEDIUM,Se.a),H()(ee,ne.POOR,je.a),H()(ee,ne.DOWN,we.a),H()(ee,ne.UNKNOWN,Pe.a),ee),Ke=(te={},H()(te,ne.GOOD,Me.a),H()(te,ne.MEDIUM,De.a),H()(te,ne.POOR,Fe.a),H()(te,ne.DOWN,He.a),H()(te,ne.UNKNOWN,He.a),te),_e=(ae={},H()(ae,ne.GOOD,"状态优异"),H()(ae,ne.MEDIUM,"状态良好"),H()(ae,ne.POOR,"状态较差"),H()(ae,ne.DOWN,"状态异常"),H()(ae,ne.UNKNOWN,"状态异常"),ae),Ue=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:16;return r.a.createElement("img",{width:t,height:a,style:{marginTop:-3},src:Ke[e]||Ke[ne.UNKNOWN]})},Ge=function(e){return _e[e]||_e[ne.UNKNOWN]},qe=function(e){var t=e.state,a=e.width,n=e.height;return r.a.createElement("div",{className:"health-state",style:{width:a,height:n}},r.a.createElement("img",{src:Ve[t]||Pe.a}))},Je=(a(43),[10,11,12]),We=[20,21],Ze=[30,31],Ye=[{label:"Live",value:1},{label:"Down",value:0}],Qe=[{label:"接入时间",value:"createTime"},{label:"健康状态",value:"HealthState"},{label:"Messages",value:"LeaderMessages"},{label:"MessageSize",value:"TotalLogSize"},{label:"BytesIn",value:"BytesIn"},{label:"BytesOut",value:"BytesOut"},{label:"Brokers",value:"Brokers"}],$e=[{label:"升序",value:"asc"},{label:"降序",value:"desc"}],Xe=["LeaderMessages","TotalLogSize","BytesIn","BytesOut"],et=["HealthScore","HealthCheckPassed","HealthCheckTotal","Brokers","Zookeepers"].concat(Xe).concat([]),tt={1:{code:ne.GOOD,key:"goodCount",name:"好"},2:{code:ne.MEDIUM,key:"mediumCount",name:"中"},3:{code:ne.POOR,key:"poorCount",name:"差"},4:{code:ne.DOWN,key:"deadCount",name:"Down"},5:{code:ne.UNKNOWN,key:"unknownCount",name:"Unknown"}},at={0:"",1:"好",2:"中",3:"差",4:"Down",5:"Unknown"},nt=a(934),rt=function(e,t){var a={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(n=Object.getOwnPropertySymbols(e);r<n.length;r++)t.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(e,n[r])&&(a[n[r]]=e[n[r]])}return a},it=["#556ee6","#94BEF2","#95e7ff","#9DDEEB","#A7B1EB","#C2D0E3","#CCABF1","#F9D77B","#F5C993","#A7E6C7","#F19FC9","#F5B6B3","#C9E795"],ot={TB:Math.pow(1024,4),GB:Math.pow(1024,3),MB:Math.pow(1024,2),KB:1024},ct={h:36e5,min:6e4,s:1e3},lt={"十亿":Math.pow(1e3,3),"百万":Math.pow(1e3,2),"千":1e3},st=function(e,t){return Object.entries(e).find((function(e){var a=l()(e,2)[1];return t/a>=1}))},ut={Memory:function(e){return st(ot,e)||["Byte",1]},Time:function(e){return st(ct,e)||["ms",1]},Num:function(e){return st(lt,e)||["",1]}},mt={0:6e4,216e5:6e5,864e5:36e5},dt=function(e,t,a){var n,r=(n=t[1]-t[0],Object.entries(mt).reverse().find((function(e){var t=l()(e,1)[0];return n>Number(t)}))[1]);e.forEach((function(e){for(var n=e.data,i=n.length,o=0;o<i;o++){if(0===o)for(var c=n[0][0];c-r>t[0];){var l=c-r;n.unshift(a?a([l,0]):[l,0]),c=l,i++,o++}if(o===i-1){for(var s=n[o][0];s+r<t[1];){var u=s+r;n.push(a?a([u,0]):[u,0]),s=u}break}for(var m=n[o][0];m+r<n[o+1][0];){var d=m+r;n.splice(o+1,0,a?a([d,0]):[d,0]),m=d,i++,o++}}}))},ft=function(e,t,a,n){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:void 0;return e.map((function(e){var i,o,c=e.metricName,s=t&&t(a,c)||null,u=!0,m=[],d=-1;(null==e?void 0:e.metricLines)&&null!==(null==e?void 0:e.metricLines)?m=e.metricLines:(u=!1,m=[{name:c,metricPoints:e.metricPoints}]);var f=null===(i=null==s?void 0:s.unit)||void 0===i?void 0:i.toLowerCase();o=f.includes("byte")?"Memory":f.includes("ms")?"Time":"Num";var p=function(e){var t=e.timeStamp,a=e.value,n=Number(a);return Number.isNaN(n)?n=a:(n=parseFloat(n.toFixed(3)),d<n&&(d=n)),[t,n]},v={metricName:c,metricType:a,metricUnit:(null==s?void 0:s.unit)||"",metricLines:m.sort((function(e,t){return Number(e.name<t.name)-.5})).map((function(e){return{name:e.name,data:e.metricPoints.map(p)}})),showLegend:u,targetUnit:void 0};if(v.metricLines.forEach((function(e){return e.data.sort((function(e,t){return e[0]-t[0]}))})),d>0){var g=r||ut[o](d),h=l()(g,2),b=h[0],E=h[1];v.targetUnit=[b,E],v.metricUnit="Num"!==o?v.metricUnit.toLowerCase().replace("Memory"===o?"byte":"ms",b):"".concat(b).concat(v.metricUnit),v.metricLines.forEach((function(e){return e.data.forEach((function(e){return parseFloat((e[1]/=E).toFixed(3))}))}))}return dt(v.metricLines,n),v}))},pt=function(e,t,a){var n=t.map((function(e){return'<div style="margin: 3px 0;">\n          <div style="display:flex;align-items:center;">\n            <div style="margin-right:4px;width:8px;height:2px;background-color:'.concat(e.color,';"></div>\n            <div style="flex:1;display:flex;justify-content:space-between;align-items:center;overflow: hidden;">\n              <span style="font-size:12px;color:#74788D;pointer-events:auto;margin-left:2px;line-height: 18px;font-family: HelveticaNeue;overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">\n                ').concat(e.seriesName,'\n              </span>\n              <span style="font-size:12px;color:#212529;line-height:18px;font-family:HelveticaNeue-Medium; padding-left: 6px;">\n                ').concat(parseFloat(Number(e.value[1]).toFixed(3)),"\n              </span>\n            </div>\n          </div>\n        </div>")})).join("");return'<div style="margin: 0px 0 0; position: relative; z-index: 99;width: '.concat(a.customWidth?a.customWidth+"px":"fit-content",';">\n    <div style="padding: 8px 0;height: 100%;">\n      <div style="font-size:12px;padding: 0 12px;color:#212529;line-height:20px;font-family: HelveticaNeue;">\n        ').concat(e,'\n      </div>\n      <div style="').concat(a.legendContextMaxHeight?"max-height: "+a.legendContextMaxHeight+"px":"",'; margin: 4px 0 0 0;overflow-y:auto;padding: 0 12px;">\n        ').concat(n,"\n      </div>\n    </div>\n  </div>")},vt=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.title,a=void 0===t?{}:t,n=e.grid,r=void 0===n?{}:n,i=e.legend,o=void 0===i?{}:i,c=e.xAxis,l=void 0===c?{}:c,s=e.yAxis,u=void 0===s?{}:s,m=e.tooltip,d=void 0===m?{}:m,f=rt(e,["title","grid","legend","xAxis","yAxis","tooltip"]);return Object.assign({title:Object.assign({show:!0,text:"示例标题",textStyle:{fontSize:14,fontFamily:"HelveticaNeue-Medium",color:"#212529",letterSpacing:.5,lineHeight:16,rich:{unit:{fontSize:12,fontFamily:"HelveticaNeue-Medium",color:"#495057",lineHeight:16}}},top:12,left:16,zlevel:1},a),grid:Object.assign({zlevel:0,top:60,left:22,right:16,bottom:40,containLabel:!0},r),legend:Object.assign({zlevel:1,type:"scroll",orient:"horizontal",left:20,top:"auto",bottom:12,icon:"rect",itemHeight:2,itemWidth:8,itemGap:8,textStyle:{fontSize:11,color:"#74788D"},pageIcons:{horizontal:["path://M474.496 512l151.616 151.616a9.6 9.6 0 0 1 0 13.568l-31.68 31.68a9.6 9.6 0 0 1-13.568 0l-190.08-190.08a9.6 9.6 0 0 1 0-13.568l190.08-190.08a9.6 9.6 0 0 1 13.568 0l31.68 31.68a9.6 9.6 0 0 1 0 13.568L474.496 512z","path://M549.504 512L397.888 360.384a9.6 9.6 0 0 1 0-13.568l31.68-31.68a9.6 9.6 0 0 1 13.568 0l190.08 190.08a9.6 9.6 0 0 1 0 13.568l-190.08 190.08a9.6 9.6 0 0 1-13.568 0l-31.68-31.68a9.6 9.6 0 0 1 0-13.568L549.504 512z"]},pageIconColor:"#495057",pageIconInactiveColor:"#ADB5BC",pageIconSize:6,tooltip:!1},o),color:it,xAxis:Object.assign({type:"category",boundaryGap:!0,axisLine:{lineStyle:{color:"#c5c5c5",width:1}},axisLabel:{formatter:function(e){return e=Number(e),["{date|".concat(ce()(e).format("MM-DD"),"}"),"{time|".concat(ce()(e).format("HH:mm"),"}")].join("\n")},padding:0,rich:{date:{color:"#495057",fontSize:11,lineHeight:18,fontFamily:"HelveticaNeue"},time:{color:"#ADB5BC",fontSize:11,lineHeight:11,fontFamily:"HelveticaNeue"}}}},l),yAxis:Object.assign({type:"value",axisLabel:{color:"#495057",fontSize:12},splitLine:{show:!0,lineStyle:{width:1,type:"dashed",color:["#E4E7ED"]}}},u),tooltip:Object.assign({position:function(e,t,a,n,r){var i=a.offsetWidth||120;return i+e[0]<r.viewSize[0]?{top:10,left:e[0]+30}:{top:10,left:e[0]-i-30}},formatter:function(e){var t="";return null!=e&&e.length>0&&(t+=pt(ce()(Number(e[0].axisValue)).format("YYYY-MM-DD HH:mm"),e,d)),t},extraCssText:"padding: 0;box-shadow: 0 -2px 4px 0 rgba(0,0,0,0.02), 0 2px 6px 6px rgba(0,0,0,0.02), 0 2px 6px 0 rgba(0,0,0,0.06);border-radius: 8px;",axisPointer:{type:"line"}},d)},f)},gt=a(953),ht={grid:{top:0,left:0,right:0,bottom:0},xAxis:{show:!1,type:"category",axisLabel:{show:!1}},yAxis:{type:"value",show:!1,axisLabel:{show:!1}},legend:{show:!1},toolBox:{show:!1},tooltip:{show:!1}},bt={lineStyle:{color:"#556EE6",width:1,smooth:.25},areaStyle:{color:{type:"linear",x:0,y:0,x2:0,y2:1,colorStops:[{offset:0,color:"rgba(178,191,255,0.24)"},{offset:1,color:"rgba(142,167,244,0.04)"}],global:!1}}},Et=function(e){var t,a=e.chartData,n=e.loading,i=void 0!==n&&n,o=e.width,c=e.height;return i?r.a.createElement(Q.a,{spinning:i,style:{width:o,height:c}}):a&&(null===(t=null==a?void 0:a.data)||void 0===t?void 0:t.length)?r.a.createElement(gt.a,{wrapStyle:{width:o,height:c,zIndex:0,minWidth:"82px"},option:ht,chartTypeProp:"line",propChartData:[a],seriesCallback:function(e){return e.map((function(e){return e.data.sort((function(e,t){return e[0]-t[0]})),Object.assign(Object.assign({},e),bt)}))}}):r.a.createElement("div",{style:{width:o,height:c}})},yt=function(e,t,a,n){return new(a||(a=Promise))((function(r,i){function o(e){try{l(n.next(e))}catch(e){i(e)}}function c(e){try{l(n.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,c)}l((n=n.apply(e,t||[])).next())}))};!function(e){e[e.Raft=2]="Raft"}(Ae||(Ae={}));var kt,Nt=r.a.forwardRef((function(e,t){var a=Object(nt.a)(),i=J.a.useForm(),o=l()(i,1)[0],c=Object(n.useState)(!1),s=l()(c,2),u=s[0],f=s[1],p=Object(n.useState)({}),v=l()(p,2),g=v[0],b=v[1],E=Object(n.useRef)((function(){}));return Object(n.useImperativeHandle)(t,(function(){return{onOpen:function(e,t){b(e),E.current=t,f(!0)}}})),Object(n.useEffect)((function(){u&&o.resetFields()}),[u]),r.a.createElement(d.a,{width:570,destroyOnClose:!0,centered:!0,className:"custom-modal",wrapClassName:"del-topic-modal delete-modal",title:a.formatMessage({id:"delete.cluster.confirm.title"}),visible:u,onOk:function(){o.validateFields().then((function(){m.a.delete(K.phyCluster,{params:{clusterPhyId:g.id}}).then((function(){ie.success("删除成功"),E.current(),f(!1)}))}))},okText:a.formatMessage({id:"btn.delete"}),cancelText:a.formatMessage({id:"btn.cancel"}),onCancel:function(){return f(!1)},okButtonProps:{style:{width:56},danger:!0,size:"small"},cancelButtonProps:{style:{width:56},size:"small"}},r.a.createElement("div",{className:"tip-info"},r.a.createElement(h.a,{type:"icon-warning-circle"}),r.a.createElement("span",null,a.formatMessage({id:"delete.cluster.confirm.tip"}))),r.a.createElement(J.a,{form:o,className:"form",labelCol:{span:4},wrapperCol:{span:16},autoComplete:"off"},r.a.createElement(J.a.Item,{label:"集群名称",name:"name"},r.a.createElement("span",null,g.name)),r.a.createElement(J.a.Item,{label:"集群名称",name:"clusterName",rules:[{required:!0,message:a.formatMessage({id:"delete.cluster.confirm.cluster"}),validator:function(e,t){return(t=t||"").trim()&&t.trim()===g.name?Promise.resolve():Promise.reject(a.formatMessage({id:"delete.cluster.confirm.cluster"}))}}]},r.a.createElement(W.a,null))))})),Ot=function(e){var t=e.searchParams,a=e.showAccessCluster,i=e.getPhyClusterState,o=e.getExistKafkaVersion,c=Object(s.useHistory)(),u=g.a.useGlobalValue(),d=l()(u,1)[0],f=Object(n.useState)(!1),p=l()(f,2),v=(p[0],p[1],Object(n.useState)([])),b=l()(v,2),E=b[0],y=b[1],k=Object(n.useState)(!0),N=l()(k,2),O=N[0],C=N[1],S=Object(n.useState)(!1),x=l()(S,2),I=x[0],w=x[1],T=Object(n.useState)({pageNo:1,pageSize:10,total:0}),P=l()(T,2),L=P[0],M=P[1],z=Object(n.useRef)(null),D=function(e,a){var n=(new Date).getTime(),r=n-864e5,i=Object.assign({metricLines:{endTime:n,metricsNames:Xe,startTime:r},latestMetricNames:et,pageNo:e,pageSize:a,preciseFilterDTOList:[{fieldName:"kafkaVersion",fieldValueList:t.checkedKafkaVersions},{fieldName:"HealthState",fieldValueList:t.healthState}],searchKeywords:t.keywords},t.sortInfo);return 1===t.clusterStatus.length&&i.preciseFilterDTOList.push({fieldName:"Alive",fieldValueList:t.clusterStatus}),m.a.post(K.phyClustersDashbord,i)},R=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;C(!0),D(1,e).then((function(e){y((null==e?void 0:e.bizData)||[]),M(e.pagination)})).finally((function(){return C(!1)}))},F=function(){return yt(void 0,void 0,void 0,q.a.mark((function e(){var t,a;return q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!I){e.next=2;break}return e.abrupt("return");case 2:return w(!0),e.next=5,D(L.pageNo+1,L.pageSize);case 5:t=e.sent,a=E.concat(t.bizData||[]),y(a),M(t.pagination),w(!1);case 10:case"end":return e.stop()}}),e)})))};Object(n.useEffect)((function(){return t.isReloadAll?R(L.pageNo*L.pageSize):R()}),[t]);var B=function(e){var t,n,u,m,f;e=e||{};var p=[];Xe.forEach((function(t){var a,n,r,i={metricName:t,value:(null===(n=null===(a=e.latestMetrics)||void 0===a?void 0:a.metrics)||void 0===n?void 0:n[t])||0,unit:d.getMetricDefine&&d.getMetricDefine(j.Cluster,t).unit||"",metricLines:{name:t,data:null===(r=e.metricLines.find((function(e){return e.metricName===t})))||void 0===r?void 0:r.metricPoints.map((function(e){return[e.timeStamp,e.value]}))}};if(i.unit.toLowerCase().includes("byte")){var o=ut.Memory(i.value),c=l()(o,2),s=c[0],u=c[1];i.value=Number((i.value/u).toFixed(2)),i.unit=i.unit.toLowerCase().replace("byte",s)}if("LeaderMessages"===i.metricName){var m=ut.Num(i.value),f=l()(m,2),v=f[0],g=f[1];i.value=Number((i.value/g).toFixed(2)),i.unit=v+i.unit}p.push(i)}));var v=e.runState,g=(null===(t=e.latestMetrics)||void 0===t?void 0:t.metrics)||{},b=g.Brokers,E=g.Zookeepers,y=g.HealthCheckPassed,k=g.HealthCheckTotal,N=g.HealthState,O=g.ZookeepersAvailable,C=(g.LoadReBalanceCpu,g.LoadReBalanceDisk),S=g.LoadReBalanceEnable,x=g.LoadReBalanceNwIn,I=g.LoadReBalanceNwOut;return r.a.createElement(Z.b.Item,{onClick:function(){c.push("/cluster/".concat(e.id,"/cluster"))}},r.a.createElement("div",{className:"multi-cluster-list-item"},r.a.createElement("div",{className:"multi-cluster-list-item-healthy"},r.a.createElement("div",{className:"healthy-box"},r.a.createElement(qe,{state:N,width:70,height:70}),r.a.createElement("div",{className:"healthy-degree"},r.a.createElement("span",{className:"healthy-degree-status"},"通过"),r.a.createElement("span",{className:"healthy-degree-proportion"},y,"/",k)))),r.a.createElement("div",{className:"multi-cluster-list-item-right"},r.a.createElement("div",{className:"multi-cluster-list-item-base"},r.a.createElement("div",{className:"multi-cluster-list-item-base-left"},r.a.createElement("div",{className:"base-name"},null!==(n=e.name)&&void 0!==n?n:"-"),r.a.createElement("span",{className:"base-version"},null!==(u=e.kafkaVersion)&&void 0!==u?u:"-"),void 0!==S&&r.a.createElement("div",{style:{display:"flex"},onClick:function(e){e.preventDefault(),e.stopPropagation()}},[["BytesIn",1===x],["BytesOut",1===I],["Disk",1===C]].map((function(t){var a=l()(t,2),n=a[0];return a[1]?r.a.createElement("div",{className:"balance-box balanced"},n," 已均衡"):S?r.a.createElement("div",{className:"balance-box unbalanced"},n," 未均衡"):r.a.createElement(Y.a,{title:r.a.createElement("span",null,"尚未开启 ",n," 均衡策略，",r.a.createElement(s.Link,{to:"/cluster/".concat(e.id,"/operation/balance")},"前往开启"))},r.a.createElement("div",{className:"balance-box unbalanced"},n," 未均衡"))})))),r.a.createElement("div",{className:"multi-cluster-list-item-base-date"},ce()(e.createTime).format(de))),r.a.createElement("div",{className:"multi-cluster-list-item-Indicator"},r.a.createElement("div",{className:"indicator-left"},r.a.createElement("div",{className:"indicator-left-item"},r.a.createElement("div",{className:"indicator-left-item-title"},r.a.createElement("span",{className:"indicator-left-item-title-dot",style:{background:(null===(f=null===(m=e.latestMetrics)||void 0===m?void 0:m.metrics)||void 0===f?void 0:f.BrokersNotAlive)?"#FF7066":"#34C38F"}}),"Brokers"),r.a.createElement("div",{className:"indicator-left-item-value"},b)),v!==Ae.Raft&&r.a.createElement("div",{className:"indicator-left-item"},r.a.createElement("div",{className:"indicator-left-item-title"},r.a.createElement("span",{className:"indicator-left-item-title-dot",style:{background:-1===O?"#e9e7e7":0===O?"#FF7066":"#34C38F"}}),"ZK"),r.a.createElement("div",{className:"indicator-left-item-value"},-1===O?"-":E))),r.a.createElement("div",{className:"indicator-right"},p.map((function(e,t){return r.a.createElement("div",{key:e.metricName+t,className:"indicator-right-item ".concat("LeaderMessages"===e.metricName?"first-right-item":"")},r.a.createElement("div",{className:"indicator-right-item-total"},r.a.createElement("div",{className:"indicator-right-item-total-name"},"TotalLogSize"===e.metricName?"MessageSize":e.metricName),r.a.createElement("div",{className:"indicator-right-item-total-value"},e.value,r.a.createElement("span",{className:"total-value-unit"},e.unit))),r.a.createElement("div",{className:"indicator-right-item-chart"},r.a.createElement(Et,{width:79,height:40,chartData:e.metricLines})))}))))),d.hasPermission?r.a.createElement("div",{className:"multi-cluster-list-item-btn"},d.hasPermission(V.CLUSTER_CHANGE_INFO)&&r.a.createElement("div",{className:"icon",onClick:function(t){t.stopPropagation(),a(e)}},r.a.createElement(h.a,{type:"icon-duojiqunbianji"})),d.hasPermission(V.CLUSTER_DEL)&&r.a.createElement("div",{className:"icon",onClick:function(t){t.stopPropagation(),z.current.onOpen(e,(function(){i(),o(!0),R(L.pageNo*L.pageSize)}))}},r.a.createElement(h.a,{type:"icon-duojiqunshanchu"}))):r.a.createElement(r.a.Fragment,null)))};return r.a.createElement(Q.a,{spinning:O},Object(n.useMemo)((function(){return r.a.createElement(le.a,{dataLength:E.length,next:F,hasMore:E.length<L.total,loader:r.a.createElement(Q.a,{style:{paddingLeft:"50%",paddingTop:15},spinning:!0}),endMessage:L.total?r.a.createElement($.a,{className:"load-completed-tip",plain:!0},"加载完成 共 ",L.total," 条"):"",scrollableTarget:"scrollableDiv"},r.a.createElement(Z.b,{bordered:!1,split:!1,className:"multi-cluster-list",itemLayout:"horizontal",dataSource:E,renderItem:B}))}),[E,L,I]),r.a.createElement(Nt,{ref:z}))},Ct=a(809).ident,St=function(e,t){return{name:"".concat(Ct),icon:"icon-jiqun",path:"cluster/".concat(e),children:[{name:"cluster",path:"cluster",icon:"icon-Cluster1"},{name:"broker",path:"broker",icon:"icon-Brokers1",children:[{name:"dashbord",path:"",icon:"#icon-luoji"},{name:"list",path:"list",icon:"#icon-jiqun1"},{name:"controller-changelog",path:"controller-changelog",icon:"#icon-jiqun1"}]},{name:"topic",path:"topic",icon:"icon-Topics1",children:[{name:"dashbord",path:"",icon:"icon-luoji"},{name:"list",path:"list",icon:"icon-luoji"}]},t&&t!==Ae.Raft?{name:function(e){return r.a.createElement("span",null,e.formatMessage({id:"menu.cluster.zookeeper"}))},path:"zookeeper",icon:"icon-Zookeeper",children:[{name:function(e){return r.a.createElement("span",null,e.formatMessage({id:"menu.cluster.zookeeper.dashboard"}))},path:"",icon:"#icon-luoji"},{name:function(e){return r.a.createElement("span",null,e.formatMessage({id:"menu.cluster.zookeeper.servers"}))},path:"servers",icon:"icon-Jobs"}]}:void 0,{name:function(e){return r.a.createElement("div",{className:"menu-item-with-beta-tag"},r.a.createElement("span",null,e.formatMessage({id:"menu.cluster.connect"})))},path:"connect",icon:"icon-Operation",children:[{name:function(e){return r.a.createElement("span",null,e.formatMessage({id:"menu.cluster.connect.dashboard"}))},path:"",icon:"icon-luoji"},{name:function(e){return r.a.createElement("span",null,e.formatMessage({id:"menu.cluster.connect.connectors"}))},path:"connectors",icon:"#icon-luoji"},{name:function(e){return r.a.createElement("span",null,e.formatMessage({id:"menu.cluster.connect.workers"}))},path:"workers",icon:"icon-Jobs"}].filter((function(e){return e}))},{name:function(e){return r.a.createElement("div",{className:"menu-item-with-beta-tag"},r.a.createElement("span",null,e.formatMessage({id:"menu.cluster.replication"})),r.a.createElement("div",{className:"beta-tag"}))},path:"replication",icon:"icon-Operation",children:[{name:function(e){return r.a.createElement("span",null,e.formatMessage({id:"menu.cluster.replication.dashboard"}))},path:"",icon:"icon-luoji"},{name:function(e){return r.a.createElement("span",null,e.formatMessage({id:"menu.cluster.replication.mirror-maker"}))},path:"mirror-maker",icon:"#icon-luoji"}].filter((function(e){return e}))},{name:"consumer-group",path:"consumers",icon:"icon-Consumer"},{name:"operation",path:"operation",icon:"icon-Operation",children:[void 0,{name:"jobs",path:"jobs",icon:"icon-Jobs"}].filter((function(e){return e}))},void 0,{name:"security",path:"security",icon:"icon-Security",children:[{name:"acls",path:"acls",icon:"icon-luoji"},{name:"users",path:"users",icon:"icon-luoji"}]}].filter((function(e){return e}))}},xt=(H()({},"menu.".concat(Ct,".home"),!0),"menu.".concat(Ct,".home"),kt={yes:"是",no:"否",login:"登录",logout:"退出登录",register:"注册","login.title":"账户登录","login.ldap":"使用LDAP账号登录","add-task":"添加任务","sider.footer.hide":"收起","sider.footer.expand":"展开","test.result":"测试结果","add.task":"添加任务","test.client.stop":"Stop","test.client.clear":"Clear","test.client.run":"Run"},H()(kt,"menu.".concat(Ct,".cluster"),"Cluster"),H()(kt,"menu.".concat(Ct,".cluster.overview"),"Overview"),H()(kt,"menu.".concat(Ct,".broker"),"Broker"),H()(kt,"menu.".concat(Ct,".broker.dashbord"),"Overview"),H()(kt,"menu.".concat(Ct,".broker.list"),"Brokers"),H()(kt,"menu.".concat(Ct,".broker.controller-changelog"),"Controller"),H()(kt,"menu.".concat(Ct,".topic"),"Topic"),H()(kt,"menu.".concat(Ct,".topic.dashbord"),"Overview"),H()(kt,"menu.".concat(Ct,".topic.list"),"Topics"),H()(kt,"menu.".concat(Ct,".produce-consume"),"Message"),H()(kt,"menu.".concat(Ct,".produce-consume.producer"),"Produce"),H()(kt,"menu.".concat(Ct,".produce-consume.consumer"),"Consume"),H()(kt,"menu.".concat(Ct,".security"),"Security"),H()(kt,"menu.".concat(Ct,".security.acls"),"ACLs"),H()(kt,"menu.".concat(Ct,".security.users"),"Users"),H()(kt,"menu.".concat(Ct,".consumer-group"),"Consumer"),H()(kt,"menu.".concat(Ct,".consumer-group.operating-state"),"Operating State"),H()(kt,"menu.".concat(Ct,".consumer-group.group-list"),"GroupList"),H()(kt,"menu.".concat(Ct,".operation"),"Operation"),H()(kt,"menu.".concat(Ct,".operation.balance"),"Rebalance"),H()(kt,"menu.".concat(Ct,".operation.jobs"),"Job"),H()(kt,"menu.".concat(Ct,".connect"),"Connect"),H()(kt,"menu.".concat(Ct,".connect.dashboard"),"Overview"),H()(kt,"menu.".concat(Ct,".connect.connectors"),"Connectors"),H()(kt,"menu.".concat(Ct,".connect.workers"),"Workers"),H()(kt,"menu.".concat(Ct,".replication"),"Replication"),H()(kt,"menu.".concat(Ct,".replication.dashboard"),"Overview"),H()(kt,"menu.".concat(Ct,".replication.mirror-maker"),"Mirror Makers"),H()(kt,"menu.".concat(Ct,".acls"),"ACLs"),H()(kt,"menu.".concat(Ct,".jobs"),"Job"),H()(kt,"menu.".concat(Ct,".zookeeper"),"Zookeeper"),H()(kt,"menu.".concat(Ct,".zookeeper.dashboard"),"Overview"),H()(kt,"menu.".concat(Ct,".zookeeper.servers"),"Servers"),H()(kt,"access.cluster","接入集群"),H()(kt,"access.cluster.low.version.tip","监测到当前Version较低，建议维护Zookeeper信息以便得到更好的产品体验"),H()(kt,"edit.cluster","编辑集群"),H()(kt,"check.detail","查看详情"),H()(kt,"healthy.setting","健康度设置"),H()(kt,"delete.cluster.confirm.title","确定要删除此集群吗？"),H()(kt,"delete.cluster.confirm.tip","删除集群不会删除集群内的资源，仅解除平台的纳管关系！请再次输入集群名称进行确认"),H()(kt,"delete.cluster.confirm.cluster","请再次输入集群名称进行确认"),H()(kt,"btn.delete","删除"),H()(kt,"btn.cancel","取消"),H()(kt,"btn.ok","确定"),kt),jt=a(382),It=function(e,t,a,n){return new(a||(a=Promise))((function(r,i){function o(e){try{l(n.next(e))}catch(e){i(e)}}function c(e){try{l(n.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,c)}l((n=n.apply(e,t||[])).next())}))},wt={env:{NODE_ENV:"production",BUSINESS_VERSION:!1}};function Tt(e,t){return fetch(e).then((function(e){return e.text()})).then((function(e){if(e){var a=e.match(/<meta name="manifest" content="([\w|\d|-]+.json)">/),n="";return t&&a&&(n="".concat(t).concat(a[1],"?q=").concat((new Date).getTime())),n}}))}function Pt(e,t,a){return a&&"[object Function]"===Object.prototype.toString.call(a)?a(e):e.href==="".concat(e.origin,"/").concat(t)||-1!==e.href.indexOf("".concat(e.origin,"/").concat(t))}function Lt(e){var t=function(e){return document.getElementById("".concat(e,"-stylesheet"))}(e);t&&t.remove()}function Mt(e,t,a){return It(this,void 0,void 0,q.a.mark((function n(){var r;return q.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r="",_.forEach(Object.values(t.assetsByChunkName),(function(t){if("string"==typeof t&&0===t.indexOf(e.ident)&&_.endsWith(t,a)&&(r=t),Array.isArray(t)&&(r=t.find((function(t){return 0===t.indexOf(e.ident)&&_.endsWith(t,a)}))))return!1})),n.abrupt("return","".concat(e.production.publicPath).concat(r));case 3:case"end":return n.stop()}}),n)})))}function zt(e,t,a){return It(this,void 0,void 0,q.a.mark((function n(){var r,i,o=this;return q.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=Object.values(t.assetsByChunkName),i=/js$/.test(a),n.next=4,Promise.all(r.map((function(t){return It(o,void 0,void 0,q.a.mark((function n(){var r;return q.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r="","string"==typeof t?r=t:Array.isArray(t)&&(r=t.find((function(t){return i?t.indexOf(e.ident)<0&&_.endsWith(t,a):_.endsWith(t,a)}))),r){n.next=4;break}return n.abrupt("return",Promise.resolve());case 4:if(!i){n.next=8;break}return n.abrupt("return",System.import("".concat(e.production.publicPath).concat(r)));case 8:return n.abrupt("return",(o=e.ident,c="".concat(e.production.publicPath).concat(r),l=void 0,s=void 0,l=document.getElementsByTagName("head")[0],(s=document.createElement("link")).id="".concat(o,"-stylesheet"),s.rel="stylesheet",s.href=c,void l.appendChild(s)));case 9:case"end":return n.stop()}var o,c,l,s}),n)})))})));case 4:case"end":return n.stop()}}),n)})))}var Dt,Rt={systemsConfig:[{ident:"config",development:{publicPath:"http://localhost:8001/config/",index:"http://localhost:8001/config/manifest.json"},production:{publicPath:"".concat("","/config/"),index:"".concat("","/config/manifest.json")}}],feConfig:{title:"Know Streaming",header:{mode:"complicated",logo:"/static/logo-white.png",subTitle:"管理平台",theme:"",right_links:[]}}},Ft=a(928),Bt=a(932),Ht=a(58),At=function(e,t,a,n){return new(a||(a=Promise))((function(r,i){function o(e){try{l(n.next(e))}catch(e){i(e)}}function c(e){try{l(n.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,c)}l((n=n.apply(e,t||[])).next())}))};!function(e){e.input="input",e.inputPassword="inputPassword",e.inputNumber="inputNumber",e.custom="custom"}(Dt||(Dt={}));var Vt,Kt=function(e){var t=J.a.useForm(),a=l()(t,1)[0],n=Object(s.useHistory)();return r.a.createElement(r.a.Fragment,null,r.a.createElement(J.a,{name:"normal_login",form:a,className:"login-form",onFinish:function(e){var t=e.userName,a=e.pw;return At(void 0,void 0,void 0,q.a.mark((function e(){return q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:m.a.post(K.login,{userName:t,pw:m.a.encryptAES(a,"Szjx2022@666666$")}).then((function(e){ie.success("登录成功"),localStorage.setItem("userInfo",JSON.stringify(e));var t=window.location.search.slice("?redirect=".length)||"/";n.replace(t)}));case 1:case"end":return e.stop()}}),e)})))},layout:"vertical"},Zt.map((function(e){return r.a.createElement(Bt.a,{key:e.key},r.a.createElement(J.a.Item,{key:e.key,name:e.key,label:e.label,rules:e.rules,style:{width:"100%"}},function(e){switch(e.type){default:case Dt.input:return r.a.createElement(W.a,Object.assign({key:e.key},e.attrs));case Dt.inputPassword:return r.a.createElement(W.a.Password,Object.assign({key:e.key},e.attrs));case Dt.inputNumber:return r.a.createElement(Ft.a,Object.assign({key:e.key},e.attrs));case Dt.custom:return e.customFormItem}}(e)))})),r.a.createElement(J.a.Item,{key:"submit"},r.a.createElement(Bt.a,null,r.a.createElement(Ht.a,{className:"submit-btn",type:"primary",htmlType:"submit"},"登录")))))},_t=a(111),Ut=a(964),Gt=function(e,t,a,n){return new(a||(a=Promise))((function(r,i){function o(e){try{l(n.next(e))}catch(e){i(e)}}function c(e){try{l(n.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,c)}l((n=n.apply(e,t||[])).next())}))};!function(e){e.login="login",e.register="register"}(Vt||(Vt={}));var qt=[{label:"账号密码登录",key:Vt.login,render:function(e){return r.a.createElement(Kt,{fn:e})}}],Jt=new Map;qt.forEach((function(e){Jt.set(e.key,e)}));var Wt=Jt,Zt=[{key:"userName",label:"账号",type:Dt.input,rules:[{required:!0,message:r.a.createElement(r.a.Fragment,null,r.a.createElement(_t.a,null)," 请输入用户账号")}],attrs:{placeholder:"请输入账号",prefix:r.a.createElement(r.a.Fragment,null)}},{key:"pw",type:Dt.inputPassword,label:"密码",rules:[{required:!0,message:r.a.createElement(r.a.Fragment,null,r.a.createElement(_t.a,null)," 请输入密码")}],attrs:{placeholder:"请输入密码"}}],Yt=function(e){var t=Object(u.debounce)((function(e){return Gt(void 0,void 0,void 0,q.a.mark((function e(){return q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})))}),1e3);return r.a.createElement(r.a.Fragment,null,r.a.createElement(W.a,{key:"user-name1",placeholder:"6-20个字符，支持英文字母、数字、标点符号（除空格）",prefix:r.a.createElement(Ut.a,{style:{color:"rgba(0,0,0,.25)"}}),onChange:function(e){t(e.target.value)}}))},Qt=(Dt.custom,Dt.inputPassword,Ut.a,Dt.inputPassword,Ut.a,Dt.input,Dt.input,Dt.input,a(936)),$t=a(294),Xt=a.n($t),ea=a(482),ta=a.n(ea),aa=[r.a.createElement("div",{key:"2"},r.a.createElement("div",{className:"carousel-eg-ctr carousel-eg-ctr-two"},r.a.createElement("img",{className:"carousel-eg-ctr-two-img img-one",src:ta.a}),r.a.createElement("div",{className:"carousel-eg-ctr-two-desc desc-one"},r.a.createElement("span",null,"Github: "),r.a.createElement("span",null,"5.8K"),r.a.createElement("span",null,"+ Star的的实时流处理平台")),r.a.createElement("div",{className:"carousel-eg-ctr-two-desc desc-two"},"从开源至今社区内已经超过 2000+ 用户使用，从新创公司到巨头，尤其是得到各行业一线企业开发者的信赖。")))],na=function(){var e,t,a=g.a.useGlobalValue(),i=l()(a,2),o=i[0],c=i[1],s=Object(n.useState)([qt[0].key]),u=l()(s,2),m=u[0],d=u[1],f=function(e){d([e]),window.location.hash=e};return Object(n.useEffect)((function(){Object.keys(o).length&&c({})}),[o]),r.a.createElement("div",{className:"login-page"},r.a.createElement("div",{className:"login-page-left"},r.a.createElement(Qt.a,{autoplay:!0,autoplaySpeed:5e3},aa)),r.a.createElement("div",{className:"login-page-right"},r.a.createElement("div",{className:"login-page-right-content"},r.a.createElement("div",{className:"login-page-right-content-title"},r.a.createElement("img",{className:"logo",src:Xt.a}),r.a.createElement("div",{className:"desc"},"可能是北半球最简单易用的 Kafka 管控平台")),r.a.createElement("div",{className:"login-page-right-content-content"},(null===(e=Wt.get(m[0]))||void 0===e?void 0:e.render(f))||(null===(t=Wt.get(qt[0].key))||void 0===t?void 0:t.render(f))))))},ra=a(942),ia=a(134),oa=a(148),ca=a(959),la=a(957),sa=a(483),ua={key:"MultiPage",steps:[{target:".cluster-header-card",title:"Cluster 总数",content:"这里展示了集群的数量和运行状态",disableBeacon:!0,placement:"bottom-start"},{target:".header-filter-bottom",title:"版本选择、健康分",content:"这里展示了版本、健康分的统计信息，并可以进行筛选",placement:"bottom-start"},{target:".multi-cluster-list-item:first-child",title:"集群卡片",content:"这里展示了每个集群状态、指标等综合信息，点击可以 进入单集群管理页面",placement:"bottom-start"}]},ma={key:"ClusterDetail",steps:[{target:".single-cluster-detail .left-sider",title:"集群概览",content:"这里展示了集群的整体健康状态和统计信息",disableBeacon:!0,placement:"right-start"},{target:".single-cluster-detail .cluster-detail .left-sider .healthy-state-status .icon",title:"设置健康度",content:"点击这里可以设置集群的健康检查项、权重及规则",placement:"right-start",spotlightPadding:5,styles:{spotlight:{borderRadius:6}}},{target:".single-cluster-detail .cluster-detail .left-sider .healthy-state-btn",title:"查看健康状态详情",content:"点击这里可以查看集群的健康状态的检查结果",placement:"right-start",spotlightPadding:6,styles:{spotlight:{borderRadius:6}}},{target:".single-cluster-detail .cluster-detail .left-sider .title .edit-icon-box",title:"编辑集群信息",content:"点击这里可以查看集群配置信息，并且可以对信息进行编辑",placement:"right-start",spotlightPadding:1,styles:{spotlight:{borderRadius:6}}},{target:".single-cluster-detail .ks-chart-container-header .header-right .dcloud-btn",title:"指标筛选",content:"点击这里可以对展示的图表进行筛选",placement:"left-start"},{target:".single-cluster-detail .cluster-detail .change-log-panel",title:"历史变更记录",content:"这里展示了配置变更的历史记录",placement:"left-start"}]},da={options:{zIndex:2e3},spotlight:{borderRadius:12}},fa=function(e){var t,a,n=e.continuous,i=e.index,o=e.size,c=e.step,l=e.isLastStep,s=e.skipProps,u=e.primaryProps,m=e.tooltipProps,d=c.placement.startsWith("top"),f=c.placement.startsWith("right"),p=c.placement.startsWith("bottom"),v=(t={},H()(t,"margin-".concat(d?"bottom":f?"left":p?"top":"right"),20),H()(t,"margin-".concat(d||p?"left":"top"),-10),t),g=(a={},H()(a,d||p?"left":"top",24),H()(a,d?"bottom":f?"left":p?"top":"right",-24),H()(a,"transform","rotate(".concat(d?-90:f?0:p?90:180,"deg)")),a);return r.a.createElement("div",Object.assign({className:"joyride-tooltip"},m,{style:v}),c.title&&r.a.createElement("div",{className:"joyride-tooltip-header"},c.title),r.a.createElement("div",{className:"joyride-tooltip-body"},c.content),r.a.createElement("div",{className:"joyride-tooltip-footer"},r.a.createElement("div",{className:"joyride-tooltip-footer-left"},i+1," / ",o),r.a.createElement("div",{className:"joyride-tooltip-footer-right"},r.a.createElement(la.b,null,r.a.createElement(Ht.a,Object.assign({},s,{size:"small",type:"text"}),"跳过"),n&&r.a.createElement(Ht.a,Object.assign({},u,{size:"small",type:"primary"}),l?"我知道了":"下一个")))),r.a.createElement("div",{className:"joyride-tooltip-arrow",style:g},r.a.createElement("div",{className:"joyride-tooltip-arrow-line"})))},pa=function(e){var t=e.guide,a=e.run,i=Object(n.useState)(!1),o=l()(i,2),c=o[0],s=o[1];return Object(n.useLayoutEffect)((function(){if(a){var e,n=t.key,r=localStorage.getItem("guided");try{(e=JSON.parse(r)||[]).includes(n)||(e.push(n),localStorage.setItem("guided",JSON.stringify(e)),s(!0))}catch(e){}}}),[a]),r.a.createElement(sa.a,{steps:t.steps,run:c,continuous:!0,hideCloseButton:!0,showProgress:!0,disableCloseOnEsc:!0,disableOverlayClose:!0,disableScrolling:!0,disableScrollParentFix:!0,tooltipComponent:fa,styles:da,floaterProps:{hideArrow:!0,offset:60}})},va=a(39),ga=a.n(va),ha=a(956),ba=a(314),Ea=a(136),ya=a(937),ka=a(938),Na=/^[\u4E00-\u9FA5A-Za-z0-9\_\-\!\#\$\%&'()\*\+,./\:\;\<=\>?\@\[\\\]^\`\{\|\}~]*$/im,Oa=/^[_a-zA-Z-]*$/,Ca=/^http(s|):\/\/(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])(:((6553[0-5])|(655[0-2][0-9])|(65[0-4][0-9]{2})|(6[0-4][0-9]{3})|([1-5][0-9]{4})|([0-5]{1,5})|([0-9]{1,4})))?$/,Sa=/^[A-Za-z0-9_\-!"#$%&'()*+,./:;<=>?@[\\\]^`{|}~]*$/,xa=a(296);a(813),a(814),a(815),a(816),a(817);a(818),a(819);var ja,Ia=function(e){var t=e.defaultInput,a=e.placeholder,i=void 0===a?"请输入内容":a,o=e.resize,c=void 0!==o&&o,s=e.onBeforeChange,u=e.onBlur,m=Object(n.useState)(""),d=l()(m,2),f=d[0],p=d[1];Object(n.useEffect)((function(){var e="";try{e=JSON.stringify(JSON.parse(t),null,2)}catch(a){e=t}p(e)}),[t]);return r.a.createElement(xa.Controlled,{className:"codemirror-form-item ".concat(c?"codemirror-form-item-resize":""),value:f,options:{mode:"application/json",lineNumbers:!0,lineWrapper:!0,autoCloseBrackets:!0,smartIndent:!0,tabSize:2,placeholder:i},onBlur:function(e){u&&u(e)},onBeforeChange:function(e,t,a){s(a),p(a)}})},wa=function(e,t,a,n){return new(a||(a=Promise))((function(r,i){function o(e){try{l(n.next(e))}catch(e){i(e)}}function c(e){try{l(n.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,c)}l((n=n.apply(e,t||[])).next())}))},Ta=ha.a.Panel,Pa=Object(n.forwardRef)((function(e,t){var a=e.form,i=e.clusterInfo,o=e.visible,c=Object(nt.a)(),s=r.a.useState(!1),u=l()(s,2),d=u[0],f=u[1],p=r.a.useState({}),v=l()(p,2),g=v[0],h=v[1],b=r.a.useState({versionExtra:"",zooKeeperExtra:"",bootstrapExtra:"",jmxExtra:""}),E=l()(b,2),y=E[0],k=E[1],N=r.a.useRef({bootstrapServers:(null==g?void 0:g.bootstrapServers)||"",zookeeper:(null==g?void 0:g.zookeeper)||"",clientProperties:(null==g?void 0:g.clientProperties)||{}}),O=function(){a.resetFields(),f(!1),h({}),k({versionExtra:"",zooKeeperExtra:"",bootstrapExtra:"",jmxExtra:""}),N.current={bootstrapServers:"",zookeeper:"",clientProperties:{}}},C=function(){var t=a.getFieldValue("bootstrapServers"),n=a.getFieldValue("zookeeper"),r={};try{r=a.getFieldValue("clientProperties")&&JSON.parse(a.getFieldValue("clientProperties"))}catch(e){console.error("JSON.parse(form.getFieldValue('clientProperties')) ERROR: ".concat(e))}return f(!0),m.a.post(K.kafkaValidator,{bootstrapServers:t||"",zookeeper:n||"",clientProperties:r||{}}).then((function(r){var i={zookeeper:n||r.zookeeper};r.kafkaVersion&&e.kafkaVersion.includes(r.kafkaVersion)&&(i.kafkaVersion=r.kafkaVersion),r.jmxPort&&(i.jmxPort=r.jmxPort),a.setFieldsValue(i);var o=Object.assign(Object.assign({},y),{bootstrapExtra:t?"连接成功":"",zooKeeperExtra:n?"连接成功":""});return(r.errList||[]).forEach((function(e){var t,a=e.code,n=e.message;Je.includes(a)?t="bootstrapExtra":We.includes(a)?t="zooKeeperExtra":Ze.includes(a)&&(t="jmxExtra"),t&&(o[t]=n)})),k(o),r})).finally((function(){f(!1)}))};r.a.useEffect((function(){N.current={bootstrapServers:(null==g?void 0:g.bootstrapServers)||"",zookeeper:(null==g?void 0:g.zookeeper)||"",clientProperties:(null==g?void 0:g.clientProperties)||{}},a.setFieldsValue(Object.assign({},g)),(null==g?void 0:g.kafkaVersion)&&a.validateFields(["kafkaVersion"])}),[g]),r.a.useEffect((function(){if((null==i?void 0:i.id)&&o){f(!0);var e=function(e){var t=Object.assign({},e);try{var a=null==e?void 0:e.jmxProperties;if(a){var n=JSON.parse(a);"object"===ga()(n)&&null!==n&&Object.assign(t,n)}}catch(e){console.error("jmxProperties not JSON: ",e)}return t};m.a.request(K.getPhyClusterBasic(i.id)).then((function(t){h(e(t))})).catch((function(t){h(e(i))})).finally((function(){f(!1)}))}else h({})}),[i,o]);var S={name:function(e,t){return wa(void 0,void 0,void 0,q.a.mark((function e(){return q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return",Promise.reject("集群名称不能为空"));case 2:if(t!==(null==g?void 0:g.name)){e.next=4;break}return e.abrupt("return",Promise.resolve());case 4:if(!((null==t?void 0:t.length)>128)){e.next=6;break}return e.abrupt("return",Promise.reject("集群名称长度限制在1～128字符"));case 6:if(new RegExp(Na).test(t)){e.next=8;break}return e.abrupt("return",Promise.reject("集群名称支持中英文、数字、特殊字符 ! # $ % & ' ( ) * + , - . / : ; < = > ? @ [  ] ^ _ ` { | } ~"));case 8:return e.abrupt("return",m.a.request(K.getClusterBasicExit(t)).then((function(e){var t=e||{};return(null==t?void 0:t.exist)?Promise.reject("集群名称重复"):Promise.resolve()})).catch((function(){return Promise.reject("连接超时! 请重试或检查服务")})));case 9:case"end":return e.stop()}}),e)})))},bootstrapServers:function(e,t){return wa(void 0,void 0,void 0,q.a.mark((function e(){return q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return",Promise.reject("Bootstrap Servers不能为空"));case 2:if(!(t.length>2e3)){e.next=4;break}return e.abrupt("return",Promise.reject("Bootstrap Servers长度限制在2000字符"));case 4:if(!t||t===N.current.bootstrapServers){e.next=7;break}return N.current.bootstrapServers=t,e.abrupt("return",C().catch((function(){return N.current.bootstrapServers=""})));case 7:return e.abrupt("return",Promise.resolve(""));case 8:case"end":return e.stop()}}),e)})))},zookeeper:function(e,t){return wa(void 0,void 0,void 0,q.a.mark((function e(){return q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return",Promise.resolve(""));case 2:if(!(t.length>2e3)){e.next=4;break}return e.abrupt("return",Promise.reject("Zookeeper长度限制在2000字符"));case 4:if(!t||t===N.current.zookeeper){e.next=7;break}return N.current.zookeeper=t,e.abrupt("return",C().catch((function(){return N.current.zookeeper=""})));case 7:return e.abrupt("return",Promise.resolve(""));case 8:case"end":return e.stop()}}),e)})))},securityUserName:function(e,t){return wa(void 0,void 0,void 0,q.a.mark((function e(){return q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return",Promise.reject("用户名不能为空"));case 2:if(new RegExp(Oa).test(t)){e.next=4;break}return e.abrupt("return",Promise.reject("仅支持大小写、下划线、短划线（-）"));case 4:if(!(t.length>128)){e.next=6;break}return e.abrupt("return",Promise.reject("用户名长度限制在1～128字符"));case 6:return e.abrupt("return",Promise.resolve());case 7:case"end":return e.stop()}}),e)})))},securityToken:function(e,t){return wa(void 0,void 0,void 0,q.a.mark((function e(){return q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return",Promise.reject("密码不能为空"));case 2:if(new RegExp(Oa).test(t)){e.next=4;break}return e.abrupt("return",Promise.reject("密码只能由大小写、下划线、短划线（-）组成"));case 4:if(!(t.length<6||t.length>32)){e.next=6;break}return e.abrupt("return",Promise.reject("密码长度限制在6～32字符"));case 6:return e.abrupt("return",Promise.resolve());case 7:case"end":return e.stop()}}),e)})))},kafkaVersion:function(e,t){return wa(void 0,void 0,void 0,q.a.mark((function e(){var n,r;return q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return",Promise.reject("版本号不能为空"));case 2:return n=a.getFieldValue("zookeeper"),r="",t<"2.8.0"&&!n&&(r=c.formatMessage({id:"access.cluster.low.version.tip"})),k(Object.assign(Object.assign({},y),{versionExtra:r})),e.abrupt("return",Promise.resolve());case 7:case"end":return e.stop()}}),e)})))},clientProperties:function(e,t){return wa(void 0,void 0,void 0,q.a.mark((function e(){return q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t&&JSON.parse(t),e.abrupt("return",Promise.resolve());case 5:return e.prev=5,e.t0=e.catch(0),e.abrupt("return",Promise.reject(new Error("输入内容必须为 JSON")));case 8:case"end":return e.stop()}}),e,null,[[0,5]])})))},description:function(e,t){return wa(void 0,void 0,void 0,q.a.mark((function e(){return q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return",Promise.resolve(""));case 2:if(!(t&&t.length>200)){e.next=4;break}return e.abrupt("return",Promise.reject("集群描述长度限制在200字符"));case 4:return e.abrupt("return",Promise.resolve());case 5:case"end":return e.stop()}}),e)})))}};return Object(n.useImperativeHandle)(t,(function(){return{onCancel:O}})),r.a.createElement(Q.a,{spinning:d},r.a.createElement(J.a,{form:a,layout:"vertical",onValuesChange:function(e){Object.keys(e).forEach((function(e){switch(e){case"zookeeper":case"bootstrapServers":k(Object.assign(Object.assign({},y),{zooKeeperExtra:"",bootstrapExtra:"",jmxExtra:""}));break;case"kafkaVersion":k(Object.assign(Object.assign({},y),{versionExtra:""}))}}))}},r.a.createElement(J.a.Item,{name:"name",label:"集群名称",validateTrigger:"onBlur",rules:[{required:!0,validator:S.name}]},r.a.createElement(W.a,null)),r.a.createElement(J.a.Item,{name:"bootstrapServers",label:"Bootstrap Servers",extra:r.a.createElement("span",{className:y.bootstrapExtra.includes("连接成功")?"":"error-extra-info"},y.bootstrapExtra),validateTrigger:"onBlur",rules:[{required:!0,validator:S.bootstrapServers}]},r.a.createElement(W.a.TextArea,{rows:3,placeholder:"请输入Bootstrap Servers地址，例如：192.168.1.1:9092,192.168.1.2:9092,192.168.1.3:9092"})),r.a.createElement(J.a.Item,{name:"zookeeper",label:"Zookeeper",extra:r.a.createElement("span",{className:y.zooKeeperExtra.includes("连接成功")?"":"error-extra-info"},y.zooKeeperExtra),validateTrigger:"onBlur",rules:[{validator:S.zookeeper}]},r.a.createElement(W.a.TextArea,{rows:3,placeholder:"请输入Zookeeper地址，例如：192.168.0.1:2181,192.168.0.2:2181,192.168.0.2:2181/ks-kafka"})),r.a.createElement(J.a.Item,{className:"metrics-form-item",label:"Metrics"},r.a.createElement("div",{className:"horizontal-form-container"},r.a.createElement("div",{className:"inline-items"},r.a.createElement(J.a.Item,{name:"jmxPort",label:"JMX Port :",extra:y.jmxExtra},r.a.createElement(Ft.a,{min:0,max:99999,style:{width:129}})),r.a.createElement(J.a.Item,{name:"maxConn",label:"Max Conn :"},r.a.createElement(Ft.a,{addonAfter:"个",min:0,max:99999,style:{width:124}}))),r.a.createElement(J.a.Item,{name:"openSSL",label:"Security :"},r.a.createElement(ba.a.Group,null,r.a.createElement(ba.a,{value:!1},"None"),r.a.createElement(ba.a,{value:!0},"Password Authentication"))),r.a.createElement(J.a.Item,{dependencies:["openSSL"],noStyle:!0},(function(e){return(0,e.getFieldValue)("openSSL")?r.a.createElement("div",{className:"user-info-form-items"},r.a.createElement(J.a.Item,{className:"user-info-label",label:"User Info :",required:!0}),r.a.createElement("div",{className:"inline-items"},r.a.createElement(J.a.Item,{name:"username",rules:[{validator:S.securityUserName}]},r.a.createElement(W.a,{placeholder:"请输入用户名"})),r.a.createElement(J.a.Item,{className:"token-form-item",name:"token",rules:[{validator:S.securityToken}]},r.a.createElement(W.a,{placeholder:"请输入密码"})))):null})))),r.a.createElement(J.a.Item,{name:"kafkaVersion",label:"Version",dependencies:["zookeeper"],extra:r.a.createElement("span",{className:"error-extra-info"},y.versionExtra),rules:[{required:!0,validator:S.kafkaVersion}]},r.a.createElement(oa.a,{placeholder:"请选择Kafka Version，如无匹配则选择相近版本"},(e.kafkaVersion||[]).map((function(e){return r.a.createElement(oa.a.Option,{key:e,value:e},e)})))),r.a.createElement(J.a.Item,{name:"clientProperties",label:"集群配置",rules:[{validator:S.clientProperties}]},r.a.createElement("div",null,r.a.createElement(Ia,{resize:!0,defaultInput:a.getFieldValue("clientProperties"),placeholder:'用于创建Kafka客户端进行信息获取的相关配置，\n例如开启SCRAM-SHA-256安全管控模式的集群需输入如下配置，\n未开启安全管控可不进行任何输入：\n{\n  "security.protocol": "SASL_PLAINTEXT",\n  "sasl.mechanism": "SCRAM-SHA-256",\n  "sasl.jaas.config": "org.apache.kafka.common.security.\nscram.ScramLoginModule required username=\\"xxxxxx\\" pass\nword=\\"xxxxxx\\";"\n}\n',onBeforeChange:function(e){a.setFieldsValue({clientProperties:e}),a.validateFields(["clientProperties"])},onBlur:function(){a.validateFields(["clientProperties"]).then((function(){var e=a.getFieldValue("bootstrapServers"),t=a.getFieldValue("zookeeper"),n=a.getFieldValue("clientProperties");n&&n!==N.current.clientProperties&&(e||t)&&C().then((function(){N.current.clientProperties=n})).catch((function(){ie.error("连接失败")}))}))}}))),r.a.createElement(J.a.Item,{name:"description",label:"集群描述",rules:[{validator:S.description}]},r.a.createElement(W.a.TextArea,{rows:4}))))})),La=function(e){var t=e.initFieldsValue,a=e.kafkaVersion,i=e.setSelectedTabKey,o=e.getConnectClustersList,c=e.clusterInfo,s=J.a.useForm(),u=l()(s,1)[0],d={name:function(e,a){return wa(void 0,void 0,void 0,q.a.mark((function e(){return q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a){e.next=2;break}return e.abrupt("return",Promise.reject("集群名称不能为空"));case 2:if(a!==(null==t?void 0:t.name)){e.next=4;break}return e.abrupt("return",Promise.resolve());case 4:if(new RegExp(Na).test(a)){e.next=6;break}return e.abrupt("return",Promise.reject("集群名称支持中英文、数字、特殊字符 ! \" # $ % & ' ( ) * + , - . / : ; < = > ? @ [  ] ^ _ ` { | } ~"));case 6:return e.abrupt("return",m.a.request(K.getConnectClusterBasicExit(c.id,a)).then((function(e){var t=e||{};return(null==t?void 0:t.exist)?Promise.reject("集群名称重复"):Promise.resolve()})).catch((function(){return Promise.reject("连接超时! 请重试或检查服务")})));case 7:case"end":return e.stop()}}),e)})))},address:function(e,t){return wa(void 0,void 0,void 0,q.a.mark((function e(){return q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return",Promise.reject("请输入集群地址"));case 2:if(new RegExp(Ca).test(t)){e.next=4;break}return e.abrupt("return",Promise.reject("格式错误，正确示例：http://1.1.1.1, http://1.1.1.1:65535, https://1.1.1.1, https://1.1.1.1:65535"));case 4:return e.abrupt("return",Promise.resolve());case 5:case"end":return e.stop()}}),e)})))}};return Object(n.useLayoutEffect)((function(){try{var e=JSON.parse(t.jmxProperties)||{};u.setFieldsValue(Object.assign(Object.assign({},t),{jmxProperties:e.jmxProperties}))}catch(e){u.setFieldsValue(Object.assign({},t))}}),[]),r.a.createElement(r.a.Fragment,null,r.a.createElement(J.a,{form:u,layout:"vertical",onFinish:function(e){var a=Object.assign(Object.assign({},e),{id:null==t?void 0:t.id,jmxProperties:e.jmxProperties?'{ "jmxProperties": "'.concat(e.jmxProperties,'" }'):void 0});m.a.put(K.batchConnectClusters,[a]).then((function(e){o(),O.success({message:"修改Connect集群成功"})})).catch((function(e){O.success({message:"修改Connect集群失败"})}))}},r.a.createElement(J.a.Item,{name:"name",label:"集群名称",validateTrigger:"onBlur",rules:[{required:!0,validator:d.name}]},r.a.createElement(W.a,{placeholder:"请输入集群名称",maxLength:64})),r.a.createElement(J.a.Item,{name:"groupName",label:"ConsumerGroup Name"},r.a.createElement(W.a,{disabled:!0,placeholder:"请输入 ConsumerGroup Name"})),r.a.createElement(J.a.Item,{name:"clusterUrl",label:"集群地址"},r.a.createElement(W.a,{disabled:!0,placeholder:"请输入集群地址"})),r.a.createElement("div",{className:"inline-form-items",style:{display:"flex",justifyContent:"space-between"}},r.a.createElement(J.a.Item,{name:"version",label:"版本号",style:{width:202},rules:[{required:!0,message:"请选择版本号"}]},r.a.createElement(oa.a,{placeholder:"请选择版本，如无匹配可选择相邻版本"},(a||[]).map((function(e){return r.a.createElement(oa.a.Option,{key:e,value:e},e)})))),r.a.createElement(J.a.Item,{name:"jmxProperties",label:"JMX Port",style:{width:202}},r.a.createElement(Ft.a,{min:0,max:99999,style:{width:202}}))),r.a.createElement(J.a.Item,{style:{marginBottom:0}},r.a.createElement(la.b,null,r.a.createElement(Ht.a,{type:"primary",htmlType:"submit",size:"small",style:{width:56}},"保存"),r.a.createElement(Ht.a,{size:"small",style:{width:56},onClick:function(){i(void 0);try{var e=JSON.parse(t.jmxProperties)||{};u.setFieldsValue(Object.assign(Object.assign({},t),{jmxProperties:e.jmxProperties}))}catch(e){u.setFieldsValue(Object.assign({},t))}}},"取消")))))},Ma=Object(n.forwardRef)((function(e,t){var a=e.kafkaVersion,i=e.clusterInfo,o=e.visible,c=Object(n.useState)([]),s=l()(c,2),u=s[0],d=s[1],f=Object(n.useState)(void 0),p=l()(f,2),v=p[0],g=p[1],b=Object(n.useState)(!0),E=l()(b,2),y=E[0],k=E[1],N=function(e){return r.a.createElement(h.a,{type:"icon-shanchu1",onClick:function(t){t.stopPropagation(),m.a.delete(K.deleteConnectClusters,{params:{connectClusterId:e.id}}).then((function(e){C(),O.success({message:"删除Connect集群成功"})}))}})},C=function(){k(!0),m.a.request(K.getConnectClusters(i.id)).then((function(e){d(e||[])})).finally((function(){k(!1)}))};return Object(n.useEffect)((function(){o&&C()}),[o]),r.a.createElement(Q.a,{spinning:y},(null==u?void 0:u.length)?r.a.createElement(ha.a,{accordion:!0,bordered:!1,activeKey:v,className:"cluster-connect-custom-collapse",expandIcon:function(e){var t=e.isActive;return r.a.createElement(h.a,{type:"icon-jiantou_1",rotate:t?90:0})},onChange:function(e){g(e)}},u.map((function(e,t){return r.a.createElement(Ta,{header:e.name,key:t,className:"cluster-connect-custom-panel",extra:N(e)},r.a.createElement(La,{initFieldsValue:e,kafkaVersion:a,setSelectedTabKey:g,getConnectClustersList:C,clusterInfo:i}))}))):r.a.createElement(Ea.a,{description:"暂无Connect集群",image:Ea.a.PRESENTED_IMAGE_CUSTOM,style:{padding:"100px 0"}}))})),za=function(e){var t=e.afterSubmitSuccess,a=e.clusterInfo,i=e.visible,o=e.setVisible,c=e.kafkaVersion,s=Object(nt.a)(),u=J.a.useForm(),d=l()(u,1)[0],f=Object(n.useState)(!1),p=l()(f,2),v=p[0],g=p[1],h=Object(n.useRef)(null),b=Object(n.useState)("cluster"),E=l()(b,2),y=E[0],k=E[1],N=function(){k("cluster"),d.resetFields(),h.current.onCancel(),o&&o(!1)};return r.a.createElement(ya.a,{className:"drawer-content drawer-access-cluster",onClose:N,maskClosable:!1,extra:"cluster"===y?r.a.createElement("div",{className:"operate-wrap"},r.a.createElement(la.b,null,r.a.createElement(Ht.a,{size:"small",onClick:N},"取消"),r.a.createElement(Ht.a,{size:"small",type:"primary",loading:v,onClick:function(){d.validateFields().then((function(e){g(!0);var n=null;try{n=e.clientProperties&&JSON.parse(e.clientProperties)}catch(e){console.error(e)}var r={bootstrapServers:e.bootstrapServers,clientProperties:n||{},description:e.description||"",jmxProperties:{jmxPort:e.jmxPort,maxConn:e.maxConn,openSSL:e.openSSL||!1,token:e.token,username:e.username},kafkaVersion:e.kafkaVersion,name:e.name,zookeeper:e.zookeeper||""};isNaN(null==a?void 0:a.id)?m.a.post(K.phyCluster,r).then((function(){ie.success("集群接入成功。注意：新接入集群数据稳定需要1-2分钟"),t&&t(),N()})).finally((function(){g(!1)})):m.a.put(K.phyCluster,Object.assign(Object.assign({},r),{id:null==a?void 0:a.id})).then((function(){ie.success("编辑成功"),t&&t(),N()})).finally((function(){g(!1)}))}))}},"确定"),r.a.createElement($.a,{type:"vertical"}))):null,title:s.formatMessage({id:e.title||(null==a?void 0:a.id)?"edit.cluster":"access.cluster"}),visible:i,placement:"right",width:480},r.a.createElement(ka.a,{onChange:function(e){k(e)},activeKey:y,defaultActiveKey:"cluster"},r.a.createElement(ka.a.TabPane,{tab:"Cluster",key:"cluster"},r.a.createElement(Pa,{ref:h,form:d,clusterInfo:a,kafkaVersion:c,visible:i})),(null==a?void 0:a.id)&&r.a.createElement(ka.a.TabPane,{tab:"Connect",key:"connect"},r.a.createElement(Ma,{kafkaVersion:c,clusterInfo:a,visible:i}))))},Da=a(965),Ra=function(){var e=Object(n.useState)(1),t=l()(e,2),a=t[0],i=t[1];return r.a.createElement("div",{className:"multi-cluster-erge",onClick:function(){a>=50?(X.b.success({content:"Erge",icon:r.a.createElement(Da.a,null)}),i(1)):i(a+1)}})},Fa=a(526),Ba=ia.a.Group,Ha=function(e){var t=e.kafkaVersions,a=e.onChangeCheckGroup,i=r.a.useState([]),o=l()(i,2),c=o[0],s=o[1],m=r.a.useState({}),d=l()(m,2),f=d[0],p=d[1],v=r.a.useState(!1),g=l()(v,2),h=g[0],b=g[1],E=r.a.useState(!0),y=l()(E,2),k=y[0],N=y[1],O=Object(n.useState)({width:400,num:0}),C=l()(O,2),S=C[0],x=C[1],j=r.a.useState(!1),I=l()(j,2),w=I[0],T=I[1],P=function(e){T(!1)},L=function(){var e,t=((null===(e=document.getElementsByClassName("custom-check-group")[0])||void 0===e?void 0:e.offsetWidth)-100-86)/108|0;x({width:108*t+88+66,num:t})},M=function(e,t){return Object.entries(e).filter(t).map((function(e){return l()(e,1)[0]}))},z=function(e,n){var r=Object.assign({},f);Object.keys(r).forEach((function(t,a){(e&&a<S.num||!e&&a>=S.num)&&(r[t]=n.includes(t))}));var i=Object.values(r).filter((function(e){return e})).length;p(r),b(i&&i<t.length),N(i===t.length),a(M(r,(function(e){return l()(e,2)[1]})))};return Object(n.useEffect)((function(){var e=Object.assign({},f);Object.keys(e).forEach((function(a){t.includes(a)||delete e[a]})),t.forEach((function(t){Object.keys(e).includes(t)||(e[t]=!0)}));var n=Object.values(e).filter((function(e){return e})).length;s(ue()(t)),p(e),b(n&&n<t.length),N(n===t.length),a(M(e,(function(e){return l()(e,2)[1]})))}),[t]),Object(n.useEffect)((function(){L();var e=Object(u.debounce)(L,500);return window.addEventListener("resize",e),document.addEventListener("click",P),function(){window.removeEventListener("resize",e),document.removeEventListener("click",P)}}),[]),r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"custom-check-group",onClick:function(e){return e.nativeEvent.stopImmediatePropagation()}},r.a.createElement("div",null,r.a.createElement(ia.a,{className:"check-all",indeterminate:h,onChange:function(e){var t=e.target.checked,n=Object.assign({},f);Object.keys(n).forEach((function(e){return n[e]=t})),p(n),b(!1),N(t),a(e.target.checked?c:[])},checked:k},"全选")),r.a.createElement(Ba,{options:Array.from(c).splice(0,S.num),value:M(f,(function(e,t){var a=l()(e,2)[1];return t<S.num&&a})),onChange:function(e){return z(!0,e)}}),w?r.a.createElement(Ba,{style:{width:S.width},className:"more-check-group",options:Array.from(c).splice(S.num),value:M(f,(function(e,t){var a=l()(e,2)[1];return t>=S.num&&a})),onChange:function(e){return z(!1,e)}}):null,c.length>S.num?r.a.createElement("div",{className:"more-btn",onClick:function(){return T(!w)}},r.a.createElement("a",null,w?"收起更多":"展开更多"," ",r.a.createElement(Fa.a,{style:{transform:"rotate(".concat(w?"270":"90","deg)")}}))):r.a.createElement(r.a.Fragment,null)))},Aa=ia.a.Group,Va=oa.a.Option,Ka=function(e){return r.a.createElement("div",{className:"empty-page"},r.a.createElement("div",{className:"title"},"Kafka 多集群管理"),r.a.createElement("div",{className:"img"},r.a.createElement("div",{className:"img-card-1"}),r.a.createElement("div",{className:"img-card-2"}),r.a.createElement("div",{className:"img-card-3"})),r.a.createElement("div",null,r.a.createElement(Ht.a,{className:"header-filter-top-button",type:"primary",onClick:function(){return e.setVisible(!0)}},r.a.createElement("span",null,r.a.createElement(h.a,{type:"icon-jiahao"}),r.a.createElement("span",{className:"text"},"接入集群")))))},_a=function(){return r.a.createElement("div",{style:{height:"100%",display:"flex",justifyContent:"center",alignItems:"center"}},r.a.createElement(Q.a,{spinning:!0}))},Ua=function(){var e=g.a.useGlobalValue(),t=l()(e,1)[0],a=Object(n.useState)(!0),i=l()(a,2),o=i[0],c=i[1],s=r.a.useState(!1),u=l()(s,2),d=u[0],f=u[1],p=Object(n.useState)({}),v=l()(p,2),b=v[0],E=v[1],y=r.a.useState([]),k=l()(y,2),N=k[0],O=k[1],C=r.a.useState([]),S=l()(C,2),x=S[0],j=S[1],I=r.a.useState({downCount:0,liveCount:0,total:0}),w=l()(I,2),T=w[0],P=w[1],L=r.a.useState(),M=l()(L,2),z=M[0],D=M[1],R=r.a.useState({value:[0,5],desc:""}),F=l()(R,2),B=F[0],A=F[1],_=r.a.useState({keywords:"",checkedKafkaVersions:[],sortInfo:{sortField:"HealthState",sortType:"asc"},clusterStatus:[0,1],healthState:[-1,0,1,2,3],isReloadAll:!1}),U=l()(_,2),G=U[0],q=U[1],J=Object(n.useRef)(""),Z=Object(n.useRef)(!1),Q=function(){m.a.request(K.phyClusterHealthState).then((function(e){D(e||void 0);for(var t=[],a=0;a<B.value[1]-B.value[0];a++){var n=tt[B.value[1]-a];t.push("".concat(n.name,": ").concat(null==e?void 0:e[n.key]))}A((function(e){return Object.assign(Object.assign({},e),{desc:t.reverse().join(", ")})}))}))},$=function(){Q(),m.a.request(K.phyClusterState).then((function(e){P(e)})).finally((function(){c(!1)}))},X=function(e){q((function(t){return Object.assign(Object.assign(Object.assign({},t),{isReloadAll:!1}),e)})),Q()},ee={onSilderChange:function(e){return X({healthState:e})},onSortInfoChange:function(e,t){return X({sortInfo:Object.assign(Object.assign({},G.sortInfo),H()({},e,t))})},onClusterStatusChange:function(e){return X({clusterStatus:e})},onInputChange:function(){return X({keywords:J.current})},onChangeCheckGroup:function(e){X({checkedKafkaVersions:e,isReloadAll:Z.current}),Z.current=!1}},te=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];Z.current=e,m.a.request(K.getClustersVersion).then((function(e){Array.isArray(e)||(e=[]),j(e.sort().reverse()||[])}))},ae=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};E(e),f(!0)};return Object(n.useEffect)((function(){$(),m.a.request(K.supportKafkaVersion).then((function(e){O(Object.keys(e||{}))})),te()}),[]),r.a.createElement(r.a.Fragment,null,o?r.a.createElement(_a,null):(null==T?void 0:T.total)?r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"multi-cluster-page",id:"scrollableDiv"},r.a.createElement("div",{className:"multi-cluster-page-fixed"},r.a.createElement("div",{className:"content-container"},r.a.createElement("div",{className:"multi-cluster-header"},r.a.createElement("div",{className:"cluster-header-card"},r.a.createElement("div",{className:"cluster-header-card-bg-left"}),r.a.createElement("div",{className:"cluster-header-card-bg-right"}),r.a.createElement("h5",{className:"header-card-title"},"Clusters",r.a.createElement("span",{className:"chinese-text"}," 总数")),r.a.createElement("div",{className:"header-card-total"},T.total),r.a.createElement("div",{className:"header-card-info"},r.a.createElement("div",{className:"card-info-item card-info-item-live"},r.a.createElement("div",null,"live",r.a.createElement("span",{className:"info-item-value"},r.a.createElement("em",null,T.liveCount)))),r.a.createElement("div",{className:"card-info-item card-info-item-down"},r.a.createElement("div",null,"down",r.a.createElement("span",{className:"info-item-value"},r.a.createElement("em",null,T.downCount)))))),r.a.createElement("div",{className:"cluster-header-filter"},r.a.createElement("div",{className:"header-filter-top"},r.a.createElement("div",{className:"header-filter-top-input"},r.a.createElement(W.a,{onPressEnter:ee.onInputChange,onChange:function(e){return J.current=e.target.value},allowClear:!0,bordered:!1,placeholder:"请输入ClusterName进行搜索",suffix:r.a.createElement(h.a,{className:"icon",type:"icon-fangdajing",onClick:ee.onInputChange})})),t.hasPermission&&t.hasPermission(V.CLUSTER_ADD)?r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"header-filter-top-divider"}),r.a.createElement(Ht.a,{className:"header-filter-top-button",type:"primary",onClick:function(){return ae()}},r.a.createElement(h.a,{type:"icon-jiahao"}),r.a.createElement("span",{className:"text"},"接入集群"))):r.a.createElement(r.a.Fragment,null)),r.a.createElement("div",{className:"header-filter-bottom"},r.a.createElement("div",{className:"header-filter-bottom-item header-filter-bottom-item-checkbox"},r.a.createElement("h3",{className:"header-filter-bottom-item-title"},"版本分布"),r.a.createElement("div",{className:"header-filter-bottom-item-content flex"},x.length?r.a.createElement(Ha,{kafkaVersions:x,onChangeCheckGroup:ee.onChangeCheckGroup}):null)),r.a.createElement("div",{className:"header-filter-bottom-item header-filter-bottom-item-slider"},r.a.createElement("h3",{className:"header-filter-bottom-item-title title-right"},"健康状态"),r.a.createElement(Y.a,{title:B.desc,overlayClassName:"cluster-health-state-tooltip"},r.a.createElement("div",{className:"header-filter-bottom-item-content",id:"clusters-slider"},r.a.createElement(ca.a,{dots:!0,range:{draggableTrack:!0},step:1,max:5,marks:at,value:B.value,tooltipVisible:!1,onChange:function(e){if(e[0]!==e[1]){for(var t=[],a=0;a<e[1]-e[0];a++){var n=tt[e[1]-a];t.push("".concat(n.name,": ").concat(null==z?void 0:z[n.key]))}A({value:e,desc:t.reverse().join(", ")})}},onAfterChange:function(e){for(var t=[],a=0;a<e[1]-e[0];a++){var n=tt[e[1]-a];t.push(n.code)}ee.onSilderChange(t)}}))))))),r.a.createElement("div",{className:"multi-cluster-filter"},r.a.createElement("div",{className:"multi-cluster-filter-select"},r.a.createElement(oa.a,{onChange:function(e){return ee.onSortInfoChange("sortField",e)},defaultValue:"HealthState",style:{width:170,marginRight:12}},Qe.map((function(e){return r.a.createElement(Va,{key:e.value,value:e.value},e.label)}))),r.a.createElement(oa.a,{onChange:function(e){return ee.onSortInfoChange("sortType",e)},defaultValue:"asc",style:{width:170}},$e.map((function(e){return r.a.createElement(Va,{key:e.value,value:e.value},e.label)})))),r.a.createElement("div",{className:"multi-cluster-filter-checkbox"},r.a.createElement(Aa,{options:Ye,value:G.clusterStatus,onChange:ee.onClusterStatusChange}))),r.a.createElement(Ra,null))),r.a.createElement("div",{className:"multi-cluster-page-dashboard"},r.a.createElement(Ot,{searchParams:G,showAccessCluster:ae,getPhyClusterState:$,getExistKafkaVersion:te}))),r.a.createElement(pa,{guide:ua,run:!0})):r.a.createElement(Ka,{setVisible:f}),r.a.createElement(za,{clusterInfo:b,kafkaVersion:N,visible:d,setVisible:f,afterSubmitSuccess:function(){$(),te(!0)}}))};!function(e){e.BROKER_DETAIL_CONFIG="FEBrokersSpecifiedBrokerConfigList",e.BROKER_DETAIL_DATALOGS="FEBrokersSpecifiedBrokerDataLogsList",e.TESTING_PRODUCER_HEADER="FETestingProducerHeader",e.TESTING_PRODUCER_COMPRESSION_TYPE_ZSTD="FETestingProducerCompressionTypeZSTD",e.TESTING_CONSUMER_HEADER="FETestingConsumerHeader",e.CREATE_TOPIC_CLEANUP_POLICY="FECreateTopicCleanupPolicy"}(ja||(ja={}));var Ga,qa,Ja=function(e){var t=g.a.useGlobalValue(),a=l()(t,2),i=(a[0],a[1]),o=Object(s.useParams)().clusterId,c=Object(s.useHistory)();g.a.context.Consumer;Object(n.useEffect)((function(){u(),d()}),[]);var u=function(){m.a.request(K.getPhyClusterBasic(+o),{init:{errorNoTips:!0},retryTimes:2}).then((function(e){e?i((function(t){return Object.assign(Object.assign({},t),{clusterInfo:e})})):c.replace("/")})).catch((function(e){c.replace("/")}))},d=function(){m.a.request(K.getSupportKafkaVersions(o,j.Controls),{retryTimes:2,init:{errorNoTips:!0}}).then((function(e){var t=function(t){var a=t&&e.find((function(e){return e.name===t}));return!!a&&a.support};i((function(a){return Object.assign(Object.assign({},a),{controlsStatus:e,isShowControl:t})}))}))};return r.a.createElement(r.a.Fragment,null,r.a.createElement(U,null))},Wa=a(943),Za=a(130),Ya=a(939),Qa=function(e){var t=window.getComputedStyle(e);return[t.marginLeft,t.marginRight].reduce((function(e,t){return e+Number(t.slice(0,-2))}),0)},$a=function(e){var t=e.list,a=void 0===t?[]:t,i=e.expandTagContent,o=e.placement,c=void 0===o?"bottomRight":o;a.sort();var s=Object(n.useRef)(null),u=Object(n.useState)({list:a,isHideExpandNode:!0,endI:-1,calculated:!1}),m=l()(u,2),d=m[0],f=m[1],p=Object(n.useState)(a),v=l()(p,2),g=v[0],h=v[1];return Object(n.useEffect)((function(){setTimeout((function(){return function(){var e=s.current;if(e){var t=e.offsetWidth,a=Array.from(s.current.children),n=a.length,r=n>1?a[n-2]:null;if((r?r.offsetLeft+r.offsetWidth-e.offsetLeft:0)>t){var i=a[n-1],o=Qa(r),c=i.offsetWidth+Qa(i);a.some((function(e,a){var n=e.offsetWidth+o;return c+n<t?(c+=n,!1):(f({list:g,isHideExpandNode:!1,endI:a,calculated:!0}),!0)}))}else f({list:g,isHideExpandNode:!0,endI:-1,calculated:!0})}}()}))}),[g]),Object(n.useEffect)((function(){(a.length!==g.length||g.some((function(e,t){return e!==a[t]})))&&(h(a),f({list:a,isHideExpandNode:!0,endI:-1,calculated:!1}))}),[a]),r.a.createElement("div",{className:"list-with-hide-container",ref:s},d.list.map((function(e,t){return r.a.createElement("div",{key:t,className:"container-item ".concat(d.calculated?d.isHideExpandNode?"show":t>=d.endI?"hide":"show":"")},e)})),r.a.createElement(Ya.a,{placement:c,overlayClassName:"tags-with-hide-popover",content:d.list.length?r.a.createElement("div",{className:"container-item-popover"},d.list.map((function(e){return r.a.createElement("div",{key:e,className:"container-item"},e)}))):r.a.createElement(r.a.Fragment,null)},r.a.createElement("div",{className:"expand-item ".concat(d.calculated?d.isHideExpandNode?"hide":"show":"")},"string"==typeof i?i:i(d.list.length),r.a.createElement(Za.a,null))))},Xa=a(216),en=a.n(Xa),tn=function(e,t,a,n){return new(a||(a=Promise))((function(r,i){function o(e){try{l(n.next(e))}catch(e){i(e)}}function c(e){try{l(n.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,c)}l((n=n.apply(e,t||[])).next())}))},an={1:{label:"Broker",href:"/broker"},2:{label:"Topic",href:"/topic"},3:{label:"ConsumerGroup",href:"/consumers"},4:{label:"Zookeeper",href:"/zookeeper"},5:{label:"Connect",href:"/connect"},6:{label:"Connector",href:"/connect/connectors"},7:{label:"MirrorMaker",href:"/replication"}},nn={Controller:function(){return"集群 Controller 数等于 1"},RequestQueueSize:function(e){return"Broker-RequestQueueSize 小于 ".concat(null==e?void 0:e.value)},NoLeader:function(e){return"Topic 无 Leader 数小于 ".concat(null==e?void 0:e.value)},NetworkProcessorAvgIdlePercent:function(e){return"Broker-NetworkProcessorAvgIdlePercent 的 idle 大于 ".concat(100*(null==e?void 0:e.value),"%")},UnderReplicaTooLong:function(e){return"Topic 小于 ".concat(parseFloat(((null==e?void 0:e.detectedTimes)/(null==e?void 0:e.latestMinutes)*100).toFixed(2)),"% 周期处于未同步状态")},"Group Re-Balance":function(e){return"Consumer Group 小于 ".concat(parseFloat(((null==e?void 0:e.detectedTimes)/(null==e?void 0:e.latestMinutes)*100).toFixed(2)),"% 周期处于 Re-balance 状态")},BrainSplit:function(){return"Zookeeper 未脑裂"},OutstandingRequests:function(e){return"Zookeeper 请求堆积数小于 ".concat(100*(null==e?void 0:e.ratio),"% 总容量")},WatchCount:function(e){return"Zookeeper 订阅数小于 ".concat(100*(null==e?void 0:e.ratio),"% 总容量")},AliveConnections:function(e){return"Zookeeper 连接数小于 ".concat(100*(null==e?void 0:e.ratio),"% 总容量")},ApproximateDataSize:function(e){return"Zookeeper 数据大小小于 ".concat(100*(null==e?void 0:e.ratio),"% 总容量")},SentRate:function(e){return"Zookeeper 首发包数小于 ".concat(100*(null==e?void 0:e.ratio),"% 总容量")},TaskStartupFailurePercentage:function(e){return"任务启动失败概率 小于 ".concat(100*(null==e?void 0:e.value),"%")},ConnectorFailedTaskCount:function(e){return"失败状态的任务数量 小于 ".concat(null==e?void 0:e.value)},ConnectorUnassignedTaskCount:function(e){return"未被分配的任务数量 小于 ".concat(null==e?void 0:e.value)},MirrorMakerFailedTaskCount:function(e){return"失败状态的任务数量 小于 ".concat(null==e?void 0:e.value)},MirrorMakerUnassignedTaskCount:function(e){return"未被分配的任务数量 小于 ".concat(null==e?void 0:e.value)},ReplicationLatencyMsMax:function(e){return"消息复制最大延迟时间 小于 ".concat(null==e?void 0:e.value)},"TotalRecord-errors":function(e){return"消息处理错误的次数 增量小于 ".concat(null==e?void 0:e.value)}},rn=function(e,t){var a;return null===(a=nn[e])||void 0===a?void 0:a.call(nn,t)},on=function(e){var t=e.validator,a=e.configItem,n=e.percent,i=e.type,o=void 0===i?"value":i,c=e.attrs,l=void 0===c?{min:0}:c;return r.a.createElement(J.a.Item,{name:"".concat(o,"_").concat(a),label:"",rules:t?[{required:!0,validator:t}]:[{required:!0,message:"请输入"}]},n?r.a.createElement(Ft.a,{size:"small",min:0,max:1,style:{width:86},formatter:function(e){return"".concat(100*e,"%")},parser:function(e){return parseFloat(e.replace("%",""))/100}}):r.a.createElement(Ft.a,Object.assign({style:{width:86},size:"small"},l)))},cn=function(e,t){return r.a.createElement(r.a.Fragment,null,(null==e?void 0:e.length)>t?r.a.createElement(r.a.Fragment,null,r.a.createElement(Y.a,{placement:"topLeft",title:e},null!=e?e:"-")):null!=e?e:"-")},ln=function(e){return[{title:"检查模块",dataIndex:"dimension",render:function(t,a){var n;return an[t]?r.a.createElement(s.Link,{to:"/".concat(Ct,"/").concat(e).concat(null===(n=an[t])||void 0===n?void 0:n.href)},null==a?void 0:a.dimensionDisplayName):null==a?void 0:a.dimensionDisplayName}},{title:"检查项",dataIndex:"checkConfig",render:function(e,t){var a={};try{a=JSON.parse(e.value)}catch(e){}return rn(t.configItem,a)||t.configDesc||"-"}},{title:"检查时间",width:190,dataIndex:"updateTime",render:function(e){return e?ce()(e).format(de):"-"}},{title:"检查结果",dataIndex:"passed",width:280,render:function(e,t){return(null==t?void 0:t.updateTime)?e?r.a.createElement(r.a.Fragment,null,r.a.createElement(h.a,{type:"icon-zhengchang"}),r.a.createElement("span",{style:{marginLeft:4}},"通过")):r.a.createElement("div",{style:{display:"flex",alignItems:"center",width:"240px"}},r.a.createElement(h.a,{type:"icon-yichang"}),r.a.createElement("div",{style:{marginLeft:4,marginRight:6,flexShrink:0}},"未通过"),r.a.createElement($a,{list:t.notPassedResNameList||[],expandTagContent:"更多"})):"-"}}]},sn=function(e,t,a){return[{title:"检查模块",dataIndex:"dimensionCode",width:140,render:function(e,t){var n;return an[e]?r.a.createElement(s.Link,{to:"/".concat(Ct,"/").concat(a).concat(null===(n=an[e])||void 0===n?void 0:n.href)},null==t?void 0:t.dimensionDisplayName):null==t?void 0:t.dimensionDisplayName}},{title:"检查项",dataIndex:"configItem",width:230,needTooltip:!0},{title:"检查项描述",dataIndex:"configDesc",width:310,needToolTip:!0},{title:"检查规则",dataIndex:"passed",render:function(t,a){var n=a.configItem;switch(n){case"Controller":return r.a.createElement("div",{className:"table-form-item"},"≠ 1 则不通过");case"BrainSplit":return r.a.createElement("div",{className:"table-form-item"},"脑裂则不通过");case"RequestQueueSize":case"NoLeader":return r.a.createElement("div",{className:"table-form-item"},r.a.createElement("span",{className:"left-text"},"≥"),on({configItem:n,attrs:{min:0,max:99998}}),r.a.createElement("span",{className:"right-text"},"则不通过"));case"SentRate":case"WatchCount":case"AliveConnections":case"ApproximateDataSize":case"OutstandingRequests":return r.a.createElement("div",{className:"table-form-item"},r.a.createElement("span",{className:"left-text"},"总容量指标"),on({configItem:n,type:"amount"}),r.a.createElement("span",{className:"left-text"},", ≥"),on({configItem:n,type:"ratio",percent:!0}),r.a.createElement("span",{className:"right-text"},"则不通过"));case"NetworkProcessorAvgIdlePercent":return r.a.createElement("div",{className:"table-form-item"},r.a.createElement("span",{className:"left-text"},"≤"),on({configItem:n,percent:!0}),r.a.createElement("span",{className:"right-text"},"则不通过"));case"UnderReplicaTooLong":case"Group Re-Balance":return r.a.createElement("div",{className:"table-form-item"},on({type:"latestMinutes",configItem:n,attrs:{min:1,max:10080}}),r.a.createElement("span",{className:"right-text left-text"},"周期内，≥"),on({type:"detectedTimes",configItem:n,attrs:{min:1,max:10080},validator:function(t,a){return tn(void 0,void 0,void 0,q.a.mark((function t(){var r;return q.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=e.getFieldValue("latestMinutes_".concat(n)),a){t.next=3;break}return t.abrupt("return",Promise.reject("请输入"));case 3:if(!(+a<1)){t.next=5;break}return t.abrupt("return",Promise.reject("最小为1"));case 5:if(!(+a>+r)){t.next=7;break}return t.abrupt("return",Promise.reject("值不能大于周期"));case 7:return t.abrupt("return",Promise.resolve(""));case 8:case"end":return t.stop()}}),t)})))}}),r.a.createElement("span",{className:"right-text"},"则不通过"));case"TaskStartupFailurePercentage":return r.a.createElement("div",{className:"table-form-item"},r.a.createElement("span",{className:"left-text"},">"),on({configItem:n,percent:!0}),r.a.createElement("span",{className:"right-text"},"则不通过"));case"ConnectorFailedTaskCount":case"ConnectorUnassignedTaskCount":case"MirrorMakerFailedTaskCount":case"MirrorMakerUnassignedTaskCount":case"ReplicationLatencyMsMax":case"TotalRecord-errors":return r.a.createElement("div",{className:"table-form-item"},r.a.createElement("span",{className:"left-text"},">"),on({configItem:n,attrs:{min:0,max:99998}}),r.a.createElement("span",{className:"right-text"},"则不通过"));default:return r.a.createElement(r.a.Fragment,null)}}}]},un=function(e,t){return"function"==typeof e?e(t):e},mn={brokers:{code:1,fieldName:"brokerId",alias:"Brokers"},broker:{code:1,fieldName:"brokerId",alias:"Broker"},topics:{code:2,fieldName:"topicName",alias:"Topics"},topic:{code:2,fieldName:"topicName",alias:"Topic"},group:{code:3,fieldName:"groupName",alias:"Consumers"},zookeeper:{code:4,fieldName:"zookeeperId",alias:"Zookeeper"},connect:{code:5,fieldName:"connectClusterId",alias:"Connect"},connector:{code:6,fieldName:"connectorName",alias:"Connector"},mm2:{code:7,fieldName:"connectorName",alias:"MM2"}},dn=function(e){var t=e.cardColumnsItemData,a=e.showCardBg,i=Object(n.useState)(!1),o=l()(i,2),c=o[0],s=o[1];return r.a.createElement("div",{onMouseEnter:function(){return s(!0)},onMouseLeave:function(){return s(!1)},className:"card-bar-colunms ".concat(t.className),style:Object.assign({backgroundColor:a?"rgba(86, 110, 230,0.04)":"transparent"},null==t?void 0:t.customStyle)},r.a.createElement("div",{className:"card-bar-colunms-header"},r.a.createElement("span",null,t.icon),r.a.createElement("span",null,un(t.title))),r.a.createElement("div",{className:"card-bar-colunms-body ".concat(null==t?void 0:t.valueClassName)},r.a.createElement("div",{style:{marginRight:12},className:"num"},"-"===t.value?r.a.createElement("div",{style:{fontSize:20}},"-"):void 0!==un(t.value)?un(t.value,c):r.a.createElement("div",{style:{fontSize:20}},"-"))))},fn=function(e){var t=Object(s.useParams)(),a=e.healthData,i=e.cardColumns,o=e.showCardBg,c=void 0===o||o,u=e.scene,d=e.record,f=e.loading,p=e.needProgress,v=void 0===p||p,g=Object(n.useState)(!1),b=l()(g,2),E=b[0],y=b[1],k=Object(n.useState)([]),N=l()(k,2),O=N[0],C=N[1];Object(n.useEffect)((function(){var e=mn[u],a=d?K.getResourceHealthDetail(Number("connector"===u||"mm2"===u?null==d?void 0:d.connectClusterId:t.clusterId),e.code,d[e.fieldName]):K.getResourceListHealthDetail(Number(t.clusterId));(d?m.a.request(a):m.a.request(a,{method:"POST",data:"connect"===u?JSON.parse(JSON.stringify([5,6])):JSON.parse(JSON.stringify([e.code]))})).then((function(e){C(e)}))}),[]);var S=[{title:"检查项",dataIndex:"checkConfig",width:"40%",render:function(e,t){var a={};try{a=JSON.parse(e.value)}catch(e){}return rn(t.configItem,a)||rn(e.configItem,a)||t.configDesc||"-"}},{title:"检查时间",dataIndex:"updateTime",width:"30%",render:function(e){return e?ce()(e).format("YYYY-MM-DD HH:mm:ss"):"-"}},{title:"检查结果",dataIndex:"passed",width:"30%",render:function(e,t){if(null==t?void 0:t.updateTime){var a=e?r.a.createElement(h.a,{type:"icon-zhengchang"}):r.a.createElement(h.a,{type:"icon-yichang"}),n=e?"已通过":"未通过",i=t.notPassedResNameList||[];return r.a.createElement("div",{style:{display:"flex",width:240}},r.a.createElement("div",{style:{marginRight:6}},a," ",n),r.a.createElement($a,{list:i,expandTagContent:"更多"}))}return"-"}}];return r.a.createElement(Q.a,{spinning:f},r.a.createElement("div",{className:"card-bar-container"},r.a.createElement("div",{className:"card-bar-content"},a&&v&&r.a.createElement("div",{className:"card-bar-health"},r.a.createElement("div",{className:"card-bar-health-process"},r.a.createElement(qe,{state:null==a?void 0:a.state,width:74,height:74})),r.a.createElement("div",null,r.a.createElement("div",{className:"state"},Ue(null==a?void 0:a.state)," ",mn[u].alias,Ge(null==a?void 0:a.state)),r.a.createElement("div",{className:"value-bar"},r.a.createElement("div",{className:"value"},"".concat(null==a?void 0:a.passed,"/").concat(null==a?void 0:a.total)),r.a.createElement("div",{className:"check-detail",onClick:function(e){return y(!0)}},"查看详情")))),i&&0!=(null==i?void 0:i.length)&&(null==i?void 0:i.map((function(e,t){return r.a.createElement(dn,{key:t,cardColumnsItemData:e,showCardBg:c})}))))),r.a.createElement(ya.a,{className:"health-check-res-drawer",maskClosable:!1,title:"".concat(mn[u].alias,"健康状态详情"),placement:"right",width:1080,onClose:function(e){return y(!1)},visible:E},r.a.createElement(Wa.a,{rowKey:"configName",columns:S,dataSource:O,pagination:!1})))},pn=a(509),vn=a(521),gn=function(){var e=Object(s.useParams)(),t=Object(n.useState)(!1),a=l()(t,2),i=a[0],o=a[1],c=Object(n.useState)([]),u=l()(c,2),d=u[0],f=u[1],p=Object(n.useState)({state:ne.UNKNOWN,passed:0,total:0}),v=l()(p,2),g=v[0],h=v[1],b=["HealthCheckPassed_Brokers","HealthCheckTotal_Brokers","HealthState"];return Object(n.useEffect)((function(){o(!0);var t=m.a.post(K.getBrokerMetricPoints(Number(e.clusterId)),b).then((function(e){var t,a,n;h({state:null===(t=null==e?void 0:e.metrics)||void 0===t?void 0:t.HealthState,passed:(null===(a=null==e?void 0:e.metrics)||void 0===a?void 0:a.HealthCheckPassed_Brokers)||0,total:(null===(n=null==e?void 0:e.metrics)||void 0===n?void 0:n.HealthCheckTotal_Brokers)||0})})),a=m.a.request(K.getBrokersState(null==e?void 0:e.clusterId)).then((function(e){var t=JSON.parse(JSON.stringify(e));f([{title:"Brokers",value:function(){var e;return r.a.createElement("div",{style:{width:"100%",display:"flex",alignItems:"end"}},r.a.createElement("span",null,null==t?void 0:t.brokerCount),r.a.createElement("span",{style:{display:"flex",fontSize:"13px"}},null===(e=null==t?void 0:t.brokerVersionList)||void 0===e?void 0:e.map((function(e,t){return r.a.createElement(pn.a,{style:{padding:"2px 5px",marginLeft:"8px",backgroundColor:"#ECECF6",fontFamily:"Helvetica Neue, PingFangSC"},key:t},e)}))))}},{title:"Controller",value:function(){return(null==t?void 0:t.kafkaController)&&(null==t?void 0:t.kafkaControllerAlive)?r.a.createElement("div",{style:{width:"100%",display:"flex",alignItems:"end"}},r.a.createElement("span",null,null==t?void 0:t.kafkaController.brokerId),r.a.createElement("span",{style:{display:"flex",fontSize:"13px"}},r.a.createElement(pn.a,{style:{padding:"2px 5px",marginLeft:"8px",backgroundColor:"#ECECF6",fontFamily:"Helvetica Neue, PingFang SC"}},null==t?void 0:t.kafkaController.brokerHost))):r.a.createElement("span",{style:{fontFamily:"Helvetica Neue"}},"None")}},{title:function(){return r.a.createElement("div",null,r.a.createElement("span",{style:{display:"inline-block",marginRight:"8px"}},"Similar Config"),r.a.createElement(Y.a,{overlayClassName:"rebalance-tooltip",title:"所有Broker配置是否一致"},r.a.createElement(vn.a,null)))},value:function(){return r.a.createElement(r.a.Fragment,null,r.a.createElement("span",{style:{fontFamily:"Helvetica Neue",fontSize:36,color:(null==t?void 0:t.configSimilar)?"":"#F58342"}},(null==t?void 0:t.configSimilar)?"YES":"NO"))}}])}));Promise.all([t,a]).finally((function(){o(!1)}))}),[e.clusterId]),r.a.createElement(fn,{scene:"brokers",healthData:g,cardColumns:d,loading:i})},hn=a(933),bn=a(960),En=[{label:"Top 5",value:5},{label:"Top 10",value:10},{label:"Top 15",value:15}],yn=function(e){var t=e.name,a=e.onChange,i=e.children,o=Object(n.useState)(5),c=l()(o,2),s=c[0],u=c[1],m=Object(n.useState)(!0),d=l()(m,2),f=d[0],p=d[1],v=Object(n.useState)(En),g=l()(v,1)[0],b=Object(n.useState)(null),E=l()(b,2),y=E[0],k=E[1],N=Object(n.useState)(!1),O=l()(N,2),C=O[0],S=O[1];Object(n.useEffect)((function(){if(s){var e=g.find((function(e){return e.value===s}));k(null==e?void 0:e.label),S(!1)}}),[s]);var x=function(e){S(e)},j=r.a.createElement("div",{className:"dd-node-scope-module"},r.a.createElement("div",{className:"flx_con"},r.a.createElement("div",{className:"flx_l"},r.a.createElement("h6",{className:"time_title"},"选择 top 范围"),r.a.createElement(ba.a.Group,{optionType:"button",buttonStyle:"solid",className:"topNum-radio-group",onChange:function(e){var t=e.target.value;u(t),a(t,!0),p(!0)},value:s},r.a.createElement(la.b,{direction:"vertical",size:16},g.map((function(e,t){return r.a.createElement(ba.a,{value:e.value,key:t},e.label)}))))),r.a.createElement("div",{className:"flx_r"},i?r.a.Children.map(i,(function(e){return r.a.cloneElement(e,{isTop:f,visibleChange:x,onChange:function(e,t){a(e,!1),p(!1),u(null),k(t),S(!1)}})})):r.a.createElement(r.a.Fragment,null))));return r.a.createElement("div",{id:"d-node-scope"},r.a.createElement("div",{className:"scope-title"},t,"筛选："),r.a.createElement(Ya.a,{trigger:["click"],visible:C,content:j,placement:"bottomRight",overlayClassName:"d-node-scope-popover large-size",onVisibleChange:x},r.a.createElement("span",{className:"input-span"},r.a.createElement(W.a,{className:f?"relativeTime d-node-scope-input":"absoluteTime d-node-scope-input",value:y,readOnly:!0,suffix:r.a.createElement(h.a,{type:"icon-jiantou1",rotate:90,style:{color:"#74788D"}})}))))},kn=[{label:"3列",value:8},{label:"2列",value:12},{label:"1列",value:24}],Nn=function(e){var t=e.nodeSelect,a=void 0===t?{}:t,i=e.hideNodeScope,o=void 0!==i&&i,c=e.hideGridSelect,s=void 0!==c&&c,u=e.onChange,m=e.openMetricFilter,d=Object(n.useState)(kn[1].value),f=l()(d,2),p=f[0],v=f[1],g=Object(n.useState)((function(){var e=ce()().valueOf();return[e-36e5,e]})),b=l()(g,2),E=b[0],y=b[1],k=Object(n.useState)(!0),N=l()(k,2),O=N[0],C=N[1],S=Object(n.useState)(!1),x=l()(S,2),j=x[0],I=x[1],w=Object(n.useState)({isTop:!0,data:5}),T=l()(w,2),P=T[0],L=T[1],M=function(){if(O){var e=E[1]-E[0]||0,t=ce()().valueOf();y([t-e,t])}else y(ue()(E))};return Object(n.useEffect)((function(){u({rangeTime:E,scopeData:P,gridNum:p,isRelativeRangeTime:O,isAutoReload:j}),I(!1)}),[E,P,p,O]),Object(n.useEffect)((function(){var e;return O&&(e=window.setInterval((function(){I(!0),M()}),6e4)),function(){e&&window.clearInterval(e)}}),[O,E]),r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"ks-chart-container"},r.a.createElement("div",{className:"ks-chart-container-header"},r.a.createElement("div",{className:"header-left"},r.a.createElement("div",{className:"icon-box",onClick:M},r.a.createElement(h.a,{className:"icon",type:"icon-shuaxin1"})),r.a.createElement($.a,{type:"vertical",style:{height:20,top:0}}),r.a.createElement(bn.a,{timeChange:function(e,t){y(ue()(e)),C(t)},rangeTimeArr:E})),r.a.createElement("div",{className:"header-right"},!o&&r.a.createElement(yn,{name:a.name||"",onChange:function(e,t){L({isTop:t,data:e})}},a.customContent),!s&&r.a.createElement(oa.a,{className:"grid-select",style:{width:70},value:p,options:kn,onChange:function(e){return v(e)}}),(!o||!s)&&r.a.createElement($.a,{type:"vertical",style:{height:20,top:0}}),r.a.createElement(Ht.a,{type:"primary",onClick:function(){return m()}},"指标筛选")))))},On=(Ga={},H()(Ga,j.Broker,(function(e){return K.getDashboardMetricChartData(e,j.Broker)})),H()(Ga,j.Topic,(function(e){return K.getDashboardMetricChartData(e,j.Topic)})),H()(Ga,j.Zookeeper,(function(e){return K.getZookeeperMetrics(e)})),H()(Ga,j.MM2,(function(e){return K.getMirrorMakerMetrics(e)})),Ga),Cn=function(e){var t=it.length;return e.map((function(e,a){return Object.assign(Object.assign({},e),{z:t-a,lineStyle:{width:1.5},connectNulls:!1,symbol:"emptyCircle",symbolSize:4,smooth:.25,color:it[a%t],areaStyle:{color:{type:"linear",x:0,y:0,x2:0,y2:1,colorStops:[{offset:0,color:it[a%t]+"10"},{offset:1,color:"rgba(255,255,255,0)"}],global:!1}}})}))},Sn=function(e){var t=e.height,a=void 0===t?200:t,n=e.message;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"empty-panel",style:{height:a}},r.a.createElement("div",{className:"img"}),r.a.createElement("div",{className:"text"},n)))},xn=function(e){var t,a,i,o=g.a.useGlobalValue(),c=l()(o,1)[0],d=Object(s.useParams)().clusterId,f=e.metricType,p=e.metricName,v=e.queryLines,h=e.setSliderRange,b=e.setDisposeChartInstance,E=Object(n.useRef)(null),y=Object(n.useRef)((t=ce()().valueOf()-6e4,{chartInstance:void 0,isLoadingAdditionData:!1,isLoadedFullData:!1,fullTimeRange:a=[t-72e5,t],fullMetricData:{},curTimeRange:a,oldDataZoomOption:{},sliderPos:[0,0],transformUnit:void 0})),k=Object(n.useState)(!1),N=l()(k,2),O=N[0],C=N[1],S=Object(n.useState)(),x=l()(S,2),I=x[0],w=x[1],T=Object(n.useState)([]),P=l()(T,2),L=P[0],M=P[1],z=Object(n.useState)({}),D=l()(z,2),R=D[0],F=D[1],B=Object(n.useMemo)((function(){return[{title:f===j.Broker?"Host":"Topic",dataIndex:"name",width:200,render:function(e,t){return r.a.createElement("div",{style:{display:"flex",alignItems:"center"}},r.a.createElement("div",{style:{width:8,height:2,marginRight:4,background:t.color}}),r.a.createElement("span",null,e))}},{title:"Avg",dataIndex:"avg",width:120,render:function(e){return e.toFixed(2)}},{title:"Max",dataIndex:"max",width:120,render:function(e,t){return r.a.createElement("div",null,r.a.createElement("span",null,e.toFixed(2)))}},{title:"Min",dataIndex:"min",width:120,render:function(e,t){return r.a.createElement("div",null,r.a.createElement("span",null,e.toFixed(2)))}},{title:"Latest",dataIndex:"latest",width:120,render:function(e){return"".concat(e[1].toFixed(2))}}]}),[f]),A=function(e){y.current=Object.assign(Object.assign({},y.current),e)},V=function(e){var t,a=l()(e,2),n=a[0],r=a[1],i=(t={},H()(t,j.Broker,"brokerIds"),H()(t,j.Topic,"topics"),H()(t,j.Connect,"connectClusterIdList"),H()(t,j.Connectors,"connectorNameList"),H()(t,j.MM2,"connectorNameList"),t);return m.a.post(function(){switch(f){case j.MM2:return K.getMirrorMakerMetrics(d);case j.Connect:return K.getConnectClusterMetrics(d);default:return K.getDashboardMetricChartData(d,f)}}(),H()({startTime:n,endTime:r,metricsNames:[p],topNu:null},i[f],f===j.MM2?v.map((function(e){return"string"==typeof e?m.a.parseJSON(e):e})):v))},_=function(e,t){var a=y.current,n=l()(a.fullTimeRange,2),r=n[0],i=n[1],o=a.isLoadedFullData,c=Math.floor(e[0]),s=c<r+.4*(i-r),u=!1;(c>r||o)&&(A({curTimeRange:[c>r?c:r,e[1]],sliderPos:t}),q(),u=!0),!o&&s&&U(!u,c,e[1],t)},U=function(e,t,a,n){var r=y.current,i=l()(r.fullTimeRange,2),o=i[0],c=i[1],s=r.fullMetricData;if(r.isLoadingAdditionData)return!1;A({isLoadingAdditionData:!0});for(var u=o,m=[],d=[],f=function(r){setTimeout((function(){var i=u-216e5;m.push(V([i,u])),d.push([i,u]),u=i,5===r&&Promise.all(m).then((function(r){r.forEach((function(e,t){(null==e?void 0:e.length)?G(e,d[t]):t===r.length-1&&A({isLoadedFullData:!0})}));var i=Number(s.metricLines.map((function(e){var t,a;return null===(a=null===(t=null==e?void 0:e.data)||void 0===t?void 0:t[0])||void 0===a?void 0:a[0]})).sort()[0]);t<i&&(t=i),A(Object.assign(Object.assign({fullTimeRange:[u-216e5,c]},n?{sliderPos:n}:{}),{isLoadingAdditionData:!1})),e&&(A({curTimeRange:[t,a]}),q())}))}),10*r)},p=0;p<6;p++)f(p);return!0},G=function(e,t){var a=ft(e,c.getMetricDefine||{},f,t,y.current.transformUnit)[0].metricLines;Object.values(a).forEach((function(e){var t=y.current.fullMetricData.metricLines,a=t.find((function(t){var a=t.name;return e.name===a}));a?a.data=e.data.concat(a.data):t.push(e)}))},q=function(){var e=y.current,t=e.fullMetricData,a=e.curTimeRange,n=Object.assign({},t);n.metricLines=ue()(n.metricLines),n.metricLines.forEach((function(e,t){(e=Object.assign({},e)).data=ue()(e.data),e.data=e.data.filter((function(e){return a[0]<=e[0]&&e[0]<=a[1]})),n.metricLines[t]=e})),n.metricLines=n.metricLines.filter((function(e){return e.data.length})),w(n),F((function(e){var t=Object.assign({},e);return n.metricLines.map((function(e){return e.name})).forEach((function(e){void 0===t[e]&&(t[e]=!1)})),t}))},J=function(){var e=[],t=y.current,a=t.sliderPos,n=t.chartInstance.getOption().color;I.metricLines.forEach((function(t,r){var i=t.name,o=t.data,c={name:i,avg:-1,max:-1,min:Number.MAX_SAFE_INTEGER,latest:["0",-1],color:n[r%n.length]},l=o.filter((function(e){return a[0]<e[0]&&e[0]<a[1]}));if(!l.length)return!1;var s=l.reduce((function(e,t){var a=t[1];return a>c.max&&(c.max=a),a<c.min&&(c.min=a),e+=a}),0);return c.avg=s/l.length,c.latest=l[l.length-1],e.push(c),!0})),function(){var e=y.current.sliderPos,t=Number(((e[1]-e[0])/60/1e3).toFixed(2)),a=0,n=0;t>60&&(a=Math.floor(t/60),t=Number((t%60).toFixed(2))),a>24&&(n=Math.floor(a/24),a=Number((a%24).toFixed(2)));var r=" 当前选中范围: ".concat(n>0?"".concat(n," 天 "):"").concat(a>0?"".concat(a," 小时 "):"").concat(t," 分钟");h(r)}(),M(e)};return Object(n.useEffect)((function(){I&&(setTimeout((function(){y.current.oldDataZoomOption=y.current.chartInstance.getOption().dataZoom[0]})),J())}),[I]),Object(n.useEffect)((function(){Object.entries(R).map((function(e){var t=l()(e,2),a=t[0],n=t[1]?"legendSelect":"legendUnSelect";y.current.chartInstance.dispatchAction({type:n,name:a})}))}),[R]),Object(n.useEffect)((function(){if(f&&p){C(!0);var e=y.current.curTimeRange;V(e).then((function(t){if(null==t?void 0:t.length){var a=ft(t,c.getMetricDefine||{},f,e)[0],n=e,r=a.metricLines.find((function(e){return e.data.length})).data;r&&(n=[r[0][0],r[r.length-1][0]]),A({fullMetricData:a,fullTimeRange:ue()(n),curTimeRange:ue()(n),sliderPos:[n[1]-.25*(n[1]-n[0]),n[1]],transformUnit:a.targetUnit}),w(a);var i={};a.metricLines.forEach((function(e){i[e.name]=!0})),F(i),C(!1),U(!1,n[0],n[1])}}),(function(){return C(!1)}))}}),[]),E.current=Object(u.debounce)((function(e){var t=e.start,a=e.end;if(!t&&!a)return!1;var n=y.current,r=l()(n.fullTimeRange,2),i=r[0],o=r[1],c=l()(n.curTimeRange,2),s=c[0],u=c[1],m=n.oldDataZoomOption,d=n.isLoadedFullData,f=n.chartInstance,p=m.start,v=m.end,g=m.startValue,h=m.endValue,b=f.getOption().dataZoom[0],E=b.startValue,k=b.endValue,N=(v-p)/100,O=(a-t)/100,C=O/N;if(N.toFixed(3)===O.toFixed(3))return A({sliderPos:[E,k],oldDataZoomOption:b}),J(),!1;var S,x,j=g-s,I=u-h,w=j*C,T=I*C;if(C>1){var P=0;if((x=k+T)>o&&(P=x-o,x=o),S=E-w-P,d&&S<i&&x<o){var L=i-S;x+L>=o?x=o:x+=L,S=i}}else{var M=N-.25>.01,z=O-.25>.01;if(M&&z)return A({sliderPos:[E,k],oldDataZoomOption:b}),J(),!0;if(M&&!z){var D=(k-E)/.25*.75/(j|I);w=j*D,T=I*D}S=E-w,x=k+T}return _([S,x],[E,k]),!0}),300),r.a.createElement(Q.a,{spinning:O},r.a.createElement("div",{className:"chart-detail-modal-container"},I?r.a.createElement(r.a.Fragment,null,r.a.createElement(gt.a,Object.assign({chartTypeProp:"line",wrapStyle:{width:"auto",height:462},onEvents:{dataZoom:function(e){return null==E?void 0:E.current(e)}},showHeader:!1,propChartData:I.metricLines,optionMergeProps:{notMerge:!0},getChartInstance:function(e){b((function(){return function(){return e.dispose()}})),A({chartInstance:e})}},("".concat(I.metricName,"{unit|（").concat(I.metricUnit,"）}"),i=y.current.sliderPos,{option:vt({title:{show:!1},xAxis:{type:"time",boundaryGap:!1},legend:{show:!1},dataZoom:[{type:"inside",startValue:i[0],endValue:i[1],zoomOnMouseWheel:!1,minValueSpan:6e5},{start:0,end:0}]}),seriesCallback:Cn}))),r.a.createElement(Wa.a,{className:"detail-table",rowKey:"name",rowSelection:{preserveSelectedRowKeys:!0,selectedRowKeys:Object.entries(R).filter((function(e){return l()(e,2)[1]})).map((function(e){return l()(e,1)[0]})),selections:[Wa.a.SELECTION_INVERT,Wa.a.SELECTION_NONE],onChange:function(e){return function(e){var t=Object.assign({},R);Object.entries(t).forEach((function(a){var n=l()(a,2),r=n[0],i=n[1];e.includes(r)?!i&&(t[r]=!0):i&&(t[r]=!1)})),F(t)}(e)}},scroll:{x:"max-content",y:"calc(100vh - 582px)"},dataSource:L,columns:B,pagination:!1})):!O&&r.a.createElement(Sn,{message:"详情加载失败，请重试",height:400})))},jn=Object(n.forwardRef)((function(e,t){var a=g.a.useGlobalValue(),i=l()(a,1)[0],o=Object(n.useState)(!1),c=l()(o,2),s=c[0],u=c[1],m=Object(n.useState)([]),d=l()(m,2),f=d[0],p=d[1],v=Object(n.useState)(""),h=l()(v,2),b=h[0],E=h[1],y=Object(n.useState)((function(){return 0})),k=l()(y,2),N=k[0],O=k[1],C=Object(n.useState)({type:void 0,name:"",unit:"",desc:""}),S=l()(C,2),x=S[0],j=S[1],I=function(e,t,a){var n=i.getMetricDefine(e,t);j({type:e,name:t,unit:(null==n?void 0:n.unit)||"",desc:(null==n?void 0:n.desc)||""}),p(a),u(!0)};return Object(n.useImperativeHandle)(t,(function(){return{onOpen:I}})),r.a.createElement(ya.a,{className:"overview-chart-detail-drawer",width:1080,visible:s,title:r.a.createElement("div",{className:"detail-header"},r.a.createElement("div",{className:"title"},r.a.createElement(Y.a,{placement:"bottomLeft",title:x.desc},r.a.createElement("span",{style:{cursor:"pointer"}},r.a.createElement("span",null,x.name)," ",r.a.createElement("span",{className:"unit"},"(",x.unit,") ")))),r.a.createElement("div",{className:"slider-info"},b)),footer:null,closable:!0,maskClosable:!1,destroyOnClose:!0,onClose:function(){u(!1),E(""),N(),O((function(){return function(){return 0}})),j({type:void 0,name:"",unit:"",desc:""})}},x.type&&x.name&&r.a.createElement(xn,{metricType:x.type,metricName:x.name,queryLines:f,setSliderRange:E,setDisposeChartInstance:O}))})),In=a(946),wn=a(143),Tn=[{title:"指标名称",dataIndex:"name",key:"name"},{title:"单位",dataIndex:"unit",key:"unit"},{title:"描述",dataIndex:"desc",key:"desc"}],Pn=function(e){var t=e.metrics,a=e.category,n=e.selectedMetrics,i=e.selectedMetricChange;return r.a.createElement("div",null,r.a.createElement(In.a,{tableProps:{showHeader:!1,noPagination:!0,rowKey:"name",columns:Tn,dataSource:t,attrs:{rowSelection:{hideSelectAll:!0,selectedRowKeys:n,onChange:function(e){i(a,e)}}}}}))},Ln=Object(n.forwardRef)((function(e,t){var a=g.a.useGlobalValue(),i=l()(a,1)[0],o=Object(s.useLocation)().pathname,c=Object(n.useState)(!1),u=l()(c,2),m=u[0],d=u[1],f=Object(n.useState)([]),p=l()(f,2),v=p[0],b=p[1],E=Object(n.useState)([]),y=l()(E,2),k=y[0],N=y[1],O=Object(n.useState)({}),C=l()(O,2),S=C[0],x=C[1],j=Object(n.useState)(!1),I=l()(j,2),w=I[0],T=I[1],P=[{title:"".concat(o.endsWith("/broker")?"Broker":o.endsWith("/topic")?"Topic":o.endsWith("/replication")?"MM2":"Cluster"," Metrics"),dataIndex:"category",key:"category"}],L=function(e,t){if(x((function(a){return Object.assign(Object.assign({},a),H()({},e,t))})),0===t.length){var a=k.indexOf(e);if(-1!==a){var n=ue()(k);n.splice(a,1),N(n)}}else{v.find((function(t){return t.category===e})).metrics.length===t.length&&N([].concat(ue()(k),[e]))}},M={selectedRowKeys:k,onChange:function(e){e.sort();var t=k,a=[],n=[];e.forEach((function(e){return!t.includes(e)&&a.push(e)})),t.forEach((function(t){return!e.includes(t)&&n.push(t)}));var r={};a.forEach((function(e){var t=[];v.some((function(a){var n=a.category,r=a.metrics;return e===n&&(t=r.map((function(e){return e.name})),!0)})),r[e]=t})),n.forEach((function(e){r[e]=[]})),N(e),x((function(e){return Object.assign(Object.assign({},e),r)}))},getCheckboxProps:function(e){var t,a,n=e.metrics.length===(null===(t=S[e.category])||void 0===t?void 0:t.length);return{indeterminate:!(!S[e.category]||0===(null===(a=S[e.category])||void 0===a?void 0:a.length))&&!n}}};return Object(n.useEffect)((function(){var t=e.tableData,a={};t.forEach((function(t){var n=t.name,r=t.desc,o=i.getMetricDefine(null==e?void 0:e.metricType,n),c={name:n,desc:r,unit:null==o?void 0:o.unit};(null==o?void 0:o.category)&&(a[o.category]?a[o.category].push(c):a[o.category]=[c])}));var n=Object.entries(a).map((function(e){var t=l()(e,2);return{category:t[0],metrics:t[1].sort((function(e,t){return Number(e.name>t.name)-.5}))}}));b(n)}),[e.tableData]),Object(n.useEffect)((function(){w&&function(){var t=null==e?void 0:e.selectedRows,a={},n=[];null==t||t.forEach((function(t){var n=i.getMetricDefine(null==e?void 0:e.metricType,t);n&&(a[n.category]?a[n.category].push(t):a[n.category]=[t])})),Object.entries(a).forEach((function(e){var t=l()(e,2),a=t[0];t[1].length&&n.push(a)})),N(n),x((function(e){return Object.assign(Object.assign({},e),a)}))}()}),[w,e.selectedRows]),Object(n.useImperativeHandle)(t,(function(){return{open:function(){return T(!0)}}}),[]),r.a.createElement(r.a.Fragment,null,r.a.createElement(ya.a,{className:"indicator-drawer",title:e.drawerTitle||"指标筛选",width:"868px",forceRender:!0,onClose:function(){return T(!1)},visible:w,maskClosable:!1,extra:r.a.createElement(la.b,null,r.a.createElement(Ht.a,{size:"small",onClick:function(){return T(!1)}},"取消"),r.a.createElement(Ht.a,{type:"primary",size:"small",disabled:Object.entries(S).every((function(e){return!l()(e,2)[1].length})),loading:m,onClick:function(){d(!0);var t=[];Object.entries(S).forEach((function(e){var a=l()(e,2)[1];return t.push.apply(t,ue()(a))})),e.submitCallback(t).then((function(){d(!1),T(!1)}),(function(){d(!1)}))}},"确定"),r.a.createElement($.a,{type:"vertical"}))},r.a.createElement(In.a,{tableProps:{showHeader:!1,rowKey:"category",columns:P,dataSource:v,noPagination:!0,attrs:{rowSelection:M,expandable:{expandRowByClick:!0,expandedRowRender:function(e){return r.a.createElement(Pn,{metrics:e.metrics,category:e.category,selectedMetrics:S[e.category]||[],selectedMetricChange:L})},expandIcon:function(e){var t=e.expanded,a=e.onExpand,n=e.record;return t?r.a.createElement(h.a,{style:{fontSize:"16px"},type:"icon-xia",onClick:function(e){a(n,e)}}):r.a.createElement(h.a,{style:{fontSize:"16px"},type:"icon-jiantou_1",onClick:function(e){a(n,e)}})}}}}})))})),Mn=Object(n.forwardRef)((function(e,t){var a=e.metricType,i=e.onSelectChange,o=Object(s.useParams)().clusterId,c=Object(n.useState)([]),u=l()(c,2),d=u[0],f=u[1],p=Object(n.useState)([]),v=l()(p,2),g=v[0],h=v[1],b=Object(n.useState)(void 0),E=l()(b,2),y=E[0],k=E[1],N=Object(n.useRef)(null),O=function(e){return m.a.request(K.getDashboardMetricList(o,a),{method:"POST",data:{metricDetailDTOList:e}})},C=function(e,t){var a=Object(wn.a)(g,e,t);h(a),O(a.map((function(e,t){var a;return{metric:e,rank:t,set:(null===(a=d.find((function(t){var a=t.name;return e===a})))||void 0===a?void 0:a.set)||!1}})))},S=function(e){var t=function(e){var t=!1,a=[];if(e.some((function(e){return null!==e.rank}))){var n=e.filter((function(e){return null!==e.rank})).sort((function(e,t){return e.rank-t.rank})),r=e.filter((function(e){return null===e.rank}));(r.length||n.some((function(e,t){return e.rank!==t})))&&(t=!0),a=[].concat(ue()(n.map((function(e){return e.name}))),ue()(r.map((function(e){return e.name})).sort()))}else t=!0,a=e.map((function(e){return e.name})).sort();return{list:a,listInfo:a.map((function(t,a){var n;return{metric:t,rank:a,set:(null===(n=e.find((function(e){var a=e.name;return t===a})))||void 0===n?void 0:n.set)||!1}})),shouldUpdate:t}}(e),a=t.list,n=t.listInfo,r=t.shouldUpdate;h(a),r&&O(n)},x=function(){m.a.request(K.getDashboardMetricList(o,a)).then((function(e){if(e){var t=e.filter((function(e){return e.support})),a=t.filter((function(e){return e.set})).map((function(e){return e.name}));S(ue()(t)),f(t),k(a)}}))};return Object(n.useEffect)((function(){i(y,g)}),[y,g]),Object(n.useEffect)((function(){x()}),[]),Object(n.useImperativeHandle)(t,(function(){return{rankChange:C,open:function(){var e;return null===(e=N.current)||void 0===e?void 0:e.open()}}})),r.a.createElement(Ln,{ref:N,metricType:a,tableData:d,selectedRows:y,submitCallback:function(e){var t=[];e.forEach((function(e){var a;return!y.includes(e)&&t.push({metric:e,set:!0,rank:null===(a=d.find((function(t){return t.name===e})))||void 0===a?void 0:a.rank})})),y.forEach((function(a){var n;return!e.includes(a)&&t.push({metric:a,set:!1,rank:null===(n=d.find((function(e){return e.name===a})))||void 0===n?void 0:n.rank})}));var a=Object.keys(t).length?O(t):Promise.resolve();return a.then((function(){return x()}),(function(){return x()})),a}})})),zn=a(333),Dn=Object(zn.a)((function(e){var t=e.children,a=e.gutter;return r.a.createElement(Bt.a,{className:"drag-container",gutter:a},t)})),Rn=Object(zn.c)((function(){return r.a.createElement(h.a,{className:"drag-handle-icon",type:"icon-tuozhuai1"})})),Fn=Object(zn.b)((function(e){var t=e.children,a=e.sortableItemProps;return r.a.createElement(hn.a,{className:"drag-sort-item",span:a.span},(null==a?void 0:a.useDragHandle)&&r.a.createElement(Rn,null),t)})),Bn=function(e){var t=e.children,a=e.gridProps,n=void 0===a?{span:8,gutter:[10,10]}:a,i=e.sortableContainerProps;return r.a.createElement(Dn,Object.assign({pressDelay:0},i,{gutter:n.gutter}),r.a.Children.map(t,(function(e,t){var a="object"===ga()(e)&&null!==e&&e.key||t;return r.a.createElement(Fn,{key:a,index:t,sortableItemProps:{useDragHandle:i.useDragHandle||!1,span:n.span}},e)})))},Hn=[16,16],An=function(e){var t=e.loading,a=e.gridNum,i=e.data,o=e.autoReload,c=e.busInstance,s=e.dragCallback,u=e.onExpand,m=g.a.useGlobalValue(),d=l()(m,1)[0],f=Object(n.useState)(i),p=l()(f,2),v=p[0],b=p[1];return Object(n.useEffect)((function(){b(i)}),[i]),Object(n.useEffect)((function(){setTimeout((function(){var e;(e=document.getElementsByClassName("dcd-two-columns-layout-sider-footer")[0])&&e.addEventListener("click",(function(){return c.emit("chartResize")}))}))}),[]),r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"topic-dashboard-container"},r.a.createElement(Q.a,{spinning:t,style:{height:400}},v&&v.length?r.a.createElement("div",{className:"no-group-con"},r.a.createElement(Bn,{sortableContainerProps:{onSortStart:function(){c.emit("onDrag",!0)},onSortEnd:function(e){var t=e.oldIndex,a=e.newIndex;s(t,a),c.emit("onDrag",!1),b(Object(wn.a)(v,t,a))},axis:"xy",useDragHandle:!0},gridProps:{span:a,gutter:Hn}},v.map((function(e){var t=e.metricName,a=e.metricType,n=e.metricUnit,i=e.metricLines,l=e.showLegend;return r.a.createElement("div",{key:t,className:"dashboard-drag-item-box"},r.a.createElement("div",{className:"dashboard-drag-item-box-title"},r.a.createElement(Y.a,{placement:"topLeft",title:function(){var e="",n=d.getMetricDefine(a,t);return n&&(e=n.desc),e}},r.a.createElement("span",null,r.a.createElement("span",{className:"name"},t),r.a.createElement("span",{className:"unit"},"（",n,"）"),(a===j.Connect||a===j.Connectors)&&r.a.createElement("span",{style:{padding:"2px 8px",borderRadius:4,fontSize:12,background:a===j.Connect?"#ECECF6":"rgba(85,110,230,0.10)",color:a===j.Connect?"#495057":"#5664FF"}},a===j.Connect?"Cluster":"Connector")))),(null==i?void 0:i.length)>0&&r.a.createElement("div",{className:"expand-icon-box",onClick:function(){return u(t,a)}},r.a.createElement(h.a,{type:"icon-chuangkoufangda",className:"expand-icon"})),(null==i?void 0:i.length)>0?r.a.createElement(gt.a,Object.assign({chartKey:t,chartTypeProp:"line",showHeader:!1,wrapStyle:{width:"auto",height:222},connectEventName:"".concat(a,"BoardDragChart"),eventBus:c,propChartData:i,optionMergeProps:{replaceMerge:o?["xAxis"]:["series"]}},function(e,t){var a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return{option:vt({title:{show:!1},grid:{top:24,bottom:a?40:20},tooltip:{enterable:t>9,legendContextMaxHeight:192},legend:{show:a}}),seriesCallback:Cn}}("".concat(t,"{unit|（").concat(n,"）}"),i.length,l))):r.a.createElement(Ea.a,{description:"指标采集失败，请刷新或联系管理员排查",image:Ea.a.PRESENTED_IMAGE_CUSTOM,style:{padding:"40px 0"}}))})))):t?r.a.createElement(r.a.Fragment,null):r.a.createElement(Ea.a,{description:"数据为空，请选择指标或刷新",image:Ea.a.PRESENTED_IMAGE_CUSTOM,style:{padding:"100px 0"}}))))},Vn=function(e,t,a,n){return new(a||(a=Promise))((function(r,i){function o(e){try{l(n.next(e))}catch(e){i(e)}}function c(e){try{l(n.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,c)}l((n=n.apply(e,t||[])).next())}))},Kn=new(0,m.a.EventBus),_n=function(e){var t=e.searchPlaceholder,a=void 0===t?"输入内容进行搜索":t,i=e.list,o=e.isTop,c=e.visibleChange,s=e.onChange,u=Object(n.useState)(""),m=l()(u,2),d=m[0],f=m[1],p=Object(n.useState)(!1),v=l()(p,2),g=v[0],b=v[1],E=Object(n.useState)(!1),y=l()(E,2),k=y[0],N=y[1],O=Object(n.useState)([]),C=l()(O,2),S=C[0],x=C[1],j=Object(n.useState)([]),I=l()(j,2),w=I[0],T=I[1],P=Object(n.useRef)([]);return Object(n.useEffect)((function(){b(!!S.length&&S.length<w.length),N((null==S?void 0:S.length)===w.length)}),[S]),Object(n.useEffect)((function(){var e=(null==i?void 0:i.map((function(e){return e.value})))||[];T(e)}),[i]),Object(n.useEffect)((function(){o&&(x([]),P.current=[])}),[o]),r.a.createElement(r.a.Fragment,null,r.a.createElement("h6",{className:"time_title"},e.title),r.a.createElement("div",{className:"custom-scope"},r.a.createElement("div",{className:"check-row"},r.a.createElement(ia.a,{className:"check-all",indeterminate:g,checked:k,onChange:function(e){x(e.target.checked?w:[])}},"全选"),r.a.createElement(W.a,{className:"search-input",suffix:r.a.createElement(h.a,{type:"icon-fangdajing",style:{fontSize:"16px"}}),size:"small",placeholder:a,onChange:function(e){return f(e.target.value)}})),r.a.createElement("div",{className:"fixed-height"},r.a.createElement(ia.a.Group,{style:{width:"100%"},onChange:function(e){x(e)},value:S},r.a.createElement(Bt.a,{gutter:[10,12]},i.filter((function(e){return e.label.includes(d)})).map((function(e){return r.a.createElement(hn.a,{span:12,key:e.value},r.a.createElement(ia.a,{value:e.value},e.label))}))))),r.a.createElement("div",{className:"btn-con"},r.a.createElement(Ht.a,{type:"primary",size:"small",className:"btn-sure",onClick:function(){P.current=S,null==s||s(S,"".concat(null==S?void 0:S.length,"项"))},disabled:!((null==S?void 0:S.length)>0)},"确定"),r.a.createElement(Ht.a,{size:"small",onClick:function(){x(P.current),c(!1)}},"取消"))))},Un=function(e){var t=g.a.useGlobalValue(),a=l()(t,1)[0],i=e.type,o=Object(s.useParams)().clusterId,c=Object(n.useState)(!0),u=l()(c,2),d=u[0],f=u[1],p=Object(n.useState)([]),v=l()(p,2),h=v[0],b=v[1],E=Object(n.useState)(),y=l()(E,2),k=y[0],N=y[1],O=Object(n.useState)([]),C=l()(O,2),S=C[0],x=C[1],I=Object(n.useState)([]),w=l()(I,2),T=w[0],P=w[1],L=Object(n.useState)(12),M=l()(L,2),z=M[0],D=M[1],R=Object(n.useRef)(0),F=Object(n.useRef)([]),B=Object(n.useRef)(null),A=Object(n.useRef)(null),V=function(){var e,t,n;!k.isAutoReload&&f(!0);var r=l()(k.rangeTime,2),c=r[0],s=r[1],u=Date.now();R.current=u;var d=Object.assign({startTime:c,endTime:s,metricsNames:S||[]},i===j.Broker||i===j.Topic||i===j.MM2?H()({topNu:(null===(e=null==k?void 0:k.scopeData)||void 0===e?void 0:e.isTop)?k.scopeData.data:null},i===j.Broker?"brokerIds":i===j.MM2?"connectorNameList":"topics",(null===(t=null==k?void 0:k.scopeData)||void 0===t?void 0:t.isTop)?null:i===j.MM2?null===(n=k.scopeData.data)||void 0===n?void 0:n.map((function(e){return JSON.parse(e)})):k.scopeData.data):{});m.a.post(function(e,t){return On[t](e)}(o,i),d).then((function(e){if(R.current===u){if(null===e)P([]);else{var t=ft(e,a.getMetricDefine||{},i,k.rangeTime),n=[];null==S||S.forEach((function(e){var r;if(t&&t.some((function(t){return e===t.metricName})))n.push(null);else{var o={metricName:e,metricType:i,metricUnit:(null===(r=a.getMetricDefine(i,e))||void 0===r?void 0:r.unit)||"",metricLines:[],showLegend:!1,targetUnit:void 0};n.push(o)}})),t.sort((function(e,t){return F.current.indexOf(e.metricName)-F.current.indexOf(t.metricName)}));var r=n.filter((function(e){return null!==e}));r.sort((function(e,t){return F.current.indexOf(null==e?void 0:e.metricName)-F.current.indexOf(null==t?void 0:t.metricName)})),P([].concat(ue()(t),ue()(r)))}f(!1)}}),(function(){return R.current===u&&f(!1)}))};return Object(n.useEffect)((function(){(null==S?void 0:S.length)&&k?V():(P([]),f(!1))}),[k,S]),Object(n.useEffect)((function(){(i===j.Broker||i===j.Topic||i===j.MM2)&&Vn(void 0,void 0,void 0,q.a.mark((function e(){var t,a,n;return q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,m.a.request(i!==j.MM2?K.getDashboardMetadata(o,i):K.getMirrorMakerMetadata(o));case 2:t=e.sent,a=[{connectClusterId:1,connectClusterName:"connectClusterName",connectorName:"connectorName"}],n=t.length>0?t.map((function(e){return i===j.Broker?{label:e.host,value:e.brokerId}:i===j.MM2?{label:e.connectorName,value:JSON.stringify({connectClusterId:e.connectClusterId,connectorName:e.connectorName})}:{label:e.topicName,value:e.topicName}})):a.map((function(e){return{label:e.connectorName,value:JSON.stringify(e)}})),b(n);case 6:case"end":return e.stop()}}),e)})))}),[]),r.a.createElement("div",{id:"dashboard-drag-chart",className:"topic-dashboard"},r.a.createElement(Nn,{onChange:function(e){z!==e.gridNum?(D(e.gridNum||12),Kn.emit("chartResize")):(e.isRelativeRangeTime&&(e.rangeTime=e.rangeTime.map((function(e){return e-6e4}))),N({isRelativeRangeTime:e.isRelativeRangeTime,isAutoReload:e.isAutoReload,rangeTime:e.rangeTime,scopeData:e.scopeData}))},hideNodeScope:i===j.Zookeeper,openMetricFilter:function(){var e;return null===(e=B.current)||void 0===e?void 0:e.open()},nodeSelect:{name:i===j.Broker?"Broker":i===j.Topic?"Topic":i===j.MM2?"MM2":"Zookeeper",customContent:r.a.createElement(_n,{title:"自定义 ".concat(i===j.Broker?"Broker":i===j.Topic?"Topic":i===j.MM2?"MM2":"Zookeeper"," 范围"),list:h})}}),r.a.createElement(Mn,{ref:B,metricType:i,onSelectChange:function(e,t){F.current=t,x(e)}}),r.a.createElement(An,{busInstance:Kn,loading:d,gridNum:z,data:T,autoReload:null==k?void 0:k.isAutoReload,dragCallback:function(e,t){var a,n=F.current.indexOf(T[e].metricName),r=F.current.indexOf(T[t].metricName);null===(a=B.current)||void 0===a||a.rankChange(n,r)},onExpand:function(e){var t=h.map((function(e){return e.value}));A.current.onOpen(i,e,t)}}),r.a.createElement(jn,{ref:A}))},Gn=a(40),qn=function(){var e,t,a=g.a.useGlobalValue(),n=l()(a,1)[0];return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"breadcrumb",style:{marginBottom:"10px"}},r.a.createElement(Gn.a,{breadcrumbs:[{label:"多集群管理",aHref:"/"},{label:null===(e=null==n?void 0:n.clusterInfo)||void 0===e?void 0:e.name,aHref:"/cluster/".concat(null===(t=null==n?void 0:n.clusterInfo)||void 0===t?void 0:t.id)},{label:"Broker",aHref:""}]})),r.a.createElement(gn,null),r.a.createElement(Un,{type:j.Broker}))},Jn=a(961),Wn={current:1,pageSize:10,position:"bottomRight",showSizeChanger:!0,pageSizeOptions:["10","20","50","100","200","500"]},Zn=function(e,t,a,n){return new(a||(a=Promise))((function(r,i){function o(e){try{l(n.next(e))}catch(e){i(e)}}function c(e){try{l(n.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,c)}l((n=n.apply(e,t||[])).next())}))},Yn=m.a.request,Qn=function(e){var t=e.hashData,a=Object(s.useParams)(),i=Object(n.useState)(!1),o=l()(i,2),c=o[0],u=o[1],d=Object(n.useState)([]),f=l()(d,2),p=f[0],v=f[1],g=Object(n.useState)({current:1,pageSize:10,position:"bottomRight",showSizeChanger:!0,pageSizeOptions:["10","20","50","100","200","500"],showTotal:function(e){return"共 ".concat(e," 条目")}}),h=l()(g,2),b=h[0],E=h[1],y=function(n){var r=n.pageNo,i=n.pageSize;return Zn(void 0,void 0,void 0,q.a.mark((function n(){var o;return q.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(void 0!==(null==a?void 0:a.clusterId)&&void 0!==(null==t?void 0:t.brokerId)){n.next=2;break}return n.abrupt("return");case 2:v([]),u(!0),o={searchKeywords:e.searchKeywords?e.searchKeywords.slice(0,128):"",pageNo:r,pageSize:i},Yn(K.getBrokerDataLogs(null==t?void 0:t.brokerId,null==a?void 0:a.clusterId),{params:o}).then((function(e){var t,a,n;E({current:null===(t=e.pagination)||void 0===t?void 0:t.pageNo,pageSize:null===(a=e.pagination)||void 0===a?void 0:a.pageSize,total:null===(n=e.pagination)||void 0===n?void 0:n.total}),v((null==e?void 0:e.bizData)||[]),u(!1)})).catch((function(e){u(!1)}));case 6:case"end":return n.stop()}}),n)})))};return Object(n.useEffect)((function(){y({pageNo:1,pageSize:b.pageSize})}),[e.searchKeywords,null==t?void 0:t.brokerId]),r.a.createElement(In.a,{showQueryForm:!1,tableProps:{showHeader:!1,rowKey:"path",loading:c,columns:[{title:"Folder",dataIndex:"dir",key:"dir"},{title:"Topic",dataIndex:"topicName",key:"topicName"},{title:"Partition",dataIndex:"partitionId",key:"partitionId"},{title:"Offset Lag",dataIndex:"offsetLag",key:"offsetLag"},{title:"Size（MB）",dataIndex:"logSizeUnitB",key:"logSizeUnitB",render:function(e,t){return e||0===e?m.a.transBToMB(e):"-"}}],dataSource:p,paginationProps:Object.assign({},b),attrs:{onChange:function(e,t,a){y({pageNo:e.current,pageSize:e.pageSize})},bordered:!1}}})},$n=function(e){var t,a,n=Object(s.useParams)(),i=J.a.useForm(),o=l()(i,1)[0],c=function(){e.setVisible(!1)};return r.a.useEffect((function(){o.setFieldsValue(e.record)}),[e.record]),r.a.createElement(ya.a,{title:r.a.createElement(la.b,{size:0},r.a.createElement(Ht.a,{className:"drawer-title-left-button",type:"text",size:"small",icon:r.a.createElement(h.a,{type:"icon-fanhui1"}),onClick:c}),r.a.createElement($.a,{type:"vertical"}),r.a.createElement("span",{style:{paddingLeft:"5px"}},"编辑配置")),width:580,visible:e.visible,onClose:function(){return e.setVisible(!1)},maskClosable:!1,destroyOnClose:!0,extra:r.a.createElement(la.b,null,r.a.createElement(Ht.a,{size:"small",onClick:c},"取消"),r.a.createElement(Ht.a,{size:"small",type:"primary",onClick:function(){o.validateFields().then((function(t){var a,r,i={applyAll:t.applyAll,brokerId:Number(null===(a=e.hashData)||void 0===a?void 0:a.brokerId),changedProps:H()({},null===(r=e.record)||void 0===r?void 0:r.name,t.newValue),clusterId:Number(n.clusterId)};m.a.put(K.getBrokerEditConfig(),i).then((function(t){ie.success("编辑配置成功"),e.setVisible(!1),e.genData({pageNo:e.pagination.current,pageSize:e.pagination.pageSize})})).catch((function(e){console.log(e,"err")}))}))}},"确认"),r.a.createElement($.a,{type:"vertical"}))},r.a.createElement(Bt.a,{gutter:[12,12],className:"desc-row"},r.a.createElement(hn.a,{span:3,className:"label-col"},"配置名:"),r.a.createElement(hn.a,{span:21,className:"value-col"},(null===(t=e.record)||void 0===t?void 0:t.name)||"-"),r.a.createElement(hn.a,{span:3,className:"label-col"},"描述:"),r.a.createElement(hn.a,{span:21,className:"value-col"},(null===(a=e.record)||void 0===a?void 0:a.documentation)||"-")),r.a.createElement(J.a,{form:o,layout:"vertical"},r.a.createElement(J.a.Item,{name:"defaultValue",label:"Kafka默认配置"},r.a.createElement(W.a,{disabled:!0})),r.a.createElement(J.a.Item,{name:"value",label:"当前配置"},r.a.createElement(W.a,{disabled:!0})),r.a.createElement(J.a.Item,{name:"newValue",label:"新配置",rules:[{required:!0,message:"请输入新的配置值！！！"}]},r.a.createElement(W.a,null)),r.a.createElement(J.a.Item,{name:"applyAll",valuePropName:"checked"},r.a.createElement(ia.a,{defaultChecked:!1},"应用到全部Broker"))))},Xn=function(e,t,a,n){return new(a||(a=Promise))((function(r,i){function o(e){try{l(n.next(e))}catch(e){i(e)}}function c(e){try{l(n.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,c)}l((n=n.apply(e,t||[])).next())}))},er=m.a.request,tr=function(e){var t,a,i=e.hashData,o=Object(s.useParams)(),c=g.a.useGlobalValue(),u=l()(c,1)[0],m=Object(n.useState)(!1),d=l()(m,2),f=d[0],p=d[1],v=Object(n.useState)([]),b=l()(v,2),E=b[0],y=b[1],k=Object(n.useState)([]),N=l()(k,2),O=N[0],C=N[1],S=Object(n.useState)({current:1,pageSize:10,position:"bottomRight",showSizeChanger:!0,pageSizeOptions:["10","20","50","100","200","500"],showTotal:function(e){return"共 ".concat(e," 条目")}}),x=l()(S,2),j=x[0],I=x[1],w=Object(n.useState)(!1),T=l()(w,2),P=T[0],L=T[1],M=Object(n.useState)(null),z=l()(M,2),D=z[0],R=z[1],F=Object(n.useState)(null),B=l()(F,2),H=B[0],A=B[1],_=Object(n.useState)(null),U=l()(_,2),G=U[0],J=U[1],W=function(t){var a=t.pageNo,n=t.pageSize;return Xn(void 0,void 0,void 0,q.a.mark((function t(){var r;return q.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(void 0!==(null==o?void 0:o.clusterId)&&void 0!==(null==i?void 0:i.brokerId)){t.next=2;break}return t.abrupt("return");case 2:p(!0),r={searchKeywords:e.searchKeywords?e.searchKeywords.slice(0,128):void 0,pageNo:a,pageSize:n,preciseFilterDTOList:O.length>0?O.map((function(e){return{fieldName:e,fieldValueList:["readOnly"!==e],include:!0}})):void 0},er(K.getBrokerConfigs(null==i?void 0:i.brokerId,null==o?void 0:o.clusterId),{data:r,method:"POST"}).then((function(e){var t,a,n;I({current:null===(t=e.pagination)||void 0===t?void 0:t.pageNo,pageSize:null===(a=e.pagination)||void 0===a?void 0:a.pageSize,total:null===(n=e.pagination)||void 0===n?void 0:n.total}),y((null==e?void 0:e.bizData)||[])})).finally((function(){p(!1)}));case 5:case"end":return t.stop()}}),t)})))};return Object(n.useEffect)((function(){W({pageNo:1,pageSize:j.pageSize})}),[e.searchKeywords,O,null==i?void 0:i.brokerId]),r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"detail-header-cases",style:{padding:"0 0 12px"}},r.a.createElement(ia.a.Group,{options:[{label:"Hide read-only",value:"readOnly"},{label:"Show Overrides Only",value:"override"}],value:O,onChange:function(e){C(e)}}),r.a.createElement("div",{className:"detail-header-cases-right"},r.a.createElement("div",null,r.a.createElement("div",{className:"icon normal"}),r.a.createElement("div",null,"正常")),r.a.createElement("div",null,r.a.createElement("div",{className:"icon differ"}),r.a.createElement("div",null,"在集群内存在差异")),r.a.createElement("div",null,r.a.createElement("div",{className:"icon unique"}),r.a.createElement("div",null,"该broker独有")))),r.a.createElement(In.a,{showQueryForm:!1,tableProps:{showHeader:!1,rowKey:"path",loading:f,columns:(t={setEditOp:function(e){L(!0),R(e)},readOnlyRecord:G,readOnlyVisible:H,allowEdit:u.hasPermission&&u.hasPermission(V.BROKER_CHANGE_CONFIG)},a=[{title:"",dataIndex:"readOnly",key:"readOnly",align:"right",render:function(e,a){var n;return e?r.a.createElement(Y.a,{title:"该配置无法修改",visible:a.name===(null===(n=null==t?void 0:t.readOnlyRecord)||void 0===n?void 0:n.name)&&(null==t?void 0:t.readOnlyVisible)},r.a.createElement(h.a,{style:{color:"#556EE6",fontSize:"16px"},type:"icon-suoding"})):null},width:56,className:"table-suoding"},{title:"配置名",dataIndex:"name",key:"name",width:250},{title:"描述",dataIndex:"documentation",key:"documentation",width:300,lineClampTwo:!0,needTooltip:!0},{title:"配置值",dataIndex:"value",key:"value",width:250,lineClampTwo:!0},{title:"状态",dataIndex:"state",key:"state",render:function(e,t){return t.differentiated?r.a.createElement("div",{className:"differ"}):t.exclusive?r.a.createElement("div",{className:"unique"}):r.a.createElement("div",{className:"normal"})}}],t.allowEdit&&a.push({title:"操作",dataIndex:"options",key:"options",render:function(e,a){return a.readOnly?"-":r.a.createElement("a",{onClick:function(){return t.setEditOp(a)}},"编辑")}}),a),dataSource:E,paginationProps:Object.assign({},j),attrs:{onChange:function(e,t,a){W({pageNo:e.current,pageSize:e.pageSize})},bordered:!1,onRow:function(e){return(null==e?void 0:e.readOnly)?{onMouseEnter:function(){A(!0),J(e)},onMouseLeave:function(){A(!1),J(null)}}:{}}}}}),r.a.createElement($n,{record:D,hashData:i,visible:P,setVisible:L,genData:W,pagination:j}))},ar=function(e){var t=e.record,a=Object(s.useParams)(),i=Object(s.useLocation)(),o=Object(n.useState)(!1),c=l()(o,2),u=c[0],d=c[1],f=Object(n.useState)([]),p=l()(f,2),v=p[0],g=p[1],h=Object(n.useState)({state:ne.UNKNOWN,passed:0,total:0}),b=l()(h,2),E=b[0],y=b[1];return Object(n.useEffect)((function(){var e;d(!0),m.a.post(K.getBrokerDetailMetricPoints(null===(e=Ee(i.hash))||void 0===e?void 0:e.brokerId,null==a?void 0:a.clusterId),["Partitions","Leaders","PartitionURP","HealthCheckPassed","HealthCheckTotal","HealthState"]).then((function(e){var t,a,n;d(!1);var r=JSON.parse(JSON.stringify(e.metrics)),i=[{title:"Partitions",value:r.Partitions||"-"},{title:"Leaders",value:r.Leaders||"-"},{title:"Under Replicated Partitions",value:r.PartitionURP||"-"}];g(i),y({state:null===(t=null==e?void 0:e.metrics)||void 0===t?void 0:t.HealthState,passed:(null===(a=null==e?void 0:e.metrics)||void 0===a?void 0:a.HealthCheckPassed)||0,total:(null===(n=null==e?void 0:e.metrics)||void 0===n?void 0:n.HealthCheckTotal)||0})}))}),[]),r.a.createElement(fn,{record:t,scene:"broker",healthData:E,cardColumns:v,showCardBg:!1,loading:u})},nr=ka.a.TabPane,rr=(qa={},H()(qa,"Configuration",(function(e){return r.a.createElement(Jn.a,{onSearch:e.setSearchKeywords,attrs:{value:e.searchValue,onChange:e.setSearchValue,placeholder:"请输入配置名",size:"small",style:{width:"210px",marginRight:"2px"},maxLength:128}})})),H()(qa,"DataLogs",(function(e){return r.a.createElement(Jn.a,{onSearch:e.setSearchKeywords,attrs:{value:e.searchValue,onChange:e.setSearchValue,placeholder:"请输入TopicName",size:"small",style:{width:"210px",marginRight:"2px"},maxLength:128}})})),qa),ir=function(e){var t,a,i=g.a.useGlobalValue(),o=l()(i,1)[0],c=(Object(s.useParams)(),Object(s.useLocation)()),u=Object(s.useHistory)(),d=Object(n.useState)("Configuration"),f=l()(d,2),p=f[0],v=f[1],h=Object(n.useState)(""),b=l()(h,2),E=b[0],y=b[1],k=Object(n.useState)(""),N=l()(k,2),O=N[0],C=N[1],S=Object(n.useState)(!1),x=l()(S,2),j=x[0],I=x[1],w=Object(n.useState)({}),T=l()(w,2),P=T[0],L=T[1];return Object(n.useEffect)((function(){var e,t;(null===(e=null==o?void 0:o.clusterInfo)||void 0===e?void 0:e.id)&&Ee(c.hash).brokerId?m.a.request(K.getBrokerMetadata(Ee(c.hash).brokerId,null===(t=null==o?void 0:o.clusterInfo)||void 0===t?void 0:t.id),{init:{errorNoTips:!0}}).then((function(e){(null==e?void 0:e.exist)&&(null==e?void 0:e.alive)?(L(e),I(!0)):(u.replace(c.pathname),I(!1))})).catch((function(e){u.replace(c.pathname),I(!1)})):I(!1)}),[Ee(c.hash).brokerId,null==o?void 0:o.clusterInfo,c]),r.a.createElement(ya.a,{push:!1,title:r.a.createElement("span",null,r.a.createElement("span",{style:{fontSize:"18px",fontFamily:"PingFangSC-Semibold",color:"#495057"}},"Broker ",null==P?void 0:P.brokerId),(null==P?void 0:P.host)&&r.a.createElement(pn.a,{style:{fontSize:"10px",color:"#495057",textAlign:"center",background:"#ECECF6",borderRadius:"4px",marginLeft:"10px",padding:"1px 10px"}},null==P?void 0:P.host),(null===(t=null==o?void 0:o.clusterInfo)||void 0===t?void 0:t.name)&&r.a.createElement(pn.a,{style:{fontSize:"10px",color:"#495057",textAlign:"center",background:"#ECECF6",borderRadius:"4px",marginLeft:"10px",padding:"1px 10px"}},null===(a=null==o?void 0:o.clusterInfo)||void 0===a?void 0:a.name)),width:1080,placement:"right",onClose:function(){I(!1),C(""),y(""),v("Configuration"),u.push(c.pathname)},visible:j,className:"broker-detail-drawer",destroyOnClose:!0,maskClosable:!1},r.a.createElement(ar,{record:{brokerId:null==P?void 0:P.brokerId}}),P&&p&&r.a.createElement(ka.a,{className:"custom_tabs_class",defaultActiveKey:"Configuration",onChange:function(e){C(""),y(""),v(e)},tabBarExtraContent:rr[p]&&o.isShowControl&&o.isShowControl("Configuration"===p?ja.BROKER_DETAIL_CONFIG:ja.BROKER_DETAIL_DATALOGS)&&rr[p]({setSearchKeywords:y,setSearchValue:C,searchValue:O,positionType:p}),destroyInactiveTabPane:!0},r.a.createElement(nr,{tab:"Configuration",key:"Configuration"},o.isShowControl&&o.isShowControl(ja.BROKER_DETAIL_CONFIG)?r.a.createElement(tr,{searchKeywords:E,positionType:p,hashData:P}):r.a.createElement(Ea.a,{description:"当前版本过低，不支持该功能！"})),r.a.createElement(nr,{tab:"DataLogs",key:"DataLogs"},o.isShowControl&&o.isShowControl(ja.BROKER_DETAIL_DATALOGS)?r.a.createElement(Qn,{searchKeywords:E,positionType:p,hashData:P}):r.a.createElement(Ea.a,{description:"当前版本过低，不支持该功能！"}))))},or=function(e,t,a,n){return new(a||(a=Promise))((function(r,i){function o(e){try{l(n.next(e))}catch(e){i(e)}}function c(e){try{l(n.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,c)}l((n=n.apply(e,t||[])).next())}))},cr=m.a.request,lr=function(e){var t,a,i=g.a.useGlobalValue(),o=l()(i,1)[0],c=Object(s.useParams)(),u=(Object(s.useHistory)(),Object(n.useState)(!1)),m=l()(u,2),d=m[0],f=m[1],p=Object(n.useState)([]),v=l()(p,2),b=v[0],E=v[1],y=Object(n.useState)(""),k=l()(y,2),N=k[0],O=k[1],C=Object(n.useState)(Wn),S=l()(C,2),x=S[0],j=S[1],I=Object(n.useState)(null),w=l()(I,2),T=(w[0],w[1],function(e){var t=e.pageNo,a=e.pageSize,n=(e.filters,e.sorter);return or(void 0,void 0,void 0,q.a.mark((function e(){var r;return q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==(null==c?void 0:c.clusterId)){e.next=2;break}return e.abrupt("return");case 2:f(!0),r={searchKeywords:N.slice(0,128),pageNo:t,pageSize:a,latestMetricNames:["PartitionsSkew","Leaders","LeadersSkew","LogSize"],sortField:(null==n?void 0:n.field)||"brokerId",sortType:(null==n?void 0:n.order)?n.order.substring(0,n.order.indexOf("end")):"asc"},cr(K.getBrokersList(null==c?void 0:c.clusterId),{method:"POST",data:r}).then((function(e){var t,a,n;j({current:null===(t=e.pagination)||void 0===t?void 0:t.pageNo,pageSize:null===(a=e.pagination)||void 0===a?void 0:a.pageSize,total:null===(n=e.pagination)||void 0===n?void 0:n.total});var r=(null==e?void 0:e.bizData.map((function(e){var t;return Object.assign(Object.assign({},e),null===(t=null==e?void 0:e.latestMetrics)||void 0===t?void 0:t.metrics)})))||[];E(r),f(!1)})).catch((function(e){f(!1)}));case 5:case"end":return e.stop()}}),e)})))});return Object(n.useEffect)((function(){T({pageNo:1,pageSize:x.pageSize})}),[N]),r.a.createElement("div",{key:"brokerList",className:"brokerList"},r.a.createElement("div",{className:"breadcrumb",style:{marginBottom:"10px"}},r.a.createElement(Gn.a,{breadcrumbs:[{label:"多集群管理",aHref:"/"},{label:null===(t=null==o?void 0:o.clusterInfo)||void 0===t?void 0:t.name,aHref:"/cluster/".concat(null===(a=null==o?void 0:o.clusterInfo)||void 0===a?void 0:a.id)},{label:"Broker",aHref:"/cluster/".concat(null==c?void 0:c.clusterId,"/broker")},{label:"Brokers",aHref:""}]})),r.a.createElement("div",{style:{margin:"12px 0"}},r.a.createElement(gn,null)),r.a.createElement("div",{className:"custom-table-content"},r.a.createElement("div",{className:ke},r.a.createElement("div",{className:"".concat(ke,"-left")},r.a.createElement("div",{className:"".concat(ke,"-left-refresh"),onClick:function(){return T({pageNo:x.current,pageSize:x.pageSize})}},r.a.createElement(h.a,{className:"".concat(ke,"-left-refresh-icon"),type:"icon-shuaxin1"}))),r.a.createElement("div",{className:"".concat(ke,"-right")},r.a.createElement(Jn.a,{onSearch:O,attrs:{placeholder:"请输入Broker Host",style:{width:"248px",borderRiadus:"8px"},maxLength:128}}))),r.a.createElement(In.a,{key:"brokerTable",showQueryForm:!1,tableProps:{showHeader:!1,rowKey:"broker_list",loading:d,columns:[{title:"Broker ID",dataIndex:"brokerId",key:"brokerId",sorter:!0,render:function(e,t){var a,n;return(null==t?void 0:t.alive)?r.a.createElement(r.a.Fragment,null,r.a.createElement("a",{onClick:function(){window.location.hash="brokerId=".concat(e||0===e?e:"","&host=").concat(t.host||"")}},e),(null===(a=null==t?void 0:t.kafkaRoleList)||void 0===a?void 0:a.includes("controller"))&&r.a.createElement(pn.a,{style:{color:"#556EE6",padding:"2px 5px",background:"#eff1fd",marginLeft:"4px",transform:"scale(0.83,0.83)"}},"Controller")):r.a.createElement(r.a.Fragment,null,r.a.createElement("span",null,e),(null===(n=null==t?void 0:t.kafkaRoleList)||void 0===n?void 0:n.includes("controller"))&&r.a.createElement(pn.a,{style:{color:"#556EE6",padding:"2px 5px",background:"#eff1fd",marginLeft:"4px",transform:"scale(0.83,0.83)"}},"Controller"))},fixed:"left",width:150},{title:"Broker Host",dataIndex:"host",key:"host",width:180,render:function(e,t){return r.a.createElement("span",null,e,(null==t?void 0:t.alive)?r.a.createElement(pn.a,{className:"tag-success"},"Live"):r.a.createElement(pn.a,{className:"tag-error"},"Down"))}},{title:" JMX Port",dataIndex:"jmxPort",key:"jmxPort",width:100,render:function(e,t){return r.a.createElement("span",null,r.a.createElement(h.a,{type:(null==t?void 0:t.jmxConnected)?"icon-zhengchang":"icon-yichang"}),r.a.createElement("span",{style:{marginLeft:4}},e))}},{title:"Partitions",dataIndex:"Partitions",key:"Partitions",width:100},{title:"Partitions Skew",dataIndex:"PartitionsSkew",key:"PartitionsSkew",width:140,render:function(e){return e||0===e?(100*e).toFixed(2)+"%":"-"}},{title:"Leaders Partition",dataIndex:"Leaders",key:"Leaders",width:140},{title:"Leaders Skew",dataIndex:"LeadersSkew",key:"LeadersSkew",width:120,render:function(e){return e||0===e?(100*e).toFixed(2)+"%":"-"}},{title:"Message Size",dataIndex:"LogSize",key:"LogSize",sorter:!0,width:150,render:function(e){return be(e,"B").valueWithUnit}},{title:"Roles",dataIndex:"kafkaRoleList",key:"kafkaRoleList",width:100,render:function(e){var t;if(e){var a=null===(t=null==e?void 0:e.filter((function(e){return"__c"==e.slice(0,3)||"__t"==e.slice(0,3)})))||void 0===t?void 0:t.map((function(e){return"__c"==e.slice(0,3)?"GC":"__t"==e.slice(0,3)?"TC":null})),n=a.map((function(e){return"GC"===e?"GroupCoordinator":"TC"===e?"TransactionCoordinator":null}));return r.a.createElement(Y.a,{title:n.join()},r.a.createElement("span",null,a.length>0?a.join("、"):"-"))}return"-"}},{title:"Start Time",dataIndex:"startTimeUnitMs",key:"startTimeUnitMs",width:200,render:function(e){return e?ce()(e).format(de):"-"}}],dataSource:b,paginationProps:Object.assign({},x),attrs:{onChange:function(e,t,a){T({pageNo:e.current,pageSize:e.pageSize,filters:t,sorter:a})},scroll:{x:"max-content",y:"calc(100vh - 400px)"},bordered:!1}}})),r.a.createElement(ir,null))},sr={current:1,pageSize:10,position:"bottomRight",showSizeChanger:!0,pageSizeOptions:["10","20","50","100","200","500"]},ur=m.a.request,mr=function(e){var t,a,i=g.a.useGlobalValue(),o=l()(i,1)[0],c=Object(s.useParams)(),u=(Object(s.useHistory)(),Object(n.useState)(!1)),m=l()(u,2),d=m[0],f=m[1],p=Object(n.useState)([]),v=l()(p,2),b=v[0],E=v[1],y=Object(n.useState)(""),k=l()(y,2),N=k[0],O=k[1],C=Object(n.useState)(null),S=l()(C,2),x=S[0],j=S[1],I=Object(n.useState)(sr),w=l()(I,2),T=w[0],P=w[1],L=Object(n.useState)(null),M=l()(L,2),z=(M[0],M[1],{sortField:"changeTime",sortType:"desc"}),D=function(e){var t=e.pageNo,a=e.pageSize,n=e.filters,r=void 0===n?null:n;e.sorter;if(void 0!==(null==c?void 0:c.clusterId)){r=r||x,f(!0);var i={searchKeywords:N.slice(0,128),pageNo:t,pageSize:a};ur(K.getChangeLogList(null==c?void 0:c.clusterId),{params:Object.assign(Object.assign({},i),z)}).then((function(e){var t,a,n;P({current:null===(t=e.pagination)||void 0===t?void 0:t.pageNo,pageSize:null===(a=e.pagination)||void 0===a?void 0:a.pageSize,total:null===(n=e.pagination)||void 0===n?void 0:n.total}),E((null==e?void 0:e.bizData)||[]),f(!1)})).catch((function(e){f(!1)}))}};return Object(n.useEffect)((function(){D({pageNo:1,pageSize:T.pageSize})}),[N]),r.a.createElement("div",{className:"controllerList"},r.a.createElement("div",{className:"breadcrumb",style:{marginBottom:"10px"}},r.a.createElement(Gn.a,{breadcrumbs:[{label:"多集群管理",aHref:"/"},{label:null===(t=null==o?void 0:o.clusterInfo)||void 0===t?void 0:t.name,aHref:"/cluster/".concat(null===(a=null==o?void 0:o.clusterInfo)||void 0===a?void 0:a.id)},{label:"Broker",aHref:"/cluster/".concat(null==c?void 0:c.clusterId,"/broker")},{label:"Controller",aHref:""}]})),r.a.createElement("div",{style:{margin:"12px 0"}},r.a.createElement(gn,null)),r.a.createElement("div",{className:"custom-table-content"},r.a.createElement("div",{className:ke},r.a.createElement("div",{className:"".concat(ke,"-left")},r.a.createElement("div",{className:"".concat(ke,"-left-refresh"),onClick:function(){return D({pageNo:T.current,pageSize:T.pageSize})}},r.a.createElement(h.a,{className:"".concat(ke,"-left-refresh-icon"),type:"icon-shuaxin1"}))),r.a.createElement("div",{className:"".concat(ke,"-right")},r.a.createElement(Jn.a,{onSearch:O,attrs:{placeholder:"请输入Broker Host",style:{width:"248px",borderRiadus:"8px"},maxLength:128}}))),r.a.createElement(In.a,{showQueryForm:!1,tableProps:{showHeader:!1,rowKey:"path",loading:d,columns:[{title:"Change Time",dataIndex:"timestamp",key:"timestamp",render:function(e){return e?ce()(e).format(de):"-"}},{title:"Broker ID",dataIndex:"brokerId",key:"brokerId",render:function(e,t){return-1===e?"-":r.a.createElement("a",{onClick:function(){window.location.hash="brokerId=".concat(e||"","&host=").concat(t.brokerHost||"")}},e)}},{title:"Broker Host",dataIndex:"brokerHost",key:"brokerHost"}],dataSource:b,paginationProps:Object.assign({},T),attrs:{onChange:function(e,t,a){j(t),D({pageNo:e.current,pageSize:e.pageSize,filters:t,sorter:a})},bordered:!1,scroll:{y:"calc(100vh - 400px)"}}}})),r.a.createElement(ir,null))},dr=function(){var e=Object(s.useParams)(),t=Object(n.useState)(!1),a=l()(t,2),i=a[0],o=a[1],c=Object(n.useState)([]),u=l()(c,2),d=u[0],f=u[1],p=Object(n.useState)({state:ne.UNKNOWN,passed:0,total:0}),v=l()(p,2),g=v[0],h=v[1],b=["Topics","Partitions","PartitionNoLeader","PartitionMinISR_S","PartitionMinISR_E","PartitionURP"],E=["HealthCheckPassed_Topics","HealthCheckTotal_Topics","HealthState"];return Object(n.useEffect)((function(){o(!0),m.a.post(K.getMetricPointsLatest(Number(e.clusterId)),b.concat(E)).then((function(e){o(!1);f(b.map((function(t){var a=t;return"PartitionMinISR_E"===a&&(a="= Min ISR"),"PartitionMinISR_S"===a?{title:"< Min ISR",value:r.a.createElement("span",{style:{color:0!==e.metrics[t]?"#F58342":""}},e.metrics[t])}:"PartitionNoLeader"===a||"PartitionURP"===a?{title:a,value:r.a.createElement("span",{style:{color:0!==e.metrics[t]?"#F58342":""}},e.metrics[t])}:{title:a,value:e.metrics[t]}}))),h({state:e.metrics.HealthState,passed:e.metrics.HealthCheckPassed_Topics||0,total:e.metrics.HealthCheckTotal_Topics||0})}))}),[]),r.a.createElement(fn,{scene:"topics",healthData:g,cardColumns:d,loading:i})},fr=function(){var e,t,a=g.a.useGlobalValue(),n=l()(a,1)[0];return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"breadcrumb",style:{marginBottom:"10px"}},r.a.createElement(Gn.a,{breadcrumbs:[{label:"多集群管理",aHref:"/"},{label:null===(e=null==n?void 0:n.clusterInfo)||void 0===e?void 0:e.name,aHref:"/cluster/".concat(null===(t=null==n?void 0:n.clusterInfo)||void 0===t?void 0:t.id)},{label:"Topic",aHref:""}]})),r.a.createElement(dr,null),r.a.createElement(Un,{type:j.Topic}))},pr=a(930),vr=a(219),gr=a(962),hr=a(527),br=a(512),Er=ia.a.Group,yr=ba.a.Group,kr=oa.a.Option,Nr=W.a.TextArea,Or={ms:1,min:6e4,h:36e5,day:864e5},Cr=["retention.ms","cleanup.policy","max.message.bytes"];var Sr=function(e){var t=e.onConfirm,a=Object(n.useState)(0),i=l()(a,2),o=i[0],c=i[1],u=Object(n.useState)("ms"),f=l()(u,2),p=f[0],v=f[1],h=Object(n.useState)(!1),b=l()(h,2),E=b[0],y=b[1],k=Object(n.useState)(!1),N=l()(k,2),C=N[0],S=N[1],x=Object(n.useState)(""),j=l()(x,2),I=j[0],w=j[1],T=Object(n.useState)("close"),P=l()(T,2),L=P[0],M=P[1],z=Object(n.useState)([]),D=l()(z,2),R=D[0],F=D[1],B=J.a.useForm(),H=l()(B,1)[0],A=Object(n.useState)({}),V=l()(A,2),_=V[0],U=V[1],G=Object(s.useParams)(),q=g.a.useGlobalValue(),Z=l()(q,1)[0],Y=Z.isShowControl&&Z.isShowControl(ja.CREATE_TOPIC_CLEANUP_POLICY);return Object(n.useEffect)((function(){E&&m.a.request(K.getDefaultTopicConfig(Number(G.clusterId))).then((function(e){F(e);var t=e.map((function(e){var t;try{t="cleanup.policy"===e.name&&Y?e.defaultValue.replace(/\[|\]|\s+/g,"").split(",").filter((function(e){return e})):e.defaultValue}catch(e){t=[]}return{name:["properties",e.name],value:t}}));U(e.reduce((function(e,t){return e[t.name]=t.defaultValue,e}),_));var a=m.a.transUnitTimePro(Number(e.find((function(e){return"retention.ms"===e.name})).defaultValue),2)||"";c(null==a?void 0:a.value),v(null==a?void 0:a.unit),H.setFieldsValue({saveTime:null==a?void 0:a.value,saveTimeUnit:null==a?void 0:a.unit}),H.setFields(ue()(t))}))}),[E]),r.a.createElement(r.a.Fragment,null,r.a.createElement(Ht.a,{type:"primary",className:"add-btn",icon:r.a.createElement(hr.a,null),onClick:function(){y(!0)}},"新增Topic"),r.a.createElement(ya.a,{title:"创建Topic",width:800,className:"cluster-topic-add",visible:E,maskClosable:!1,destroyOnClose:!0,extra:r.a.createElement("div",{className:"operate-wrap"},r.a.createElement(Ht.a,{size:"small",style:{marginRight:8},onClick:function(e){H.resetFields(),y(!1)}},"取消"),r.a.createElement(Ht.a,{size:"small",type:"primary",onClick:function(){H.validateFields().then((function(e){var a=JSON.parse(JSON.stringify(H.getFieldsValue()));a.clusterId=Number(G.clusterId),a.properties["retention.ms"]=o*Or[p],Object.keys(_).forEach((function(e){a.properties[e]===_[e]&&delete a.properties[e]})),Object.keys(a.properties).forEach((function(e){Array.isArray(a.properties[e])&&(a.properties[e]=a.properties[e].join(","))})),m.a.post(K.addTopic(),a).then((function(e){null===e?(O.success({message:"创建成功"}),t&&t(),H.resetFields(),y(!1)):O.error({message:"创建失败"})}))}))}},"确定"),r.a.createElement($.a,{type:"vertical"})),onClose:function(e){y(!1)}},r.a.createElement(J.a,{form:H,layout:"vertical",validateTrigger:"onBlur"},r.a.createElement(J.a.Item,{name:"topicName",label:"Topic名称",rules:[{required:!0,message:""},function(){return{validator:function(e,t){return t?/[\u4e00-\u9fa5\w\-]+/.test(t)?/^[a-zA-Z]/.test(t)?t.length<3||t.length>128?Promise.reject("Topic名称长度限制为3～128字符"):new Promise((function(e,a){m.a.request(K.getTopicMetadata(Number(G.clusterId),t)).then((function(t){t.exist?a("Topic名称重复"):e("")})).catch((function(t){e("")}))})):Promise.reject("Topic名称须以字母开头"):Promise.reject("Topic名称只能由中英文、下划线、短划线（-）组成"):Promise.reject("Topic名称不能为空")}}}]},r.a.createElement(W.a,{placeholder:"请输入Topic名称"})),r.a.createElement(J.a.Item,{name:"description",label:"Topic描述",rules:[{required:!0,message:"请输入Topic描述"}]},r.a.createElement(W.a.TextArea,{style:{height:80},placeholder:"请输入Topic描述。例如，数据来源、使用方式、预计流量等"})),r.a.createElement("div",{className:"create-topic-flex-layout"},r.a.createElement(J.a.Item,{name:"partitionNum",label:"分区数",rules:[{required:!0,message:"请输入分区数"}]},r.a.createElement(Ft.a,{min:1,style:{width:"100%"},addonAfter:"个"})),r.a.createElement(J.a.Item,{name:"replicaNum",label:"副本数",rules:[{required:!0,message:"请输入副本数"}]},r.a.createElement(Ft.a,{min:1,style:{width:"100%"},addonAfter:"个"}))),r.a.createElement(J.a.Item,{className:"data-save-time-label",name:"dataSaveTime"},r.a.createElement("div",{className:"data-save-time-wrap"},r.a.createElement(J.a.Item,{name:"saveTime",label:"数据保存时间",rules:[{required:!0,message:"请输入数据保存时间"}]},r.a.createElement(Ft.a,{min:0,className:"num",value:o,onChange:function(e){c(e)}})),r.a.createElement(J.a.Item,{name:"saveTimeUnit",label:" ",rules:[{validator:function(e,t){return t?Promise.resolve(""):Promise.reject("请选择时间格式")}}]},r.a.createElement(oa.a,{className:"unit",value:p,onChange:function(e){v(e)}},r.a.createElement(kr,{value:"ms"},"ms"),r.a.createElement(kr,{value:"min"},"min"),r.a.createElement(kr,{value:"h"},"h"),r.a.createElement(kr,{value:"day"},"day"))))),r.a.createElement(J.a.Item,{name:["properties","cleanup.policy"],label:"清理策略",rules:[{required:!0,message:"请输入清理策略"}]},Y?r.a.createElement(Er,null,r.a.createElement(ia.a,{style:{marginRight:"65px"},value:"delete"},"delete"),r.a.createElement(ia.a,{value:"compact"},"compact")):r.a.createElement(yr,null,r.a.createElement(ba.a,{style:{marginRight:"65px"},value:"delete"},"delete"),r.a.createElement(ba.a,{value:"compact"},"compact"))),r.a.createElement("div",{className:"more-config"},r.a.createElement("div",{className:"txt"},"更多配置"),r.a.createElement("div",{className:"switch-expand",onClick:function(e){M("open"===L?"close":"open")}},r.a.createElement("span",{className:"txt"},"open"===L?"收起":"展开"),"open"===L?r.a.createElement(br.a,null):r.a.createElement(Za.a,null))),r.a.createElement("div",{style:{display:"open"===L?"block":"none"}},r.a.createElement(gr.a,{className:"tip-info",message:"不知道单条消息大小?",type:"warning",showIcon:!0,action:r.a.createElement("div",{className:"test-right-away",onClick:function(e){S(!0)}},"立即测试")}),r.a.createElement("div",{className:"create-topic-flex-layout"},r.a.createElement(J.a.Item,{name:["properties","max.message.bytes"],label:"Max message size"},r.a.createElement(Ft.a,{min:0,style:{width:"100%"},formatter:function(e){return"".concat(e,"KB")},parser:function(e){return e.replace("KB","")}})),R.filter((function(e){return!Cr.includes(e.name)})).map((function(e,t){return r.a.createElement(J.a.Item,{key:t,name:["properties",e.name],label:e.name.slice(0,1).toUpperCase()+e.name.slice(1)},r.a.createElement(W.a,null))})))))),r.a.createElement(d.a,{wrapClassName:"msg-size-info-modal custom-modal",title:"消息大小测试",visible:C,centered:!0,footer:null,onCancel:function(e){S(!1)}},r.a.createElement("div",{className:"msg-size-info"},"在下方输入框内输入消息样例即可计算出消息大小"),r.a.createElement(Nr,{rows:16,value:I,onChange:function(e){w(e.target.value)}}),r.a.createElement("div",{className:"statistics-info"},r.a.createElement("span",null,"字符数：",I.length),r.a.createElement("span",null,"大小：",function(e,t){var a,n,r,i=0;if("utf-16"===(t=t?t.toLowerCase():"")||"utf16"===t)for(n=0,r=e.length;n<r;n++)i+=(a=e.charCodeAt(n))<=65535?2:4;else for(n=0,r=e.length;n<r;n++)i+=(a=e.charCodeAt(n))<=127?1:a<=2047?2:a<=65535?3:4;return i}(I),"Bytes"))))},xr=function(e){var t=g.a.useGlobalValue(),a=l()(t,1)[0],i=e.record,o=e.onConfirm,c=J.a.useForm(),u=l()(c,1)[0],d=Object(s.useParams)(),f=Object(n.useState)(!1),p=l()(f,2),v=p[0],h=p[1],b=Object(n.useState)(),E=l()(b,2),y=E[0],k=E[1],N=Object(n.useState)(0),C=l()(N,2),S=C[0],x=C[1],I=Object(n.useState)(i.partitionNum),w=l()(I,2),T=w[0],P=w[1],L=Object(n.useState)(!1),M=l()(L,2),z=M[0],D=M[1];Object(n.useEffect)((function(){if(v){var e=[Date.now()-864e5,Date.now()],t=e[0],n=e[1];D(!0);var r={aggType:"avg",endTime:Math.round(n),metricsNames:["BytesIn","BytesOut"],startTime:Math.round(t),topNu:0,topics:[i.topicName]};m.a.post(K.getTopicsMetrics(Number(d.clusterId)),r).then((function(e){var r=Math.min.apply(Math,ue()(e.map((function(e){return Math.min.apply(Math,ue()(e.metricLines.map((function(e){return Math.min.apply(Math,ue()(e.metricPoints.map((function(e){return Number(e.value)}))))}))))})))),o=10240*i.partitionNum,c=e.map((function(e){var t=e.metricLines[0];return t.name=e.metricName,t})),l=ft([{metricName:"BytesIn",metricLines:c}],(null==a?void 0:a.getMetricDefine)||{},j.Topic,[t,n]);x(r<o?o:r),k(l[0]),D(!1)})),u.setFieldsValue({incPartitionNum:i.partitionNum})}}),[v]);var R=function(e){var t=ut.Memory(e),a=l()(t,2),n=a[0],r=a[1];return"".concat((e/r).toFixed(2)).concat(n,"/s")};return r.a.createElement(r.a.Fragment,null,r.a.createElement(Ht.a,{type:"link",onClick:function(e){h(!0)}},"扩分区"),r.a.createElement(ya.a,{className:"expand-partition-drawer",title:"扩分区",width:1080,visible:v,maskClosable:!1,extra:r.a.createElement(la.b,null,r.a.createElement(Ht.a,{size:"small",style:{marginRight:8},onClick:function(){h(!1)}},"取消"),r.a.createElement(Ht.a,{size:"small",type:"primary",onClick:function(){var e={clusterId:Number(d.clusterId),incPartitionNum:u.getFieldValue("incPartitionNum")-i.partitionNum,topicName:i.topicName};m.a.post(K.expandPartitions(),e).then((function(e){null===e?(O.success({message:"扩分区成功"}),h(!1),o&&o()):O.error({message:"扩分区失败"})}))}},"确定"),r.a.createElement($.a,{type:"vertical"})),onClose:function(e){h(!1)}},r.a.createElement("div",{className:"brief-info"},r.a.createElement("div",{className:"item"},r.a.createElement("span",{className:"field"},"Topic名称 :"),r.a.createElement(Y.a,{title:i.topicName},r.a.createElement("span",{className:"val"},i.topicName))),r.a.createElement("div",{className:"item"},r.a.createElement("span",{className:"field desc-field"},"描述 :"),r.a.createElement(Y.a,{title:i.description||"-"},r.a.createElement("span",{className:"desc-val"},i.description||"-")))),r.a.createElement(Q.a,{spinning:z},r.a.createElement("div",{className:"flow-chart",style:{height:247}},y&&r.a.createElement(gt.a,{showHeader:!1,wrapStyle:{width:"100%",height:268,marginTop:10},chartTypeProp:"line",propChartData:y,option:vt({title:{text:"{unit|单位: ".concat(y.metricUnit,"}"),top:0,left:-6},xAxis:{type:"time"},legend:{left:"center"},grid:{left:0,right:20,top:36},tooltip:{customWidth:160}}),seriesCallback:function(e){return e.metricLines.map((function(e){return Object.assign(Object.assign({},e),{areaStyle:{opacity:.06},lineStyle:{width:1},smooth:.25,symbol:"emptyCircle",symbolSize:4,emphasis:{disabled:!0}})}))}}))),r.a.createElement("div",{className:"operation"},r.a.createElement("div",{className:"partition-input"},r.a.createElement("div",{className:"cur"},r.a.createElement("div",{className:"num-txt"},"当前分区数："),r.a.createElement(Ft.a,{className:"num-input",disabled:!0,value:i.partitionNum,size:"small"}),r.a.createElement("span",{className:"remark"},"当前分区数预计最低可支持 ",S===1/0?"-":R(S)," 的消息写入速率")),r.a.createElement("div",{className:"expand-to"},r.a.createElement("div",{className:"num-txt"},"增加至："),r.a.createElement(J.a,{form:u},r.a.createElement(J.a.Item,{name:"incPartitionNum",style:{marginBottom:0}},r.a.createElement(Ft.a,{className:"num-input",size:"small",min:i.partitionNum,onChange:function(e){P(Number(e))}}))),r.a.createElement("span",{className:"remark"},"扩分区后预计最低可支持"," ",S===1/0?"-":R(S*(T?T/i.partitionNum:1))," ","的消息写入速率"))))))},jr=a(70),Ir=function(e){var t=e.defaultKey,a=e.activeKey,i=e.onChange,o=e.children,c=Object(n.useRef)(),s=Object(n.useState)(a||t),u=l()(s,2),m=u[0],d=u[1],f=Object(n.useState)({left:0,width:0}),p=l()(f,2),v=p[0],g=p[1];return Object(n.useLayoutEffect)((function(){var e;c.current&&ue()(null===(e=null==c?void 0:c.current)||void 0===e?void 0:e.children).some((function(e){return!!e.className.includes("active")&&(g({left:(null==e?void 0:e.offsetLeft)||0,width:(null==e?void 0:e.offsetWidth)||0}),!0)}))}),[m]),Object(n.useLayoutEffect)((function(){a&&d(a)}),[a]),r.a.createElement("div",{ref:c,className:"d-switch-tab"},o.map((function(e){var t=e.key;return r.a.createElement("div",{key:t,className:"d-switch-tab-content d-switch-tab-content-".concat(m===t?"active":""),onClick:function(){!a&&d(t),i(t)}},e)})),r.a.createElement("div",{className:"d-switch-tab-bar",style:Object.assign({},v)}))};Ir.TabItem=function(e){var t=e.key,a=e.children;return r.a.createElement("div",{key:t},a)};var wr=Ir,Tr=["LogEndOffset","LogStartOffset","Messages","LogSize"];for(var Pr,Lr=function(e){var t=g.a.useGlobalValue(),a=l()(t,1)[0],i=e.clusterId,o=e.hashData,c=e.record,s=e.brokerId,u=e.close,d=Object(n.useState)(!0),f=l()(d,2),p=f[0],v=f[1],h=Object(n.useState)([]),b=l()(h,2),E=b[0],y=b[1];return Object(n.useEffect)((function(){var e,t,n;e=c.partitionId,t=c.leaderBrokerId,n=c.inSync,m.a.request(K.getPartitionMetricInfo(i,o.topicName,s,e),{method:"POST",data:Tr}).then((function(e){var r,i,o,c=j.Replication,l=(null==e?void 0:e.metrics)||{},s=[{label:"LeaderBroker",value:t},{label:"BeginningOffset",value:"".concat(void 0===l.LogStartOffset?"-":l.LogStartOffset," ").concat((null===(r=a.getMetricDefine(c,"LogStartOffset"))||void 0===r?void 0:r.unit)||"")},{label:"EndOffset",value:"".concat(void 0===l.LogEndOffset?"-":l.LogEndOffset," ").concat((null===(i=a.getMetricDefine(c,"LogEndOffset"))||void 0===i?void 0:i.unit)||"")},{label:"MsgNum",value:"".concat(void 0===l.Messages?"-":l.Messages," ").concat((null===(o=a.getMetricDefine(c,"Messages"))||void 0===o?void 0:o.unit)||"")},{label:"LogSize",value:"".concat(void 0===l.LogSize?"-":m.a.formatAssignSize(l.LogSize,"MB")," MB")},{label:"是否同步",value:n?"是":"否"}];y(s),v(!1)}))}),[]),r.a.createElement(Q.a,{spinning:p},r.a.createElement("div",{className:"header"},r.a.createElement("div",{className:"title"},"分区详情"),r.a.createElement(Ht.a,{type:"text",icon:r.a.createElement(jr.a,{className:"close-icon"}),onClick:function(e){e.preventDefault(),e.stopPropagation(),u()}})),r.a.createElement("div",{className:"main"},r.a.createElement(Z.b,{itemLayout:"vertical",size:"small",dataSource:E,renderItem:function(e){return r.a.createElement(Z.b.Item,{key:e.label,extra:e.value},e.label)}})))},Mr=function(e){var t=e.clusterId,a=e.topicName,i=Object(n.useState)(null),o=l()(i,2),c=o[0],s=o[1];return Object(n.useEffect)((function(){m.a.request(K.getTopicPartitionsSummary(t,a)).then((function(e){s(e)}))}),[]),r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"info-box"},r.a.createElement("div",{className:"info-detail info-detail-title"},r.a.createElement("span",{className:"desc"},"Brokers 总数"),r.a.createElement("span",{className:"num"},null==c?void 0:c.brokerCount)),r.a.createElement("div",{className:"info-detail"},r.a.createElement("span",{className:"desc"},"live"),r.a.createElement("span",{className:"num"},null==c?void 0:c.liveBrokerCount)),r.a.createElement("div",{className:"info-detail"},r.a.createElement("span",{className:"desc"},"down"),r.a.createElement("span",{className:"num"},null==c?void 0:c.deadBrokerCount))),r.a.createElement("div",{className:"info-box"},r.a.createElement("div",{className:"info-detail info-detail-title"},r.a.createElement("span",{className:"desc"},"Partition 总数"),r.a.createElement("span",{className:"num"},null==c?void 0:c.partitionCount)),r.a.createElement("div",{className:"info-detail"},r.a.createElement("span",{className:"desc"},"No Leader"),r.a.createElement("span",{className:"num"},null==c?void 0:c.noLeaderPartitionCount)),r.a.createElement("div",{className:"info-detail"},r.a.createElement("span",{className:"desc"},"URP"),r.a.createElement("span",{className:"num"},null==c?void 0:c.underReplicatedPartitionCount))))},zr=function(e){var t,a=e.clusterId,i=e.hashData,o=Object(n.useState)(),c=l()(o,2),s=c[0],u=c[1],d=Object(n.useState)(-1),f=l()(d,2),p=f[0],v=f[1],g=Object(n.useState)(""),h=l()(g,2),b=h[0],E=h[1],y=Object(n.useState)(!0),k=l()(y,2),N=k[0],O=k[1],C=Object(n.useCallback)((function(){return E("")}),[]);return Object(n.useEffect)((function(){m.a.request(K.getTopicBrokersList(a,i.topicName)).then((function(e){u(e),O(!1)}),(function(){return O(!1)}))}),[]),r.a.createElement(Q.a,{spinning:N},r.a.createElement("div",{className:"broker-container"},(null===(t=null==s?void 0:s.brokerPartitionStateList)||void 0===t?void 0:t.length)?null==s?void 0:s.brokerPartitionStateList.map((function(e){var t,n;return r.a.createElement("div",{className:"broker-container-box",key:e.brokerId},r.a.createElement("div",{className:"broker-container-box-header"},r.a.createElement("div",{className:"header-info"},r.a.createElement("div",{className:"label"},"Broker"),r.a.createElement("div",{className:"value"},e.brokerId)),r.a.createElement("div",{className:"header-info"},r.a.createElement("div",{className:"label"},"Host ID"),r.a.createElement("div",{className:"value"},e.host||"-")),["BytesIn","BytesOut"].map((function(t){return r.a.createElement("div",{className:"header-info",key:t},r.a.createElement("div",{className:"label"},t),r.a.createElement("div",{className:"value"},function(e){var t=["B","KB","MB","GB","TB"],a=0,n=!0,r=e;if("number"!=typeof r&&(r=Number(r),isNaN(r)))return[r,t[a]];for(;n;)r/1024>=1?(r/=1024,a++):n=!1;return[r.toFixed(2),t[a]]}("BytesIn"===t?e.bytesInOneMinuteRate:e.bytesOutOneMinuteRate).map((function(e,t){return t?r.a.createElement("span",{className:"unit"},e,"/s"):r.a.createElement("span",null,e)}))))}))),r.a.createElement("div",{className:"broker-container-box-detail"},e.alive&&(null===(t=null==e?void 0:e.replicaList)||void 0===t?void 0:t.length)?r.a.createElement("div",{className:"partition-list ".concat(-1!==p?"partition-list-hover-state":"")},null===(n=null==e?void 0:e.replicaList)||void 0===n?void 0:n.map((function(t){return r.a.createElement("div",{key:t.partitionId,className:"partition-list-item partition-list-item-".concat(t.isLeaderReplace?"leader":t.inSync?"isr":"osr"," ").concat(t.partitionId===p?"partition-active":""),onMouseEnter:function(){return v(t.partitionId)},onMouseLeave:function(){return v(-1)},onClick:function(){return E("".concat(e.brokerId,"&").concat(t.partitionId))}},r.a.createElement(Ya.a,{visible:b==="".concat(e.brokerId,"&").concat(t.partitionId),onVisibleChange:function(e){return!e&&C()},overlayClassName:"broker-partition-popover",content:r.a.createElement(Lr,{clusterId:a,hashData:i,record:t,brokerId:e.brokerId,close:C}),destroyTooltipOnHide:!0,trigger:"click",placement:"rightTop"},t.partitionId))}))):r.a.createElement(Sn,{message:"暂无数据",height:"unset"})))})):N?r.a.createElement(r.a.Fragment,null):r.a.createElement(Ea.a,{style:{margin:"0 auto",marginTop:100}})))},Dr=function(e){var t=e.clusterId,a=e.hashData,i=Object(n.useState)(!0),o=l()(i,2),c=o[0],s=o[1],u=Object(n.useState)([]),d=l()(u,2),f=d[0],p=d[1],v=[{title:"Partition ID",dataIndex:"partitionId"},{title:"StartOffset",dataIndex:["latestMetrics","metrics","LogStartOffset"]},{title:"EndOffset",dataIndex:["latestMetrics","metrics","LogEndOffset"]},{title:"MsgNum",dataIndex:["latestMetrics","metrics","Messages"]},{title:"Leader Broker",dataIndex:"leaderBrokerId"},{title:"LogSize(MB)",dataIndex:["latestMetrics","metrics","LogSize"],render:function(e){return void 0===e?"-":m.a.formatAssignSize(e,"MB")}},{title:"AR",dataIndex:"assignReplicas",width:180,render:function(e){return r.a.createElement($a,{list:e,expandTagContent:function(e){return"共有".concat(e,"个")}})}},{title:"ISR",dataIndex:"inSyncReplicas",width:180,render:function(e){return r.a.createElement($a,{list:e,expandTagContent:function(e){return"共有".concat(e,"个")}})}}];return Object(n.useEffect)((function(){m.a.request(K.getTopicPartitionsDetail(t,a.topicName),{method:"POST",data:Tr}).then((function(e){p(e),s(!1)}))}),[]),r.a.createElement(In.a,{tableProps:{loading:c,rowKey:"partitionId",columns:v,dataSource:f,showHeader:!1}})},Rr=function(e){var t=Object(s.useParams)().clusterId,a=e.hashData,i=Object(n.useState)("card"),o=l()(i,2),c=o[0],u=o[1];return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"brokers-tab-container"},r.a.createElement("div",{className:"overview"},r.a.createElement("div",{className:"left"},r.a.createElement(Mr,{clusterId:t,topicName:a.topicName})),r.a.createElement("div",{className:"cases-box"},"card"===c&&r.a.createElement("div",{className:"broker-cases"},r.a.createElement("div",{className:"case case-leader"},r.a.createElement("div",{className:"icon"}),r.a.createElement("div",{className:"desc"},"Leader")),r.a.createElement("div",{className:"case case-isr"},r.a.createElement("div",{className:"icon"}),r.a.createElement("div",{className:"desc"},"ISR")),r.a.createElement("div",{className:"case case-osr"},r.a.createElement("div",{className:"icon"}),r.a.createElement("div",{className:"desc"},"OSR"))),r.a.createElement(wr,{defaultKey:"card",onChange:function(e){u(e)}},r.a.createElement(wr.TabItem,{key:"card"},r.a.createElement("div",{style:{width:34,height:23}},r.a.createElement(h.a,{type:"icon-tubiao"}))),r.a.createElement(wr.TabItem,{key:"table"},r.a.createElement("div",{style:{width:34,height:23}},r.a.createElement(h.a,{type:"icon-biaoge"})))))),"card"===c?r.a.createElement(zr,{clusterId:t,hashData:a}):r.a.createElement(Dr,{clusterId:t,hashData:a})))},Fr=a(326),Br=a(488),Hr=a.n(Br),Ar=function(e){var t=e.content,a=Object(n.useState)(!1),i=l()(a,2),o=i[0],c=i[1];return r.a.createElement(Hr.a,{text:t},r.a.createElement("div",{className:"content-with-copy"},r.a.createElement(Y.a,{title:t},r.a.createElement("span",{className:"content"},t)),t&&r.a.createElement(Y.a,{title:r.a.createElement("span",null,r.a.createElement(Fr.a,{style:{color:"#00b365"}})," 复制成功"),visible:o,onVisibleChange:function(){return c(!1)}},r.a.createElement(h.a,{className:"copy-icon",type:"icon-fuzhi",onClick:function(){return c(!0)}}))))},Vr={0:"UNKNOWN",1:"ANY",2:"ALL",3:"READ",4:"WRITE",5:"CREATE",6:"DELETE",7:"ALTER",8:"DESCRIBE",9:"CLUSTER_ACTION",10:"DESCRIBE_CONFIGS",11:"ALTER_CONFIGS",12:"IDEMPOTENT_WRITE"},Kr={0:"UNKNOWN",1:"ANY",2:"DENY",3:"ALLOW"},_r={0:"UNKNOWN",1:"ANY",2:"MATCH",3:"LITERAL",4:"PREFIXED"},Ur=function(e,t,a,n){return new(a||(a=Promise))((function(r,i){function o(e){try{l(n.next(e))}catch(e){i(e)}}function c(e){try{l(n.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,c)}l((n=n.apply(e,t||[])).next())}))},Gr=m.a.request,qr={truncate:!0,maxRecords:100,pullTimeoutUnitMs:5e3,filterOffsetReset:0},Jr={current:1,pageSize:10,position:"bottomRight",showSizeChanger:!0,pageSizeOptions:["10","20","50","100"]},Wr=function(e){var t=e.hashData,a=Object(s.useParams)(),i=(Object(s.useHistory)(),Object(n.useState)(!1)),o=l()(i,2),c=o[0],u=o[1],m=Object(n.useState)([]),d=l()(m,2),f=d[0],p=d[1],v=Object(n.useState)(qr),g=l()(v,2),b=g[0],E=g[1],y=Object(n.useState)([]),k=l()(y,2),N=k[0],O=k[1],C=Object(n.useState)(Jr),S=l()(C,2),x=S[0],j=S[1],I=J.a.useForm(),w=l()(I,1)[0],T=Object(n.useState)({sortField:"timestampUnitMs",sortType:"desc"}),P=l()(T,2),L=P[0],M=P[1],z=function(){return Ur(void 0,void 0,void 0,q.a.mark((function e(){return q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==(null==a?void 0:a.clusterId)&&void 0!==(null==t?void 0:t.topicName)){e.next=2;break}return e.abrupt("return");case 2:u(!0),Gr(K.getTopicMessagesMetadata(null==t?void 0:t.topicName,null==a?void 0:a.clusterId)).then((function(e){var t=null==e?void 0:e.partitionIdList.map((function(e){return{label:e,value:e}}));O(t||[])})),Gr(K.getTopicMessagesList(null==t?void 0:t.topicName,null==a?void 0:a.clusterId),{data:Object.assign(Object.assign({},b),L),method:"POST"}).then((function(e){p(e||[]),u(!1)})).catch((function(e){u(!1)}));case 5:case"end":return e.stop()}}),e)})))};return Object(n.useEffect)((function(){"Messages"===e.positionType&&z()}),[e,b,L]),r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"}},r.a.createElement("div",null,r.a.createElement("span",{style:{display:"inline-block",padding:"0 10px",marginRight:"10px",borderRight:"1px solid #ccc",fontSize:"13px"},onClick:function(){j(Jr),z()}},r.a.createElement("i",{className:"iconfont icon-shuaxin1",style:{fontSize:"13px",cursor:"pointer"}})),r.a.createElement("span",{style:{fontSize:"13px"}},r.a.createElement(ia.a,{checked:b.truncate,onChange:function(e){E(Object.assign(Object.assign({},b),{truncate:e.target.checked}))}},"是否要截断数据")),r.a.createElement(Y.a,{title:"截断数据后只展示前1024字符的数据"},r.a.createElement(h.a,{style:{fontSize:"14px"},type:"icon-zhushi"}))),r.a.createElement("div",{className:"messages-query"},r.a.createElement(J.a,{form:w,layout:"inline",onFinish:function(e){E(Object.assign(Object.assign(Object.assign({},b),e),{filterKey:(null==e?void 0:e.filterKey)?null==e?void 0:e.filterKey:void 0}))}},r.a.createElement(J.a.Item,{name:"filterOffsetReset"},r.a.createElement(oa.a,{options:[{label:"latest",value:0},{label:"earliest",value:1}],size:"small",style:{width:"120px"},className:"detail-table-select",placeholder:"请选择offset"})),r.a.createElement(J.a.Item,{name:"filterPartitionId"},r.a.createElement(oa.a,{options:N,size:"small",style:{width:"140px"},className:"detail-table-select",placeholder:"请选择分区"})),r.a.createElement(J.a.Item,{name:"filterKey"},r.a.createElement(W.a,{size:"small",style:{width:"140px"},className:"detail-table-input",placeholder:"请输入key"})),r.a.createElement(J.a.Item,{name:"filterValue"},r.a.createElement(W.a,{size:"small",style:{width:"140px"},className:"detail-table-input",placeholder:"请输入value"})),r.a.createElement(J.a.Item,null,r.a.createElement(Ht.a,{size:"small",type:"primary",ghost:!0,htmlType:"submit"},"查询"))))),r.a.createElement("div",null,r.a.createElement(gr.a,{style:{margin:"12px 0 4px",padding:"7px 12px",background:"#FFF9E6"},message:r.a.createElement("div",null,"此处展示 Topic 的 100 条 messages。",""),type:"warning",closable:!0})),r.a.createElement(In.a,{showQueryForm:!1,tableProps:{showHeader:!1,rowKey:"offset",loading:c,columns:[{title:"Partition",dataIndex:"partitionId",key:"partitionId"},{title:"Offset",dataIndex:"offset",key:"offset",render:function(e){return e?e.toLocaleString():"-"}},{title:"Timestamp",dataIndex:"timestampUnitMs",key:"timestampUnitMs",sorter:!0,render:function(e){return e?ce()(e).format(de)+"."+ce()(e).millisecond():"-"}},{title:"Key",dataIndex:"key",key:"key",needTooltip:!0,lineClampOne:!0},{title:"Value",dataIndex:"value",key:"value",width:280,render:function(e){return e?r.a.createElement(Ar,{content:e}):"-"}},{title:"Header",dataIndex:"headerList",key:"headerList",needTooltip:!0,lineClampTwo:!0,width:280,render:function(e){if(e&&Array.isArray(e)){var t=e.map((function(e){try{return JSON.stringify(e)}catch(t){return e}}));return(null==t?void 0:t.join("、"))||"-"}return e||"-"}}],dataSource:f,paginationProps:x,attrs:{bordered:!1,onChange:function(e,t,a,n){j(e),"sort"===n.action&&M({sortField:a.field||"",sortType:a.order?a.order.substring(0,a.order.indexOf("end")):""})},scroll:{x:"max-content"},sortDirections:["descend","ascend","default"]}}}))},Zr=function(e,t,a,n){return new(a||(a=Promise))((function(r,i){function o(e){try{l(n.next(e))}catch(e){i(e)}}function c(e){try{l(n.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,c)}l((n=n.apply(e,t||[])).next())}))},Yr=m.a.request,Qr=function(e){var t=e.hashData,a=Object(s.useParams)(),i=Object(n.useState)(!1),o=l()(i,2),c=o[0],u=o[1],m=Object(n.useState)([]),d=l()(m,2),f=d[0],p=d[1],v=Object(n.useState)({current:1,pageSize:10,position:"bottomRight",showSizeChanger:!0,pageSizeOptions:["10","20","50","100","200","500"],showTotal:function(e){return"共 ".concat(e," 条目")}}),g=l()(v,2),h=g[0],b=g[1],E={sortField:"kafkaUser",sortType:"asc"},y=function(n){var r=n.pageNo,i=n.pageSize;n.filters,n.sorter;return Zr(void 0,void 0,void 0,q.a.mark((function n(){var o;return q.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(void 0!==(null==a?void 0:a.clusterId)&&void 0!==(null==t?void 0:t.topicName)){n.next=2;break}return n.abrupt("return");case 2:u(!0),o=Object.assign({searchKeywords:e.searchKeywords?e.searchKeywords.slice(0,128):"",pageNo:r,pageSize:i},E),Yr(K.getTopicACLsList(null==t?void 0:t.topicName,null==a?void 0:a.clusterId),{params:o}).then((function(e){var t,a,n;b({current:null===(t=e.pagination)||void 0===t?void 0:t.pageNo,pageSize:null===(a=e.pagination)||void 0===a?void 0:a.pageSize,total:null===(n=e.pagination)||void 0===n?void 0:n.total}),p((null==e?void 0:e.bizData)||[]),u(!1)})).catch((function(e){u(!1)}));case 5:case"end":return n.stop()}}),n)})))};return Object(n.useEffect)((function(){"ACLs"===e.positionType&&y({pageNo:1,pageSize:h.pageSize})}),[e.searchKeywords,e.positionType]),r.a.createElement(In.a,{showQueryForm:!1,tableProps:{showHeader:!1,rowKey:"path",loading:c,columns:[{title:"Principle",dataIndex:"kafkaUser",key:"kafkaUser"},{title:"Operations",dataIndex:"aclOperation",key:"aclOperation",render:function(e){return e||0===e?Vr[e]:"-"}},{title:"Permission Type",dataIndex:"aclPermissionType",key:"aclPermissionType",render:function(e){return e||0===e?Kr[e]:"-"}},{title:"Pattern Type",dataIndex:"resourcePatternType",key:"resourcePatternType",render:function(e){return e||0===e?_r[e]:"-"}}],dataSource:f,paginationProps:Object.assign({},h),attrs:{bordered:!1,onChange:function(e,t,a){y({pageNo:e.current,pageSize:e.pageSize})}}}})},$r=function(e){var t,a,n=Object(s.useParams)(),i=J.a.useForm(),o=l()(i,1)[0],c=function(){e.setVisible(!1)};return r.a.useEffect((function(){o.setFieldsValue(e.record)}),[e.record]),r.a.createElement(ya.a,{title:r.a.createElement(la.b,{size:0},r.a.createElement(Ht.a,{className:"drawer-title-left-button",type:"text",size:"small",icon:r.a.createElement(h.a,{type:"icon-fanhui1"}),onClick:c}),r.a.createElement($.a,{type:"vertical"}),r.a.createElement("span",{style:{paddingLeft:"5px"}},"编辑配置")),width:580,visible:e.visible,onClose:function(){return e.setVisible(!1)},maskClosable:!1,destroyOnClose:!0,extra:r.a.createElement(la.b,null,r.a.createElement(Ht.a,{size:"small",onClick:c},"取消"),r.a.createElement(Ht.a,{size:"small",type:"primary",onClick:function(){o.validateFields().then((function(t){var a,r,i={changedProps:H()({},null===(a=e.record)||void 0===a?void 0:a.name,t.newValue),clusterId:Number(n.clusterId),topicName:null===(r=e.hashData)||void 0===r?void 0:r.topicName};m.a.put(K.getTopicEditConfig(),i).then((function(t){ie.success("编辑配置成功"),e.setVisible(!1),e.genData({pageNo:1,pageSize:10})})).catch((function(e){}))}))}},"确认"),r.a.createElement("div",{style:{width:"1px",height:"17px",background:"rgba(0, 0, 0, 0.13)",margin:"0 16px 0 10px"}}))},r.a.createElement(Bt.a,{gutter:[12,12],className:"desc-row"},r.a.createElement(hn.a,{span:3,className:"label-col"},"配置名:"),r.a.createElement(hn.a,{span:21,className:"value-col"},(null===(t=e.record)||void 0===t?void 0:t.name)||"-"),r.a.createElement(hn.a,{span:3,className:"label-col"},"描述:"),r.a.createElement(hn.a,{span:21,className:"value-col"},(null===(a=e.record)||void 0===a?void 0:a.documentation)||"-")),r.a.createElement(J.a,{form:o,layout:"vertical"},r.a.createElement(J.a.Item,{name:"defaultValue",label:"Kafka默认配置"},r.a.createElement(W.a,{disabled:!0})),r.a.createElement(J.a.Item,{name:"value",label:"当前配置"},r.a.createElement(W.a,{disabled:!0})),r.a.createElement(J.a.Item,{name:"newValue",label:"新配置",rules:[{required:!0,message:"请输入新的配置值！！！"}]},r.a.createElement(W.a,null))))},Xr=function(e,t,a,n){return new(a||(a=Promise))((function(r,i){function o(e){try{l(n.next(e))}catch(e){i(e)}}function c(e){try{l(n.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,c)}l((n=n.apply(e,t||[])).next())}))},ei=m.a.request,ti=function(e){var t,a,i=e.hashData,o=Object(s.useParams)(),c=g.a.useGlobalValue(),u=l()(c,1)[0],m=Object(n.useState)(!1),d=l()(m,2),f=d[0],p=d[1],v=Object(n.useState)([]),h=l()(v,2),b=h[0],E=h[1],y=Object(n.useState)([]),k=l()(y,2),N=k[0],O=k[1],C=Object(n.useState)({current:1,pageSize:10,position:"bottomRight",showSizeChanger:!0,pageSizeOptions:["10","20","50","100","200","500"],showTotal:function(e){return"共 ".concat(e," 条目")}}),S=l()(C,2),x=S[0],j=S[1],I=Object(n.useState)(!1),w=l()(I,2),T=w[0],P=w[1],L=Object(n.useState)(null),M=l()(L,2),z=M[0],D=M[1],R=Object(n.useState)(null),F=l()(R,2),B=F[0],H=F[1],A=Object(n.useState)(null),_=l()(A,2),U=_[0],G=_[1],J=function(t){var a=t.pageNo,n=t.pageSize;return Xr(void 0,void 0,void 0,q.a.mark((function t(){var r;return q.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(void 0!==(null==o?void 0:o.clusterId)&&void 0!==(null==i?void 0:i.topicName)){t.next=2;break}return t.abrupt("return");case 2:p(!0),r={searchKeywords:e.searchKeywords?e.searchKeywords.slice(0,128):void 0,pageNo:a,pageSize:n,preciseFilterDTOList:N.length>0?N.map((function(e){return{fieldName:e,fieldValueList:["readOnly"!==e],include:!0}})):void 0},ei(K.getTopicConfigs(null==i?void 0:i.topicName,null==o?void 0:o.clusterId),{data:r,method:"POST"}).then((function(e){var t,a,n;j({current:null===(t=e.pagination)||void 0===t?void 0:t.pageNo,pageSize:null===(a=e.pagination)||void 0===a?void 0:a.pageSize,total:null===(n=e.pagination)||void 0===n?void 0:n.total}),E((null==e?void 0:e.bizData)||[])})).finally((function(){p(!1)}));case 5:case"end":return t.stop()}}),t)})))};return Object(n.useEffect)((function(){"Configuration"===e.positionType&&J({pageNo:1,pageSize:x.pageSize})}),[e.searchKeywords,N]),r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"detail-header-cases",style:{padding:"0 0 12px"}},r.a.createElement(ia.a.Group,{options:[{label:"Show Overrides Only",value:"override"}],value:N,onChange:function(e){O(e)}})),r.a.createElement(In.a,{showQueryForm:!1,tableProps:{showHeader:!1,rowKey:"path",loading:f,columns:(t={setEditOp:function(e){P(!0),D(e)},readOnlyRecord:U,readOnlyVisible:B,allowEdit:u.hasPermission&&u.hasPermission(V.TOPIC_CHANGE_CONFIG)},a=[{title:"配置名",dataIndex:"name",key:"name",width:250},{title:"描述",dataIndex:"documentation",key:"documentation",width:300,lineClampTwo:!0,needTooltip:!0},{title:"配置值",dataIndex:"value",key:"value",width:300,lineClampTwo:!0}],t.allowEdit&&a.push({title:"操作",dataIndex:"option",key:"option",render:function(e,a){return a.readOnly?"-":r.a.createElement("a",{onClick:function(){return t.setEditOp(a)}},"编辑")}}),a),dataSource:b,paginationProps:Object.assign({},x),attrs:{bordered:!1,onChange:function(e,t,a){J({pageNo:e.current,pageSize:e.pageSize})},onRow:function(e){return(null==e?void 0:e.readOnly)?{onMouseEnter:function(){H(!0),G(e)},onMouseLeave:function(){H(!1),G(null)}}:{}}}}}),r.a.createElement($r,{record:z,hashData:i,visible:T,setVisible:P,genData:J}))},ai=a(394),ni=a(948),ri=a(166),ii=a(514),oi=function(e,t,a,n){return new(a||(a=Promise))((function(r,i){function o(e){try{l(n.next(e))}catch(e){i(e)}}function c(e){try{l(n.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,c)}l((n=n.apply(e,t||[])).next())}))},ci=function(e,t){var a={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(n=Object.getOwnPropertySymbols(e);r<n.length;r++)t.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(e,n[r])&&(a[n[r]]=e[n[r]])}return a},li=function(e){var t=e.editing,a=e.dataIndex,n=(e.title,e.inputType),i=e.placeholder,o=(e.record,e.index,e.children),c=e.options,l=ci(e,["editing","dataIndex","title","inputType","placeholder","record","index","children","options"]),s="number"===n?r.a.createElement(Ft.a,{min:0,precision:0,style:{width:"130px"},autoComplete:"off",placeholder:i}):"select"===n?r.a.createElement(oa.a,{style:{width:"140px"},options:c||[],placeholder:i}):r.a.createElement(W.a,{autoComplete:"off",placeholder:i});return r.a.createElement("td",Object.assign({},l),t?r.a.createElement(J.a.Item,{name:a,style:{margin:0},rules:[{required:!0,message:"请输入!"}]},s):o)},si=r.a.forwardRef((function(e,t){var a=e.colCustomConfigs,i=J.a.useForm(),o=l()(i,1)[0],c=Object(n.useState)([]),s=l()(c,2),u=s[0],m=s[1],d=Object(n.useState)(0),f=l()(d,2),p=f[0],v=f[1],g=function(e){return e.editKey===p},b=function(){return u},E=function(){m([])};r.a.useImperativeHandle(t,(function(){return{getTableData:b,resetTable:E}}));var y=[{title:"key",dataIndex:"key",width:40,editable:!0},{title:"value",dataIndex:"value",width:40,editable:!0},{title:"",dataIndex:"operation",width:20,className:"no-padding",render:function(e,t){return g(t)?r.a.createElement("span",null,r.a.createElement(ni.a.Link,{onClick:function(){return e=t.editKey,oi(void 0,void 0,void 0,q.a.mark((function t(){var a,n,r,i;return q.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,o.validateFields();case 3:a=t.sent,n=ue()(u),(r=n.findIndex((function(t){return e===t.editKey})))>-1?(i=n[r],n.splice(r,1,Object.assign(Object.assign({},i),a)),m(n),v(0)):(n.push(a),m(n),v(0)),t.next=12;break;case 9:t.prev=9,t.t0=t.catch(0),console.log("Validate Failed:",t.t0);case 12:case"end":return t.stop()}}),t,null,[[0,9]])})));var e},style:{marginRight:8}},r.a.createElement(ri.a,null)),r.a.createElement("a",null,r.a.createElement(jr.a,{onClick:function(){return function(e){if(""===e.key){var t=u.filter((function(t){return t.editKey!==e.editKey}));m(t)}v(0)}(t)}}))):r.a.createElement(r.a.Fragment,null,r.a.createElement(ni.a.Link,{className:"custom-typography",disabled:0!==p,style:{marginRight:8},onClick:function(){return function(e){o.setFieldsValue(Object.assign({key:"",value:""},e)),v(e.editKey)}(t)}},r.a.createElement(h.a,{type:"icon-bianji1",size:11})),r.a.createElement(ni.a.Link,{className:"custom-typography",disabled:0!==p,onClick:function(){return function(e){var t=u.filter((function(t){return t.editKey!==e.editKey}));m(t)}(t)}},r.a.createElement(h.a,{type:"icon-shanchu1",size:11})))}}].map((function(e,t){var n;return e.editable?Object.assign(Object.assign({},e),{onCell:function(n){return Object.assign({record:n,inputType:"text",dataIndex:e.dataIndex,title:e.title,editing:g(n)},null==a?void 0:a[t])},title:(null===(n=null==a?void 0:a[t])||void 0===n?void 0:n.title)||e.title}):e}));return r.a.createElement("div",{className:"edit-table-form"},r.a.createElement(J.a,{form:o,component:!1},r.a.createElement(Wa.a,{components:{body:{cell:li}},dataSource:u,columns:y,rowClassName:"editable-row",pagination:!1})),r.a.createElement("div",{className:"add-btn"},r.a.createElement(Ht.a,{type:"link",onClick:function(){if(0===p){o.resetFields();var e=u.length?u[u.length-1].editKey+1:1;m([].concat(ue()(u),[{key:"",value:"",editKey:e}])),v(e)}else ie.error("请先保存当前编辑项")}},r.a.createElement(ii.a,null)," 新增条件")))})),ui=function(e){var t=e.value,a=e.onChange,i=Object(n.useState)("newest"),o=l()(i,2),c=o[0],s=o[1];return Object(n.useEffect)((function(){a("newest")}),[]),r.a.createElement(r.a.Fragment,null,r.a.createElement(ba.a.Group,{style:{marginBottom:20},onChange:function(e){s(e.target.value),"newest"!==e.target.value&&"oldest"!==e.target.value||a(e.target.value)},value:c},r.a.createElement(ba.a,{value:"newest"},"最新Offset"),r.a.createElement(ba.a,{value:"oldest"},"最旧Offset"),r.a.createElement(ba.a,{value:"custom"},"自定义")),"custom"===c&&r.a.createElement(ai.a,{value:ce()("newest"===t||"oldest"===t?Date.now():t),style:{width:"100%"},showTime:!0,onChange:function(e){a(e.valueOf())}}))},mi=function(e){var t=e.record,a=Object(s.useParams)(),i=J.a.useForm(),o=l()(i,1)[0],c=Object(n.useState)("assignedTime"),u=l()(c,2),d=u[0],f=u[1],p=Object(n.useState)(!1),v=l()(p,2),g=v[0],h=v[1],b=r.a.createRef(),E=Number(a.clusterId),y=Object(n.useState)([]),N=l()(y,2),O=N[0],C=N[1];Object(n.useEffect)((function(){o.setFieldsValue({resetType:"assignedTime"})}),[]),Object(n.useEffect)((function(){m.a.request(K.getTopicsMetaData(null==t?void 0:t.topicName,+a.clusterId)).then((function(e){var t=((null==e?void 0:e.partitionIdList)||[]).map((function(e){return{label:e,value:e}}));C(t)})).catch((function(e){X.b.error(e)}))}),[]);return r.a.createElement(r.a.Fragment,null,r.a.createElement(Ht.a,{size:"small",type:"primary",onClick:function(e){h(!0)}},"重置Offset"),r.a.createElement(ya.a,{title:"重置Offset",width:480,visible:g,maskClosable:!1,extra:r.a.createElement(la.b,null,r.a.createElement(Ht.a,{size:"small",style:{marginRight:8},onClick:function(e){h(!1)}},"取消"),r.a.createElement(Ht.a,{size:"small",type:"primary",onClick:function(){var e;b.current&&(e=b.current.getTableData());var a=o.getFieldsValue(),n={clusterId:E,createIfNotExist:!1,groupName:t.groupName,topicName:t.topicName};"assignedTime"===a.resetType&&(n.resetType="newest"===a.timestamp?0:"oldest"===a.timestamp?1:2,2===n.resetType&&(n.timestamp=a.timestamp)),"partition"===a.resetType&&(n.resetType=3,n.offsetList=e?e.map((function(e){return{partitionId:e.key,offset:e.value}})):[]),m.a.put(K.resetGroupOffset(),n).then((function(e){null===e?(k.a.success({message:"重置offset成功"}),h(!1)):(k.a.error({message:"重置offset失败"}),h(!1))}))}},"确定"),r.a.createElement($.a,{type:"vertical"})),className:"cluster-detail-consumer-resetoffset",onClose:function(e){h(!1)}},r.a.createElement(J.a,{form:o,labelCol:{span:5},layout:"vertical",className:"reset-offset-form"},r.a.createElement(J.a.Item,{name:"resetType",label:"重置类型",required:!0},r.a.createElement(ba.a.Group,{defaultValue:"assignedTime",value:d,onChange:function(e){f(e.target.value)}},r.a.createElement(ba.a,{value:"assignedTime"},"重置到指定时间"),r.a.createElement(ba.a,{value:"partition"},"重置分区"))),"assignedTime"===d&&r.a.createElement(J.a.Item,{name:"timestamp",label:"时间",required:!0},r.a.createElement(ui,null)),"partition"===d&&r.a.createElement(J.a.Item,{name:"partition",label:"分区及偏移",required:!0},r.a.createElement(si,{ref:b,colCustomConfigs:[{title:"PartitionID",inputType:"select",placeholder:"请输入Partition",options:O},{title:"Offset",inputType:"number",placeholder:"请输入Offset"}]})))))},di=oa.a.Option,fi=["LogEndOffset","OffsetConsumed","Lag"],pi=[{metricName:"LogEndOffset",metricType:104},{metricName:"OffsetConsumed",metricType:102},{metricName:"Lag",metricType:102}],vi=function(e){var t=e.scene,a=e.visible,i=e.setVisible,o=e.hashData,c=Object(s.useParams)(),u=(Object(s.useHistory)(),g.a.useGlobalValue()),d=l()(u,1)[0],f=Date.now(),p=Object(n.useState)([]),v=l()(p,2),b=v[0],E=v[1],y=Object(n.useState)([]),k=l()(y,2),N=k[0],O=k[1],C=Object(n.useState)([f-864e5,f]),S=l()(C,2),x=S[0],j=S[1],I=Object(n.useState)([]),w=l()(I,2),T=w[0],P=w[1],L=Object(n.useState)([]),M=l()(L,2),z=M[0],D=M[1],R=Object(n.useState)(""),F=l()(R,2),B=F[0],H=F[1],A=Object(n.useState)("table"),_=l()(A,2),U=_[0],G=_[1],q=Object(n.useState)(1),J=l()(q,2),W=(J[0],J[1],Object(n.useState)(1)),Z=l()(W,2),Y=(Z[0],Z[1],Object(n.useState)(10)),Q=l()(Y,2),X=(Q[0],Q[1],Object(n.useState)(!0)),ee=l()(X,2),te=ee[0],ae=ee[1],ne=Object(n.useState)(!1),re=l()(ne,2),ie=(re[0],re[1],Object(n.useState)({sortField:"",sortType:""})),oe=l()(ie,2),ce=(oe[0],oe[1]),le=Object(n.useState)({current:1,pageSize:10,position:"bottomRight",showSizeChanger:!0,pageSizeOptions:["10","20","50","100","200","500"],showTotal:function(e){return"共 ".concat(e," 条目")}}),se=l()(le,2),ue=se[0],me=se[1],de=Number(c.clusterId),fe=[{title:"Topic Partition",dataIndex:"partitionId",key:"partitionId",lineClampOne:!0,needTooltip:!0,width:180,render:function(e,t){return"".concat(t.topicName,"-").concat(e)}},{title:"Member ID",dataIndex:"memberId",key:"memberId",width:200,render:function(e){return e?r.a.createElement(Ar,{content:e}):"-"}},{title:"Current Offset",dataIndex:"OffsetConsumed",key:"OffsetConsumed",render:function(e,t){var a,n;return null===(n=null===(a=null==t?void 0:t.latestMetrics)||void 0===a?void 0:a.metrics)||void 0===n?void 0:n.OffsetConsumed.toLocaleString()},sorter:!0},{title:"Log End Offset",dataIndex:"LogEndOffset",key:"LogEndOffset",render:function(e,t){var a,n;return null===(n=null===(a=null==t?void 0:t.latestMetrics)||void 0===a?void 0:a.metrics)||void 0===n?void 0:n.LogEndOffset.toLocaleString()},sorter:!0},{title:"Lag",dataIndex:"Lag",key:"Lag",render:function(e,t){var a,n;return null===(n=null===(a=null==t?void 0:t.latestMetrics)||void 0===a?void 0:a.metrics)||void 0===n?void 0:n.Lag.toLocaleString()},sorter:!0},{title:"Host",dataIndex:"host",key:"host"},{title:"Client ID",dataIndex:"clientId",key:"clientId",needTooltip:!0,lineClampOne:!0,width:200}],pe=function(e){var t=e.hashData,a=e.pagination,n=void 0===a?{current:1,pageSize:10}:a,r=e.sorter,i=void 0===r?{}:r;ae(!0);var o={latestMetricNames:fi,pageNo:n.current,pageSize:n.pageSize,sortField:i.field||void 0,sortType:i.order?i.order.substring(0,i.order.indexOf("end")):void 0};return m.a.post(K.getTopicGroupMetric({clusterId:de,groupName:t.groupName,topicName:t.topicName}),o).then((function(e){var t,a,n;e&&(me({current:null===(t=e.pagination)||void 0===t?void 0:t.pageNo,pageSize:null===(a=e.pagination)||void 0===a?void 0:a.pageSize,total:null===(n=e.pagination)||void 0===n?void 0:n.total}),P(null==e?void 0:e.bizData))})).finally((function(){ae(!1)}))},ve=function(e,t){var a={aggType:"sum",groupTopics:null==e?void 0:e.map((function(e){return{partition:e.value,topic:t.topicName}})),group:t.groupName,metricsNames:pi.map((function(e){return e.metricName})),startTime:x[0],endTime:x[1],topNu:0};m.a.post(K.getTopicGroupMetricHistory(de),a).then((function(e){E(e)}))};return Object(n.useEffect)((function(){if(""!==B&&0!==b.length){var e=b.map((function(e){var t=e.metricLines.reduce((function(e,t){return 0===e.metricLine.metricPoints.length?e.metricLine.metricPoints=t.metricPoints.map((function(e){return{timeStamp:e.timeStamp,value:Number(e.value)}})):e.metricLine.metricPoints.forEach((function(e){var a=t.metricPoints.find((function(t){return t.timeStamp===e.timeStamp}));e.value+=a?Number(a.value):0})),e}),{metricName:e.metricName,metricLine:{name:"all",metricPoints:[]}});return"__all__"===B?t:{metricName:e.metricName,metricLine:e.metricLines.find((function(e){return e.name.indexOf(B)>=0}))}}));O(e)}}),[B,b]),Object(n.useEffect)((function(){o.groupName&&o.topicName&&a&&function(e){return m.a.request(K.getConsumersMetadata(de,e.groupName,e.topicName))}(o).then((function(e){e.exist?(function(e){return m.a.request(K.getTopicsMetaData(e.topicName,de))}(o).then((function(e){var t,a=((null==e?void 0:e.partitionIdList)||[]).map((function(e){return{label:e,value:e}}));H(null===(t=null==a?void 0:a[0])||void 0===t?void 0:t.value),D(a),ve(a,o)})).catch((function(e){i(!1)})),pe({hashData:o})):i(!1)}))}),[a]),Object(n.useEffect)((function(){0!==z.length&&ve(z,o)}),[x]),r.a.createElement(ya.a,{push:!1,title:"Consumer Group详情",width:1080,placement:"right",onClose:function(){i(!1),ce({sortField:"",sortType:""})},visible:a,className:"consumer-group-detail-drawer",maskClosable:!1,destroyOnClose:!0,extra:r.a.createElement(la.b,null,d.hasPermission&&d.hasPermission("topicDetail"===t?V.TOPIC_RESET_OFFSET:V.CONSUMERS_RESET_OFFSET)&&r.a.createElement(mi,{record:o}),r.a.createElement($.a,{type:"vertical"}))},r.a.createElement("div",{className:"consumer-group-detail"},r.a.createElement("div",{className:"title-and-mode"},r.a.createElement("div",{className:"title-and-mode-header"}),r.a.createElement("div",{className:"right"},"chart"===U&&r.a.createElement(oa.a,{style:{width:140,marginRight:8},size:"small",value:B,onChange:function(e){H(e)}},r.a.createElement(di,{value:"__all__"},"全部Partition"),z.map((function(e){return r.a.createElement(di,{key:e.value,value:e.value},e.value)}))),"chart"===U&&r.a.createElement(bn.a,{rangeTimeArr:x,timeChange:function(e){j(e)}}),"chart"===U&&r.a.createElement("div",{className:"divider"}),r.a.createElement(wr,{defaultKey:U,onChange:function(e){return G(e)}},r.a.createElement(wr.TabItem,{key:"chart"},r.a.createElement("div",{style:{width:34,height:23}},r.a.createElement(h.a,{type:"icon-tubiao"}))),r.a.createElement(wr.TabItem,{key:"table"},r.a.createElement("div",{style:{width:34,height:23}},r.a.createElement(h.a,{type:"icon-biaoge"})))))),"table"===U&&r.a.createElement(In.a,{showQueryForm:!1,tableProps:{loading:te,showHeader:!1,rowKey:"partitionId",columns:fe,dataSource:T,paginationProps:Object.assign({},ue),attrs:{sortDirections:["descend","ascend","default"],scroll:{x:1032},onChange:function(e,t,a){pe({hashData:o,pagination:e,sorter:a})},bordered:!1}}}),"chart"===U&&r.a.createElement("div",{className:"single-chart"},r.a.createElement(gt.a,{showHeader:!1,wrapStyle:{width:"100%",height:242},option:vt({xAxis:{type:"time"},title:{show:!1},legend:{left:"center"},color:it,grid:{left:0,right:0,top:10},tooltip:{customWidth:200}}),chartTypeProp:"line",propChartData:N,seriesCallback:function(e){return e.map((function(e){var t,a=(null===(t=e.metricLine)||void 0===t?void 0:t.metricPoints)||[];return{name:e.metricName,data:a.map((function(e){return[e.timeStamp,e.value,e.unit]})),lineStyle:{width:1.5},smooth:.25,symbol:"emptyCircle",symbolSize:4,emphasis:{disabled:!0}}}))}}))))},gi=function(e,t,a,n){return new(a||(a=Promise))((function(r,i){function o(e){try{l(n.next(e))}catch(e){i(e)}}function c(e){try{l(n.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,c)}l((n=n.apply(e,t||[])).next())}))},hi=m.a.request,bi=function(e){var t,a=e.hashData,i=Object(s.useParams)(),o=Object(n.useState)(!1),c=l()(o,2),u=c[0],m=c[1],d=Object(n.useState)([]),f=l()(d,2),p=f[0],v=f[1],g=Object(n.useState)(!1),h=l()(g,2),b=h[0],E=h[1],y=Object(n.useState)({current:1,pageSize:10,position:"bottomRight",showSizeChanger:!0,pageSizeOptions:["10","20","50","100","200","500"],showTotal:function(e){return"共 ".concat(e," 条目")}}),k=l()(y,2),N=k[0],O=k[1],C=Object(n.useState)(""),S=l()(C,2),x=S[0],j=S[1],I=function(t){var n=t.pageNo,r=t.pageSize;t.filters,t.sorter;return gi(void 0,void 0,void 0,q.a.mark((function t(){var o;return q.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(void 0!==(null==i?void 0:i.clusterId)&&void 0!==(null==a?void 0:a.topicName)){t.next=2;break}return t.abrupt("return");case 2:m(!0),o={searchGroupName:e.searchKeywords?e.searchKeywords.slice(0,128):void 0,pageNo:n,pageSize:r},hi(K.getTopicGroupList(null==a?void 0:a.topicName,null==i?void 0:i.clusterId),{params:o}).then((function(e){var t,a,n;O({current:null===(t=e.pagination)||void 0===t?void 0:t.pageNo,pageSize:null===(a=e.pagination)||void 0===a?void 0:a.pageSize,total:null===(n=e.pagination)||void 0===n?void 0:n.total}),v((null==e?void 0:e.bizData)||[]),m(!1)})).catch((function(e){O({current:1,pageSize:10,total:20}),m(!1)}));case 5:case"end":return t.stop()}}),t)})))};return Object(n.useEffect)((function(){"ConsumerGroups"===e.positionType&&I({pageNo:1,pageSize:N.pageSize})}),[e.searchKeywords]),r.a.createElement("div",{className:"pro-table-wrap"},r.a.createElement(In.a,{showQueryForm:!1,tableProps:{loading:u,showHeader:!1,rowKey:"unique",columns:(t={getGroupInfo:function(e){E(!0),j(e)}},[{title:"ConsumerGroup",dataIndex:"groupName",key:"groupName",render:function(e,a){return r.a.createElement("a",{onClick:function(){return t.getGroupInfo(e)}},e)}},{title:"消费的Topic",dataIndex:"topicName",key:"topicName"},{title:"Status",dataIndex:"state",key:"state"},{title:"Max Lag",dataIndex:"maxLag",key:"maxLag",render:function(e){return e?e.toLocaleString():"-"}},{title:"Member数",dataIndex:"memberCount",key:"memberCount",render:function(e){return e?e.toLocaleString():"-"}}]),dataSource:p,paginationProps:Object.assign({},N),attrs:{onChange:function(e,t,a){I({pageNo:e.current,pageSize:e.pageSize})},scroll:{y:"calc(100vh - 400px)"}}}}),r.a.createElement(vi,{scene:"topicDetail",visible:b,setVisible:E,hashData:Object.assign(Object.assign({},a),{groupName:x})}))},Ei=m.a.request,yi=function(e){var t,a,i,o=e.hashData,c=Object(s.useParams)(),u=g.a.useGlobalValue(),f=l()(u,1)[0],p=Object(n.useState)(!1),v=l()(p,2),h=v[0],b=v[1],E=Object(n.useState)([]),y=l()(E,2),k=y[0],N=y[1],O=Object(n.useState)({current:1,pageSize:10,position:"bottomRight",showSizeChanger:!0,pageSizeOptions:["10","20","50","100","200","500"]}),C=l()(O,2),S=C[0],x=C[1],j=function(){void 0!==(null==c?void 0:c.clusterId)&&void 0!==(null==o?void 0:o.topicName)&&(b(!0),Ei(K.getTopicMirrorList(null==c?void 0:c.clusterId,null==o?void 0:o.topicName)).then((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];N(e)})).finally((function(){return b(!1)})))};return Object(n.useEffect)((function(){"Replicator"===e.positionType&&j()}),[]),r.a.createElement("div",{className:"pro-table-wrap"},r.a.createElement(In.a,{showQueryForm:!1,tableProps:{loading:h,showHeader:!1,rowKey:"unique",columns:(t={global:f,cancelSync:function(e){d.a.confirm({title:"确认取消此Topic同步吗？",okType:"primary",centered:!0,okButtonProps:{size:"small",danger:!0},cancelButtonProps:{size:"small"},maskClosable:!1,onOk:function(t){t();var a=[{destClusterPhyId:e.destClusterId,sourceClusterPhyId:e.sourceClusterId,topicName:e.topicName}];m.a.delete(K.handleTopicMirror(),{data:a}).then((function(){ie.success("成功取消Topic同步"),j()}))}})},clusterId:null==c?void 0:c.clusterId},a=function(e){var t=ut.Memory(e),a=l()(t,2),n=a[0],r=a[1];return"".concat((e/r).toFixed(2)).concat(n,"/s")},i=r.a.createElement(pn.a,{style:{color:"#5664FF",padding:"2px 5px",background:"#eff1fd",marginLeft:"-4px",transform:"scale(0.83,0.83)"}},"当前集群"),[{title:"源集群",dataIndex:"sourceClusterName",key:"sourceClusterName",render:function(e,a){return r.a.createElement(r.a.Fragment,null,r.a.createElement("span",null,e||"-"),a.sourceClusterId==t.clusterId&&i)}},{title:"目标集群",dataIndex:"destClusterName",key:"destClusterName",render:function(e,a){return r.a.createElement(r.a.Fragment,null,r.a.createElement("span",null,e||"-"),a.destClusterId==t.clusterId&&i)}},{title:"消息写入速率",dataIndex:"bytesIn",key:"bytesIn",width:150,render:function(e){return null!=e?a(e):"-"}},{title:"消息复制速率",dataIndex:"replicationBytesIn",key:"replicationBytesIn",width:150,render:function(e){return null!=e?a(e):"-"}},{title:"延迟（个消息）",dataIndex:"lag",key:"lag",width:150},{title:"操作",dataIndex:"option",key:"option",width:100,render:function(e,a){return t.global.hasPermission(V.TOPIC_CANCEL_REPLICATOR)?r.a.createElement("a",{onClick:function(){return t.cancelSync(a)}},"取消同步"):"-"}}]),dataSource:k,paginationProps:S,attrs:{onChange:function(e,t,a,n){x(e)},scroll:{y:"calc(100vh - 400px)"}}}}))},ki=["HealthCheckPassed","HealthCheckTotal","HealthState"],Ni=function(e){var t=e.record,a=Object(s.useParams)(),i=Object(n.useState)(!1),o=l()(i,2),c=o[0],u=o[1],d=Object(n.useState)([]),f=l()(d,2),p=f[0],v=f[1],g=Object(n.useState)({state:ne.UNKNOWN,passed:0,total:0}),b=l()(g,2),E=b[0],y=b[1],k=Object(n.useState)(0),N=l()(k,2),O=N[0],C=N[1];return Object(n.useEffect)((function(){u(!0);var e=Ee(location.hash).topicName,t=m.a.post(K.getTopicMetricPointsLatest(Number(a.clusterId),e),ki).then((function(e){y({state:e.metrics.HealthState,passed:e.metrics.HealthCheckPassed||0,total:e.metrics.HealthCheckTotal||0})})),n=m.a.request(K.getTopicState(Number(a.clusterId),e)).then((function(e){v([{title:"Partitions",value:function(){return t={value:e.partitionCount||"-",subTitle:"All have a leader",subTitleStatus:e.allPartitionHaveLeader},r.a.createElement("div",{style:{width:"100%",display:"flex",alignItems:"end"}},r.a.createElement("span",null,t.value),r.a.createElement("div",{className:"sub-title",style:{transform:"scale(0.83) translateY(14px)"}},r.a.createElement("span",{className:"txt"},"function"==typeof(a=t.subTitle)?a(n):a),r.a.createElement("span",{className:"icon-wrap"},t.subTitleStatus?r.a.createElement(h.a,{type:"icon-zhengchang"}):r.a.createElement(h.a,{type:"icon-yichang"}))));var t,a,n}},{title:"Replications",value:e.replicaFactor||"-",subTitle:"All ISRs = ".concat(e.replicaFactor),subTitleStatus:e.allReplicaInSync},{title:"Min ISR",value:e.minimumIsr||"-",subTitle:"All ISRs ≥ ".concat(e.minimumIsr),subTitleStatus:e.allPartitionMatchAtMinIsr},{title:"Is Compacted",value:function(){return r.a.createElement("span",{style:{fontFamily:"HelveticaNeue"}},e.compacted?"YES":"NO")}}])})),i=m.a.post(K.getMetricPointsLatest(Number(a.clusterId)),["Alive"]).then((function(e){var t;C((null===(t=null==e?void 0:e.metrics)||void 0===t?void 0:t.Alive)||0)}));Promise.all([t,n,i]).then((function(){u(!1)}))}),[]),r.a.createElement(fn,{record:t,scene:"topic",healthData:Object.assign(Object.assign({},E),{state:O?E.state:ne.DOWN}),cardColumns:p,showCardBg:!1,loading:c})},Oi=ka.a.TabPane,Ci=(Pr={},H()(Pr,"Configuration",(function(e){return r.a.createElement(Jn.a,{onSearch:e.setSearchKeywords,attrs:{value:e.searchValue,onChange:e.setSearchValue,placeholder:"请输入配置名",size:"small",style:{width:"210px",marginRight:"2px"},maxLength:128}})})),H()(Pr,"ACLs",(function(e){return r.a.createElement(Jn.a,{onSearch:e.setSearchKeywords,attrs:{value:e.searchValue,onChange:e.setSearchValue,placeholder:"请输入Principle",size:"small",style:{width:"210px",marginRight:"2px"},maxLength:128}})})),H()(Pr,"ConsumerGroups",(function(e){return r.a.createElement(Jn.a,{onSearch:e.setSearchKeywords,attrs:{value:e.searchValue,onChange:e.setSearchValue,placeholder:"请输入Consumer Group",size:"small",style:{width:"210px",marginRight:"2px"},maxLength:128}})})),Pr),Si=function(e){var t,a,i=g.a.useGlobalValue(),o=l()(i,1)[0],c=Object(s.useParams)(),u=Object(s.useHistory)(),d=Object(n.useState)("Partitions"),f=l()(d,2),p=f[0],v=f[1],h=Object(n.useState)(""),b=l()(h,2),E=b[0],y=b[1],k=Object(n.useState)(""),N=l()(k,2),C=N[0],S=N[1],x=Object(n.useState)(!1),j=l()(x,2),I=j[0],w=j[1],T=Object(n.useState)({}),P=l()(T,2),L=P[0],M=P[1];return Object(n.useEffect)((function(){S(""),y("")}),[p]),Object(n.useEffect)((function(){var e,t,a;(null===(e=null==o?void 0:o.clusterInfo)||void 0===e?void 0:e.id)&&Ee(location.hash).topicName?m.a.request(K.getTopicMetadata(+(null===(t=null==o?void 0:o.clusterInfo)||void 0===t?void 0:t.id),null===(a=Ee(location.hash))||void 0===a?void 0:a.topicName),{init:{errorNoTips:!0}}).then((function(e){(null==e?void 0:e.exist)&&!Ee(location.hash).groupName?(M(e),w(!0)):(u.replace("/cluster/".concat(null==c?void 0:c.clusterId,"/topic/list")),w(!1))})).catch((function(e){u.replace("/cluster/".concat(null==c?void 0:c.clusterId,"/topic/list")),w(!1),O.error({message:"错误",description:"Topic不存在或Topic名称有误"})})):w(!1)}),[Ee(location.hash).topicName,null==o?void 0:o.clusterInfo]),r.a.createElement(ya.a,{title:r.a.createElement("span",null,r.a.createElement("span",{style:{fontSize:"18px",fontFamily:"PingFangSC-Semibold",color:"#495057"}},null==L?void 0:L.topicName),(null===(t=null==o?void 0:o.clusterInfo)||void 0===t?void 0:t.name)&&r.a.createElement(pn.a,{style:{fontSize:"10px",color:"#495057",textAlign:"center",background:"#ECECF6",borderRadius:"4px",marginLeft:"10px",padding:"1px 10px"}},null===(a=null==o?void 0:o.clusterInfo)||void 0===a?void 0:a.name)),width:1080,placement:"right",onClose:function(){w(!1),v("Partitions"),u.push("/cluster/".concat(null==c?void 0:c.clusterId,"/topic/list"))},visible:I,className:"topic-detail-drawer",destroyOnClose:!0,maskClosable:!1},r.a.createElement(Ni,{record:{topicName:null==L?void 0:L.topicName}}),r.a.createElement(ka.a,{className:"custom_tabs_class",defaultActiveKey:"Partitions",onChange:function(e){S(""),y(""),v(e)},tabBarExtraContent:Ci[p]&&Ci[p](Object.assign(Object.assign({},e),{setSearchKeywords:y,setSearchValue:S,searchValue:C,positionType:p})),destroyInactiveTabPane:!0},r.a.createElement(Oi,{tab:"Partitions",key:"Partitions"},"Partitions"===p&&r.a.createElement(Rr,{hashData:L})),r.a.createElement(Oi,{tab:"Messages",key:"Messages"},"Messages"===p&&r.a.createElement(Wr,{searchKeywords:E,positionType:p,hashData:L})),r.a.createElement(Oi,{tab:"ConsumerGroups",key:"ConsumerGroups"},"ConsumerGroups"===p&&r.a.createElement(bi,{searchKeywords:E,positionType:p,hashData:L})),r.a.createElement(Oi,{tab:"ACLs",key:"ACLs"},"ACLs"===p&&r.a.createElement(Qr,{searchKeywords:E,positionType:p,hashData:L})),r.a.createElement(Oi,{tab:"Configuration",key:"Configuration"},"Configuration"===p&&r.a.createElement(ti,{searchKeywords:E,positionType:p,hashData:L})),r.a.createElement(Oi,{tab:"Replicator",key:"Replicator"},"Replicator"===p&&r.a.createElement(yi,{searchKeywords:E,positionType:p,hashData:L}))))},xi=function(e){var t=e.record,a=e.onConfirm,i=Object(s.useParams)(),o=J.a.useForm(),c=l()(o,1)[0],u=Object(n.useState)(!1),f=l()(u,2),p=f[0],v=f[1];return r.a.createElement(r.a.Fragment,null,r.a.createElement(Ht.a,{type:"link",onClick:function(e){v(!0)}},"删除"),r.a.createElement(d.a,{className:"custom-modal",title:"确定要删除此Topic吗？",centered:!0,visible:p,wrapClassName:"del-topic-modal",destroyOnClose:!0,maskClosable:!1,onOk:function(){c.validateFields().then((function(e){var t=c.getFieldsValue();t.clusterId=Number(i.clusterId),m.a.delete(K.deleteTopic(),{data:t}).then((function(e){null===e?(O.success({message:"删除成功"}),v(!1),a&&a()):O.error({message:"删除失败"})}))}))},onCancel:function(e){v(!1)},okText:"删除",okButtonProps:{danger:!0,size:"small",style:{paddingLeft:"16px",paddingRight:"16px"}},cancelButtonProps:{size:"small",style:{paddingLeft:"16px",paddingRight:"16px"}}},r.a.createElement("div",{className:"tip-info"},r.a.createElement(h.a,{type:"icon-warning-circle"}),r.a.createElement("span",null,"会删除Topic的全部消息数据和ACL权限！请再次输入Topic名称进行确认！")),r.a.createElement(J.a,{form:c,labelCol:{span:5},style:{marginTop:18}},r.a.createElement(J.a.Item,{label:"TopicName"},t.topicName),r.a.createElement(J.a.Item,{name:"topicName",label:"TopicName",rules:[function(){return{validator:function(e,a){return a?a!==t.topicName?Promise.reject(new Error("请输入正确的Topic名称")):Promise.resolve():Promise.reject(new Error("请输入Topic名称"))}}}]},r.a.createElement(W.a,{placeholder:"请输入",size:"small"})))))},ji=oa.a.Option,Ii=function(e){var t=e.taskPlanData,a=e.onClickPreview,i=e.onClickSavePreview,o=e.brokerList,c=void 0===o?[]:o,u=(Object(s.useParams)(),Object(n.useState)(!1)),m=l()(u,2),d=m[0],f=m[1],p=Object(n.useState)({}),v=l()(p,2),g=v[0],b=v[1],E=function(){f(!1)},y=function(e,t,a){var n=JSON.parse(JSON.stringify(g));n[e.topicName][t].isEdit=a,b(n)};return Object(n.useEffect)((function(){var e=t.reduce((function(e,t){return e[t.topicName]=t.partitionPlanList.reduce((function(e,t){return e[t.partitionId]={currentBrokerIdList:t.currentBrokerIdList,reassignBrokerIdList:t.reassignBrokerIdList,isEdit:!1},e}),{}),e}),{});b(e)}),[t]),r.a.createElement("div",null,r.a.createElement(Ht.a,{style:{marginTop:20},type:"link",onClick:function(){f(!0),a&&a(t)}},"预览任务计划"),r.a.createElement(ya.a,{title:r.a.createElement(la.b,{size:0},r.a.createElement(Ht.a,{className:"drawer-title-left-button",type:"text",size:"small",icon:r.a.createElement(h.a,{type:"icon-fanhui1"}),onClick:E}),r.a.createElement($.a,{type:"vertical"}),r.a.createElement("span",{style:{paddingLeft:"5px"}},"任务计划")),width:600,placement:"right",onClose:E,visible:d,className:"preview-task-plan-drawer",maskClosable:!1,destroyOnClose:!0},r.a.createElement(Wa.a,{rowKey:"topicName",dataSource:t,columns:[{title:"Topic",dataIndex:"topicName"},{title:"源BrokerID",dataIndex:"currentBrokerIdList",render:function(e){return e.join(",")}},{title:"目标BrokerID",dataIndex:"reassignBrokerIdList",render:function(e){return e.join(",")}}],pagination:!1,expandable:{expandedRowRender:function(e){var t=e.partitionPlanList,a=[{title:"Partition",dataIndex:"partitionId"},{title:"源BrokerID",dataIndex:"currentBrokerIdList",render:function(e){return e.join(",")}},{title:"目标BrokerID",dataIndex:"reassignBrokerIdList",render:function(t,a){var n=g[e.topicName][a.partitionId].isEdit,i=g[e.topicName][a.partitionId].reassignBrokerIdList;return n?r.a.createElement(oa.a,{value:i,mode:"multiple",maxTagCount:"responsive",allowClear:!0,onChange:function(t){var n=JSON.parse(JSON.stringify(g));n[e.topicName][a.partitionId].reassignBrokerIdList=t,b(n)},style:{width:"122px"}},c.length>0&&(null==c?void 0:c.map((function(e){return r.a.createElement(ji,{key:Math.random(),value:e.brokerId},e.brokerId)})))):t.join(",")}},{title:"操作",dataIndex:"partitionId",render:function(t){return g[e.topicName][t].isEdit?r.a.createElement(r.a.Fragment,null,r.a.createElement(Ht.a,{type:"link",onClick:function(){i&&i(g)}},"保存"),r.a.createElement(Ht.a,{type:"link",onClick:function(){y(e,t,!1)}},"取消")):r.a.createElement(r.a.Fragment,null,r.a.createElement(Ht.a,{type:"link",onClick:function(){y(e,t,!0)}},"编辑"))}}];return r.a.createElement("div",{className:"partition-task-plan-list"},r.a.createElement(Wa.a,{rowKey:"partitionId",dataSource:t,columns:a,pagination:{simple:!0}}))}}})))},wi=W.a.TextArea,Ti=oa.a.Option,Pi={expandAndReduce:"扩缩副本",transfer:"迁移副本"},Li=function(e){var t=e.type,a=void 0===t?"expandAndReduce":t,i=e.topics,o=e.drawerVisible,c=e.onClose,u=e.jobId,d=e.genData,f=e.jobStatus,p=Object(s.useParams)(),v=Object(n.useState)(!1),h=l()(v,2),b=h[0],E=h[1],y=Object(n.useState)([]),k=l()(y,2),N=k[0],O=k[1],C=Object(n.useState)([]),S=l()(C,2),x=S[0],I=S[1],w=Object(n.useState)([]),T=l()(w,2),P=T[0],L=T[1],M=Object(n.useState)([]),z=l()(M,2),D=z[0],R=z[1],F=Object(n.useState)([]),B=l()(F,2),H=B[0],A=B[1],V=J.a.useForm(),_=l()(V,1)[0],U=g.a.useGlobalValue(),G=l()(U,1)[0],q=Object(n.useState)(!0),W=l()(q,2),Z=W[0],Y=W[1],Q=Object(n.useState)(!1),X=l()(Q,2),ee=X[0],te=X[1],ae=Object(n.useState)([]),ne=l()(ae,2),re=ne[0],oe=ne[1],le=Object(n.useState)(i),se=l()(le,2),me=se[0],fe=se[1],pe=[{title:"Topic名称",dataIndex:"topicName"},{title:"近三天平均流量",dataIndex:"latestDaysAvgBytesInList",render:function(e){return r.a.createElement("div",{className:"custom-tag-wrap"},e.map((function(e,t){return r.a.createElement("div",{key:t,className:"custom-tag"},e&&e.value?"".concat(m.a.formatSize(+e.value),"/S"):"-")})))}},{title:"近三天峰值流量&时间",dataIndex:"latestDaysMaxBytesInList",render:function(e){return r.a.createElement("div",{className:"custom-tag-wrap"},e.map((function(e,t){return r.a.createElement("div",{key:t,className:"custom-tag"},r.a.createElement("div",null,e&&e.value?"".concat(m.a.formatSize(+e.value),"/S"):"-"),r.a.createElement("div",{className:"time"},e&&e.timeStamp?ce()(1e3*e.timeStamp).format("HH:mm:ss"):"-"))})))}},{title:"Partition数",dataIndex:"partitionNum"},{title:"当前副本数",dataIndex:"replicaNum"},{title:"最终副本数",dataIndex:"replicaNum",render:function(e,t,a){return r.a.createElement(Ft.a,{min:1,max:x.length||1,value:H[a],defaultValue:H[a],onChange:function(e){var t,n;e>(null===(t=N[a])||void 0===t?void 0:t.replicaNum)?te(!0):e<=(null===(n=N[a])||void 0===n?void 0:n.replicaNum)&&N.filter((function(e,t){return H[t]&&e.replicaNum<H[t]})).length<1&&te(!1);var r=JSON.parse(JSON.stringify(H));r[a]=e,A(r)}})}}],ve=function(){_.resetFields(),O([]),R([]),E(!1),te(!1),A([]),c()},ge=function(e){return m.a.post(K.getTaskPlanData(),e)},he=function(e){if(!ee){var t=N.map((function(e,t){return{brokerIdList:[],clusterId:p.clusterId,newReplicaNum:H[t],topicName:e.topicName}}));ge(t).then((function(e){L(e.topicPlanList)}))}0!==D.length&&(H.find((function(e){return e>D.length}))||!e&&_.validateFields(["brokerList"]).then((function(e){var t=me.map((function(e,t){return{brokerIdList:D,clusterId:p.clusterId,newReplicaNum:H[t]||e.replicaNum,topicName:e}}));ge(t).then((function(e){L(e.topicPlanList)}))})))},be=function(e,t){for(var a=[],n=e;n<t;n++)a.push(n);return a};Object(n.useEffect)((function(){if(b){var e=N.map((function(e,t){return{brokerIdList:[],clusterId:p.clusterId,newReplicaNum:e.replicaNum,topicName:e.topicName}}));ge(e).then((function(e){L(e.topicPlanList)}))}}),[i]),Object(n.useEffect)((function(){_.setFieldsValue}),[i]),Object(n.useEffect)((function(){o&&he()}),[D,H]),Object(n.useEffect)((function(){var e;o&&(u&&(Y(!0),(e={clusterId:p.clusterId,jobId:u},m.a.request(K.getJobsTaskData(e.clusterId,e.jobId),e)).then((function(e){var t=e&&JSON.parse(e.jobData)||{},a=(null==e?void 0:e.planTime)&&ce()(e.planTime,de),n=t.topicPlanList,r=void 0===n?[]:n,i=t.throttleUnitB,o=void 0===i?0:i,c=(t.jobDesc,[]),l=r.map((function(e){return c=e.reassignBrokerIdList,Object.assign(Object.assign({},e),{topicName:e.topicName,latestDaysAvgBytesInList:e.latestDaysAvgBytesInList||[],latestDaysMaxBytesInList:e.latestDaysMaxBytesInList||[],partitionIdList:e.partitionIdList,replicaNum:e.presentReplicaNum,retentionMs:e.originalRetentionTimeUnitMs})}));O(l);var s=r.map((function(e){return e.newReplicaNum||[]}));A(s),R(c),_.setFieldsValue({brokerList:c,throttle:o/1024/1024,planTime:a,description:null==e?void 0:e.jobDesc,topicList:me})})).finally((function(){Y(!1)}))))}),[o]),Object(n.useEffect)((function(){o&&(E(!0),m.a.request(K.getDashboardMetadata(p.clusterId,j.Broker)).then((function(e){I(e||[])})))}),[o]),Object(n.useEffect)((function(){o&&!u&&m.a.request(K.getTopicMetaData(+p.clusterId)).then((function(e){var t=(e||[]).map((function(e){return{label:e.topicName,value:e.topicName,partitionIdList:e.partitionIdList}}));oe(t)})).catch((function(e){ie.error(e)}))}),[o]),Object(n.useEffect)((function(){var e;u||(Y(!0),o&&(e=me,m.a.post(K.getReassignmentList(),{clusterId:Number(p.clusterId),topicNameList:e})).then((function(e){O(e);var t=e.map((function(e){return e.replicaNum||[]}));A(t)})).finally((function(){Y(!1)})))}),[me,o]);return r.a.createElement(ya.a,{push:!1,title:Pi[a],width:1080,placement:"right",onClose:ve,visible:b,className:"topic-job-drawer",maskClosable:!1,destroyOnClose:!0,extra:r.a.createElement(la.b,null,r.a.createElement(Ht.a,{size:"small",style:{marginRight:8},onClick:function(e){ve()}},"取消"),r.a.createElement(Ht.a,{size:"small",type:"primary",onClick:function(){_.validateFields().then((function(e){var t=_.getFieldsValue(),a={creator:G.userInfo.userName,jobType:1,planTime:t.planTime,jobStatus:u?f:2,target:me.join(","),id:u||"",jobDesc:t.description,jobData:JSON.stringify({clusterId:p.clusterId,jobDesc:t.description,throttleUnitB:1024*t.throttle*1024,topicPlanList:me.map((function(e,t){return{clusterId:p.clusterId,topicName:e,partitionIdList:e.partitionIdList,partitionNum:N[t].partitionNum,presentReplicaNum:N[t].replicaNum,newReplicaNum:H[t],originalBrokerIdList:P[t].currentBrokerIdList,reassignBrokerIdList:P[t].reassignBrokerIdList,originalRetentionTimeUnitMs:N[t].retentionMs,reassignRetentionTimeUnitMs:N[t].retentionMs,latestDaysAvgBytesInList:N[t].latestDaysAvgBytesInList,latestDaysMaxBytesInList:N[t].latestDaysMaxBytesInList,partitionPlanList:P[t].partitionPlanList}}))})};u?m.a.put(K.putJobsTaskData(p.clusterId),a).then((function(){ie.success("扩缩副本任务编辑成功"),ve(),d()})).catch((function(e){console.log(e,"err")})):m.a.post(K.createTask(p.clusterId),a).then((function(){ie.success("扩缩副本任务创建成功"),ve()})).catch((function(e){console.log(e)}))}))}},"确定"),r.a.createElement($.a,{type:"vertical"}))},r.a.createElement("div",{className:"wrap"},r.a.createElement("h4",{className:"title"},Pi[a],"Topic"),!u&&r.a.createElement(J.a,{form:_},r.a.createElement(Bt.a,null,r.a.createElement(hn.a,{span:12},r.a.createElement(J.a.Item,null,r.a.createElement(oa.a,{placeholder:"请选择Topic，可多选",mode:"multiple",maxTagCount:"responsive",allowClear:!0,onChange:function(e){fe(e)},options:re}))))),r.a.createElement(Wa.a,{dataSource:N,columns:pe,pagination:!1,loading:Z}),r.a.createElement(J.a,{form:_,layout:"vertical",className:"task-form"},r.a.createElement(Bt.a,null,ee&&r.a.createElement(hn.a,{span:12},r.a.createElement(J.a.Item,{name:"brokerList",label:"目标节点",rules:[{required:!0},{validator:function(e,t){return t&&t.length&&H.find((function(e){return e&&e>t.length}))?Promise.reject("节点数低于Topic最大副本数"):Promise.resolve()}}]},r.a.createElement(oa.a,{placeholder:"请选择Broker，可多选",mode:"multiple",maxTagCount:"responsive",allowClear:!0,onChange:function(e){R(e)}},x.map((function(e,t){return r.a.createElement(Ti,{key:t,value:e.brokerId},e.brokerId,"(".concat(e.host,")"))}))))),r.a.createElement(hn.a,{span:1},r.a.createElement(Ii,{taskPlanData:P,onClickPreview:he,onClickSavePreview:function(e){var t=JSON.parse(JSON.stringify(P)),a=[];t.forEach((function(t,n){var r=Object.keys(e[t.topicName]).reduce((function(r,i){var o=e[t.topicName][i].reassignBrokerIdList;return o.length!==H[n]&&a.push(t.topicName+" Partition "+i),r.push.apply(r,ue()(o)),r}),[]);t.reassignBrokerIdList=Array.from(new Set(r)),t.partitionPlanList.forEach((function(a){a.reassignBrokerIdList=e[t.topicName][a.partitionId].reassignBrokerIdList}))})),a.length?ie.error(a.join(",")+"副本数与目标节点数不一致"):L(t)},brokerList:x}))),r.a.createElement("h4",{className:"title"},"迁移任务配置"),r.a.createElement(Bt.a,{gutter:32,className:"topic-execution-time"},r.a.createElement(hn.a,{span:12},r.a.createElement(J.a.Item,{name:"throttle",label:"限流",rules:[{required:!0},{validator:function(e,t){return(t||0===t)&&t<=0?Promise.reject("限流值不能小于等于0"):Promise.resolve()}}]},r.a.createElement(Ft.a,{style:{width:"100%"},max:99999,addonAfter:"MB/S"}))),r.a.createElement(hn.a,{span:12},r.a.createElement(J.a.Item,{name:"planTime",label:"任务执行时间",rules:[{required:!0}]},r.a.createElement(ai.a,{format:"YYYY-MM-DD HH:mm:ss",showTime:!0,style:{width:"100%"},disabledDate:function(e){return e&&e<=ce()().add(-1,"days").endOf("day")},disabledTime:function(e){return{disabledHours:function(){return e>ce()()?[]:be(0,ce()().hour())},disabledMinutes:function(){return e>ce()()?[]:be(0,ce()().add(1,"minute").minute())}}}})))),r.a.createElement("h4",{className:"title"},"描述"),r.a.createElement(J.a.Item,{name:"description",label:"任务描述",rules:[{required:!0}]},r.a.createElement(wi,{placeholder:"暂支持 String 格式",style:{height:110}})))))},Mi=a(952),zi=W.a.TextArea,Di=oa.a.Option,Ri={expandAndReduce:"扩缩副本",transfer:"迁移副本"},Fi=function(e){var t=e.type,a=void 0===t?"transfer":t,i=e.topics,o=e.drawerVisible,c=e.onClose,u=e.jobId,d=e.genData,f=e.jobStatus,p=Object(s.useParams)(),v=Object(n.useState)(o),b=l()(v,2),E=b[0],y=b[1],k=Object(n.useState)([]),N=l()(k,2),O=N[0],C=N[1],S=Object(n.useState)([]),x=l()(S,2),I=x[0],w=x[1],T=Object(n.useState)([]),P=l()(T,2),L=P[0],M=P[1],z=Object(n.useState)([]),D=l()(z,2),R=D[0],F=D[1],B=Object(n.useState)([]),H=l()(B,2),A=H[0],V=H[1],_=Object(n.useState)([]),U=l()(_,2),G=U[0],q=U[1],W=Object(n.useState)([]),Z=l()(W,2),Y=Z[0],Q=Z[1],X=Object(n.useState)([]),ee=l()(X,2),te=ee[0],ae=ee[1],ne=J.a.useForm(),re=l()(ne,1)[0],oe=g.a.useGlobalValue(),le=l()(oe,1)[0],se=Object(n.useState)(!0),me=l()(se,2),de=me[0],fe=me[1],pe=Object(n.useState)([]),ve=l()(pe,2),ge=ve[0],he=ve[1],be=Object(n.useState)(i),Ee=l()(be,2),ye=Ee[0],ke=Ee[1],Ne=[{title:"Topic名称",dataIndex:"topicName"},{title:"近三天平均流量",dataIndex:"latestDaysAvgBytesInList",render:function(e){return r.a.createElement("div",{className:"custom-tag-nowrap"},e.map((function(e,t){return r.a.createElement("div",{key:t,className:"custom-tag"},e&&e.value?"".concat(m.a.formatSize(+e.value),"/S"):"-")})))}},{title:"近三天峰值流量&时间",dataIndex:"latestDaysMaxBytesInList",render:function(e){return r.a.createElement("div",{className:"custom-tag-wrap"},e.map((function(e,t){return r.a.createElement("div",{className:"custom-tag",key:t},r.a.createElement("div",null,e&&e.value?"".concat(m.a.formatSize(+e.value),"/S"):"-"),r.a.createElement("div",{className:"time"},e&&e.timeStamp?ce()(1e3*e.timeStamp).format("HH:mm:ss"):"-"))})))}},{title:"需迁移Partition",dataIndex:"partitionIdList",width:220,render:function(e,t,a){return r.a.createElement(oa.a,{style:{width:"100%"},placeholder:"下拉多选分区ID",defaultValue:e,value:G[a],mode:"multiple",maxTagCount:"responsive",allowClear:!0,onChange:function(e){var t=JSON.parse(JSON.stringify(G));t[a]=e,q(t)}},e.map((function(e,t){return r.a.createElement(Di,{key:t,value:e},e)})))}},{title:"副本数",dataIndex:"replicaNum"},{title:"数据保存时间",dataIndex:"retentionMs",render:function(e){return t=e,[{v:Math.floor(t/864e5),unit:"天"},{v:Math.floor(t%864e5/36e5),unit:"小时"},{v:Math.floor(t%36e5/6e4),unit:"分钟"},{v:t%6e4/1e3,unit:"秒"}].filter((function(e){return e.v>0})).map((function(e){return"".concat(e.v).concat(e.unit)})).join();var t}},{title:"迁移数据时间范围",dataIndex:"newRetentionMs",render:function(e,t,a){var n=r.a.createElement(oa.a,{onChange:function(e){var t=JSON.parse(JSON.stringify(te));t[a]="h"===e?1:60,ae(t)},defaultValue:"h",style:{width:82}},r.a.createElement(Di,{value:"m"},"Minute"),r.a.createElement(Di,{value:"h"},"Hour"));return r.a.createElement(Ft.a,{width:80,min:0,max:99999,defaultValue:Y[a],value:Y[a],onChange:function(e){var t=JSON.parse(JSON.stringify(Y));t[a]=e,Q(t)},className:"move-dete-time-tanges",addonAfter:n})}}],Oe=function(){re.resetFields(),C([]),F([]),V([]),q([]),Q([]),y(!1),c()},Ce=function(e){0!==R.length&&(A.find((function(e){return e>R.length}))||!e&&re.validateFields(["brokerList"]).then((function(e){var t,a=ye.map((function(e,t){return{brokerIdList:R,clusterId:p.clusterId,enableRackAwareness:!1,newReplicaNum:A[t],partitionIdList:G[t],topicName:e}}));(t=a,m.a.post(K.getMovePlanTaskData(),t)).then((function(e){M(e.topicPlanList)}))})))},Se=function(e,t){for(var a=[],n=e;n<t;n++)a.push(n);return a};Object(n.useEffect)((function(){o&&Ce()}),[R,G,Y]),Object(n.useEffect)((function(){var e;0!==i.length&&o&&(u&&(fe(!0),(e={clusterId:p.clusterId,jobId:u},m.a.request(K.getJobsTaskData(e.clusterId,e.jobId),e)).then((function(e){var t=e&&JSON.parse(e.jobData)||{},a=(null==e?void 0:e.planTime)&&ce()(e.planTime,"YYYY-MM-DD HH:mm:ss"),n=t.topicPlanList,r=void 0===n?[]:n,i=t.throttleUnitB,o=void 0===i?0:i,c=(t.jobDesc,[]),l=r.map((function(e){return c=e.reassignBrokerIdList,Object.assign(Object.assign({},e),{topicName:e.topicName,latestDaysAvgBytesInList:e.latestDaysAvgBytesInList||[],latestDaysMaxBytesInList:e.latestDaysMaxBytesInList||[],partitionIdList:e.partitionIdList,replicaNum:e.presentReplicaNum,retentionMs:e.originalRetentionTimeUnitMs})}));C(l);var s=r.map((function(e){return e.newReplicaNum||[]}));V(s);var u=r.map((function(e){return e.partitionIdList||[]}));q(u);var m=r.map((function(e){var t=e.reassignRetentionTimeUnitMs/1e3/60/60;return t>1?Math.floor(t):t.toFixed(2)}));Q(m),F(c),re.setFieldsValue({brokerList:c,throttle:o/1024/1024,planTime:a,description:null==e?void 0:e.jobDesc})})).finally((function(){fe(!1)}))))}),[o]),Object(n.useEffect)((function(){o&&!u&&o&&m.a.request(K.getTopicMetaData(+p.clusterId)).then((function(e){var t=(e||[]).map((function(e){return{label:e.topicName,value:e.topicName,partitionIdList:e.partitionIdList}}));he(t)})).catch((function(e){ie.error(e)}))}),[o]),Object(n.useEffect)((function(){var e;o&&(u||(fe(!0),o&&(e=ye,m.a.post(K.getReassignmentList(),{clusterId:Number(p.clusterId),topicNameList:e})).then((function(e){C(e);var t=e.map((function(e){return e.replicaNum||[]}));V(t);var a=e.map((function(e){return e.partitionIdList||[]}));q(a);var n=e.map((function(e){var t=e.retentionMs/1e3/60/60;return t>1?Math.floor(t):t.toFixed(2)}));Q(n)})).finally((function(){fe(!1)}))))}),[ye,o]),Object(n.useEffect)((function(){o&&(y(!0),m.a.request(K.getDashboardMetadata(p.clusterId,j.Broker)).then((function(e){var t=(e||[]).map((function(e){return Object.assign(Object.assign({},e),{key:e.brokerId,title:"".concat(e.brokerId," (").concat(e.host,")")})}));w(t)})))}),[o]);return r.a.createElement(ya.a,{push:!1,title:Ri[a],width:1080,placement:"right",onClose:Oe,visible:E,className:"topic-job-drawer",maskClosable:!1,destroyOnClose:!0,extra:r.a.createElement(la.b,null,r.a.createElement(Ht.a,{size:"small",style:{marginRight:8},onClick:function(e){Oe()}},"取消"),r.a.createElement(Ht.a,{size:"small",type:"primary",onClick:function(){R.length&&A.find((function(e){return e>R.length}))||re.validateFields().then((function(e){var t=re.getFieldsValue(),a={creator:le.userInfo.userName,jobType:0,planTime:t.planTime,jobStatus:u?f:2,target:ye.join(","),id:u||"",jobDesc:t.description,jobData:JSON.stringify({clusterId:p.clusterId,jobDesc:t.description,throttleUnitB:1024*t.throttle*1024,topicPlanList:ye.map((function(e,t){return{clusterId:p.clusterId,topicName:e,partitionIdList:G[t],partitionNum:G[t].length,presentReplicaNum:A[t],newReplicaNum:A[t]||e.replicaNum,originalBrokerIdList:L[t].currentBrokerIdList,reassignBrokerIdList:L[t].reassignBrokerIdList,originalRetentionTimeUnitMs:O[t].retentionMs,reassignRetentionTimeUnitMs:60*Y[t]*60*1e3/(te[t]||1),latestDaysAvgBytesInList:O[t].latestDaysAvgBytesInList,latestDaysMaxBytesInList:O[t].latestDaysMaxBytesInList,partitionPlanList:L[t].partitionPlanList}}))})};u?m.a.put(K.putJobsTaskData(p.clusterId),a).then((function(){ie.success("迁移任务编辑成功"),Oe(),d()})).catch((function(e){console.log(e,"err")})):m.a.post(K.createTask(p.clusterId),a).then((function(){ie.success("迁移任务创建成功"),Oe()}))}))}},"确定"),r.a.createElement($.a,{type:"vertical"}))},r.a.createElement("div",{className:"wrap"},r.a.createElement("h4",{className:"title"},Ri[a],"Topic"),!u&&r.a.createElement(J.a,{form:re},r.a.createElement(Bt.a,null,r.a.createElement(hn.a,{span:12},r.a.createElement(J.a.Item,null,r.a.createElement(oa.a,{placeholder:"请选择Topic，可多选",mode:"multiple",maxTagCount:"responsive",allowClear:!0,onChange:function(e){ke(e)},options:ge}))))),r.a.createElement(Wa.a,{dataSource:O,columns:Ne,pagination:!1,loading:de}),r.a.createElement(J.a,{form:re,layout:"vertical",className:"task-form"},r.a.createElement(Bt.a,null,r.a.createElement(hn.a,{span:12},r.a.createElement(J.a.Item,{name:"brokerList",label:"目标节点",rules:[{required:!0},{validator:function(e,t){return t&&t.length&&A.find((function(e){return e&&e>t.length}))?Promise.reject("节点数低于Topic最大副本数"):Promise.resolve()}}]},r.a.createElement(Mi.a,{dataSource:I,showSearch:!0,filterOption:function(e,t){return t.host.indexOf(e)>-1},targetKeys:R,onChange:function(e){F(e)},render:function(e){return e.title},titles:["待选节点","已选节点"],customHeader:!0,showSelectedCount:!0,locale:{itemUnit:"",itemsUnit:""},suffix:r.a.createElement(h.a,{type:"icon-fangdajing"})}))),r.a.createElement(hn.a,{span:12},r.a.createElement(Ii,{taskPlanData:L,onClickPreview:Ce,onClickSavePreview:function(e){var t=JSON.parse(JSON.stringify(L)),a=[];t.forEach((function(t,n){var r=Object.keys(e[t.topicName]).reduce((function(r,i){var o=e[t.topicName][i].reassignBrokerIdList;return o.length!==A[n]&&a.push(t.topicName+" Partition "+i),r.push.apply(r,ue()(o)),r}),[]);t.reassignBrokerIdList=Array.from(new Set(r)),t.partitionPlanList.forEach((function(a){a.reassignBrokerIdList=e[t.topicName][a.partitionId].reassignBrokerIdList}))})),a.length?ie.error(a.join(",")+"副本数与目标节点数不一致"):M(t)},brokerList:I}))),r.a.createElement("h4",{className:"title"},"迁移任务配置"),r.a.createElement(Bt.a,{gutter:32,className:"topic-execution-time"},r.a.createElement(hn.a,{span:12},r.a.createElement(J.a.Item,{name:"throttle",label:"限流",rules:[{required:!0},{validator:function(e,t){return(t||0===t)&&t<=0?Promise.reject("限流值不能小于或等于0"):Promise.resolve()}}]},r.a.createElement(Ft.a,{style:{width:"100%"},addonAfter:"MB/S",max:99999}))),r.a.createElement(hn.a,{span:12},r.a.createElement(J.a.Item,{name:"planTime",label:"任务执行时间",rules:[{required:!0}]},r.a.createElement(ai.a,{showTime:!0,style:{width:"100%"},disabledDate:function(e){return e&&e<=ce()().add(-1,"days").endOf("day")},disabledTime:function(e){return{disabledHours:function(){return e>ce()()?[]:Se(0,ce()().hour())},disabledMinutes:function(){return e>ce()()?[]:Se(0,ce()().add(1,"minute").minute())}}}})))),r.a.createElement("h4",{className:"title"},"描述"),r.a.createElement(J.a.Item,{name:"description",label:"任务描述",rules:[{required:!0}]},r.a.createElement(zi,{placeholder:"暂支持 String 格式",style:{height:110}})))))},Bi=(oa.a.Option,ia.a.Group),Hi=function(e){var t=e.drawerVisible,a=e.onClose,i=e.genData,o=Object(s.useParams)(),c=Object(n.useState)(t),u=l()(c,2),d=u[0],f=u[1],p=Object(n.useState)([]),v=l()(p,2),g=v[0],b=v[1],E=Object(n.useState)([]),y=l()(E,2),k=y[0],N=y[1],O=Object(n.useState)([]),C=l()(O,2),S=C[0],x=C[1],j=J.a.useForm(),I=l()(j,1)[0],w=r.a.useRef({}),T=function(e){m.a.request(K.getTopicMetaData(e)).then((function(t){var a=(t||[]).map((function(e){return e.topicName}));w.current=Object.assign(Object.assign({},w.current),H()({},e,a)),setTimeout((function(){I.validateFields(["topicNames"])}),1e3)}))},P=function(){I.resetFields(),x([]),w.current={},f(!1),a()};Object(n.useEffect)((function(){t&&(f(!0),m.a.request(K.getTopicMetaData(+o.clusterId)).then((function(e){var t=(e||[]).map((function(e){return Object.assign(Object.assign({},e),{key:e.topicName,title:e.topicName})}));b(t)})),m.a.request(K.getMirrorClusterList()).then((function(e){var t=(e||[]).map((function(e){return{label:e.name,value:e.id}}));N(t)})))}),[t]);return r.a.createElement(ya.a,{push:!1,title:"Topic复制",width:600,placement:"right",onClose:P,visible:d,className:"topic-job-drawer",maskClosable:!1,destroyOnClose:!0,extra:r.a.createElement(la.b,null,r.a.createElement(Ht.a,{size:"small",style:{marginRight:8},onClick:function(e){P()}},"取消"),r.a.createElement(Ht.a,{size:"small",type:"primary",onClick:function(){I.validateFields().then((function(e){var t=I.getFieldsValue(),a=[];t.destClusterPhyIds.forEach((function(e){t.topicNames.forEach((function(n){a.push({destClusterPhyId:e,sourceClusterPhyId:+o.clusterId,syncData:t.mirrorScope.indexOf("syncData")>-1,syncConfig:t.mirrorScope.indexOf("syncConfig")>-1,topicName:n})}))})),m.a.post(K.handleTopicMirror(),a).then((function(){ie.success("成功复制Topic"),P(),i()}))}))}},"确定"),r.a.createElement($.a,{type:"vertical"}))},r.a.createElement("div",{className:"wrap"},r.a.createElement(J.a,{form:I,layout:"vertical",className:"task-form"},r.a.createElement(J.a.Item,{name:"topicNames",label:"选择Topic",rules:[{required:!0,validator:function(e,t){var a=I.getFieldValue("destClusterPhyIds");if(t&&t.length){if(a&&a.length){var n={};if(a.forEach((function(e){e&&w.current[e]?(n[e]=[],t.forEach((function(t){w.current[e].indexOf(t)>-1&&n[e].push(t)})),n[e].length||delete n[e]):T(e)})),Object.keys(n).length){var r="";return Object.keys(n).forEach((function(e){var t,a=null===(t=k.find((function(t){return t.value==e})))||void 0===t?void 0:t.label;r=r.concat("".concat(n[e].join("、"),"在集群【").concat(a,"】中已存在，"))})),r=r.concat("请重新选择"),Promise.reject(r)}return Promise.resolve()}return Promise.resolve()}return Promise.reject("请选择需要复制的Topic")}}]},r.a.createElement(Mi.a,{dataSource:g,showSearch:!0,filterOption:function(e,t){return t.topicName.indexOf(e)>-1},targetKeys:S,onChange:function(e){x(e)},render:function(e){return e.title},titles:["待选Topic","已选Topic"],customHeader:!0,showSelectedCount:!0,locale:{itemUnit:"",itemsUnit:""},suffix:r.a.createElement(h.a,{type:"icon-fangdajing"})})),r.a.createElement(J.a.Item,{name:"destClusterPhyIds",label:r.a.createElement(r.a.Fragment,null,r.a.createElement("span",{style:{marginRight:"8px"}},"选择目标集群"),r.a.createElement(Y.a,{title:"目标集群需要为使用滴滴kafka的350+版本的kafka集群"},r.a.createElement(vn.a,null))),rules:[{required:!0,message:"请选择目标集群"}]},r.a.createElement(oa.a,{placeholder:"请选择目标集群，可多选",mode:"multiple",maxTagCount:"responsive",allowClear:!0,onChange:function(e){e&&e.length?e.forEach((function(e){e&&!w.current[e]?T(e):I.validateFields(["topicNames"])})):I.validateFields(["topicNames"])},options:k.filter((function(e){return e.value!==+o.clusterId}))})),r.a.createElement(J.a.Item,{name:"mirrorScope",label:"Topic复制范围",rules:[{required:!0,validator:function(e,t){return t&&t.length?-1===t.indexOf("syncData")?Promise.reject("Topic复制范围必须选择[数据]"):Promise.resolve():Promise.reject("请选择Topic复制范围")}}],initialValue:["syncData"]},r.a.createElement(Bi,{className:"checkbox-content-margin"},[{label:"数据",value:"syncData"},{label:"Topic配置",value:"syncConfig"},{label:"kafkauser+Acls",value:"kafkauserAcls",disabled:!0},{label:"Group Offset",value:"groupOffset",disabled:!0}].map((function(e){return e.disabled?r.a.createElement(Y.a,{title:"当前版本暂不支持"},r.a.createElement(ia.a,{key:e.value,value:e.value,disabled:!0},e.label)):r.a.createElement(ia.a,{key:e.value,value:e.value},e.label)})))))))},Ai={"-1":"Unknown",0:"好",1:"中",2:"差",3:"Down"},Vi=(oa.a.Option,function(e){var t,a,i=Object(s.useParams)(),o=(Object(s.useHistory)(),g.a.useGlobalValue()),c=l()(o,1)[0],u=Object(n.useState)([]),d=l()(u,2),f=d[0],v=(d[1],Object(n.useState)([])),b=l()(v,2),E=(b[0],b[1],Object(n.useState)([])),y=l()(E,2),k=y[0],N=y[1],O=Object(n.useState)(1),C=l()(O,2),S=C[0],x=C[1],j=Object(n.useState)(1),I=l()(j,2),w=I[0],T=I[1],P=Object(n.useState)(10),L=l()(P,2),M=L[0],z=L[1],D=Object(n.useState)(!1),R=l()(D,2),F=R[0],B=R[1],H=Object(n.useState)(""),A=l()(H,2),_=A[0],U=A[1],G=Object(n.useState)(""),q=l()(G,2),J=q[0],Z=q[1],Q=Object(n.useState)(!1),X=l()(Q,2),ee=X[0],te=X[1],ae=Object(n.useState)(""),ne=l()(ae,2),re=(ne[0],ne[1],Object(n.useState)(!1)),ie=l()(re,2),oe=ie[0],ce=ie[1],le=Object(n.useState)(!1),se=l()(le,2),ue=se[0],me=se[1],de=Object(n.useState)(!1),fe=l()(de,2),pe=fe[0],ve=fe[1],ge=Object(n.useState)("批量操作"),he=l()(ge,2),be=(he[0],he[1]),Ee=Object(n.useState)({sortField:"createTime",sortType:"desc"}),ye=l()(Ee,2),Ne=ye[0],Oe=ye[1],Ce=function(){var e=[Date.now()-864e5,Date.now()],t=l()(e,2),a=t[0],n={metricLines:{aggType:"avg",endTime:t[1],metricsNames:["HealthScore","BytesIn","BytesOut","LogSize"],startTime:a,topNu:0},latestMetricNames:["HealthScore","BytesIn","BytesOut","LogSize"],pageNo:S,pageSize:M,searchKeywords:_,showInternalTopics:F,sortType:Ne.sortType||"desc",sortField:Ne.sortField||"createTime"};te(!0),m.a.post(K.getTopicsList(Number(i.clusterId)),n).then((function(e){te(!1),N((null==e?void 0:e.bizData)||[]),T(e.pagination.total)})).catch((function(e){te(!1)}))};Object(n.useEffect)((function(){Ce()}),[Ne,F,_,S,M]);var Se,xe=function(e,t){var a,n,r=null===(n=null===(a=null==e?void 0:e.latestMetrics)||void 0===a?void 0:a.metrics)||void 0===n?void 0:n[t];return void 0!==r?"HealthState"===t?Ai[r]||"-":"LogSize"===t?Number(m.a.formatAssignSize(r,"MB")).toLocaleString():Number(m.a.formatAssignSize(r,"KB")).toLocaleString():"-"},je=function(e,t){var a,n=(null===(a=e.metricLines.find((function(e){return e.metricName===t})))||void 0===a?void 0:a.metricPoints)||[];return r.a.createElement("div",{className:"metric-data-wrap"},r.a.createElement(Et,{width:"100%",height:30,chartData:{name:e.metricName,data:n.map((function(e){return{time:e.timeStamp,value:e.value}}))}}),r.a.createElement("span",{className:"cur-val"},xe(e,t)))},Ie=function(){ce(!1),me(!1),ve(!1),be("批量操作")},we=r.a.createElement(p.a,null,c.hasPermission(V.TOPIC_CHANGE_REPLICA)&&r.a.createElement(p.a.Item,null,r.a.createElement("a",{onClick:function(){return ce(!0)}},"扩缩副本")),c.hasPermission(V.TOPIC_MOVE_REPLICA)&&r.a.createElement(p.a.Item,null,r.a.createElement("a",{onClick:function(){return me(!0)}},"迁移副本")),c.hasPermission(V.TOPIC_REPLICATOR)&&r.a.createElement(p.a.Item,null,r.a.createElement("a",{onClick:function(){return ve(!0)}},"Topic复制")));return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"breadcrumb",style:{marginBottom:"10px"}},r.a.createElement(Gn.a,{breadcrumbs:[{label:"多集群管理",aHref:"/"},{label:null===(t=null==c?void 0:c.clusterInfo)||void 0===t?void 0:t.name,aHref:"/cluster/".concat(null===(a=null==c?void 0:c.clusterInfo)||void 0===a?void 0:a.id)},{label:"Topic",aHref:"/cluster/".concat(null==i?void 0:i.clusterId,"/topic")},{label:"Topics",aHref:""}]})),r.a.createElement("div",{style:{margin:"12px 0"}},r.a.createElement(dr,null)),r.a.createElement("div",{className:"custom-table-content"},r.a.createElement("div",{className:"".concat(ke)},r.a.createElement("div",{className:"".concat(ke,"-left")},r.a.createElement(Li,{drawerVisible:oe,jobId:"",topics:f,onClose:Ie}),r.a.createElement(Fi,{drawerVisible:ue,jobId:"",topics:f,onClose:Ie}),r.a.createElement(Hi,{drawerVisible:pe,genData:Ce,onClose:Ie}),r.a.createElement("div",{className:"".concat(ke,"-left-refresh"),onClick:function(){return Ce()}},r.a.createElement(h.a,{className:"".concat(ke,"-left-refresh-icon"),type:"icon-shuaxin1"})),r.a.createElement($.a,{type:"vertical",className:"".concat(ke,"-divider")}),r.a.createElement("div",{className:"internal-switch"},r.a.createElement(pr.a,{size:"small",checked:F,onChange:function(e){B(e)}}),r.a.createElement("span",null,"展示系统Topic"))),r.a.createElement("div",{className:"".concat(ke,"-right")},r.a.createElement(W.a,{className:"search-input",suffix:r.a.createElement(h.a,{type:"icon-fangdajing",onClick:function(e){U(J)},style:{fontSize:"16px"}}),placeholder:"请输入TopicName",value:J,onPressEnter:function(e){U(J)},onChange:function(e){Z(e.target.value)}}),(c.hasPermission(V.TOPIC_CHANGE_REPLICA)||c.hasPermission(V.TOPIC_MOVE_REPLICA)||c.hasPermission(V.TOPIC_REPLICATOR))&&r.a.createElement(vr.a,{overlay:we,trigger:["click"]},r.a.createElement(Ht.a,{className:"batch-btn",icon:r.a.createElement(Za.a,null),type:"primary",ghost:!0},"批量变更")),c.hasPermission&&c.hasPermission(V.TOPIC_ADD)?r.a.createElement(Sr,{onConfirm:Ce}):r.a.createElement(r.a.Fragment,null))),r.a.createElement(In.a,{showQueryForm:!1,tableProps:{loading:ee,showHeader:!1,rowKey:"topicName",columns:(Se=[{title:"TopicName",dataIndex:"topicName",key:"topicName",fixed:"left",width:140,className:"clean-padding-left",lineClampOne:!0,render:function(e,t){return r.a.createElement(r.a.Fragment,null,r.a.createElement(Y.a,{title:e},r.a.createElement("a",{onClick:function(){window.location.hash="topicName=".concat(e)}},e)),t.inMirror&&r.a.createElement("div",null,r.a.createElement(pn.a,{style:{color:"#5664FF",padding:"2px 5px",background:"#eff1fd",marginLeft:"-4px",transform:"scale(0.83,0.83)"}},"复制中...")))}},{title:"Partitions",dataIndex:"partitionNum",key:"partitionNum",width:100},{title:"Replications",dataIndex:"replicaNum",key:"replicaNum",width:100},{title:"健康状态",dataIndex:"HealthState",key:"HealthState",sorter:!0,width:100,render:function(e,t){return xe(t,"HealthState")}},{title:"Bytes In(KB/s)",dataIndex:"BytesIn",key:"BytesIn",sorter:!0,width:170,render:function(e,t){return je(t,"BytesIn")}},{title:"Bytes Out(KB/s)",dataIndex:"BytesOut",key:"BytesOut",sorter:!0,width:170,render:function(e,t){return je(t,"BytesOut")}},{title:"MessageSize(MB)",dataIndex:"LogSize",key:"LogSize",sorter:!0,width:170,render:function(e,t){return je(t,"LogSize")}},{title:"保存时间(h)",dataIndex:"retentionTimeUnitMs",key:"retentionTimeUnitMs",width:120,render:function(e){return(e/36e5).toFixed(2)}},{title:"描述",dataIndex:"description",key:"description",lineClampTwo:!0,width:150,needTooltip:!0}],c.hasPermission&&(c.hasPermission(V.TOPIC_EXPOND)||c.hasPermission(V.TOPIC_DEL))&&Se.push({title:"操作",dataIndex:"desc",key:"desc",fixed:"right",width:140,render:function(e,t){return r.a.createElement("div",{className:"operation-list"},c.hasPermission(V.TOPIC_EXPOND)?r.a.createElement(xr,{record:t,onConfirm:Ce}):r.a.createElement(r.a.Fragment,null),c.hasPermission(V.TOPIC_DEL)?r.a.createElement(xi,{record:t,onConfirm:Ce}):r.a.createElement(r.a.Fragment,null))}}),Se),dataSource:k,lineFillColor:!0,paginationProps:w>0?{current:S,total:w,pageSize:M}:null,attrs:{className:"topic-list",bordered:!1,scroll:{x:"max-content",y:"calc(100vh - 400px)"},sortDirections:["descend","ascend","default"],onChange:function(e,t,a){Oe({sortField:a.field||"",sortType:a.order?a.order.substring(0,a.order.indexOf("end")):""}),x(e.current),z(e.pageSize)}}}})),r.a.createElement(Si,null))}),Ki={current:1,pageSize:10,position:"bottomRight",showSizeChanger:!0,pageSizeOptions:["10","20","50","100","200","500"]},_i=function(){var e=Object(s.useParams)(),t=Object(n.useState)(!1),a=l()(t,2),i=a[0],o=a[1],c=Object(n.useState)([]),u=l()(c,2),d=u[0],f=u[1],p=Object(n.useState)({state:ne.UNKNOWN,passed:0,total:0}),v=l()(p,2),g=v[0],h=v[1],b=["Groups","GroupActives","GroupEmptys","GroupRebalances","GroupDeads"],E=["HealthCheckPassed_Groups","HealthCheckTotal_Groups","HealthState"];return Object(n.useEffect)((function(){o(!0),m.a.post(K.getMetricPointsLatest(Number(e.clusterId)),b.concat(E)).then((function(e){var t,a,n;o(!1),f(b.map((function(t){return"GroupDeads"===t?{title:t,value:r.a.createElement("span",{style:{color:0!==e.metrics[t]?"#F58342":""}},e.metrics[t])}:{title:t,value:e.metrics[t]}}))),h({state:null===(t=null==e?void 0:e.metrics)||void 0===t?void 0:t.HealthState,passed:(null===(a=null==e?void 0:e.metrics)||void 0===a?void 0:a.HealthCheckPassed_Groups)||0,total:(null===(n=null==e?void 0:e.metrics)||void 0===n?void 0:n.HealthCheckTotal_Groups)||0})}))}),[]),r.a.createElement(fn,{scene:"group",healthData:g,cardColumns:d,loading:i})},Ui=oa.a.Option,Gi=["LogEndOffset","OffsetConsumed","Lag"],qi=[{metricName:"LogEndOffset",metricType:104},{metricName:"OffsetConsumed",metricType:102},{metricName:"Lag",metricType:102}],Ji=function(e){var t=e.record,a=e.groupName,i=Object(s.useParams)(),o=Object(s.useHistory)(),c=Date.now(),u=Object(n.useState)([]),d=l()(u,2),f=d[0],p=d[1],v=Object(n.useState)("table"),g=l()(v,2),b=g[0],E=g[1],y=Object(n.useState)(""),k=l()(y,2),N=k[0],O=k[1],C=Object(n.useState)([]),S=l()(C,2),x=S[0],j=S[1],I=Object(n.useState)([c-864e5,c]),w=l()(I,2),T=w[0],P=w[1],L=Object(n.useState)(!0),M=l()(L,2),z=M[0],D=M[1],R=Object(n.useState)([]),F=l()(R,2),B=F[0],H=F[1],A=Object(n.useState)([]),V=l()(A,2),_=V[0],U=V[1],G=Number(i.clusterId),q=Object(n.useState)({current:1,pageSize:5,simple:!0,hideOnSinglePage:!1}),J=l()(q,2),W=J[0],Z=J[1],Y=[{title:"Partition",dataIndex:"partitionId",key:"partitionId",lineClampOne:!0,needTooltip:!0,width:180},{title:"Member ID",dataIndex:"memberId",key:"memberId",width:200,render:function(e){return e?r.a.createElement(Ar,{content:e}):"-"}},{title:"Current Offset",dataIndex:"OffsetConsumed",key:"OffsetConsumed",render:function(e,t){var a,n;return null===(n=null===(a=null==t?void 0:t.latestMetrics)||void 0===a?void 0:a.metrics)||void 0===n?void 0:n.OffsetConsumed.toLocaleString()},sorter:!0},{title:"Log End Offset",dataIndex:"LogEndOffset",key:"LogEndOffset",render:function(e,t){var a,n;return null===(n=null===(a=null==t?void 0:t.latestMetrics)||void 0===a?void 0:a.metrics)||void 0===n?void 0:n.LogEndOffset.toLocaleString()},sorter:!0},{title:"Lag",dataIndex:"Lag",key:"Lag",render:function(e,t){var a,n;return null===(n=null===(a=null==t?void 0:t.latestMetrics)||void 0===a?void 0:a.metrics)||void 0===n?void 0:n.Lag.toLocaleString()},sorter:!0},{title:"Host",dataIndex:"host",key:"host"},{title:"Client ID",dataIndex:"clientId",key:"clientId",needTooltip:!0,lineClampOne:!0,width:200}],Q=function(e){var n=e.pagination,r=void 0===n?{current:1,pageSize:10}:n,i=e.sorter,o=void 0===i?{}:i;D(!0);var c={latestMetricNames:Gi,pageNo:r.current,pageSize:r.pageSize,sortField:o.field||void 0,sortType:o.order?o.order.substring(0,o.order.indexOf("end")):void 0};return m.a.post(K.getTopicGroupMetric({clusterId:G,groupName:a,topicName:t.topicName}),c).then((function(e){var t,a,n;e&&(Z({current:null===(t=e.pagination)||void 0===t?void 0:t.pageNo,pageSize:null===(a=e.pagination)||void 0===a?void 0:a.pageSize,total:null===(n=e.pagination)||void 0===n?void 0:n.total}),H((null==e?void 0:e.bizData)||[]))})).finally((function(){D(!1)}))},$=function(e){var n={aggType:"sum",groupTopics:e.map((function(e){return{partition:e.value,topic:t.topicName}})),group:a,metricsNames:qi.map((function(e){return e.metricName})),startTime:T[0],endTime:T[1],topNu:0};m.a.post(K.getTopicGroupMetricHistory(G),n).then((function(e){p(e)}))};return Object(n.useEffect)((function(){Ee(location.hash);m.a.request(K.getConsumersMetadata(i.clusterId,a,t.topicName)).then((function(e){e.exist?(m.a.request(K.getTopicsMetaData(null==t?void 0:t.topicName,+i.clusterId)).then((function(e){var t,a=((null==e?void 0:e.partitionIdList)||[]).map((function(e){return{label:e,value:e}}));O(null===(t=null==a?void 0:a[0])||void 0===t?void 0:t.value),j(a),$(a)})).catch((function(e){o.push("/cluster/".concat(null==i?void 0:i.clusterId,"/consumers"))})),Q({})):o.push("/cluster/".concat(null==i?void 0:i.clusterId,"/consumers"))}))}),[Ee(location.hash).groupName]),Object(n.useEffect)((function(){0!==x.length&&$(x)}),[T]),Object(n.useEffect)((function(){if(""!==N&&0!==f.length){var e=f.map((function(e){var t=e.metricLines.reduce((function(e,t){return 0===e.metricLine.metricPoints.length?e.metricLine.metricPoints=t.metricPoints.map((function(e){return{timeStamp:e.timeStamp,value:Number(e.value)}})):e.metricLine.metricPoints.forEach((function(e){var a=t.metricPoints.find((function(t){return t.timeStamp===e.timeStamp}));e.value+=a?Number(a.value):0})),e}),{metricName:e.metricName,metricLine:{name:"all",metricPoints:[]}});return"__all__"===N?t:{metricName:e.metricName,metricLine:e.metricLines.find((function(e){return e.name.indexOf(N)>=0}))}}));U(e)}}),[N,f]),r.a.createElement("div",{key:t.key,style:{position:"relative",padding:"12px 16px",border:"1px solid #EFF2F7",borderRadius:"8px",backgroundColor:"#ffffff"}},r.a.createElement("div",{className:"consumer-group-detail"},r.a.createElement("div",{className:"title-and-mode",style:{height:"30px",paddingBottom:"12px"}},r.a.createElement("div",{className:"title-and-mode-header"}),r.a.createElement("div",{className:"right"},"chart"===b&&r.a.createElement(oa.a,{style:{width:140,marginRight:8},size:"small",value:N,onChange:function(e){O(e)}},r.a.createElement(Ui,{value:"__all__"},"全部Partition"),x.map((function(e){return r.a.createElement(Ui,{key:e.value,value:e.value},e.value)}))),"chart"===b&&r.a.createElement(bn.a,{rangeTimeArr:T,timeChange:function(e){P(e)}}),"chart"===b&&r.a.createElement("div",{className:"divider"}),r.a.createElement(wr,{defaultKey:b,onChange:function(e){return E(e)}},r.a.createElement(wr.TabItem,{key:"chart"},r.a.createElement("div",{style:{width:34,height:23}},r.a.createElement(h.a,{type:"icon-tubiao"}))),r.a.createElement(wr.TabItem,{key:"table"},r.a.createElement("div",{style:{width:34,height:23}},r.a.createElement(h.a,{type:"icon-biaoge"})))))),"table"===b&&r.a.createElement(In.a,{showQueryForm:!1,tableProps:{isCustomPg:!1,loading:z,showHeader:!1,rowKey:"partitionId",columns:Y,dataSource:B||[],paginationProps:Object.assign({},W),attrs:{sortDirections:["descend","ascend","default"],scroll:{x:1e3},size:"small",bordered:!1,className:"expanded-table",rowClassName:"table-small-bgcolor",onChange:function(e,t,a){Q({pagination:e,sorter:a})}}}}),"chart"===b&&r.a.createElement("div",{className:"single-chart"},r.a.createElement(gt.a,{showHeader:!1,wrapStyle:{width:"100%",height:242},option:vt({xAxis:{type:"time"},title:{show:!1},legend:{left:"center"},color:it,grid:{left:0,right:0,top:10},tooltip:{customWidth:200}}),chartTypeProp:"line",connectEventName:"",propChartData:_,seriesCallback:function(e){return e.map((function(e){var t,a=(null===(t=e.metricLine)||void 0===t?void 0:t.metricPoints)||[];return{name:e.metricName,data:a.map((function(e){return[e.timeStamp,e.value,e.unit]})),lineStyle:{width:1.5},smooth:.25,symbol:"emptyCircle",symbolSize:4,emphasis:{disabled:!0}}}))}}))))},Wi=function(e){var t=e.value,a=e.onChange,i=Object(n.useState)("newest"),o=l()(i,2),c=o[0],s=o[1];return Object(n.useEffect)((function(){a("newest")}),[]),r.a.createElement(r.a.Fragment,null,r.a.createElement(ba.a.Group,{style:{marginBottom:20},onChange:function(e){s(e.target.value),"newest"!==e.target.value&&"oldest"!==e.target.value||a(e.target.value)},value:c},r.a.createElement(ba.a,{value:"newest"},"最新Offset"),r.a.createElement(ba.a,{value:"oldest"},"最旧Offset"),r.a.createElement(ba.a,{value:"custom"},"自定义")),"custom"===c&&r.a.createElement(ai.a,{value:ce()("newest"===t||"oldest"===t?Date.now():t),style:{width:"100%"},showTime:!0,onChange:function(e){a(e.valueOf())}}))},Zi=function(e){var t=e.record,a=e.visible,i=e.setVisible,o=Object(s.useParams)(),c=J.a.useForm(),u=l()(c,1)[0],d=Object(n.useState)("assignedTime"),f=l()(d,2),p=f[0],v=f[1],g=r.a.createRef(),h=Number(o.clusterId),b=Object(n.useState)([]),E=l()(b,2),y=E[0],N=E[1];Object(n.useEffect)((function(){u.setFieldsValue({resetType:"assignedTime"})}),[]),Object(n.useEffect)((function(){a&&m.a.request(K.getTopicsMetaData(null==t?void 0:t.topicName,+o.clusterId)).then((function(e){var t=((null==e?void 0:e.partitionIdList)||[]).map((function(e){return{label:e,value:e}}));N(t)})).catch((function(e){X.b.error(e)}))}),[a]);return r.a.createElement(r.a.Fragment,null,r.a.createElement(ya.a,{title:"重置Offset",width:480,visible:a,maskClosable:!1,extra:r.a.createElement(la.b,null,r.a.createElement(Ht.a,{size:"small",style:{marginRight:8},onClick:function(e){i(!1)}},"取消"),r.a.createElement(Ht.a,{size:"small",type:"primary",onClick:function(){var e;g.current&&(e=g.current.getTableData());var a=u.getFieldsValue(),n={clusterId:h,createIfNotExist:!1,groupName:t.groupName,topicName:t.topicName};"assignedTime"===a.resetType&&(n.resetType="newest"===a.timestamp?0:"oldest"===a.timestamp?1:2,2===n.resetType&&(n.timestamp=a.timestamp)),"partition"===a.resetType&&(n.resetType=3,n.offsetList=e?e.map((function(e){return{partitionId:e.key,offset:e.value}})):[]),m.a.put(K.resetGroupOffset(),n).then((function(e){null===e?(k.a.success({message:"重置offset成功"}),i(!1)):(k.a.error({message:"重置offset失败"}),i(!1))}))}},"确定"),r.a.createElement($.a,{type:"vertical"})),className:"cluster-detail-consumer-resetoffset",onClose:function(e){i(!1)}},r.a.createElement(J.a,{form:u,labelCol:{span:5},layout:"vertical",className:"reset-offset-form"},r.a.createElement(J.a.Item,{name:"resetType",label:"重置类型",required:!0},r.a.createElement(ba.a.Group,{defaultValue:"assignedTime",value:p,onChange:function(e){v(e.target.value)}},r.a.createElement(ba.a,{value:"assignedTime"},"重置到指定时间"),r.a.createElement(ba.a,{value:"partition"},"重置分区"))),"assignedTime"===p&&r.a.createElement(J.a.Item,{name:"timestamp",label:"时间",required:!0},r.a.createElement(Wi,null)),"partition"===p&&r.a.createElement(J.a.Item,{name:"partition",label:"分区及偏移",required:!0},r.a.createElement(si,{ref:g,colCustomConfigs:[{title:"PartitionID",inputType:"select",placeholder:"请输入Partition",options:y},{title:"Offset",inputType:"number",placeholder:"请输入Offset"}]})))))},Yi=function(e,t,a,n){return new(a||(a=Promise))((function(r,i){function o(e){try{l(n.next(e))}catch(e){i(e)}}function c(e){try{l(n.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,c)}l((n=n.apply(e,t||[])).next())}))},Qi=m.a.request,$i=function(e){var t,a,i,o,c=e.scene,u=Object(s.useParams)(),m=Date.now(),d=Object(s.useHistory)(),f=Object(n.useState)({groupName:"",topicName:""}),p=l()(f,2),v=p[0],b=p[1],E=Object(n.useState)(!1),y=l()(E,2),k=y[0],N=y[1],O=Object(n.useState)([]),C=l()(O,2),S=C[0],x=C[1],j=Object(n.useState)(!0),I=l()(j,2),w=I[0],T=I[1],P=Object(n.useState)(me),L=l()(P,2),M=L[0],z=L[1],D=Object(n.useState)([]),R=l()(D,2),F=R[0],B=(R[1],Object(n.useState)([])),H=l()(B,2),A=H[0],_=(H[1],Object(n.useState)({})),U=l()(_,2),G=U[0],J=(U[1],Object(n.useState)([m-864e5,m])),W=l()(J,2),Z=(W[0],W[1],Object(n.useState)("")),Y=l()(Z,2),Q=(Y[0],Y[1],Object(n.useState)([])),$=l()(Q,2),X=($[0],$[1],Object(n.useState)()),ee=l()(X,2),te=ee[0],ae=ee[1],ne=Object(n.useState)(!1),re=l()(ne,2),ie=re[0],oe=re[1],ce=Object(n.useState)({}),le=l()(ce,2),se=le[0],ue=le[1],de=function(e){var t=e.pageNo,a=e.pageSize,n=e.groupName;return Yi(void 0,void 0,void 0,q.a.mark((function e(){var r;return q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==(null==u?void 0:u.clusterId)){e.next=2;break}return e.abrupt("return");case 2:T(!0),r={pageNo:t,pageSize:a},Qi(K.getGroupTopicList(+(null==u?void 0:u.clusterId),n),{params:r}).then((function(e){var t,a,n;N(!0),z({current:null===(t=e.pagination)||void 0===t?void 0:t.pageNo,pageSize:null===(a=e.pagination)||void 0===a?void 0:a.pageSize,total:null===(n=e.pagination)||void 0===n?void 0:n.total});var r=null==e?void 0:e.bizData.map((function(e){return Object.assign(Object.assign({},e),{key:e.topicName})}));x(r||[]),T(!1)})).catch((function(e){T(!1)}));case 5:case"end":return e.stop()}}),e)})))};return Object(n.useEffect)((function(){var e=Ee(location.hash);e.groupName||N(!1),b(e),e.groupName&&de({pageNo:1,pageSize:M.pageSize,groupName:e.groupName})}),[Ee(location.hash).groupName]),r.a.createElement(ya.a,{push:!1,title:"Consumer Group详情",width:1080,placement:"right",onClose:function(){N(!1),"topicDetail"===c&&d.goBack(),"topicDetail"!==c&&window.history.pushState("","",location.pathname)},visible:k,className:"consumer-group-detail-drawer",maskClosable:!1,destroyOnClose:!0},r.a.createElement(In.a,{showQueryForm:!1,tableProps:{showHeader:!1,rowKey:"key",loading:w,columns:(t={resetOffset:function(e){oe(!0),ue({topicName:null==e?void 0:e.topicName,groupName:null==e?void 0:e.groupName})}},a=g.a.useGlobalValue(),i=l()(a,1)[0],o=[{title:"Topic名称",dataIndex:"topicName",key:"topicName",needTooltip:!0,lineClampOne:!0,width:150},{title:"Status",dataIndex:"state",key:"state",width:150},{title:"Max Lag",dataIndex:"maxLag",key:"maxLag",width:150,render:function(e){return e?e.toLocaleString():"-"}},{title:"Member数",dataIndex:"memberCount",key:"memberCount",width:150,render:function(e){return e?e.toLocaleString():"-"}}],i.hasPermission&&i.hasPermission(V.CONSUMERS_RESET_OFFSET)&&o.push({title:"操作",dataIndex:"desc",key:"desc",width:150,render:function(e,a){return r.a.createElement("div",null,r.a.createElement("a",{onClick:function(){return t.resetOffset(a)}},"重置Offset"))}}),o),dataSource:S,paginationProps:Object.assign({},M),attrs:{className:"consumer-group-detail-drawer-table",bordered:!1,onChange:function(e,t,a){de({pageNo:e.current,pageSize:e.pageSize,filters:t,sorter:a,groupName:v.groupName})},tableLayout:"auto",scroll:{x:"max-content"},expandable:{expandedRowRender:function(e,t,a,n){return r.a.createElement(Ji,{record:e,openKeys:te,expanded:n,tableData:F,chartData:A,groupName:Ee(location.hash).groupName,loading:G})},onExpand:function(e,t){var a,n=null==t?void 0:t.key;(null===(a=F[n])||void 0===a?void 0:a.length)||ae(n)},columnWidth:"20px",fixed:"left",expandIcon:function(e){var t=e.expanded,a=e.onExpand,n=e.record;return t?r.a.createElement(h.a,{style:{fontSize:"16px"},type:"icon-xia",onClick:function(e){a(n,e)}}):r.a.createElement(h.a,{style:{fontSize:"16px"},type:"icon-jiantou_1",onClick:function(e){a(n,e)}})}},style:{width:"1032px"}}}}),r.a.createElement(Zi,{visible:ie,setVisible:oe,record:se}))},Xi=function(e,t,a,n){return new(a||(a=Promise))((function(r,i){function o(e){try{l(n.next(e))}catch(e){i(e)}}function c(e){try{l(n.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,c)}l((n=n.apply(e,t||[])).next())}))},eo=m.a.request,to=function(e){var t,a,i=g.a.useGlobalValue(),o=l()(i,1)[0],c=J.a.useForm(),u=l()(c,1)[0],m=Object(s.useParams)(),d=Object(n.useState)(!1),f=l()(d,2),p=f[0],v=f[1],b=Object(n.useState)([]),E=l()(b,2),y=E[0],k=E[1],N=Object(n.useState)(""),O=l()(N,2),C=(O[0],O[1],Object(n.useState)(Ki)),S=l()(C,2),x=S[0],j=S[1],I=Object(n.useState)({groupName:"",topicName:""}),w=l()(I,2),T=w[0],P=w[1],L=function(e){var t=e.pageNo,a=e.pageSize;return Xi(void 0,void 0,void 0,q.a.mark((function e(){var n;return q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==(null==m?void 0:m.clusterId)){e.next=2;break}return e.abrupt("return");case 2:v(!0),n={searchGroupName:T.groupName?T.groupName.slice(0,128):void 0,searchTopicName:T.topicName?T.topicName.slice(0,128):void 0,pageNo:t,pageSize:a},eo(K.getOperatingStateList(null==m?void 0:m.clusterId),{params:n}).then((function(e){var t,a,n;j({current:null===(t=e.pagination)||void 0===t?void 0:t.pageNo,pageSize:null===(a=e.pagination)||void 0===a?void 0:a.pageSize,total:null===(n=e.pagination)||void 0===n?void 0:n.total}),k((null==e?void 0:e.bizData)||[]),v(!1)})).catch((function(e){v(!1)}));case 5:case"end":return e.stop()}}),e)})))};return Object(n.useEffect)((function(){L({pageNo:1,pageSize:x.pageSize})}),[T]),r.a.createElement("div",{key:"groupList",className:"groupList"},r.a.createElement("div",{className:"breadcrumb",style:{marginBottom:"10px"}},r.a.createElement(Gn.a,{breadcrumbs:[{label:"多集群管理",aHref:"/"},{label:null===(t=null==o?void 0:o.clusterInfo)||void 0===t?void 0:t.name,aHref:"/cluster/".concat(null===(a=null==o?void 0:o.clusterInfo)||void 0===a?void 0:a.id)},{label:"Consumers",aHref:""}]})),r.a.createElement("div",{style:{margin:"12px 0"}},r.a.createElement(_i,null)),r.a.createElement("div",{className:"custom-table-content"},r.a.createElement("div",{className:ke},r.a.createElement("div",{className:"".concat(ke,"-left")},r.a.createElement("div",{className:"".concat(ke,"-left-refresh"),onClick:function(){return L({pageNo:x.current,pageSize:x.pageSize})}},r.a.createElement(h.a,{className:"".concat(ke,"-left-refresh-icon"),type:"icon-shuaxin1"})),r.a.createElement($.a,{type:"vertical",className:"".concat(ke,"-divider")}),r.a.createElement(J.a,{form:u,layout:"inline"},r.a.createElement(J.a.Item,{name:"groupName"},r.a.createElement(W.a,{allowClear:!0,style:{width:"190px"},placeholder:"请输入Consumer Group"})),r.a.createElement(J.a.Item,{name:"topicName"},r.a.createElement(W.a,{allowClear:!0,style:{width:"190px"},placeholder:"请输入Topic name"}))),r.a.createElement("div",null,r.a.createElement(J.a,{style:{justifyContent:"flex-end"},form:u,layout:"inline",onFinish:function(e){P(e)}},r.a.createElement(J.a.Item,{style:{marginRight:0}},r.a.createElement(Ht.a,{type:"primary",ghost:!0,htmlType:"submit"},"查询")))))),r.a.createElement(In.a,{key:"groupTable",showQueryForm:!1,tableProps:{showHeader:!1,rowKey:"group_list",loading:p,columns:[{title:"ConsumerGroup",dataIndex:"name",key:"name",lineClampTwo:!0,render:function(e,t){return r.a.createElement("a",{onClick:function(){window.location.hash="groupName=".concat(e||"")}},e)},width:200},{title:"消费的Topic",dataIndex:"topicNameList",key:"topicNameList",width:200,render:function(e,t){return e&&e.length>0?r.a.createElement($a,{placement:"bottom",list:e,expandTagContent:function(e){return"共有".concat(e,"个")}}):"-"}},{title:"Status",dataIndex:"state",key:"state",width:200},{title:"Member数",dataIndex:"memberCount",key:"memberCount",width:200,render:function(e){return e?e.toLocaleString():"-"}}],dataSource:y,paginationProps:Object.assign({},x),attrs:{onChange:function(e,t,a){L({pageNo:e.current,pageSize:e.pageSize,filters:t,sorter:a})},scroll:{y:"calc(100vh - 400px)"},bordered:!1}}})),r.a.createElement($i,null))},ao=a(954),no=a(313),ro=function(e){var t=Object(n.useState)(!1),a=l()(t,2),i=a[0],o=a[1],c=Object.keys(e.data).map((function(t){return{brokerId:t,brokerHost:e.data[t]}}));return r.a.createElement(Ya.a,{placement:"bottomLeft",overlayClassName:"custom-popover-borker",trigger:"click",title:r.a.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"}},r.a.createElement("div",{style:{fontSize:"16px"}},null==e?void 0:e.title),r.a.createElement(Ht.a,{type:"text",icon:r.a.createElement(jr.a,{className:"close-icon"}),onClick:function(){o(!1)}})),visible:i,onVisibleChange:function(e){return o(e)},content:r.a.createElement("div",{className:"container"},r.a.createElement("div",{className:"main"},r.a.createElement(In.a,{showQueryForm:!1,tableProps:{noPagination:!0,showHeader:!1,rowKey:"key",columns:[{title:"BrokerID",dataIndex:"brokerId",key:"brokerHost"},{title:"Host",dataIndex:"brokerHost",key:"brokerHost"}],dataSource:c,attrs:{bordered:!1,size:"middle"}}})))},c&&c.length>0&&r.a.createElement("a",{style:{display:"inline-block",marginLeft:"8px"}},"查看详情"))},io=[{label:"Topic迁移",value:0},{label:"扩缩副本",value:1},Object({NODE_ENV:"production",RUN_ENV:void 0,BUSINESS_VERSION:!1,PUBLIC_PATH:""}).BUSSINESS_VERSION?{label:"集群均衡",value:2}:void 0].filter((function(e){return e})),oo={0:"Topic迁移",1:"扩缩副本",2:"集群均衡"},co=[{label:"Doing",value:1},{label:"Prepare",value:2},{label:"Success",value:3},{label:"Failed",value:4},{label:"Canceled",value:5}],lo={1:"Doing",2:"Prepare",3:"Success",4:"Failed",5:"Canceled"},so={current:1,pageSize:10,position:"bottomRight",showSizeChanger:!0,pageSizeOptions:["10","20","50","100","200","500"]},uo=function(){var e=Object(s.useParams)(),t=Object(n.useState)(!1),a=l()(t,2),i=a[0],o=a[1],c=Object(n.useState)([]),u=l()(c,2),d=u[0],f=u[1],p=function(e){return[{title:"Jobs",value:0===(null==e?void 0:e.jobNu)||(null==e?void 0:e.jobNu)?null==e?void 0:e.jobNu:"-",customStyle:{marginLeft:0}},{title:"Doing",value:0===(null==e?void 0:e.runningNu)||(null==e?void 0:e.runningNu)?null==e?void 0:e.runningNu:"-"},{title:"Prepare",value:0===(null==e?void 0:e.waitingNu)||(null==e?void 0:e.waitingNu)?null==e?void 0:e.waitingNu:"-"},{title:"Success",value:0===(null==e?void 0:e.successNu)||(null==e?void 0:e.successNu)?null==e?void 0:e.successNu:"-"},{title:"Fail",value:0===(null==e?void 0:e.failedNu)||(null==e?void 0:e.failedNu)?null==e?void 0:e.failedNu:"-"}]};return Object(n.useEffect)((function(){o(!0),m.a.request(K.getJobsState(null==e?void 0:e.clusterId)).then((function(e){var t=JSON.parse(JSON.stringify(e));f(p(t)),o(!1)})).catch((function(e){f(p({})),o(!1)}))}),[e.clusterId]),r.a.createElement(fn,{scene:"broker",cardColumns:d,loading:i})},mo=a(955),fo=[{title:"Partition",dataIndex:"partitionId",key:"partitionId",render:function(e,t){return r.a.createElement("span",null,e,r.a.createElement(ao.a,{style:{marginLeft:"6px"},status:1===(null==t?void 0:t.status)?"warning":4===(null==t?void 0:t.status)?"error":3===(null==t?void 0:t.status)?"success":"warning"}))}},{title:"源BrokerID",dataIndex:"sourceBrokerIds",key:"sourceBrokerIds",render:function(e,t){return e&&e.length>0?e.join("、"):"-"}},{title:"目标BrokerID",dataIndex:"desBrokerIds",key:"desBrokerIds",render:function(e,t){return e&&e.length>0?e.join("、"):"-"}},{title:"MessageSize迁移进度(MB)",dataIndex:"movedSize",key:"movedSize",render:function(e,t){var a=t.movedSize?Number(m.a.formatAssignSize(e,"MB")):0,n=t.totalSize?Number(m.a.formatAssignSize(e,"MB")):0;return r.a.createElement("div",{className:"message-size"},r.a.createElement(Y.a,{title:(0===a&&0===n?100:a>0&&n>0?a/n*100:0)+"%"},r.a.createElement(no.a,{percent:0===a&&0===n?100:a>0&&n>0?a/n*100:0,strokeColor:"#556EE6",trailColor:"#ECECF1",showInfo:!1})),r.a.createElement("span",null,a+"/"+n))}},{title:"预计剩余时长",dataIndex:"remainTime",key:"remainTime",render:function(e,t){return e?m.a.transUnitTime(e):0===e?e:"-"}}],po=function(e){var t=e.record,a=e.data,i=e.loading,o=Object(n.useState)({current:1,pageSize:5,simple:!0,hideOnSinglePage:!1}),c=l()(o,2),s=c[0],u=c[1],m=Object(n.useState)({total:0,success:0,doing:0,fail:0}),d=l()(m,2),f=d[0],p=d[1];return Object(n.useEffect)((function(){var e,n,r,i,o,c,l,s;o=(null===(e=a[t.key])||void 0===e?void 0:e.filter((function(e){return"Success"===lo[e.status]})).length)||0,c=(null===(n=a[t.key])||void 0===n?void 0:n.filter((function(e){return"Doing"===lo[e.status]})).length)||0,l=(null===(r=a[t.key])||void 0===r?void 0:r.filter((function(e){return"Fail"===lo[e.status]})).length)||0,s=(null===(i=a[t.key])||void 0===i?void 0:i.length)||0,p({total:s,success:o,doing:c,fail:l})}),[a[t.key]]),r.a.createElement("div",{key:t.key,style:{position:"relative",padding:"12px 16px",border:"1px solid #EFF2F7",borderRadius:"8px",backgroundColor:"#ffffff"}},r.a.createElement(In.a,{tableProps:{isCustomPg:!1,showHeader:!1,loading:i[t.key],rowKey:"key",dataSource:a[t.key]||[],columns:fo,lineFillColor:!0,paginationProps:s,attrs:{className:"expanded-table",onChange:function(e,t){u(e)},scroll:{x:"max-content"},size:"small",bordered:!1,rowClassName:"table-small-bgcolor"}}}),r.a.createElement("div",{style:{position:"absolute",bottom:"12px",left:"16px"}},r.a.createElement("span",null,"执行情况："),r.a.createElement("span",null,"Partition总数 ",((null==f?void 0:f.success)||0)+((null==f?void 0:f.doing)||0)+((null==f?void 0:f.fail)||0)),r.a.createElement("span",{style:{marginLeft:"34px",display:"inline-block"}},r.a.createElement(ao.a,{status:"success"}),"Success ",(null==f?void 0:f.success)||0),r.a.createElement("span",{style:{marginLeft:"34px",display:"inline-block"}},r.a.createElement(ao.a,{status:"error"}),"Fail ",(null==f?void 0:f.fail)||0),r.a.createElement("span",{style:{marginLeft:"34px",display:"inline-block"}},r.a.createElement(ao.a,{status:"warning"}),"Doing ",(null==f?void 0:f.doing)||0)))},vo=function(e,t,a,n){return new(a||(a=Promise))((function(r,i){function o(e){try{l(n.next(e))}catch(e){i(e)}}function c(e){try{l(n.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,c)}l((n=n.apply(e,t||[])).next())}))},go=(m.a.request,m.a.post),ho=function(e){e.hashData;var t,a,i,o,c,u,d=Object(s.useParams)(),f=Object(n.useState)(!1),p=l()(f,2),v=p[0],g=(p[1],Object(n.useState)([])),b=l()(g,2),E=(b[0],b[1],Object(n.useState)([])),y=l()(E,2),k=y[0],N=y[1],O=Object(n.useState)({}),C=l()(O,2),S=C[0],x=C[1],j=Object(n.useState)({current:1,pageSize:10,position:"bottomRight",showSizeChanger:!0,pageSizeOptions:["10","20","50","100"]}),I=l()(j,2),w=I[0],T=I[1],P=(null===(a=null===(t=null==e?void 0:e.detailData)||void 0===t?void 0:t.subJobs)||void 0===a?void 0:a.map((function(e,t){return Object.assign(Object.assign({},e),{key:t})})))||[];return r.a.createElement(r.a.Fragment,null,r.a.createElement(gr.a,{message:r.a.createElement("div",{style:{color:"#592D00",fontSize:"14px"}},r.a.createElement("span",null,"执行情况："),r.a.createElement("span",null,"Topic总数 ",null==P?void 0:P.length),r.a.createElement("span",{style:{marginLeft:"34px",display:"inline-block"}},r.a.createElement(ao.a,{status:"success"}),"Success ",null===(i=null==e?void 0:e.detailData)||void 0===i?void 0:i.success),r.a.createElement("span",{style:{marginLeft:"34px",display:"inline-block"}},r.a.createElement(ao.a,{status:"error"}),"Fail ",null===(o=null==e?void 0:e.detailData)||void 0===o?void 0:o.fail),r.a.createElement("span",{style:{marginLeft:"34px",display:"inline-block"}},r.a.createElement(ao.a,{status:"warning"}),"Doing ",null===(c=null==e?void 0:e.detailData)||void 0===c?void 0:c.doing)),style:{background:"#FFF9E6",padding:"6px 12px",border:"none",marginBottom:"12px",borderRadius:"4px"}}),r.a.createElement("div",{className:"job-detail"},r.a.createElement(In.a,{showQueryForm:!1,tableProps:{showHeader:!1,rowKey:"key",loading:v,columns:1===(null===(u=null==e?void 0:e.detailData)||void 0===u?void 0:u.jobType)?[{title:"Topic",dataIndex:"topicName",key:"topicName",fixed:"left",width:102,render:function(e,t){return r.a.createElement("span",null,e,r.a.createElement(ao.a,{style:{marginLeft:"6px"},status:1===(null==t?void 0:t.status)?"warning":4===(null==t?void 0:t.status)?"error":3===(null==t?void 0:t.status)?"success":"warning"}))}},{title:"当前副本数",dataIndex:"oldReplicaNu",key:"oldReplicaNu"},{title:"源BrokerID",dataIndex:"sourceBrokers",key:"sourceBrokers",render:function(e,t){return e&&e.length>0?e.join("、"):"-"}},{title:"新副本数",dataIndex:"newReplicaNu",key:"newReplicaNu"},{title:"目标BrokerID",dataIndex:"desBrokers",key:"desBrokers",render:function(e,t){return e&&e.length>0?e.join("、"):"-"}},{title:"MessageSize迁移进度(MB)",dataIndex:"movedSize",key:"movedSize",render:function(e,t){var a=t.movedSize?Number(m.a.formatAssignSize(e,"MB")):0,n=t.totalSize?Number(m.a.formatAssignSize(e,"MB")):0;return r.a.createElement("div",{className:"message-size"},r.a.createElement(Y.a,{title:(t.success===t.total&&t.total>0?100:a>0&&n>0?a/n*100:0)+"%"},r.a.createElement(no.a,{percent:t.success===t.total&&t.total>0?100:a>0&&n>0?a/n*100:0,strokeColor:"#556EE6",showInfo:!1})),r.a.createElement("span",null,a+"/"+n))}},{title:"分区进度",dataIndex:"partitionRate",key:"partitionRate",render:function(e,t){return(t.success||0===t.success?t.success:"-")+"/"+(t.total||0===t.total?t.total:"-")}},{title:"预计剩余时长",dataIndex:"remainTime",key:"remainTime",render:function(e,t){return e?m.a.transUnitTime(e):0===e?e:"-"}}]:[{title:"Topic",dataIndex:"topicName",key:"topicName",fixed:"left",width:102,render:function(e,t){return r.a.createElement("span",null,e,r.a.createElement(ao.a,{style:{marginLeft:"6px"},status:1===(null==t?void 0:t.status)?"warning":4===(null==t?void 0:t.status)?"error":3===(null==t?void 0:t.status)?"success":"warning"}))}},{title:"分区",dataIndex:"partitions",key:"partitions",render:function(e,t){return e&&e.length>0?e.join("、"):"-"}},{title:"源BrokerID",dataIndex:"sourceBrokers",key:"sourceBrokers",render:function(e,t){return e&&e.length>0?e.join("、"):"-"}},{title:"目标BrokerID",dataIndex:"desBrokers",key:"desBrokers",render:function(e,t){return e&&e.length>0?e.join("、"):"-"}},{title:"当前数据保存时间 （h）",dataIndex:"currentTimeSpent",key:"currentTimeSpent",render:function(e,t){return e||0===e?m.a.transMSecondToHour(+e):"-"}},{title:"迁移数据时间范围 （h）",dataIndex:"moveTimeSpent",key:"moveTimeSpent",render:function(e,t){return e||0===e?m.a.transMSecondToHour(+e):"-"}},{title:"MessageSize迁移进度(MB)",dataIndex:"movedSize",key:"movedSize",render:function(e,t){var a=t.movedSize?Number(m.a.formatAssignSize(e,"MB")):0,n=t.totalSize?Number(m.a.formatAssignSize(e,"MB")):0;return r.a.createElement("div",{className:"message-size"},r.a.createElement(Y.a,{title:(t.success===t.total&&t.total>0?100:a>0&&n>0?a/n*100:0)+"%"},r.a.createElement(no.a,{percent:t.success===t.total&&t.total>0?100:a>0&&n>0?a/n*100:0,strokeColor:"#556EE6",showInfo:!1})),r.a.createElement("span",null,a+"/"+n))}},{title:"分区进度",dataIndex:"partitionProgress",key:"partitionProgress",render:function(e,t){return(t.success||0===t.success?t.success:"-")+"/"+(t.total||0===t.total?t.total:"-")}},{title:"预计剩余时长",dataIndex:"remainTime",key:"remainTime",render:function(e,t){return e?m.a.transUnitTime(e):0===e?e:"-"}}],dataSource:P,paginationProps:Object.assign({},w),attrs:{bordered:!1,onChange:function(e,t,a){T(e)},tableLayout:"auto",scroll:{x:"max-content"},expandable:{expandedRowRender:function(e){return r.a.createElement(po,{record:e,data:k,loading:S})},onExpand:function(t,a){var n,r=null==a?void 0:a.key;if(!(null===(n=k[r])||void 0===n?void 0:n.length)){var i=Object.assign({},S);i[r]=!0,x(i),function(t,a){vo(void 0,void 0,void 0,q.a.mark((function n(){var r,i;return q.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(void 0!==(null==d?void 0:d.clusterId)){n.next=2;break}return n.abrupt("return");case 2:try{r=Object.assign({},k),i=Object.assign({},S),(o=t.topicName,go(K.getJobPartitionDetail(null==d?void 0:d.clusterId,null==e?void 0:e.jobId,o))).then((function(e){r[a]=e,i[a]=!1,N(r),x(i)}))}catch(e){console.log(e)}case 3:case"end":return n.stop()}var o}),n)})))}(a,r)}},columnWidth:"20px",fixed:"left",expandIcon:function(e){var t=e.expanded,a=e.onExpand,n=e.record;return t?r.a.createElement(h.a,{style:{fontSize:"16px"},type:"icon-xia",onClick:function(e){a(n,e)}}):r.a.createElement(h.a,{style:{fontSize:"16px"},type:"icon-jiantou_1",onClick:function(e){a(n,e)}})}},style:{width:"1032px"}}}})))},bo=function(e,t,a,n){return new(a||(a=Promise))((function(r,i){function o(e){try{l(n.next(e))}catch(e){i(e)}}function c(e){try{l(n.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,c)}l((n=n.apply(e,t||[])).next())}))},Eo=(m.a.request,m.a.post),yo=function(e){e.hashData;var t=Object(s.useParams)(),a=Object(n.useState)(!1),i=l()(a,2),o=i[0],c=i[1],u=Object(n.useState)([]),d=l()(u,2),f=d[0],p=d[1],v=Object(n.useState)({current:1,pageSize:10,position:"bottomRight",showSizeChanger:!0,pageSizeOptions:["10","20","50","100","200","500"]}),g=l()(v,2),h=g[0],b=(g[1],Object(n.useState)(!1)),E=l()(b,2),y=(E[0],E[1],function(a){a.pageNo,a.pageSize;return bo(void 0,void 0,void 0,q.a.mark((function a(){return q.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(void 0!==(null==t?void 0:t.clusterId)){a.next=2;break}return a.abrupt("return");case 2:p([]),c(!0),Eo(K.getJobNodeTraffic(null==t?void 0:t.clusterId,null==e?void 0:e.jobId)).then((function(e){for(var t=[],a=0;a<20;a++)t.push({byteInJob:0,byteInTotal:0,byteOutJob:0,byteOutTotal:0,createTime:1645608135717,host:"string",id:0,updateTime:1645608135717});p(e||t),c(!1)})).catch((function(e){c(!1)}));case 5:case"end":return a.stop()}}),a)})))});return Object(n.useEffect)((function(){y({pageNo:1,pageSize:h.pageSize})}),[]),r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{style:{maxWidth:"1032px"}},r.a.createElement(In.a,{showQueryForm:!1,tableProps:{showHeader:!1,rowKey:"key",loading:o,columns:[{title:"Broker",dataIndex:"brokerId",key:"brokerId"},{title:"Host",dataIndex:"brokerHost",key:"brokerHost"},{title:"Job Bytes In（MB/s）",dataIndex:"byteInJob",key:"byteInJob",render:function(e,t){return r.a.createElement("div",null,r.a.createElement("span",null,e||0===e?m.a.transBToMB(e):"-"),r.a.createElement(ro,{title:"Job Bytes In",data:null==t?void 0:t.inBrokers}))}},{title:"Job Bytes Out（MB/s）",dataIndex:"byteOutJob",key:"byteOutJob",render:function(e,t){return r.a.createElement("div",null,r.a.createElement("span",null,e||0===e?m.a.transBToMB(e):"-"),(null==t?void 0:t.outBrokers)&&r.a.createElement(ro,{title:"Job Bytes Out",data:null==t?void 0:t.outBrokers}))}},{title:"Total  BytesIn（MB/s）",dataIndex:"byteInTotal",key:"byteInTotal",render:function(e,t){return e||0===e?m.a.transBToMB(e):"-"}},{title:"Total Bytes Out（MB/s）",dataIndex:"byteOutTotal",key:"byteOutTotal",render:function(e,t){return e||0===e?m.a.transBToMB(e):"-"}}],dataSource:f,paginationProps:Object.assign({},h),attrs:{bordered:!1,onChange:function(e,t,a){y({pageNo:e.current,pageSize:e.pageSize})},size:"middle"}}})))},ko=function(e,t,a,n){return new(a||(a=Promise))((function(r,i){function o(e){try{l(n.next(e))}catch(e){i(e)}}function c(e){try{l(n.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,c)}l((n=n.apply(e,t||[])).next())}))},No={1:"立即均衡",2:"周期均衡"},Oo=m.a.request,Co=(m.a.post,function(e){var t,a,i=e.jobId,o=e.balanceData,c=(e.status,Object(s.useParams)()),u=Object(n.useState)(!1),d=l()(u,2),f=d[0],p=d[1],v=Object(n.useState)({}),g=l()(v,2),h=g[0],b=g[1],E=Object(n.useState)({current:1,pageSize:10,position:"bottomRight",showSizeChanger:!0,pageSizeOptions:["10","20","50","100","200","500"]}),y=l()(E,2),k=y[0],N=y[1];Object(n.useEffect)((function(){!function(e){e.pageNo,e.pageSize;ko(void 0,void 0,void 0,q.a.mark((function e(){return q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==(null==c?void 0:c.clusterId)){e.next=2;break}return e.abrupt("return");case 2:if(p(!0),!o){e.next=7;break}return b(o),p(!1),e.abrupt("return");case 7:b([]),Oo(K.getJobsPlanRebalance(null==c?void 0:c.clusterId,i)).then((function(e){b(e||[]),p(!1)})).catch((function(e){p(!1)}));case 9:case"end":return e.stop()}}),e)})))}({pageNo:1,pageSize:k.pageSize})}),[]);for(var O=[{title:"节点",dataIndex:"host",key:"host",fixed:"left",render:function(e,t){return r.a.createElement("span",null,e,r.a.createElement(ao.a,{style:{marginLeft:"4px"},status:0===(null==t?void 0:t.status)?"success":"error"}))}},{title:r.a.createElement("div",null,"Disk使用率",r.a.createElement("span",{className:"balance-list-title"},"(","当前",r.a.createElement("span",{className:"titleImg"}),"均衡后",")")),dataIndex:"diskBefore",key:"diskBefore",width:140,render:function(e,t){var a=(null==t?void 0:t.diskBefore)||0===(null==t?void 0:t.diskBefore)?(null==t?void 0:t.diskBefore.toFixed(2))+"%":"0%",n=(null==t?void 0:t.diskAfter)||0===(null==t?void 0:t.diskAfter)?(null==t?void 0:t.diskAfter.toFixed(2))+"%":"0%";return r.a.createElement("span",{className:"balance-list-contert"},r.a.createElement("span",{className:"balance-list-contert-text"},a),r.a.createElement("span",{className:"balance-list-contert-img"}),r.a.createElement("span",{className:"balance-list-contert-text-right"},n))}},{title:r.a.createElement("div",null,"BytesIn使用率",r.a.createElement("span",{className:"balance-list-title"},"(","当前",r.a.createElement("span",{className:"titleImg"}),"均衡后",")")),dataIndex:"byteInBefore",key:"byteInBefore",width:140,render:function(e,t){var a=(null==t?void 0:t.byteInBefore)||0===(null==t?void 0:t.byteInBefore)?(null==t?void 0:t.byteInBefore.toFixed(2))+"%":"0%",n=(null==t?void 0:t.byteInAfter)||0===(null==t?void 0:t.byteInAfter)?(null==t?void 0:t.byteInAfter.toFixed(2))+"%":"0%";return r.a.createElement("span",{className:"balance-list-contert"},r.a.createElement("span",{className:"balance-list-contert-text"},a),r.a.createElement("span",{className:"balance-list-contert-img"}),r.a.createElement("span",{className:"balance-list-contert-text-right"},n))}},{title:r.a.createElement("div",null,"BytesOut使用率",r.a.createElement("span",{className:"balance-list-title"},"(","当前",r.a.createElement("span",{className:"titleImg"}),"均衡后",")")),dataIndex:"byteOutBefore",key:"byteOutBefore",width:140,render:function(e,t){var a=(null==t?void 0:t.byteOutBefore)||0===(null==t?void 0:t.byteOutBefore)?(null==t?void 0:t.byteOutBefore.toFixed(2))+"%":"0%",n=(null==t?void 0:t.byteOutAfter)||0===(null==t?void 0:t.byteOutAfter)?(null==t?void 0:t.byteOutAfter.toFixed(2))+"%":"0%";return r.a.createElement("span",{className:"balance-list-contert"},r.a.createElement("span",{className:"balance-list-contert-text"},a),r.a.createElement("span",{className:"balance-list-contert-img"}),r.a.createElement("span",{className:"balance-list-contert-text-right"},n))}},{title:"移入情况",dataIndex:"inReplica",key:"inReplica",render:function(e,t){return(e||0===e?e:0)+"/"+((null==t?void 0:t.inSize)||0===(null==t?void 0:t.inSize)?be(null==t?void 0:t.inSize,"B",0).valueWithUnit:0)}},{title:"移出情况",dataIndex:"outReplica",key:"outReplica",render:function(e,t){return(e||0===e?e:0)+"/"+((null==t?void 0:t.outSize)||0===(null==t?void 0:t.outSize)?be(null==t?void 0:t.outSize,"B",0).valueWithUnit:0)}}],C=[],S=0;S<100;S++)C.push({key:S,name:"John Brown",age:S+1,street:"Lake Park",building:"C",number:2035,companyAddress:"Lake Street 42",companyName:"SoftLake Co",gender:"M"});return r.a.createElement(r.a.Fragment,null,r.a.createElement("h3",{style:{fontSize:"16px"}},"计划概览"),r.a.createElement(Q.a,{spinning:f},r.a.createElement(mo.b,{style:{fontSize:"13px"},column:3,labelStyle:{display:"flex",textAlign:"right",justifyContent:"end",color:"#74788D",fontSize:"13px"},contentStyle:{fontSize:"13px"}},r.a.createElement(mo.b.Item,{label:"任务类型"},No[null==h?void 0:h.type]||"-"),r.a.createElement(mo.b.Item,{labelStyle:{width:"100px"},label:"总迁移大小"},m.a.getSizeAndUnit(null==h?void 0:h.moveSize,"B").valueWithUnit),r.a.createElement(mo.b.Item,{labelStyle:{width:"100px"},label:"迁移副本数"},(null==h?void 0:h.replicas)||"-"),r.a.createElement(mo.b.Item,{label:"均衡区间"},(null==h?void 0:h.clusterBalanceIntervalList)?null===(t=null==h?void 0:h.clusterBalanceIntervalList)||void 0===t?void 0:t.map((function(e){var t,a;return r.a.createElement(pn.a,{style:{padding:"4px 5px",backgroundColor:"rgba(33,37,41,0.08)",marginRight:"4px"},key:null==e?void 0:e.priority},(null===(t=e.type)||void 0===t?void 0:t.slice(0,1).toUpperCase())+(null===(a=e.type)||void 0===a?void 0:a.slice(1))+": ±"+e.intervalPercent+"%")})):"-"),r.a.createElement(mo.b.Item,{labelStyle:{width:"100px"},label:"Topic黑名单"},(null==h?void 0:h.blackTopics)&&(null===(a=null==h?void 0:h.blackTopics)||void 0===a?void 0:a.length)>0?r.a.createElement($a,{placement:"bottomLeft",list:null==h?void 0:h.blackTopics,expandTagContent:function(e){return"共有".concat(e,"个")}}):"-"))),r.a.createElement("h3",{style:{fontSize:"16px"}},"计划明细"),r.a.createElement("div",{style:{maxWidth:"1032px"}},r.a.createElement(In.a,{tableProps:{showHeader:!1,loading:f,rowKey:"key",dataSource:null==h?void 0:h.detail,paginationProps:k,columns:O,lineFillColor:!0,attrs:{onChange:function(e,t,a){N(e)},scroll:{x:"max-content"}}}})),(null==h?void 0:h.reassignmentJson)&&r.a.createElement(r.a.Fragment,null,r.a.createElement("h3",{style:{fontSize:"16px"}},"执行文件"),r.a.createElement("div",null,r.a.createElement("a",{href:"data:,".concat(null==h?void 0:h.reassignmentJson),rel:"noopener",download:"reassignment.json"},"Reassignment json file（点击下载）"))))}),So=m.a.request,xo=m.a.post,jo=ka.a.TabPane,Io=function(e){var t,a,i,o,c,u=Object(s.useParams)(),d=Object(n.useState)(null),f=l()(d,2),p=f[0],v=f[1],g=Object(n.useState)(!1),b=l()(g,2),E=b[0],y=b[1],k=Object(n.useState)("TeskDetails"),N=l()(k,2),O=(N[0],N[1]),C=Object(n.useState)(!1),S=l()(C,2),x=S[0],j=S[1],I=Object(n.useState)(),w=l()(I,2),T=w[0],P=w[1],L=function(){var t;y(!0),(null==e?void 0:e.record)&&So(K.getJobDetail(u.clusterId,null===(t=null==e?void 0:e.record)||void 0===t?void 0:t.id)).then((function(e){v(e||[]);var t=m.a.transBToMB(null==e?void 0:e.flowLimit);P(t),y(!1)})).catch((function(e){y(!1)}))};return Object(n.useEffect)((function(){L()}),[null==e?void 0:e.record]),r.a.createElement(ya.a,{width:1080,title:"查看进度",visible:e.visible,onClose:function(){return e.setVisble(!1)},destroyOnClose:!0,maskClosable:!1},r.a.createElement(Q.a,{spinning:E},r.a.createElement(mo.b,{style:{fontSize:"13px"},column:3,labelStyle:{width:"92px",textAlign:"right",display:"flex",justifyContent:"end",color:"#74788D",fontSize:"13px"},contentStyle:{fontSize:"13px"}},r.a.createElement(mo.b.Item,{label:"任务类型"},oo[null==p?void 0:p.jobType]||"-"),r.a.createElement(mo.b.Item,{label:"运行状态"},lo[null==p?void 0:p.jobStatus]||"-"),r.a.createElement(mo.b.Item,{label:"限流"},r.a.createElement("div",null,x?r.a.createElement("div",{className:"edit-flow-limit",style:{display:"flex",alignItems:"center"}},r.a.createElement(Ft.a,{controls:!1,size:"small",defaultValue:m.a.transBToMB(null==p?void 0:p.flowLimit),value:T,onChange:function(e){return P(e)},min:0,max:99999,style:{width:"150px"}}),r.a.createElement(ri.a,{style:{margin:"0 10px",color:"green"},onClick:function(){var t;if(T)if(T<0)ie.error("限流值最小值为0");else{var a=m.a.transMBToB(T);xo(K.getJobTraffic(u.clusterId,null===(t=null==e?void 0:e.record)||void 0===t?void 0:t.id,a)).then((function(e){ie.success("修改限流成功"),L(),j(!1)}))}else ie.error("限流值不能为空")}}),r.a.createElement(jr.a,{style:{color:"red"},onClick:function(){return j(!1)}})):r.a.createElement("span",null,(null==p?void 0:p.flowLimit)?m.a.transBToMB(null==p?void 0:p.flowLimit)+" MB/s ":"-",lo[null==p?void 0:p.jobStatus]&&"Success"!==lo[null==p?void 0:p.jobStatus]?r.a.createElement(h.a,{style:{fontSize:"14px"},type:"icon-bianji1",onClick:function(){return j(!0)}}):null))),r.a.createElement(mo.b.Item,{label:"计划执行时间"},(null==p?void 0:p.planTime)?ce()(null==p?void 0:p.planTime).format(de):"-"),r.a.createElement(mo.b.Item,{label:"实际执行时间"},(null==p?void 0:p.startTime)?ce()(null==p?void 0:p.startTime).format(de):"-"),r.a.createElement(mo.b.Item,{label:"任务完成时间"},(null==p?void 0:p.endTime)?ce()(null==p?void 0:p.endTime).format(de):"-"))),r.a.createElement(ka.a,{className:"custom_tabs_class",defaultActiveKey:"Configuration",onChange:function(e){O(e)},destroyInactiveTabPane:!0},2===(null===(t=null==e?void 0:e.record)||void 0===t?void 0:t.jobType)&&r.a.createElement(jo,{tab:"均衡计划",key:"Rebalance"},r.a.createElement(Co,{status:null===(a=null==e?void 0:e.record)||void 0===a?void 0:a.jobStatus,jobId:null===(i=null==e?void 0:e.record)||void 0===i?void 0:i.id})),r.a.createElement(jo,{tab:"任务明细",key:"TeskDetails"},r.a.createElement(ho,{detailData:p,jobId:null===(o=null==e?void 0:e.record)||void 0===o?void 0:o.id})),r.a.createElement(jo,{tab:"节点流量情况",key:"NodeTraffic"},r.a.createElement(yo,{jobId:null===(c=null==e?void 0:e.record)||void 0===c?void 0:c.id}))))},wo=a(496),To=function(e){var t=e.value,a=e.onChange;return r.a.createElement(vr.a,{trigger:["click"],placement:"bottomLeft",overlayClassName:"cron-input-dropDown",overlay:r.a.createElement(wo.a,{className:"cron-input",style:{width:"553px"},value:t,onOk:a})},r.a.createElement(W.a,{value:t,placeholder:"请输入任务周期"}))},Po=function(e,t,a,n){return new(a||(a=Promise))((function(r,i){function o(e){try{l(n.next(e))}catch(e){i(e)}}function c(e){try{l(n.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,c)}l((n=n.apply(e,t||[])).next())}))},Lo=function(e,t){var a={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(n=Object.getOwnPropertySymbols(e);r<n.length;r++)t.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(e,n[r])&&(a[n[r]]=e[n[r]])}return a},Mo=function(e){var t=e.dataIndex,a=e.editable,i=(e.title,e.inputType),o=e.handleSave,c=e.placeholder,l=e.record,s=(e.index,e.children),u=Lo(e,["dataIndex","editable","title","inputType","handleSave","placeholder","record","index","children"]),m=Object(n.useRef)(null),d=function(){return Po(void 0,void 0,void 0,q.a.mark((function e(){return q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:try{o(Object.assign({},l))}catch(e){console.log("Save failed:",e)}case 1:case"end":return e.stop()}}),e)})))},f="number"===i?r.a.createElement(Ft.a,{style:{width:"130px"},min:1,max:100,autoComplete:"off",placeholder:c,ref:m,formatter:function(e){return"".concat(e,"%")},parser:function(e){return e.toString().replace("%","")},onPressEnter:d,onBlur:d,prefix:"avg+-"}):r.a.createElement(W.a,{autoComplete:"off",placeholder:c});return r.a.createElement("td",Object.assign({},u),a?r.a.createElement("div",{style:{display:"flex",alignItems:"center"}},r.a.createElement("span",{style:{marginRight:"5px"}},"avg ±"),r.a.createElement(J.a.Item,{name:t,style:{margin:0},rules:[{required:!0,message:"请输入!"}]},f)):s)},zo=r.a.forwardRef((function(e,t){var a=e.colCustomConfigs,i=e.tableData,o=e.tableDataChange,c=J.a.useForm(),s=l()(c,1)[0],u=Object(n.useState)(i),m=l()(u,2),d=m[0],f=m[1];Object(n.useEffect)((function(){f(i);var e={};null==i||i.forEach((function(t){e["".concat(t.type,"-intervalPercent")]=t.intervalPercent})),s.setFieldsValue(Object.assign({},e))}),[i]);var p=function(){return Po(void 0,void 0,void 0,q.a.mark((function e(){var t;return q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.validateFields();case 2:return t=e.sent,e.abrupt("return",t);case 4:case"end":return e.stop()}}),e)})))},v=function(e){return Po(void 0,void 0,void 0,q.a.mark((function e(){var t;return q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t={},s.validateFields().then((function(e){g(t=e)})).catch((function(e){t=null==e?void 0:e.values,g(t)}));case 2:case"end":return e.stop()}}),e)})))},g=function(e){var t=ue()(d);Object.keys(e).forEach((function(a){var n=a.split("-")[0],r=t.findIndex((function(e){return n===e.type})),i=t[r];t.splice(r,1,Object.assign(Object.assign({},i),{intervalPercent:e[a]}))})),o(t)};r.a.useImperativeHandle(t,(function(){return{editTableValidate:p}}));var h=[{title:"均衡维度",dataIndex:"name",width:"40%"},{title:function(){return r.a.createElement("span",null,"均衡区间"," ",r.a.createElement(Y.a,{title:"单位：%，大于0，小于100"}," ",r.a.createElement(vn.a,null)))},dataIndex:"intervalPercent",width:"40%",editable:!0},{title:"优先级",dataIndex:"priority",width:"20%"}].map((function(e,t){var n;return e.editable?Object.assign(Object.assign({},e),{onCell:function(t,n){return Object.assign({record:t,inputType:"number",dataIndex:"".concat(t.type,"-").concat(e.dataIndex),title:e.title,editable:e.editable,index:n,handleSave:v,form:s},null==a?void 0:a[n])},title:(null===(n=null==a?void 0:a[t])||void 0===n?void 0:n.title)||e.title}):e}));return r.a.createElement("div",{className:"edit-table-form"},r.a.createElement(J.a,{form:s,component:!1},r.a.createElement(Wa.a,{components:{body:{cell:Mo}},dataSource:d,columns:h,rowClassName:function(){return"editable-row"},pagination:!1})))})),Do=function(e){var t=e.onClose,a=e.visible,n=e.detailData,i=e.isPrevew,o=e.balanceImmediate,c=e.isEdit,s=g.a.useGlobalValue();l()(s,1)[0];return r.a.createElement(r.a.Fragment,null,r.a.createElement(ya.a,{title:r.a.createElement(la.b,{size:0},r.a.createElement(Ht.a,{type:"text",className:"drawer-title-left-button",icon:r.a.createElement(h.a,{type:"icon-fanhui1"}),onClick:t}),r.a.createElement($.a,{type:"vertical"}),r.a.createElement("span",null,"执行计划")),width:"1080px",destroyOnClose:!0,className:"plan-drawer",onClose:t,visible:a,maskClosable:!1,extra:r.a.createElement(la.b,null,!!i&&r.a.createElement(r.a.Fragment,null,r.a.createElement(Ht.a,{size:"small",onClick:t},"取消"),r.a.createElement(Ht.a,{className:c?"":"btn-width84",type:"primary",size:"small",disabled:!1,onClick:function(){0===(null==n?void 0:n.replicas)?X.b.warning("replicas=0,该集群已达到均衡要求，不需要再执行均衡任务。"):o&&o()}},c?"确定":"立即均衡"),r.a.createElement($.a,{type:"vertical"})))},r.a.createElement(Co,{balanceData:n})))},Ro=[{label:"近5mins",value:300},{label:"近10mins",value:600},{label:"近30mins",value:1800},{label:"近1h",value:3600},{label:"近6h",value:21600},{label:"近12h",value:43200},{label:"近24h",value:86400}],Fo=[{label:"Disk",value:"disk"},{label:"BytesIn",value:"bytesIn"},{label:"BytesOut",value:"bytesOut"}],Bo=[],Ho=1;Ho<=28;Ho++)Bo.push({label:"每月".concat(Ho,"日"),value:Ho});var Ao=function(e){var t=e.onClose,a=e.visible,i=e.isCycle,o=void 0!==i&&i,c=e.formData,s=e.genData,u=g.a.useGlobalValue(),d=l()(u,1)[0],f=J.a.useForm(),p=l()(f,1)[0],v=Object(n.useRef)(),b=Object(n.useState)([]),E=l()(b,2),y=E[0],k=E[1],N=Object(n.useState)([]),O=l()(N,2),C=(O[0],O[1]),S=Object(n.useState)([]),x=l()(S,2),j=x[0],I=x[1],w=Object(n.useState)([]),T=l()(w,2),P=T[0],L=T[1],M=Object(n.useState)([]),z=l()(M,2),D=z[0],R=z[1],F=Object(n.useState)(["disk","bytesIn","bytesOut"]),B=l()(F,2),H=B[0],A=B[1],V=Object(n.useState)(!1),_=l()(V,2),U=_[0],G=_[1],q=Object(n.useState)({}),W=l()(q,2),Z=W[0],Q=W[1],X=Object(n.useState)(0),ee=l()(X,2),te=ee[0],ae=ee[1],ne=Object(n.useState)(1),re=l()(ne,2),oe=re[0],ce=re[1];Object(n.useEffect)((function(){ue(),me()}),[]),Object(n.useEffect)((function(){le()}),[a,c]),Object(n.useEffect)((function(){C((null==c?void 0:c.brokers)||[])}),[y]),Object(n.useEffect)((function(){L((null==c?void 0:c.topicBlackList)||[])}),[j]);var le=function(){var e,t;if(c&&Object.keys(c).length>0){var a=null===(e=null==c?void 0:c.clusterBalanceIntervalList)||void 0===e?void 0:e.map((function(e){var t,a=Fo.findIndex((function(t){return(null==t?void 0:t.value)===(null==e?void 0:e.type)}));return Object.assign(Object.assign({},e),{name:null===(t=Fo[a])||void 0===t?void 0:t.label})}));R(a||[]);var n=null===(t=null==c?void 0:c.clusterBalanceIntervalList)||void 0===t?void 0:t.map((function(e){return null==e?void 0:e.type}));p.setFieldsValue(Object.assign(Object.assign({},c),{brokers:(null==c?void 0:c.brokers)||[],topicBlackList:(null==c?void 0:c.topicBlackList)||[],dimension:n,throttleUnitM:(null==c?void 0:c.throttleUnitB)/1024/1024}))}else{var r=["disk","bytesIn","bytesOut"];p.resetFields(),p.setFieldsValue({dimension:r,metricCalculationPeriod:600});var i=null==r?void 0:r.map((function(e,t){var a,n=Fo.findIndex((function(t){return t.value===e}));return{type:e,name:null===(a=Fo[n])||void 0===a?void 0:a.label,intervalPercent:10,priority:t+1}}));R(i),A(["disk","bytesIn","bytesOut"]),C([]),L([])}},se=function(){v.current.editTableValidate().then((function(e){p.validateFields().then((function(e){var t,a,n,r,i,l,u,f,p,v=Object.assign(Object.assign({},e),{clusterId:null===(t=null==d?void 0:d.clusterInfo)||void 0===t?void 0:t.id,clusterBalanceIntervalList:D,scheduleJob:o||!1,throttleUnitB:1024*(null==e?void 0:e.throttleUnitM)*1024});if("throughput"===(null==e?void 0:e.priority)?(v.parallelNum=0,v.executionStrategy=1):"stability"===(null==e?void 0:e.priority)&&(v.parallelNum=1,v.executionStrategy=2),null==c?void 0:c.jobId){var g={creator:null===(a=JSON.parse(null==d?void 0:d.userInfo))||void 0===a?void 0:a.userName,jobType:2,planTime:null===(n=null==c?void 0:c.record)||void 0===n?void 0:n.planTime,jobStatus:(null===(r=null==c?void 0:c.record)||void 0===r?void 0:r.jobStatus)||2,target:null===(i=null==c?void 0:c.record)||void 0===i?void 0:i.target,id:null===(l=null==c?void 0:c.record)||void 0===l?void 0:l.id,jobDesc:(null===(u=null==c?void 0:c.record)||void 0===u?void 0:u.description)||"",jobData:JSON.stringify(Object.assign(Object.assign({},null==c?void 0:c.jobData),v))};m.a.put(K.putJobsTaskData(null===(f=null==d?void 0:d.clusterInfo)||void 0===f?void 0:f.id),g).then((function(){ie.success("集群均衡任务编辑成功"),de(!0),G(!1),s()})).catch((function(e){console.log(e,"err")}))}else m.a.request(K.balanceStrategy(null===(p=null==d?void 0:d.clusterInfo)||void 0===p?void 0:p.id),{method:"POST",data:v}).then((function(e){ie.success(o?"成功创建周期均衡策略":"成功创建立即均衡策略"),de(!0),G(!1),o&&s()}))}))}))},ue=function(){var e;m.a.request(K.getBrokersMetaList(null===(e=null==d?void 0:d.clusterInfo)||void 0===e?void 0:e.id),{method:"GET"}).then((function(e){var t=(e||[]).map((function(e){return Object.assign(Object.assign({},e),{key:e.brokerId,title:"".concat(e.brokerId," (").concat(e.host,")")})}));k(t)}))},me=function(){var e;m.a.request(K.getTopicMetaList(null===(e=null==d?void 0:d.clusterInfo)||void 0===e?void 0:e.id),{method:"GET"}).then((function(e){var t=(e||[]).map((function(e){return Object.assign(Object.assign({},e),{key:e.topicName,title:e.topicName})}));I(t)}))},de=function(e){e?t(e):t(),ae(0),ce(1),p.resetFields()};return r.a.createElement(r.a.Fragment,null,r.a.createElement(Do,{visible:U,onClose:function(){G(!1)},balanceImmediate:function(){se()},detailData:Z,isPrevew:!0,isEdit:!!(null==c?void 0:c.jobId)}),r.a.createElement(ya.a,{title:o?"周期均衡":"立即均衡",width:"600px",destroyOnClose:!0,className:"balance-drawer",onClose:function(){return de()},visible:a,maskClosable:!1,extra:r.a.createElement(la.b,null,r.a.createElement(Ht.a,{size:"small",onClick:function(){return de()}},"取消"),o?r.a.createElement(Ht.a,{type:"primary",size:"small",disabled:!1,onClick:se},"确定"):r.a.createElement(Ht.a,{className:"btn-width84",type:"primary",size:"small",disabled:!1,onClick:function(){v.current.editTableValidate().then((function(e){p.validateFields().then((function(e){var t,a,n,r=Object.assign(Object.assign({},e),{clusterId:null===(t=null==d?void 0:d.clusterInfo)||void 0===t?void 0:t.id,clusterBalanceIntervalList:D,scheduleJob:o||!1,throttleUnitB:1024*(null==e?void 0:e.throttleUnitM)*1024});o||("throughput"===(null==e?void 0:e.priority)?(r.parallelNum=0,r.executionStrategy=1):"stability"===(null==e?void 0:e.priority)&&(r.parallelNum=1,r.executionStrategy=2)),(null==c?void 0:c.jobId)?m.a.request(K.getBalancePlan(null===(a=null==d?void 0:d.clusterInfo)||void 0===a?void 0:a.id,null==c?void 0:c.jobId),{method:"GET"}).then((function(e){Q(e||{}),G(!0)})):m.a.request(K.balancePreview(null===(n=null==d?void 0:d.clusterInfo)||void 0===n?void 0:n.id),{method:"POST",data:r}).then((function(e){Q(e||{}),G(!0)}))}))}))}},"预览计划"),r.a.createElement($.a,{type:"vertical"}))},r.a.createElement(J.a,{form:p,layout:"vertical",preserve:!1,initialValues:{status:1}},r.a.createElement("h6",{className:"form-title"},"均衡策略"),r.a.createElement(J.a.Item,{name:"metricCalculationPeriod",label:"指标计算周期",rules:[{required:!0,message:"请选择!"}]},r.a.createElement(oa.a,{placeholder:"请选择指标计算周期",options:Ro})),r.a.createElement(J.a.Item,{label:"均衡维度",name:"dimension",rules:[{required:!0,message:"请选择!"}]},r.a.createElement(oa.a,{placeholder:"请选择均衡维度",mode:"multiple",value:H,options:Fo,onChange:function(e){var t=null==e?void 0:e.map((function(e,t){var a,n=Fo.findIndex((function(t){return t.value===e})),r=null==D?void 0:D.findIndex((function(t){return t.type===e}));return{type:e,name:null===(a=Fo[n])||void 0===a?void 0:a.label,intervalPercent:r>-1?D[r].intervalPercent:10,priority:t+1}}));R(t),A(e)}})),r.a.createElement(J.a.Item,null,r.a.createElement(zo,{ref:v,tableData:D,tableDataChange:function(e){R(e)}})),r.a.createElement(J.a.Item,{name:"topicBlackList",label:"Topic黑名单",rules:[{required:!1,message:"请选择!"}]},r.a.createElement(Mi.a,{dataSource:j,titles:["待选黑名单","已选黑名单"],customHeader:!0,showSelectedCount:!0,locale:{itemUnit:"",itemsUnit:""},showSearch:!0,filterOption:function(e,t){return t.topicName.indexOf(e)>-1},targetKeys:P,onChange:function(e){L(e)},render:function(e){return e.title},suffix:r.a.createElement(h.a,{type:"icon-fangdajing"})})),r.a.createElement("h6",{className:"form-title"},"运行配置"),o&&r.a.createElement(J.a.Item,{className:"schedule-cron",name:"scheduleCron",label:"任务周期",rules:[{required:!0,message:"请输入!"},{validator:function(e,t){var a=t.split(" ");return"*"===a[1]||"*"===a[2]?Promise.reject(new Error("任务周期必须指定分钟、小时")):Promise.resolve()}}]},r.a.createElement(To,null)),r.a.createElement(J.a.Item,{label:"",name:"priority",rules:[{required:!0,message:"Principle 不能为空"}],initialValue:"throughput"},r.a.createElement(ba.a.Group,{onChange:function(e){"throughput"===e.target.value?(ae(0),ce(1)):"stability"===e.target.value?(ae(1),ce(2)):p.setFieldsValue({parallelNum:te,executionStrategy:oe})}},r.a.createElement(ba.a,{value:"throughput"},"吞吐量优先"),r.a.createElement(ba.a,{value:"stability"},"稳定性优先"),r.a.createElement(ba.a,{value:"custom"},"自定义"))),r.a.createElement(J.a.Item,{dependencies:["priority"],style:{marginBottom:0}},(function(e){return"custom"===(0,e.getFieldValue)("priority")?r.a.createElement("div",{className:"form-item-group"},r.a.createElement(J.a.Item,{name:"parallelNum",label:r.a.createElement("span",null,"任务并行度",r.a.createElement(Y.a,{title:"每个节点同时迁移的副本数量"},r.a.createElement(h.a,{style:{fontSize:"14px",marginLeft:"5px"},type:"icon-zhushi"}))),rules:[{required:!0,message:"请输入!"}]},r.a.createElement(Ft.a,{min:0,max:999,placeholder:"请输入任务并行度",style:{width:"100%"}})),r.a.createElement(J.a.Item,{name:"executionStrategy",label:r.a.createElement("span",null,"执行策略",r.a.createElement(Y.a,{title:"不同大小副本执行的顺序"},r.a.createElement(h.a,{style:{fontSize:"14px",marginLeft:"5px"},type:"icon-zhushi"}))),rules:[{required:!0,message:"请选择!"}]},r.a.createElement(ba.a.Group,null,r.a.createElement(ba.a,{value:1},"优先最大副本"),r.a.createElement(ba.a,{value:2},"优先最小副本")))):null})),r.a.createElement(J.a.Item,{name:"throttleUnitM",label:"限流",rules:[{required:!0,message:"请输入!"}]},r.a.createElement(Ft.a,{min:1,max:99999,placeholder:"请输入限流",addonAfter:"MB/s",style:{width:"100%"}})),o&&r.a.createElement(r.a.Fragment,null,r.a.createElement(J.a.Item,{name:"status",label:"是否启用"},r.a.createElement(ba.a.Group,null,r.a.createElement(ba.a,{value:1},"启用"),r.a.createElement(ba.a,{value:0},"禁用")))))))},Vo=function(e,t,a,n){return new(a||(a=Promise))((function(r,i){function o(e){try{l(n.next(e))}catch(e){i(e)}}function c(e){try{l(n.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,c)}l((n=n.apply(e,t||[])).next())}))},Ko=m.a.request,_o=function(e){var t,a,i,o,c,u=g.a.useGlobalValue(),f=l()(u,1)[0],p=J.a.useForm(),v=l()(p,1)[0],b=Object(s.useParams)(),E=(Object(s.useHistory)(),Object(n.useState)(!1)),y=l()(E,2),k=y[0],N=y[1],O=Object(n.useState)([]),C=l()(O,2),S=C[0],x=C[1],j=Object(n.useState)(),I=l()(j,2),w=I[0],T=I[1],P=Object(n.useState)(so),L=l()(P,2),M=L[0],z=L[1],D=Object(n.useState)(!1),R=l()(D,2),F=R[0],B=R[1],H=Object(n.useState)(null),A=l()(H,2),V=A[0],_=A[1],U=Object(n.useState)(!1),G=l()(U,2),Z=G[0],Q=G[1],X=Object(n.useState)(!1),ee=l()(X,2),te=ee[0],ae=ee[1],ne=Object(n.useState)(!1),re=l()(ne,2),oe=re[0],le=re[1],se=Object(n.useState)(!1),ue=l()(se,2),me=ue[0],fe=ue[1],pe=function(e){var t=e.pageNo,a=e.pageSize;return Vo(void 0,void 0,void 0,q.a.mark((function e(){var n;return q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==(null==b?void 0:b.clusterId)){e.next=2;break}return e.abrupt("return");case 2:N(!0),n=Object.assign(Object.assign({},w),{pageNo:t,pageSize:a,type:0===(null==w?void 0:w.type)||(null==w?void 0:w.type)?null==w?void 0:w.type:-1}),Ko(K.getJobsList(null==b?void 0:b.clusterId),{method:"POST",data:n}).then((function(e){var t,a,n;z({current:null===(t=e.pagination)||void 0===t?void 0:t.pageNo,pageSize:null===(a=e.pagination)||void 0===a?void 0:a.pageSize,total:null===(n=e.pagination)||void 0===n?void 0:n.total}),x((null==e?void 0:e.bizData)||[]),N(!1)})).catch((function(e){x([]),N(!1)}));case 5:case"end":return e.stop()}}),e)})))},ve=function(e){T(e)},ge=function(){Q(!1),ae(!1),le(!1),_(null)};return Object(n.useEffect)((function(){pe({pageNo:1,pageSize:M.pageSize})}),[w]),r.a.createElement("div",{key:"brokerList"},r.a.createElement("div",{className:"breadcrumb"},r.a.createElement(Gn.a,{breadcrumbs:[{label:"多集群管理",aHref:"/"},{label:null===(t=null==f?void 0:f.clusterInfo)||void 0===t?void 0:t.name,aHref:"/cluster/".concat(null===(a=null==f?void 0:f.clusterInfo)||void 0===a?void 0:a.id)},{label:"Job",aHref:""}]})),r.a.createElement("div",{style:{margin:"12px 0"}},r.a.createElement(uo,null)),r.a.createElement("div",{className:"custom-table-content jobs-self"},r.a.createElement("div",{className:ke},r.a.createElement("div",{className:"".concat(ke,"-left")},r.a.createElement("div",{className:"".concat(ke,"-left-refresh"),onClick:function(){return pe({pageNo:M.current,pageSize:M.pageSize})}},r.a.createElement(h.a,{className:"".concat(ke,"-left-refresh-icon"),type:"icon-shuaxin1"})),r.a.createElement($.a,{type:"vertical",className:"".concat(ke,"-divider")}),r.a.createElement(J.a,{form:v,layout:"inline",onFinish:ve},r.a.createElement(J.a.Item,{name:"type"},r.a.createElement(oa.a,{options:io,style:{width:"190px"},className:"detail-table-select",placeholder:"选择任务类型"})),r.a.createElement(J.a.Item,{name:"jobTarget"},r.a.createElement(W.a,{allowClear:!0,style:{width:"190px"},placeholder:"请输入执行任务对象"})),r.a.createElement(J.a.Item,{name:"status"},r.a.createElement(oa.a,{mode:"multiple",maxTagCount:"responsive",options:co,style:{width:"190px"},className:"detail-table-select",placeholder:"选择运行状态",showArrow:!0,allowClear:!0}))),r.a.createElement("div",null,r.a.createElement(J.a,{style:{justifyContent:"flex-end"},form:v,layout:"inline",onFinish:ve},r.a.createElement(J.a.Item,{style:{marginRight:0}},r.a.createElement(Ht.a,{type:"primary",ghost:!0,htmlType:"submit"},"查询")))))),r.a.createElement(In.a,{key:"brokerTable",showQueryForm:!1,tableProps:{tableId:"jobs_list",showHeader:!1,rowKey:"id",loading:k,columns:(c={onDelete:function(e){d.a.confirm({title:'确认删除"任务【'.concat(e.id,'】"吗？'),okText:"删除",okType:"primary",centered:!0,cancelText:"取消",okButtonProps:{size:"small",danger:!0},cancelButtonProps:{size:"small"},maskClosable:!1,onOk:function(t){return m.a.delete(K.getJobsDelete(null==b?void 0:b.clusterId,null==e?void 0:e.id)).then((function(e){ie.success("删除任务成功"),pe({pageNo:1,pageSize:M.pageSize}),t()}))}})},setViewProgress:function(e,t){var a,n,r;_(e),0===t?ae(!0):1===t?Q(!0):2===t?(a=e.id,n=b.clusterId,r={clusterId:n,jobId:a},Ko(K.getJobsTaskData(r.clusterId,r.jobId),r)).then((function(t){var a=t&&JSON.parse(null==t?void 0:t.jobData)||{};fe(Object.assign(Object.assign({},a),{jobId:e.id,record:e,jobData:a})),le(!0)})):B(!0)}},[{title:"任务ID",dataIndex:"id",key:"id",width:70},{title:"任务类型",dataIndex:"jobType",key:"jobType",render:function(e,t){return oo[e]}},{title:"任务执行对象",dataIndex:"target",key:"target",width:232,render:function(e,t){return r.a.createElement($a,{placement:"bottom",list:e.split(","),expandTagContent:function(e){return"共有".concat(e,"个")}})}},{title:"运行状态",dataIndex:"jobStatus",key:"jobStatus",render:function(e,t){return r.a.createElement(pn.a,{className:"12312512512",style:{background:1===e?"rgba(85,110,230,0.10)":4===e?"#fff3e4":3===e?"rgba(0,192,162,0.10)":"#ebebf6",color:1===e?"#556EE6":4===e?"#F58342":3===e?"#00C0A2":"#495057",padding:"3px 6px"}},lo[e])}},{title:"运行进度",dataIndex:"progress",key:"progress",width:90,render:function(e,t){return(t.success||0)+"/"+(t.total||0)}},{title:"运行结果",dataIndex:"result",key:"result",render:function(e,t){var a=t.success,n=t.fail,i=t.waiting,o=t.doing;return r.a.createElement("div",{className:"run-result"},r.a.createElement("span",null,"成功:",r.a.createElement("span",null,0===a||a?(a+"").length<3?a:r.a.createElement(Y.a,{title:a},(a+"").slice(0,2)+"..."):"-")),r.a.createElement("span",null,"失败:",0===n||n?(n+"").length<3?n:r.a.createElement(Y.a,{title:n},(n+"").slice(0,2)+"..."):"-"),r.a.createElement("span",null,"运行中:",0===o||o?(o+"").length<3?o:r.a.createElement(Y.a,{title:o},(o+"").slice(0,2)+"..."):"-"),r.a.createElement("span",null,"待运行:",0===i||i?(i+"").length<3?i:r.a.createElement(Y.a,{title:i},(i+"").slice(0,2)+"..."):"-"))}},{title:"描述",dataIndex:"jobDesc",key:"jobDesc",width:150,needTooltip:!0},{title:"提交人",dataIndex:"creator",key:"creator"},{title:"计划执行时间",dataIndex:"planTime",width:160,key:"planTime",render:function(e,t){return e?ce()(e).format(de):"-"}},{title:"实际执行时间",dataIndex:"startTime",key:"startTime",width:160,render:function(e,t){return ce()(e).format("x")<ce()(t.planTime).format("x")?"已逾期":315072e5==+ce()(e).format("x")?"-":e?ce()(e).format(de):"-"}},{title:"操作",dataIndex:"options",key:"options",width:150,filterTitle:!0,fixed:"right",render:function(e,t){return r.a.createElement("div",null,2!==t.jobStatus&&5!==t.jobStatus?r.a.createElement("a",{onClick:function(){return c.setViewProgress(t)}},"查看进度"):null,2===t.jobStatus?r.a.createElement("a",{style:{marginRight:"16px"},onClick:function(){return c.setViewProgress(t,t.jobType)}},"编辑任务"):null,2===t.jobStatus?r.a.createElement("a",{onClick:function(){return c.onDelete(t)}},"删除"):null)}}]),dataSource:S,paginationProps:Object.assign({},M),attrs:{onChange:function(e,t,a){pe({pageNo:e.current,pageSize:e.pageSize,filters:t,sorter:a})},scroll:{x:"max-content",y:"calc(100vh - 400px)"},bordered:!1}}})),F&&r.a.createElement(Io,{visible:F,setVisble:B,record:V}),Z&&r.a.createElement(Li,{drawerVisible:Z,jobId:null==V?void 0:V.id,jobStatus:null==V?void 0:V.jobStatus,topics:(null===(i=null==V?void 0:V.target)||void 0===i?void 0:i.split(","))||[],onClose:ge,genData:function(){return pe({pageNo:1,pageSize:M.pageSize})}}),te&&r.a.createElement(Fi,{drawerVisible:te,jobId:null==V?void 0:V.id,jobStatus:null==V?void 0:V.jobStatus,topics:(null===(o=null==V?void 0:V.target)||void 0===o?void 0:o.split(","))||[],onClose:ge,genData:function(){return pe({pageNo:1,pageSize:M.pageSize})}}),oe&&r.a.createElement(Ao,{visible:oe,formData:me,onClose:ge,genData:function(){return pe({pageNo:1,pageSize:M.pageSize})}}))};a(135),a(92),ka.a.TabPane,a(519),oa.a.Option;ja.TESTING_PRODUCER_HEADER;ka.a.TabPane;var Uo,Go,qo,Jo,Wo=r.a.forwardRef((function(e,t){var a=Object(nt.a)(),i=J.a.useForm(),o=l()(i,1)[0],c=Object(s.useParams)().clusterId,u=Object(n.useState)(!1),d=l()(u,2),f=d[0],p=d[1],v=Object(n.useState)({}),g=l()(v,2),h=g[0],b=g[1],E=r.a.useState([]),y=l()(E,2),k=y[0],N=y[1];r.a.useImperativeHandle(t,(function(){return{setVisible:p,getHealthconfig:C}}));var C=function(){return m.a.request(K.getClusterHealthyConfigs(+c)).then((function(e){var t={};e.sort((function(e,t){return e.dimensionCode-t.dimensionCode}));try{e.forEach((function(e){var a=JSON.parse(e.value),n=a.value,r=a.latestMinutes,i=a.detectedTimes,o=a.amount,c=a.ratio;n&&(t["value_".concat(e.configItem)]=n),r&&(t["latestMinutes_".concat(e.configItem)]=r),i&&(t["detectedTimes_".concat(e.configItem)]=i),o&&(t["amount_".concat(e.configItem)]=o),c&&(t["ratio_".concat(e.configItem)]=c)}))}catch(e){O.error({message:"健康项检查规则解析失败"})}var a=Object.assign(Object.assign({},h),t);b(a),o.setFieldsValue(a),N(e)}))},S=function(){o.resetFields(),p(!1)};return r.a.createElement(r.a.Fragment,null,r.a.createElement(ya.a,{className:"drawer-content healthy-drawer-content",onClose:S,maskClosable:!1,extra:r.a.createElement("div",{className:"operate-wrap"},r.a.createElement(Ht.a,{size:"small",style:{marginRight:8},onClick:S},"取消"),r.a.createElement(Ht.a,{size:"small",type:"primary",onClick:function(){o.validateFields().then((function(e){var t=[];k.map((function(a){t.push({clusterId:+c,value:JSON.stringify({clusterPhyId:+c,detectedTimes:e["detectedTimes_".concat(a.configItem)],latestMinutes:e["latestMinutes_".concat(a.configItem)],amount:e["amount_".concat(a.configItem)],ratio:e["ratio_".concat(a.configItem)],value:"Controller"===a.configItem?1:e["value_".concat(a.configItem)]}),valueGroup:a.configGroup,valueName:a.configName})})),m.a.put(K.putPlatformConfigs,t).then((function(e){ie.success("修改成功"),o.resetFields(),p(!1)})).catch((function(e){ie.error("操作失败"+e.message)}))}))}},"确定"),r.a.createElement($.a,{type:"vertical"})),title:a.formatMessage({id:"healthy.setting"}),visible:f,placement:"right",width:1080},r.a.createElement(J.a,{form:o,layout:"vertical",onValuesChange:function(e,t){}},r.a.createElement(In.a,{tableProps:{rowKey:"configItem",showHeader:!1,dataSource:k,columns:sn(o,0,c),noPagination:!0}}))))})),Zo=Object(n.forwardRef)((function(e,t){var a=Object(n.useState)(!1),i=l()(a,2),o=i[0],c=i[1],u=Object(n.useState)(!1),d=l()(u,2),f=d[0],p=d[1],v=Object(n.useState)([]),g=l()(v,2),h=g[0],b=g[1],E=Object(s.useParams)().clusterId;Object(n.useImperativeHandle)(t,(function(){return{setVisible:c,getHealthDetail:y}}));var y=function(){return p(!0),m.a.request(K.getResourceListHealthDetail(+E)).then((function(e){e.sort((function(e,t){return e.dimension-t.dimension})),b(e),p(!1)}))};return Object(n.useEffect)((function(){o&&y()}),[o]),r.a.createElement(ya.a,{className:"drawer-content",onClose:function(){c(!1)},maskClosable:!1,title:"Cluster健康状态详情",visible:o,placement:"right",width:1080},r.a.createElement(Q.a,{spinning:f},r.a.createElement(Wa.a,{dataSource:h,columns:ln(+E),pagination:!1})))})),Yo=function(){var e,t,a,i,o=g.a.useGlobalValue(),c=l()(o,1)[0],u=Object(s.useHistory)(),d=Object(n.useState)({}),f=l()(d,2),p=f[0],v=f[1],b=Object(n.useState)({}),E=l()(b,2),y=E[0],k=E[1],N=r.a.useState(!1),O=l()(N,2),C=O[0],S=O[1],x=Object(n.useState)({}),j=l()(x,2),I=j[0],w=j[1],T=Object(n.useState)({}),P=l()(T,2),L=P[0],M=P[1],z=r.a.createRef(),D=r.a.createRef(),R=Object(s.useParams)().clusterId,F=r.a.useState(!1),B=l()(F,2),H=B[0],A=B[1],_=function(){S(!0),m.a.request(K.getPhyClusterBasic(+R)).then((function(e){var t=null;try{t=JSON.parse(null==e?void 0:e.jmxProperties)}catch(e){console.error(e)}(null==t?void 0:t.openSSL)&&(t.security="Password"),t&&(e=Object.assign({},e||{},t)),k(e),S(!1)})).catch((function(e){S(!1)}))};Object(n.useEffect)((function(){m.a.request(K.getBrokersState(R)).then((function(e){M(e)})),m.a.post(K.getPhyClusterMetrics(+R),["HealthState","HealthScore","HealthCheckPassed","HealthCheckTotal","Topics","PartitionURP","PartitionNoLeader","PartitionMinISR_S","Groups","GroupDeads","Alive"].concat([])).then((function(e){w((null==e?void 0:e.metrics)||{})})),m.a.request(K.supportKafkaVersion).then((function(e){v(e||{})})),_()}),[]);var U=function(e){return r.a.createElement("span",{className:"icon"},r.a.createElement(h.a,{type:"green"===e?"icon-zhengchang":"warning"===e?"icon-yichang":"icon-warning"}))};return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"left-sider"},r.a.createElement("div",{className:"state-card"},r.a.createElement(qe,{state:null==I?void 0:I.HealthState,width:74,height:74}),r.a.createElement("div",{className:"healthy-state"},r.a.createElement("div",{className:"healthy-state-status"},r.a.createElement("span",null,Ue(null==I?void 0:I.HealthState)," 集群",Ge(null==I?void 0:I.HealthState)),c.hasPermission&&c.hasPermission(V.CLUSTER_CHANGE_HEALTHY)?r.a.createElement("span",{className:"icon",onClick:function(){D.current.getHealthconfig().then((function(){D.current.setVisible(!0)}))}},r.a.createElement(h.a,{type:"icon-shezhi",size:13})):r.a.createElement(r.a.Fragment,null)),r.a.createElement("div",null,r.a.createElement("span",{className:"healthy-state-num"},null==I?void 0:I.HealthCheckPassed,"/",null==I?void 0:I.HealthCheckTotal),r.a.createElement("span",{className:"healthy-state-btn",onClick:function(){z.current.setVisible(!0)}},"查看详情")))),r.a.createElement($.a,null),r.a.createElement("div",{className:"title"},r.a.createElement("div",{className:"name"},cn(null==y?void 0:y.name,35)),!C&&c.hasPermission&&c.hasPermission(V.CLUSTER_CHANGE_INFO)?r.a.createElement("div",{className:"edit-icon-box",onClick:function(){return A(!0)}},r.a.createElement(h.a,{className:"edit-icon",type:"icon-bianji2"})):r.a.createElement(r.a.Fragment,null)),r.a.createElement("div",{className:"tag-panel"},r.a.createElement("div",{className:"tag default"},null!==(e=null==y?void 0:y.kafkaVersion)&&void 0!==e?e:"-"),void 0!==(null==I?void 0:I.LoadReBalanceEnable)&&[["BytesIn",1===(null==I?void 0:I.LoadReBalanceNwIn)],["BytesOut",1===(null==I?void 0:I.LoadReBalanceNwOut)],["Disk",1===(null==I?void 0:I.LoadReBalanceDisk)]].map((function(e){var t=l()(e,2),a=t[0];return t[1]?r.a.createElement("div",{className:"tag balanced"},a," 已均衡"):(null==I?void 0:I.LoadReBalanceEnable)?r.a.createElement("div",{className:"tag unbalanced"},a," 未均衡"):r.a.createElement(Y.a,{title:r.a.createElement("span",null,"尚未开启 ",a," 均衡策略，",r.a.createElement(s.Link,{to:"/cluster/".concat(R,"/cluster/balance")},"前往开启"))},r.a.createElement("div",{className:"tag unbalanced"},a," 未均衡"))}))),r.a.createElement("div",{className:"desc"},cn(null==y?void 0:y.description,35)),r.a.createElement("div",{className:"card-panel"},r.a.createElement("div",{className:"card-item",onClick:function(){return u.push("/cluster/".concat(R,"/broker"))}},r.a.createElement("div",{className:"title"},"Brokers总数"),r.a.createElement("div",{className:"count"},r.a.createElement("span",{className:"num"},null!==(t=null==L?void 0:L.brokerCount)&&void 0!==t?t:"-"),r.a.createElement("span",{className:"unit"},"个")),r.a.createElement("div",{className:"metric"},r.a.createElement("span",{className:"type"},"Controller"),U((null==L?void 0:L.kafkaControllerAlive)?"green":"red")),r.a.createElement("div",{className:"metric"},r.a.createElement("span",{className:"type"},"Similar Config"),U((null==L?void 0:L.configSimilar)?"green":"warning"))),r.a.createElement("div",{className:"card-item",onClick:function(){return u.push("/cluster/".concat(R,"/topic"))}},r.a.createElement("div",{className:"title"},"Topics总数"),r.a.createElement("div",{className:"count"},r.a.createElement("span",{className:"num"},null!==(a=null==I?void 0:I.Topics)&&void 0!==a?a:"-"),r.a.createElement("span",{className:"unit"},"个")),r.a.createElement("div",{className:"metric"},r.a.createElement("span",{className:"type"},"No leader"),U(0===(null==I?void 0:I.PartitionNoLeader)?"green":"red")),r.a.createElement("div",{className:"metric"},r.a.createElement("span",{className:"type"},"< Min ISR"),U(0===(null==I?void 0:I.PartitionMinISR_S)?"green":"red")),r.a.createElement("div",{className:"metric"},r.a.createElement("span",{className:"type"},"URP"),U(0===(null==I?void 0:I.PartitionURP)?"green":"red"))),r.a.createElement("div",{className:"card-item",onClick:function(){return u.push("/cluster/".concat(R,"/consumers"))}},r.a.createElement("div",{className:"title"},"ConsumerGroup总数"),r.a.createElement("div",{className:"count"},r.a.createElement("span",{className:"num"},null!==(i=null==I?void 0:I.Groups)&&void 0!==i?i:"-"),r.a.createElement("span",{className:"unit"},"个")),r.a.createElement("div",{className:"metric"},r.a.createElement("span",{className:"type"},"Dead"),U(0===(null==I?void 0:I.GroupDeads)?"green":"red"))))),r.a.createElement(za,{visible:H,setVisible:A,title:"edit.cluster",afterSubmitSuccess:_,clusterInfo:y,kafkaVersion:Object.keys(p)}),r.a.createElement(Wo,{ref:D}),r.a.createElement(Zo,{ref:z}))},Qo=function(e){var t=e.lineColor,a=e.isDefaultMetric;return{option:vt({title:{show:!1},legend:{show:!1},grid:{top:24,bottom:12},tooltip:void 0!==a&&a?{formatter:function(e){var t="";return null!=e&&e.length>0&&(t+=function(e,t){var a,n=t[0],r=n.data[2],i='<div style="margin: 3px 0;">\n    <div style="display:flex;align-items:center;">\n      <div style="margin-right:4px;width:8px;height:2px;background-color:'.concat(n.color,';"></div>\n      <div style="flex:1;display:flex;justify-content:space-between;align-items:center;overflow: hidden;">\n        <span style="flex: 1;font-size:12px;color:#74788D;pointer-events:auto;margin-left:2px;line-height: 18px;font-family: HelveticaNeue;overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">\n          ').concat(n.seriesName,'\n        </span>\n        <span style="font-size:12px;color:#212529;line-height:18px;font-family:HelveticaNeue-Medium;margin-left: 10px;">\n          ').concat(parseFloat(Number(n.value[1]).toFixed(3)),'\n          <span style="font-family: PingFangSC-Regular;color: #495057;">').concat((null===(a=r.MessagesIn)||void 0===a?void 0:a.unit)||"","</span>\n        </span>\n      </div>\n    </div>\n  </div>");return'<div style="margin: 0px 0 0; position: relative; z-index: 99;width: fit-content;">\n    <div style="padding: 8px 0;height: 100%;">\n      <div style="font-size:12px;padding: 0 12px;color:#212529;line-height:20px;font-family: HelveticaNeue;">\n        '.concat(e,'\n      </div>\n      <div style="margin: 4px 0 0 0;padding: 0 12px;">\n        ').concat(i,'\n       <div style="width: 100%; height: 1px; background: #EFF2F7;margin: 8px 0;"></div>\n        ').concat(r.map((function(e){var t=e.key,a=e.value,n=e.unit;return"MessagesIn"===t?"":'\n            <div style="display: flex; justify-content: space-between; align-items: center;">\n              <span style="font-size:12px;color:#74788D;pointer-events:auto;margin-left:2px;line-height: 18px;font-family: HelveticaNeue;margin-right: 10px;">\n                '.concat(t,'\n              </span>\n              <span style="font-size:12px;color:#212529;pointer-events:auto;margin-left:2px;line-height: 18px;font-family: HelveticaNeue;">\n                ').concat(parseFloat(Number(a).toFixed(3)),'\n                <span style="font-family: PingFangSC-Regular;color: #495057;">').concat(n,"</span>\n              </span>\n            </div>\n          ")})).join(""),"\n      </div>\n    </div>\n  </div>")}(ce()(Number(e[0].axisValue)).format("YYYY-MM-DD HH:mm"),e)),t}}:{}}),seriesCallback:function(e){return e.map((function(e){return Object.assign(Object.assign({},e),{lineStyle:{width:1},smooth:.25,symbol:"emptyCircle",symbolSize:4,color:"#556ee6",areaStyle:{color:t,opacity:.06}})}))}}},$o=new(0,m.a.EventBus),Xo=["#556EE6","#3991FF"],ec=function(e){return Xo[(e/2|0)%2^e%2]},tc=["MessagesIn","TotalLogSize","TotalProduceRequests","Topics","Partitions"],ac=function(e){var t=g.a.useGlobalValue(),a=l()(t,1)[0],i=Object(s.useParams)().clusterId,o=Object(n.useState)([]),c=l()(o,2),u=c[0],d=c[1],f=Object(n.useState)([]),p=l()(f,2),v=p[0],h=p[1],b=Object(n.useState)({name:"MessagesIn",unit:"",data:void 0}),E=l()(b,2),y=E[0],k=E[1],N=Object(n.useState)(),O=l()(N,2),C=O[0],S=O[1],x=Object(n.useState)(!0),I=l()(x,2),w=I[0],T=I[1],P=Object(n.useState)(!0),L=l()(P,2),M=L[0],z=L[1],D=Object(n.useRef)([]),R=Object(n.useRef)({messagesIn:0,other:0}),F=Object(n.useRef)(null),B=function(){if(null==u?void 0:u.length){!C.isAutoReload&&z(!0);var e=l()(C.rangeTime,2),t=e[0],n=e[1],r=Date.now();R.current=Object.assign(Object.assign({},R.current),{messagesIn:r}),m.a.request(K.getClusterMetricDataList(),{method:"POST",data:{startTime:t,endTime:n,clusterPhyIds:[i],metricsNames:u.filter((function(e){return"MessagesIn"!==e}))}}).then((function(e){if(R.current.messagesIn===r){var t=ft(e,a.getMetricDefine||{},j.Cluster,C.rangeTime);t.forEach((function(e){return e.metricLines[0].name=e.metricName})),t.sort((function(e,t){return D.current.indexOf(e.metricName)-D.current.indexOf(t.metricName)})),h(t),z(!1)}}),(function(){return z(!1)}))}};return Object(n.useEffect)((function(){B()}),[u]),Object(n.useEffect)((function(){C&&"0,0"!==(null==C?void 0:C.rangeTime.join(","))&&(!function(){!C.isAutoReload&&T(!0);var e=Date.now();R.current=Object.assign(Object.assign({},R.current),{other:e}),m.a.request(K.getClusterDefaultMetricData(),{method:"POST",data:{startTime:C.rangeTime[0],endTime:C.rangeTime[1],clusterPhyIds:[i],metricsNames:tc}}).then((function(t){var n;if(R.current.other===e){var r=-1,i=t.map((function(e){var t=e.timeStamp,n=e.values,i=Number(n.MessagesIn);return Number.isNaN(i)?i=n.MessagesIn:(i=parseFloat(i.toFixed(3)),r<i&&(r=i)),[t,i||"0",Object.entries(n).map((function(e){var t,n=l()(e,2),r=n[0],i=n[1],o=Number(i),c=a.getMetricDefine&&(null===(t=a.getMetricDefine(j.Cluster,r))||void 0===t?void 0:t.unit)||"";if(c.toLowerCase().includes("byte")){var s=ut.Memory(Number(i)),u=l()(s,2),m=u[0],d=u[1];c=c.toLowerCase().replace("byte",m),o/=d}return{key:r,value:o,unit:c}}))]}));i.sort((function(e,t){return e[0]-t[0]}));var o={name:"MessagesIn",unit:null===(n=a.getMetricDefine(j.Cluster,"MessagesIn"))||void 0===n?void 0:n.unit,data:i};if(r>0){var c=ut.Num(r),s=l()(c,2),u=s[0],m=s[1];o.unit="".concat(u).concat(o.unit),i.forEach((function(e){return parseFloat((e[1]/=m).toFixed(3))}))}if(i.length){var d=i[0][2].map((function(e){return Object.assign(Object.assign({},e),{value:0})}));dt([o],C.rangeTime,(function(e){return e.push(d),e}))}k(o),T(!1)}}),(function(){return T(!1)}))}(),B())}),[C]),Object(n.useEffect)((function(){setTimeout((function(){var e;(e=document.getElementsByClassName("dcd-two-columns-layout-sider-footer")[0])&&e.addEventListener("click",(function(){return $o.emit("chartResize")}))}))}),[]),r.a.createElement("div",{className:"chart-panel cluster-detail-container"},r.a.createElement(Nn,{openMetricFilter:function(){var e;return null===(e=F.current)||void 0===e?void 0:e.open()},onChange:function(e){e.isRelativeRangeTime&&(e.rangeTime=e.rangeTime.map((function(e){return e-6e4}))),S({isRelativeRangeTime:e.isRelativeRangeTime,isAutoReload:e.isAutoReload,rangeTime:e.rangeTime})},hideNodeScope:!0,hideGridSelect:!0}),r.a.createElement(Mn,{ref:F,metricType:j.Cluster,onSelectChange:function(e,t){D.current=t,d(e)}}),r.a.createElement("div",{className:"cluster-detail-container-main"},r.a.createElement("div",{className:"header-chart-container"},r.a.createElement(Q.a,{spinning:w},y.data&&r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"cluster-detail-chart-box-title"},r.a.createElement(Y.a,{placement:"topLeft",title:function(){var e="",t=a.getMetricDefine(j.Cluster,y.name);return t&&(e=t.desc),e}},r.a.createElement("span",null,r.a.createElement("span",{className:"name"},y.name),r.a.createElement("span",{className:"unit"},"（",y.unit,"）")))),y.data.length?r.a.createElement(gt.a,Object.assign({chartKey:"messagesIn",chartTypeProp:"line",showHeader:!1,wrapStyle:{width:"auto",height:210},connectEventName:"clusterChart",eventBus:$o,propChartData:[y]},Qo({lineColor:Xo[0],isDefaultMetric:!0}))):!w&&r.a.createElement(Sn,{message:"暂无数据",height:200})))),r.a.createElement("div",{className:"content"},r.a.createElement("div",{className:"multiple-chart-container"},r.a.createElement("div",{className:v.length?"":"multiple-chart-container-loading"},r.a.createElement(Q.a,{spinning:M},v.length?r.a.createElement("div",{className:"no-group-con"},r.a.createElement(Bn,{sortableContainerProps:{onSortStart:function(){$o.emit("onDrag",!0)},onSortEnd:function(e){var t,a=e.oldIndex,n=e.newIndex;$o.emit("onDrag",!1);var r=D.current.indexOf(v[a].metricName),i=D.current.indexOf(v[n].metricName),o=Object(wn.a)(D.current,r,i);D.current=o,null===(t=F.current)||void 0===t||t.rankChange(r,i),h(Object(wn.a)(v,a,n))},axis:"xy",useDragHandle:!0},gridProps:{span:12,gutter:[16,16]}},v.map((function(e,t){var n=e.metricName,i=e.metricUnit,o=e.metricLines;return r.a.createElement("div",{key:n,className:"cluster-detail-chart-box"},r.a.createElement("div",{className:"cluster-detail-chart-box-title"},r.a.createElement(Y.a,{placement:"topLeft",title:function(){var e="",t=a.getMetricDefine(j.Cluster,n);return t&&(e=t.desc),e}},r.a.createElement("span",null,r.a.createElement("span",{className:"name"},n),r.a.createElement("span",{className:"unit"},"（",i,"）")))),r.a.createElement(gt.a,Object.assign({chartKey:n,showHeader:!1,chartTypeProp:"line",wrapStyle:{width:"auto",height:210},connectEventName:"clusterChart",eventBus:$o,propChartData:o},Qo({metricName:"".concat(n,"{unit|（").concat(i,"）}"),lineColor:ec(t)}))))})))):M?r.a.createElement(r.a.Fragment,null):r.a.createElement(Sn,{message:"请先选择指标或刷新"})))),r.a.createElement("div",{className:"config-change-records-container"},e.children))))},nc=ha.a.Panel,rc=function(){var e=Object(s.useParams)().clusterId,t=n.useState([]),a=l()(t,2),r=a[0],i=a[1],o=n.useState(!0),c=l()(o,2),u=c[0],d=c[1],f=n.useState({pageNo:0,pageSize:10,total:0}),p=l()(f,2),v=p[0],g=p[1],h=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,a=m.a.request(K.getClusterChangeLog(+e),{params:{pageNo:v.pageNo+1,pageSize:t}});return a.then((function(e){i((function(t){return t.concat(null==e?void 0:e.bizData)})),g(null==e?void 0:e.pagination)})),a};n.useEffect((function(){h(20).then((function(){return d(!1)}),(function(){return d(!1)}))}),[]);var b=function(t){return t.resTypeName.toLowerCase().includes("topic")?"/cluster/".concat(e,"/topic/list#topicName=").concat(t.resName):t.resTypeName.toLowerCase().includes("broker")?"/cluster/".concat(e,"/broker/list#brokerId=").concat(t.resName):""};return n.createElement(n.Fragment,null,n.createElement("div",{className:"change-log-panel"},n.createElement("div",{className:"title"},"历史变更记录"),u||r.length?n.createElement("div",{id:"changelog-scroll-box"},n.createElement(Q.a,{spinning:u,style:{paddingLeft:"42%",marginTop:100}}),n.createElement(le.a,{dataLength:r.length,next:h,hasMore:r.length<v.total,loader:n.createElement(Q.a,{style:{paddingLeft:"42%",paddingTop:10},spinning:!0}),endMessage:v.total?n.createElement($.a,{className:"load-completed-tip",plain:!0},"加载完成 共 ",v.total," 条"):"",scrollableTarget:"changelog-scroll-box"},n.createElement(ha.a,{defaultActiveKey:["log-0"],accordion:!0},r.map((function(e,t){return n.createElement(nc,{header:n.createElement(n.Fragment,null,n.createElement("div",{className:"header"},n.createElement("div",{className:"label"},cn("[".concat(e.resTypeName,"] ").concat(e.resName),24)),n.createElement("span",{className:"icon"},n.createElement(Za.a,null))),n.createElement("div",{className:"header-time"},ce()(e.updateTime).format(de))),key:"log-".concat(t),showArrow:!1},n.createElement("div",{className:"log-item"},n.createElement("span",null,"名称"),n.createElement("div",{className:"value"},b(e)?n.createElement(s.Link,{to:b(e)},cn(e.resName,18)):cn(e.resName,18))),n.createElement($.a,null),n.createElement("div",{className:"log-item"},n.createElement("span",null,"时间"),n.createElement("span",{className:"value"},ce()(e.updateTime).format(de))),n.createElement($.a,null),n.createElement("div",{className:"log-item"},n.createElement("span",null,"内容"),n.createElement("span",{className:"value"},"修改配置")),n.createElement($.a,null),n.createElement("div",{className:"log-item"},n.createElement("span",null,"类型"),n.createElement("span",{className:"value"},e.resTypeName)))}))))):n.createElement(Sn,{message:"暂无配置记录"})))},ic=function(){return r.a.createElement(r.a.Fragment,null,r.a.createElement(pa,{guide:ma,run:!0}),r.a.createElement("div",{className:"single-cluster-detail"},r.a.createElement("div",{className:"breadcrumb"},r.a.createElement(Gn.a,{breadcrumbs:[{label:"多集群管理",aHref:"/"},{label:"集群详情",aHref:""}]})),r.a.createElement("div",{className:"cluster-detail"},r.a.createElement(Yo,null),r.a.createElement(ac,null,r.a.createElement(rc,null)))))},oc=function(){var e=Object(s.useParams)().clusterId,t=Object(n.useState)(!1),a=l()(t,2),i=a[0],o=a[1],c=Object(n.useState)([]),u=l()(c,2),d=u[0],f=u[1],p=["AclEnable","Acls","AclUsers","AclTopics","AclGroups"];return Object(n.useEffect)((function(){o(!0),m.a.request(K.getMetricPointsLatest(Number(e)),{method:"POST",data:p}).then((function(e){var t=e.metrics,a=t.AclEnable,n=t.Acls,i=t.AclUsers,c=t.AclTopics,l=t.AclGroups;f([{title:"Enable",value:function(){return r.a.createElement("span",{style:{fontFamily:"HelveticaNeue",fontSize:35,color:a?"#00C0A2":"#F58342"}},a?"Yes":"No")},customStyle:{marginLeft:0}},{title:"ACLs",value:n},{title:"Users",value:i},{title:"Topics",value:c},{title:"Consumer Groups",value:l}]),o(!1)}))}),[e]),r.a.createElement(fn,{scene:"broker",cardColumns:d,loading:i})},cc=a(929);!function(e){e[e.Unknown=0]="Unknown",e[e.Any=1]="Any",e[e.All=2]="All",e[e.Read=3]="Read",e[e.Write=4]="Write",e[e.Create=5]="Create",e[e.Delete=6]="Delete",e[e.Alter=7]="Alter",e[e.Describe=8]="Describe",e[e.ClusterAction=9]="ClusterAction",e[e.DescribeConfigs=10]="DescribeConfigs",e[e.AlterConfigs=11]="AlterConfigs",e[e.IdempotentWrite=12]="IdempotentWrite"}(Uo||(Uo={})),function(e){e[e.Unknown=0]="Unknown",e[e.Any=1]="Any",e[e.Deny=2]="Deny",e[e.Allow=3]="Allow"}(Go||(Go={})),function(e){e[e.Unknown=0]="Unknown",e[e.Any=1]="Any",e[e.Match=2]="Match",e[e.Literal=3]="Literal",e[e.Prefixed=4]="Prefixed"}(qo||(qo={})),function(e){e[e.Unknown=0]="Unknown",e[e.Any=1]="Any",e[e.Topic=2]="Topic",e[e.Group=3]="Group",e[e.Cluster=4]="Cluster",e[e.TransactionalId=5]="TransactionalId",e[e.DelegationToken=6]="DelegationToken"}(Jo||(Jo={}));var lc,sc={Cluster:["Alter","AlterConfigs","ClusterAction","Create","Describe","DescribeConfigs","IdempotentWrite"],Topic:["Alter","AlterConfigs","Create","Delete","Describe","DescribeConfigs","Read","Write"],Group:["Delete","Describe","Read"],TransactionalId:["Write","Describe"]},uc=[{label:"配置生产权限",value:"produce"},{label:"配置消费权限",value:"consume"},{label:"配置自定义权限",value:"custom"}],mc=Object(n.forwardRef)((function(e,t){var a=Object(s.useParams)().clusterId,i=J.a.useForm(),o=l()(i,1)[0],c=Object(n.useState)(!1),u=l()(c,2),d=u[0],f=u[1],p=Object(n.useState)([]),v=l()(p,2),g=v[0],h=v[1],b=Object(n.useState)(!1),E=l()(b,2),y=E[0],k=E[1],N=Object(n.useRef)((function(){})),O=r.a.useState([]),C=l()(O,2),S=C[0],x=C[1],j=r.a.useState([]),I=l()(j,2),w=I[0],T=I[1],P=function(e,t){f(e),N.current=t},L=function(){f(!1),k(!1),o.resetFields()};return Object(n.useImperativeHandle)(t,(function(){return{onOpen:P}})),Object(n.useEffect)((function(){var e;m.a.request(K.getKafkaUsers(a),{method:"GET"}).then((function(e){h(e.map((function(e){var t=e.name;return{label:t,value:t}})))})),e="",m.a.request(K.getTopicMetaData(+a),{method:"GET",params:{searchKeyword:e}}).then((function(e){var t=(e||[]).map((function(e){return{label:e.topicName,value:e.topicName}}));x(t)})),m.a.request(K.getGroupOverview(+a),{method:"GET"}).then((function(e){var t=null==e?void 0:e.bizData.map((function(e){return{label:e.name,value:e.name}}));T(t)}))}),[]),r.a.createElement(ya.a,{className:"acls-edit-drawer",title:"新增ACL",width:480,visible:d,maskClosable:!1,onClose:L,extra:r.a.createElement(la.b,null,r.a.createElement(Ht.a,{size:"small",onClick:L},"取消"),r.a.createElement(Ht.a,{type:"primary",size:"small",loading:y,onClick:function(){o.validateFields().then((function(e){var t=[],n=e.configType,r=e.principle,i=e.kafkaUser;if("custom"===n){var o=e.resourceType,c=e.resourcePatternType,l=e.aclPermissionType,s=e.aclOperation,u=e.aclClientHost;t.push({clusterId:a,kafkaUser:"all"===r?"*":i,resourceType:o,resourcePatternType:c,resourceName:"*",aclPermissionType:l,aclOperation:s,aclClientHost:u})}else{var d=e.topicPatternType,f=e.topicPrinciple,p=e.topicName;if(t.push({clusterId:a,kafkaUser:"all"===r?"*":i,resourceType:Jo.Topic,resourcePatternType:d,resourceName:"all"===f?"*":p,aclPermissionType:Go.Allow,aclOperation:"consume"===n?Uo.Read:Uo.Create,aclClientHost:"*"}),"consume"===n){var v=e.groupPatternType,g=e.groupPrinciple,h=e.groupName;t.push({clusterId:a,kafkaUser:"all"===r?"*":i,resourceType:Jo.Group,resourcePatternType:v,resourceName:"all"===g?"*":h,aclPermissionType:Go.Allow,aclOperation:Uo.Read,aclClientHost:"*"})}else t.push({clusterId:a,kafkaUser:"all"===r?"*":i,resourceType:Jo.Topic,resourcePatternType:d,resourceName:"all"===f?"*":p,aclPermissionType:Go.Allow,aclOperation:Uo.Write,aclClientHost:"*"})}k(!0),m.a.request(K.addACL,{method:"POST",data:t}).then((function(){N.current(),L(),ie.success("成功新增 ACL")}),(function(){return k(!1)}))}))}},"确定"),r.a.createElement($.a,{type:"vertical"}))},r.a.createElement(gr.a,{className:"drawer-alert-full-screen",message:"新增 ACL 必须在集群已开启 ACL 功能时才会生效",type:"info",showIcon:!0,style:{marginBottom:20}}),r.a.createElement(J.a,{form:o,layout:"vertical"},r.a.createElement(J.a.Item,{label:"ACL用途",name:"configType",rules:[{required:!0,message:"ACL用途不能为空"}],initialValue:uc[0].value},r.a.createElement(oa.a,{options:uc})),r.a.createElement(J.a.Item,{label:"Principle",name:"principle",rules:[{required:!0,message:"Principle 不能为空"}],initialValue:"all"},r.a.createElement(ba.a.Group,null,r.a.createElement(ba.a,{value:"all"},"ALL"),r.a.createElement(ba.a,{value:"special"},"Special"))),r.a.createElement(J.a.Item,{dependencies:["principle"],style:{marginBottom:0}},(function(e){return"special"===(0,e.getFieldValue)("principle")?r.a.createElement(J.a.Item,{name:"kafkaUser",rules:[{required:!0,message:"Kafka User 不能为空"}]},r.a.createElement(oa.a,{placeholder:"请选择 Kafka User",options:g})):null})),r.a.createElement(J.a.Item,{dependencies:["configType"],style:{marginBottom:0}},(function(e){var t=function(e){var t=e.type,n=t[0].toUpperCase()+t.slice(1);return r.a.createElement("div",{className:"form-item-group"},r.a.createElement(J.a.Item,{label:"".concat(n," Pattern Type"),name:"".concat(t,"PatternType"),rules:[{required:!0,message:"".concat(n," Pattern Type 不能为空")}],initialValue:qo.Literal},r.a.createElement(ba.a.Group,null,r.a.createElement(ba.a,{value:qo.Literal},"Literal"),r.a.createElement(ba.a,{value:qo.Prefixed},"Prefixed"))),r.a.createElement(J.a.Item,{label:n,name:"".concat(t,"Principle"),rules:[{required:!0,message:"".concat(n," 不能为空")}],initialValue:"all"},r.a.createElement(ba.a.Group,null,r.a.createElement(ba.a,{value:"all"},"ALL"),r.a.createElement(ba.a,{value:"special"},"Special"))),r.a.createElement(J.a.Item,{dependencies:["".concat(t,"Principle")],style:{marginBottom:0}},(function(e){return"special"===(0,e.getFieldValue)("".concat(t,"Principle"))?r.a.createElement(J.a.Item,{name:"".concat(t,"Name"),dependencies:["".concat(t,"PatternType")],validateTrigger:"onBlur",rules:[function(e){var r=e.getFieldValue;return{validator:function(e,i){return i?"topic"===t&&r("".concat(t,"PatternType"))===qo.Literal?m.a.request(K.getTopicMetadata(a,i)).then((function(e){return(null==e?void 0:e.exist)?Promise.resolve():Promise.reject("该 Topic 不存在")})):Promise.resolve():Promise.reject("".concat(n,"Name 不能为空"))}}}]},r.a.createElement(cc.a,{filterOption:function(e,t){return!!(null==t?void 0:t.value.includes(e))},options:"topic"===t?S:w,placeholder:"请输入 ".concat(t,"Name")})):null})))},n=function(){return r.a.createElement(r.a.Fragment,null,r.a.createElement(J.a.Item,{label:"Permission Type",name:"aclPermissionType",rules:[{required:!0,message:"Permission Type 不能为空"}],initialValue:Go.Allow},r.a.createElement(ba.a.Group,null,r.a.createElement(ba.a,{value:Go.Allow},"Allow"),r.a.createElement(ba.a,{value:Go.Deny},"Deny"))),r.a.createElement(J.a.Item,{label:"Pattern Type",name:"resourcePatternType",rules:[{required:!0,message:"Pattern Type 不能为空"}],initialValue:qo.Literal},r.a.createElement(ba.a.Group,null,r.a.createElement(ba.a,{value:qo.Literal},"Literal"),r.a.createElement(ba.a,{value:qo.Prefixed},"Prefixed"))),r.a.createElement(J.a.Item,{label:"Resource Type",name:"resourceType",rules:[{required:!0,message:"Resource Type 不能为空"}],initialValue:Jo.Cluster},r.a.createElement(oa.a,{placeholder:"请选择 Resource Type",options:Object.keys(sc).map((function(e){return{label:e,value:Jo[e]}}))})),r.a.createElement(J.a.Item,{dependencies:["resourceType"],style:{marginBottom:0}},(function(e){var t=e.getFieldValue;return o.resetFields(["aclOperation"]),r.a.createElement(J.a.Item,{label:"Operation",name:"aclOperation",rules:[{required:!0,message:"Operation 不能为空"}]},r.a.createElement(oa.a,{placeholder:"请选择 Resource Type",options:sc[Jo[t("resourceType")]].map((function(e){return{label:e,value:Uo[e]}}))}))})),r.a.createElement(J.a.Item,{label:"Host",name:"aclClientHost",initialValue:"*"},r.a.createElement(W.a,null)))},i=(0,e.getFieldValue)("configType");return"produce"===i?r.a.createElement(t,{type:"topic"}):"consume"===i?r.a.createElement(r.a.Fragment,null,r.a.createElement(t,{type:"topic"}),r.a.createElement(t,{type:"group"})):"custom"===i?r.a.createElement(n,null):null}))))})),dc=d.a.confirm,fc={current:1,pageSize:10,position:"bottomRight",showSizeChanger:!0,pageSizeOptions:["10","20","50","100"]},pc=function(){var e,t,a=g.a.useGlobalValue(),i=l()(a,1)[0],o=Object(s.useParams)().clusterId,c=Object(n.useState)(!0),u=l()(c,2),d=u[0],f=u[1],p=Object(n.useState)([]),v=l()(p,2),b=v[0],E=v[1],y=Object(n.useState)(fc),k=l()(y,2),N=k[0],O=k[1],C=J.a.useForm(),S=l()(C,1)[0],x=Object(n.useRef)(null),j=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=S.getFieldsValue(),n={fuzzySearchDTOList:[],preciseFilterDTOList:[]};Object.entries(a).filter((function(e){return e[1]})).forEach((function(e){var t=l()(e,2),a=t[0],r=t[1];"resourceType"===a?n.preciseFilterDTOList.push({fieldName:a,fieldValueList:r.map((function(e){return Jo[e]}))}):n.fuzzySearchDTOList.push({fieldName:a,fieldValue:r})}));var r=Object.assign(Object.assign({pageNo:N.current,pageSize:N.pageSize},n),t);f(!0),m.a.request(K.getACLs(o),{method:"POST",data:r}).then((function(t){var a=t.pagination,n=a.pageNo,r=a.pageSize,i=a.total,o=Math.ceil(i/r);return n>o&&0!==o?(e({pageNo:o}),!1):(O(Object.assign(Object.assign({},N),{current:n,pageSize:r,total:i})),E(t.bizData),f(!1),!0)}),(function(){return f(!1)}))},I=function(e){dc({title:"确定删除 ACL 吗?",okText:"删除",okType:"primary",centered:!0,okButtonProps:{size:"small",danger:!0},cancelButtonProps:{size:"small"},onOk:function(){return m.a.request(K.delACLs,{method:"DELETE",data:Object.assign(Object.assign({},e),{clusterId:Number(o)})}).then((function(e){ie.success("删除成功"),j()}))}})};return Object(n.useEffect)((function(){j()}),[]),r.a.createElement("div",{className:"security-acls-page"},r.a.createElement(Gn.a,{breadcrumbs:[{label:"多集群管理",aHref:"/"},{label:null===(e=null==i?void 0:i.clusterInfo)||void 0===e?void 0:e.name,aHref:"/cluster/".concat(null===(t=null==i?void 0:i.clusterInfo)||void 0===t?void 0:t.id)},{label:"ACLs",aHref:""}]}),r.a.createElement("div",{className:"card-bar"},r.a.createElement(oc,null)),r.a.createElement("div",{className:"security-acls-page-list custom-table-content"},r.a.createElement("div",{className:ke},r.a.createElement("div",{className:"".concat(ke,"-left")},r.a.createElement("div",{className:"".concat(ke,"-left-refresh"),onClick:function(){return j()}},r.a.createElement(h.a,{className:"".concat(ke,"-left-refresh-icon"),type:"icon-shuaxin1"})),r.a.createElement($.a,{type:"vertical",className:"".concat(ke,"-divider")}),r.a.createElement(J.a,{form:S,layout:"inline",onFinish:function(){return j({page:1})}},r.a.createElement(J.a.Item,{name:"kafkaUser"},r.a.createElement(W.a,{placeholder:"请输入 Principal"})),r.a.createElement(J.a.Item,{name:"resourceType"},r.a.createElement(oa.a,{placeholder:"选择 ResourceType",options:Object.keys(sc).map((function(e){return{label:e,value:e}})),mode:"multiple",maxTagCount:"responsive",allowClear:!0,style:{width:200}})),r.a.createElement(J.a.Item,{name:"resourceName"},r.a.createElement(W.a,{placeholder:"请输入 Resource"})),r.a.createElement(J.a.Item,null,r.a.createElement(Ht.a,{type:"primary",ghost:!0,htmlType:"submit"},"查询")))),r.a.createElement("div",{className:"".concat(ke,"-right")},r.a.createElement(Ht.a,{type:"primary",onClick:function(){return x.current.onOpen(!0,j)}},"新增ACL"))),r.a.createElement(In.a,{tableProps:{showHeader:!1,loading:d,rowKey:"id",dataSource:b,paginationProps:N,columns:[{title:"Principal",dataIndex:"kafkaUser"},{title:"Permission",dataIndex:"aclPermissionType",render:function(e){return Go[e]}},{title:"Pattern Type",dataIndex:"resourcePatternType",width:180,render:function(e){return qo[e]}},{title:"Operations",dataIndex:"aclOperation",render:function(e){return Uo[e]}},{title:"Resource",dataIndex:"resourceType",render:function(e,t){return"".concat(Jo[e]," ").concat(t.resourceName)}},{title:"Host",dataIndex:"aclClientHost"},{title:"操作",dataIndex:"",width:120,render:function(e){return r.a.createElement(r.a.Fragment,null,r.a.createElement(Ht.a,{type:"link",size:"small",style:{paddingLeft:0},onClick:function(){return I(e)}},"删除"))}}],lineFillColor:!0,attrs:{onChange:function(e){j({pageNo:e.current,pageSize:e.pageSize})},scroll:{y:"calc(100vh - 400px)"}}}})),r.a.createElement(mc,{ref:x}))},vc=a(81),gc=a(510),hc=a(321),bc=d.a.confirm;!function(e){e[e.Add=0]="Add",e[e.ChangePassword=1]="ChangePassword"}(lc||(lc={}));var Ec,yc={current:1,pageSize:10,position:"bottomRight",showSizeChanger:!0,pageSizeOptions:["10","20","50","100"]},kc=[{label:"SCRAM",value:1300},{label:"GSSAPI",value:"gssapi",disabled:!0},{label:"PLAIN",value:"plain",disabled:!0},{label:"OAUTHBEARER",value:"oauthbearer",disabled:!0}],Nc=function(e){var t=e.clusterId,a=e.name,i=Object(n.useState)(!1),o=l()(i,2),c=o[0],s=o[1],u=Object(n.useState)("********"),d=l()(u,2),f=d[0],p=d[1];return r.a.createElement("div",{style:{display:"flex",alignItems:"center"}},r.a.createElement(Y.a,{title:f,placement:"bottom"},r.a.createElement("div",{style:{maxWidth:"80%",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}},f)),r.a.createElement("span",{style:{marginLeft:6},onClick:function(){c||(s(!0),"********"===f?m.a.request(K.getKafkaUserToken(t,a)).then((function(e){var t=e.token||"";(null==e?void 0:e.decrypt)&&(t=m.a.decryptAES(t,"KnowStreamingKM$")),p(t),s(!1)}),(function(){return s(!1)})):(p("********"),s(!1)))}},c?r.a.createElement(vc.a,null):"********"===f?r.a.createElement(gc.a,null):r.a.createElement(hc.a,null)))},Oc=Object(n.forwardRef)((function(e,t){var a=Object(s.useParams)().clusterId,i=Object(n.useState)(lc.Add),o=l()(i,2),c=o[0],u=o[1],d=J.a.useForm(),f=l()(d,1)[0],p=Object(n.useState)(!1),v=l()(p,2),g=v[0],b=v[1],E=Object(n.useState)(!1),y=l()(E,2),k=y[0],N=y[1],O=Object(n.useRef)((function(){})),C=function(e,t,a,n){n&&f.setFieldsValue({kafkaUser:n.name}),u(t),b(e),O.current=a},S=function(){b(!1),N(!1),f.resetFields()};return Object(n.useImperativeHandle)(t,(function(){return{onOpen:C}})),r.a.createElement(ya.a,{className:"users-edit-drawer",title:c===lc.Add?"新增 KafkaUser":"修改密码",width:480,visible:g,maskClosable:!1,onClose:S,extra:r.a.createElement(la.b,null,r.a.createElement(Ht.a,{size:"small",onClick:S},"取消"),r.a.createElement(Ht.a,{type:"primary",size:"small",loading:k,onClick:function(){f.validateFields().then((function(e){e.token=m.a.encryptAES(e.token,"KnowStreamingKM$"),e.authType=1300,N(!0),m.a.request(c===lc.Add?K.kafkaUser:K.updateKafkaUserToken,{method:c===lc.Add?"POST":"PUT",data:Object.assign(e,{clusterId:Number(a)})}).then((function(){O.current(),S(),ie.success(c===lc.Add?"成功新增 KafkaUser":"成功修改密码")}),(function(){return N(!1)}))}))}},"确定"),r.a.createElement($.a,{type:"vertical"}))},c===lc.Add&&r.a.createElement(gr.a,{className:"drawer-alert-full-screen",message:"新增 KafkaUser 必须在集群已开启 ACL 功能时才会生效",type:"info",showIcon:!0,style:{marginBottom:20}}),r.a.createElement(J.a,{form:f,layout:"vertical"},r.a.createElement(J.a.Item,{label:"KafkaUser",name:"kafkaUser",rules:[{required:!0,message:"KafkaUser 不能为空"},{pattern:/^[a-zA-Z0-9]{3,128}$/,message:"KafkaUser 支持大小写英文、数字，长度为 3~128 字符"}]},r.a.createElement(W.a,{placeholder:"请输入 KakfaUser",disabled:c===lc.ChangePassword})),c===lc.Add&&r.a.createElement(J.a.Item,{label:"认证方式",name:"authType",rules:[{required:!0,message:"认证方式不能为空"}],initialValue:[kc[0].value]},r.a.createElement(ia.a.Group,null,kc.map((function(e){return e.disabled?r.a.createElement(Y.a,{title:"当前版本暂不支持"},r.a.createElement(ia.a,{value:e.value,disabled:!0},e.label)):r.a.createElement(ia.a,{value:e.value},e.label)})))),r.a.createElement(J.a.Item,{label:r.a.createElement("div",{className:"complex-label"},r.a.createElement("span",null,c===lc.ChangePassword&&"New"," Password"),r.a.createElement("span",null,r.a.createElement(Y.a,{title:"生成随机内容",placement:"left"},r.a.createElement(h.a,{type:"icon-shengchengdaima",className:"random-icon",onClick:function(){var e=function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:32,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"abcdefghijklmnopqrstuvwxyz1234567890",a=t.length,n="",r=0;r<e;r++)n+=t.charAt(Math.floor(Math.random()*a));return n}(12,"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz1234567890_-!\"#$%&'()*+,./:;<=>?@[]^`{|}~");f&&f.setFieldsValue({token:e})}})))),name:"token",rules:[{required:!0,message:"Password 不能为空"},{pattern:Sa,message:"密码支持中英文、数字、特殊字符 ! \" # $ % & ' ( ) * + , - . / : ; < = > ? @ [  ] ^ _ ` { | } ~"}]},r.a.createElement(W.a.Password,{placeholder:"请输入密码",maxLength:128}))))})),Cc=function(){var e,t,a=g.a.useGlobalValue(),i=l()(a,1)[0],o=Object(s.useParams)().clusterId,c=Object(n.useState)(!0),u=l()(c,2),d=u[0],f=u[1],p=Object(n.useState)([]),v=l()(p,2),b=v[0],E=v[1],y=Object(n.useState)(yc),k=l()(y,2),N=k[0],O=k[1],C=Object(n.useState)(""),S=l()(C,2),x=S[0],j=S[1],I=Object(n.useState)(""),w=l()(I,2),T=w[0],P=w[1],L=Object(n.useRef)(null),M=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=Object.assign({pageNo:N.current,pageSize:N.pageSize,searchKeywords:x},t);f(!0),m.a.request(K.getKafkaUsers(o),{method:"POST",data:a}).then((function(t){var a=t.pagination,n=a.pageNo,r=a.pageSize,i=a.total,o=Math.ceil(i/r);return n>o&&0!==o?(e({pageNo:o}),!1):(O(Object.assign(Object.assign({},N),{current:n,pageSize:r,total:i})),E(t.bizData),f(!1),!0)}),(function(){return f(!1)}))},z=function(e){bc({title:"确定删除该 KafkaUser 吗?",okText:"删除",okType:"primary",centered:!0,okButtonProps:{size:"small",danger:!0},cancelButtonProps:{size:"small"},maskClosable:!1,onOk:function(){return m.a.request(K.kafkaUser,{method:"DELETE",data:{clusterId:o,kafkaUser:e.name}}).then((function(e){ie.success("删除成功"),M()}))}})};return Object(n.useEffect)((function(){M()}),[]),Object(n.useEffect)((function(){(x||""===x)&&M({pageNo:1})}),[x]),r.a.createElement("div",{className:"security-users-page"},r.a.createElement(Gn.a,{breadcrumbs:[{label:"多集群管理",aHref:"/"},{label:null===(e=null==i?void 0:i.clusterInfo)||void 0===e?void 0:e.name,aHref:"/cluster/".concat(null===(t=null==i?void 0:i.clusterInfo)||void 0===t?void 0:t.id)},{label:"Users",aHref:""}]}),r.a.createElement("div",{className:"security-users-page-list"},r.a.createElement("div",{className:ke},r.a.createElement("div",{className:"".concat(ke,"-left")},r.a.createElement("div",{className:"".concat(ke,"-left-refresh"),onClick:function(){return M()}},r.a.createElement(h.a,{className:"".concat(ke,"-left-refresh-icon"),type:"icon-shuaxin1"}))),r.a.createElement("div",{className:"".concat(ke,"-right")},r.a.createElement(W.a,{className:"search-input",suffix:r.a.createElement(h.a,{type:"icon-fangdajing",onClick:function(e){j(T)},style:{fontSize:"16px"}}),placeholder:"请输入 Kafka User",value:T,onPressEnter:function(e){j(T)},onChange:function(e){P(e.target.value)}}),r.a.createElement(Ht.a,{type:"primary",onClick:function(){return L.current.onOpen(!0,lc.Add,M)}},"新增KafkaUser"))),r.a.createElement(In.a,{tableProps:{showHeader:!1,loading:d,rowKey:"name",dataSource:b,paginationProps:N,columns:[{title:"KafkaUser",dataIndex:"name",width:300,render:function(e){return r.a.createElement(Y.a,{title:e,placement:"topLeft"},r.a.createElement("div",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}},e))}},{title:"认证方式",dataIndex:"authName"},{title:"Password",dataIndex:"token",width:300,render:function(e,t){return r.a.createElement(Nc,{clusterId:o,name:t.name})}},{title:"操作",dataIndex:"",width:240,render:function(e){return r.a.createElement(r.a.Fragment,null,r.a.createElement(Ht.a,{type:"link",size:"small",style:{paddingLeft:0},onClick:function(){return L.current.onOpen(!0,lc.ChangePassword,M,e)}},"修改密码"),r.a.createElement(Ht.a,{type:"link",size:"small",onClick:function(){return z(e)}},"删除"))}}],lineFillColor:!0,attrs:{onChange:function(e){M({pageNo:e.current,pageSize:e.pageSize})},scroll:{y:"calc(100vh - 270px)"}}}})),r.a.createElement(Oc,{ref:L}))};a(149),Ec={},H()(Ec,"disk","Disk"),H()(Ec,"bytesIn","Byte In"),H()(Ec,"bytesOut","Byte Out");function Sc(e,t){var a="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!a){if(Array.isArray(e)||(a=function(e,t){if(!e)return;if("string"==typeof e)return xc(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return xc(e,t)}(e))||t&&e&&"number"==typeof e.length){a&&(e=a);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,c=!1;return{s:function(){a=a.call(e)},n:function(){var e=a.next();return o=e.done,e},e:function(e){c=!0,i=e},f:function(){try{o||null==a.return||a.return()}finally{if(c)throw i}}}}function xc(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}var jc,Ic,wc={leader:"Leader",follower:"Follower",ovsever:"Obsever"},Tc=function e(t,a,n){return t.map((function(t){return t.key===a?Object.assign(Object.assign({},t),{children:n}):t.children?Object.assign(Object.assign({},t),{children:e(t.children,a,n)}):t}))},Pc={current:1,pageSize:10,position:"bottomRight",showSizeChanger:!0,pageSizeOptions:["10","20","50","100","200","500"]},Lc=function(e,t){var a=[];return function e(t,n,r){if(0!==r.length){var i,o=Sc(r);try{for(o.s();!(i=o.n()).done;){var c=i.value;if(n.push(c),c.key===t)return void(a=JSON.parse(JSON.stringify(n)));e(t,n,Array.isArray(c.children)?c.children:[]),n.pop()}}catch(e){o.e(e)}finally{o.f()}}}(e,[],t),a},Mc=a(503),zc=m.a.request,Dc=function(e){var t=e.detailTreeData,a=e.setDetailInfoLoading,i=e.setPathList,o=e.setIdenKey,c=e.idenKey,s=g.a.useGlobalValue(),u=l()(s,1)[0],m=Object(n.useState)(t),d=l()(m,2),f=d[0],p=d[1],v=Object(n.useState)(!0),h=l()(v,2),b=h[0],E=h[1],y=Object(n.useState)([]),k=l()(y,2),N=k[0],O=k[1],C=Object(n.useState)([]),S=l()(C,2),x=S[0],j=S[1],I=Object(n.useState)(!1),w=l()(I,2),T=w[0],P=w[1],L=function(e,t){return{path:"/"+Lc(e,f).map((function(e){return e.title})).join("/"),keyword:t||""}};return Object(n.useEffect)((function(){var e=Lc(c[0],f);i(e)}),[c]),Object(n.useEffect)((function(){t.length>0&&p(t)}),[t]),r.a.createElement(r.a.Fragment,null,r.a.createElement(Jn.a,{onSearch:function(e){var t;c[0]&&c[0].length>0&&zc(K.getZookeeperNodeChildren(+(null===(t=null==u?void 0:u.clusterInfo)||void 0===t?void 0:t.id)),{params:L(c[0],e)}).then((function(t){var a=t&&t.length>0?t.map((function(e,t){return{title:e,key:"".concat(c[0],"-").concat(t)}})):[{title:e?"未搜索到相关节点":"暂无子节点",key:"".concat(c[0],"-",0),disabled:!0,selectable:!1,isLeaf:!0}];p((function(e){return Tc(e,c[0],a)}));var n=N.filter((function(e){return e.slice(0,c[0].length)!==c[0]})),r=[].concat(ue()(n),ue()(c));O(r),j(r),E(!0)}))},attrs:{placeholder:"选中节点后进行搜索",size:"small",style:{marginBottom:"15px"}}}),r.a.createElement("div",{className:"zk-detail-layout-left-content-text"},r.a.createElement(Mc.a,{onLoad:function(e){j(e)},loadData:function(e){var t=e.key,a=e.children,n=void 0===a?null:a;return new Promise((function(e,a){var r;!n||T?zc(K.getZookeeperNodeChildren(+(null===(r=null==u?void 0:u.clusterInfo)||void 0===r?void 0:r.id)),{params:L(t)}).then((function(e){var a=e&&e.length>0?e.map((function(e,a){return{title:e,key:"".concat(t,"-").concat(a)}})):[{title:"暂无子节点",key:"".concat(t,"-",1),disabled:!0,selectable:!1,isLeaf:!0}];E(!0),p((function(e){return Tc(e,t,a)}))})).finally((function(){return e()})):e()}))},loadedKeys:x,expandedKeys:N,selectedKeys:c,onExpand:function(e,t){var a,n=t.node,r=t.expanded,i=e,l=x;P(!1),r||(c[0]!==n.key&&(null===(a=c[0])||void 0===a?void 0:a.slice(0,n.key.length))===n.key&&o([]),i=e.filter((function(e){return e!==n.key&&e.slice(0,n.key.length)!==n.key})),l=x.filter((function(e){return e.slice(0,n.key.length)!==n.key})),P(!0)),E(!1),O(i),j(l)},autoExpandParent:b,onSelect:function(e){a(!0),o(e)},treeData:f})))},Rc=function(e){var t=e.nodeInfo,a=e.siderWidth,n={width:82};return r.a.createElement(mo.b,{style:{fontSize:"13px"},column:a>=270?2:3,labelStyle:{display:"flex",textAlign:"right",justifyContent:"end",color:"#74788D",fontSize:"13px",width:a>=270?144:100},contentStyle:{fontSize:"13px"}},r.a.createElement(mo.b.Item,{labelStyle:a<270&&n,label:"aversion"},t.aversion||0===t.aversion?t.aversion:"-"),r.a.createElement(mo.b.Item,{label:"ctime"},t.ctime||0===t.ctime?t.ctime:"-"),r.a.createElement(mo.b.Item,{label:"ctime-pretty"},t.ctime?ce()(t.ctime).format("YYYY-MM-DD HH:mm:ss"):"-"),r.a.createElement(mo.b.Item,{labelStyle:a<270&&n,label:"cversion"},t.cversion||0===t.cversion?t.cversion:"-"),r.a.createElement(mo.b.Item,{label:"czxid"},t.czxid||0===t.czxid?t.czxid:"-"),r.a.createElement(mo.b.Item,{label:"dataLength"},t.dataLength||0===t.dataLength?t.dataLength:"-"),r.a.createElement(mo.b.Item,{labelStyle:a<270&&n,label:"mtime"},t.mtime||0===t.mtime?t.mtime:"-"),r.a.createElement(mo.b.Item,{label:"mtime-pretty"},t.mtime?ce()(t.mtime).format("YYYY-MM-DD HH:mm:ss"):"-"),r.a.createElement(mo.b.Item,{label:"numChildren"},t.numChildren||0===t.numChildren?t.numChildren:"-"),r.a.createElement(mo.b.Item,{labelStyle:a<270&&n,label:"mzxid"},t.mzxid||0===t.mzxid?t.mzxid:"-"),r.a.createElement(mo.b.Item,{label:"ephemeralOwner"},t.ephemeralOwner||0===t.ephemeralOwner?t.ephemeralOwner:"-"),r.a.createElement(mo.b.Item,{style:{paddingBottom:"12px"},label:"pzxid"},t.pzxid||0===t.pzxid?t.pzxid:"-"),r.a.createElement(mo.b.Item,{labelStyle:a<270&&n,style:{paddingBottom:"12px"},label:"version"},t.version||0===t.version?t.version:"-"))},Fc=function(e){if("string"!=typeof e)return!1;try{return JSON.parse(e),!0}catch(e){return!1}},Bc=function(e){var t=e.nodeData,a=Object(n.useState)("default"),i=l()(a,2),o=i[0],c=i[1];return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"zk-detail-layout-right-content-format"},r.a.createElement(wr,{defaultKey:o,onChange:function(e){return c(e)}},r.a.createElement(wr.TabItem,{key:"default"},r.a.createElement("div",{style:{padding:"0 10px"}},"原始格式")),r.a.createElement(wr.TabItem,{key:"JSON"},r.a.createElement("div",{style:{padding:"0 10px"}},"JSON格式")))),"default"===o&&r.a.createElement("div",{className:"zk-detail-layout-right-content-data"},Fc(t)?JSON.stringify(JSON.parse(t),null,2):t),"JSON"===o&&r.a.createElement("div",{className:"zk-detail-layout-right-content-code"},r.a.createElement(xa.Controlled,{className:"zk-detail-layout-right-content-code-data",value:Fc(t)?JSON.stringify(JSON.parse(t),null,2):t,options:{mode:"application/json",lineNumbers:!0,lineWrapper:!0,autoCloseBrackets:!0,smartIndent:!0,tabSize:2},onBeforeChange:function(){}})))},Hc=m.a.request,Ac=function(e){var t=e.visible,a=e.setVisible,i=g.a.useGlobalValue(),o=l()(i,1)[0],c=Object(n.useState)(!0),s=l()(c,2),u=s[0],m=s[1],d=Object(n.useState)(!0),f=l()(d,2),p=f[0],v=f[1],h=Object(n.useState)(!1),b=l()(h,2),E=b[0],y=b[1],k=Object(n.useState)([]),N=l()(k,2),O=N[0],C=N[1],S=Object(n.useState)({}),x=l()(S,2),j=x[0],I=x[1],w=Object(n.useState)([]),T=l()(w,2),P=T[0],L=T[1],M=Object(n.useState)(200),z=l()(M,2),D=z[0],R=z[1],F=Object(n.useState)(0),B=l()(F,2),H=B[0],A=B[1],V=Object(n.useState)(!1),_=l()(V,2),U=_[0],G=_[1],q=Object(n.useState)([]),J=l()(q,2),W=J[0],Z=J[1];return Object(n.useEffect)((function(){var e;!u&&y(!0),t&&Hc(K.getZookeeperNodeData(+(null===(e=null==o?void 0:o.clusterInfo)||void 0===e?void 0:e.id)),{params:{path:"/"+O.map((function(e){return e.title})).join("/")}}).then((function(e){I(e||{})})).catch((function(){I({})})).finally((function(){y(!1)}))}),[O]),Object(n.useEffect)((function(){var e;m(!0),t&&Hc(K.getZookeeperNodeChildren(+(null===(e=null==o?void 0:o.clusterInfo)||void 0===e?void 0:e.id)),{params:{path:"/",keyword:""}}).then((function(e){var t=e&&e.length>0?e.map((function(e,t){return{title:e,key:"".concat(t)}})):[];t.length>0&&(v(!1),Z(t))})).finally((function(){m(!1)}))}),[t]),r.a.createElement(ya.a,{push:!1,title:"Zookeeper 详情",width:1080,placement:"right",onClose:function(){a(!1),C([]),I({}),L([])},visible:t,className:"zookeeper-detail-drawer",destroyOnClose:!0,maskClosable:!1},r.a.createElement(Q.a,{spinning:u},p?r.a.createElement("div",{className:"zk-detail-empty"},r.a.createElement(Ea.a,{image:Ea.a.PRESENTED_IMAGE_CUSTOM,description:"暂无数据"})):r.a.createElement("div",{className:"zk-detail-layout"},r.a.createElement("div",{className:"zk-detail-layout-left",style:{width:D+"px"}},r.a.createElement("div",{className:"zk-detail-layout-left-title"},"目录结构"),r.a.createElement("div",{className:"zk-detail-layout-left-content"},t&&r.a.createElement(Dc,{setDetailInfoLoading:y,detailTreeData:W,setPathList:C,setIdenKey:L,idenKey:P}))),r.a.createElement("div",{className:"zk-detail-layout-resizer",style:{left:D+"px"},onMouseDown:function(e){A(e.pageX),G(!0)}},U&&r.a.createElement("div",{className:"resize-mask",onMouseMove:function(e){var t=D+e.pageX-H;R(t<200?200:t>320?320:t),A(e.pageX)},onMouseUp:function(){G(!1)}})),r.a.createElement("div",{className:"zk-detail-layout-right"},r.a.createElement("div",{className:"zk-detail-layout-right-title"},"详细信息"),r.a.createElement("div",{className:"zk-detail-layout-right-content"},t&&r.a.createElement(Q.a,{spinning:E},r.a.createElement("div",{className:"zk-detail-layout-right-content-countheight"},r.a.createElement("div",{className:"zk-detail-layout-right-content-path"},r.a.createElement("span",{onClick:function(){C([]),L([])}},j.namespace),O.length>0&&O.map((function(e,t){return e.key===P[0]?r.a.createElement("span",{key:t}," ","/",r.a.createElement("a",{key:t,onClick:function(){return L([e.key])}},e.title)):r.a.createElement("span",{key:t}," ","/",r.a.createElement("span",{key:t,onClick:function(){return L([e.key])}},e.title))}))),r.a.createElement("div",{className:"zk-detail-layout-right-content-info"},r.a.createElement(Rc,{siderWidth:D,nodeInfo:(null==j?void 0:j.stat)||{}})),r.a.createElement(Bc,{nodeData:(null==j?void 0:j.data)||""}))))))))},Vc=function(e){return null==e||""===e?"-":e},Kc=function(){var e=Object(s.useParams)().clusterId,t=Object(n.useState)(!1),a=l()(t,2),i=a[0],o=a[1],c=Object(n.useState)([]),u=l()(c,2),d=u[0],f=u[1],p=Object(n.useState)({state:ne.UNKNOWN,passed:0,total:0}),v=l()(p,2),g=v[0],h=v[1];return Object(n.useEffect)((function(){o(!0),Promise.all([m.a.post(K.getZookeeperMetricsInfo(Number(e)),["HealthCheckPassed","HealthCheckTotal","HealthState"]).then((function(e){var t,a,n;h({state:null===(t=null==e?void 0:e.metrics)||void 0===t?void 0:t.HealthState,passed:(null===(a=null==e?void 0:e.metrics)||void 0===a?void 0:a.HealthCheckPassed)||0,total:(null===(n=null==e?void 0:e.metrics)||void 0===n?void 0:n.HealthCheckTotal)||0})})),m.a.request(K.getZookeeperState(e)).then((function(e){var t=e||{},a=t.aliveFollowerCount,n=t.aliveObserverCount,i=t.aliveServerCount,o=t.totalFollowerCount,c=t.totalObserverCount,l=t.totalServerCount,s=t.watchCount,u=t.leaderNode,m=[{title:"Node Count",value:function(){return r.a.createElement("span",null,i||"-","/",l||"-")},customStyle:{marginLeft:0}},{title:"Watch Count",value:Vc(s)},{title:"Leader",value:function(){return r.a.createElement(Y.a,{title:u},r.a.createElement("span",{style:{fontSize:24,overflow:"hidden",display:"block",width:"100%",whiteSpace:"nowrap",textOverflow:"ellipsis"}},u||"-"))}},{title:"Follower",value:function(){return r.a.createElement("span",null,Vc(a),"/",Vc(o))}},{title:"Observer",value:function(){return r.a.createElement("span",null,Vc(n),"/",Vc(c))}}];f(m)}))]).finally((function(){o(!1)}))}),[e]),r.a.createElement(fn,{scene:"zookeeper",healthData:g,cardColumns:d,loading:i})},_c=function(e,t,a,n){return new(a||(a=Promise))((function(r,i){function o(e){try{l(n.next(e))}catch(e){i(e)}}function c(e){try{l(n.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,c)}l((n=n.apply(e,t||[])).next())}))},Uc=m.a.request,Gc=function(){var e,t,a,i=g.a.useGlobalValue(),o=l()(i,1)[0],c=Object(n.useState)(!1),s=l()(c,2),u=s[0],m=s[1],d=Object(n.useState)(!1),f=l()(d,2),p=f[0],v=f[1],b=Object(n.useState)([]),E=l()(b,2),y=E[0],k=E[1],N=Object(n.useState)(""),O=l()(N,2),C=O[0],S=O[1],x=Object(n.useState)(Pc),j=l()(x,2),I=j[0],w=j[1],T=function(e){var t=e.pageNo,a=e.pageSize;e.filters,e.sorter;return _c(void 0,void 0,void 0,q.a.mark((function e(){var n,r,i;return q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==(null===(n=null==o?void 0:o.clusterInfo)||void 0===n?void 0:n.id)){e.next=2;break}return e.abrupt("return");case 2:m(!0),i={searchKeywords:C.slice(0,128),pageNo:t,pageSize:a},Uc(K.getZookeeperList(null===(r=null==o?void 0:o.clusterInfo)||void 0===r?void 0:r.id),{method:"POST",data:i}).then((function(e){var t,a,n;w({current:null===(t=e.pagination)||void 0===t?void 0:t.pageNo,pageSize:null===(a=e.pagination)||void 0===a?void 0:a.pageSize,total:null===(n=e.pagination)||void 0===n?void 0:n.total});var r=(null==e?void 0:e.bizData.map((function(e){var t;return Object.assign(Object.assign({},e),null===(t=null==e?void 0:e.latestMetrics)||void 0===t?void 0:t.metrics)})))||[];k(r),m(!1)})).catch((function(e){m(!1)}));case 5:case"end":return e.stop()}}),e)})))};return Object(n.useEffect)((function(){T({pageNo:1,pageSize:I.pageSize})}),[C]),r.a.createElement("div",{key:"brokerList",className:"brokerList"},r.a.createElement("div",{className:"breadcrumb",style:{marginBottom:"10px"}},r.a.createElement(Gn.a,{breadcrumbs:[{label:"多集群管理",aHref:"/"},{label:null===(e=null==o?void 0:o.clusterInfo)||void 0===e?void 0:e.name,aHref:"/cluster/".concat(null===(t=null==o?void 0:o.clusterInfo)||void 0===t?void 0:t.id)},{label:"Zookeeper",aHref:"/cluster/".concat(null===(a=null==o?void 0:o.clusterInfo)||void 0===a?void 0:a.id,"/zookepper")},{label:"Servers",aHref:""}]})),r.a.createElement("div",{style:{margin:"12px 0"}},r.a.createElement(Kc,null)),r.a.createElement("div",{className:"custom-table-content"},r.a.createElement("div",{className:ke},r.a.createElement("div",{className:"".concat(ke,"-left")},r.a.createElement("div",{className:"".concat(ke,"-left-refresh"),onClick:function(){return T({pageNo:I.current,pageSize:I.pageSize})}},r.a.createElement(h.a,{className:"".concat(ke,"-left-refresh-icon"),type:"icon-shuaxin1"}))),r.a.createElement("div",{className:"".concat(ke,"-right")},r.a.createElement(Jn.a,{onSearch:S,attrs:{placeholder:"请输入Host",style:{width:"248px",borderRiadus:"8px"},maxLength:128}}),r.a.createElement(Ht.a,{type:"primary",onClick:function(){return v(!0)}},"查看Zookeeper详情"))),r.a.createElement(In.a,{key:"zookeeper-table",showQueryForm:!1,tableProps:{showHeader:!1,rowKey:"zookeeper_list",loading:u,columns:[{title:"Host",dataIndex:"host",key:"host",width:200,render:function(e,t){return r.a.createElement("span",null,e,(null==t?void 0:t.status)?r.a.createElement(pn.a,{className:"tag-success"},"Live"):r.a.createElement(pn.a,{className:"tag-error"},"Down"))}},{title:"Port",dataIndex:"port",key:"port",width:200},{title:"Version",dataIndex:"version",key:"version",width:200},{title:"Role",dataIndex:"role",key:"role",width:200,render:function(e,t){return r.a.createElement(pn.a,{style:{background:"leader"===e?"rgba(85,110,230,0.10)":"follower"===e?"rgba(0,192,162,0.10)":"#fff3e4",color:"leader"===e?"#556EE6":"follower"===e?"#00C0A2":"#F58342",padding:"3px 6px"}},wc[e])}}],dataSource:y,paginationProps:Object.assign({},I),attrs:{onChange:function(e,t,a){T({pageNo:e.current,pageSize:e.pageSize,filters:t,sorter:a})},scroll:{y:"calc(100vh - 400px)"},bordered:!1}}})),r.a.createElement(Ac,{visible:p,setVisible:v}))},qc=function(){var e,t,a=g.a.useGlobalValue(),n=l()(a,1)[0];return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"breadcrumb",style:{marginBottom:"10px"}},r.a.createElement(Gn.a,{breadcrumbs:[{label:"多集群管理",aHref:"/"},{label:null===(e=null==n?void 0:n.clusterInfo)||void 0===e?void 0:e.name,aHref:"/cluster/".concat(null===(t=null==n?void 0:n.clusterInfo)||void 0===t?void 0:t.id)},{label:"Zookeeper",aHref:""}]})),r.a.createElement(Kc,null),r.a.createElement(Un,{type:j.Zookeeper}))},Jc=a(522),Wc=function(e){return null==e||""===e?"0":e},Zc=function(e){var t=e.state,a=Object(s.useParams)().clusterId,i=Object(n.useState)(!1),o=l()(i,2),c=o[0],u=o[1],d=Object(n.useState)([]),f=l()(d,2),p=f[0],v=f[1],g=Object(n.useState)({state:ne.UNKNOWN,passed:0,total:0}),h=l()(g,2),b=h[0],E=h[1];return Object(n.useEffect)((function(){u(!0),Promise.all([m.a.post(K.getMetricPointsLatest(Number(a)),["HealthCheckPassed_Connector","HealthCheckTotal_Connector","HealthState_Connector"]).then((function(e){var t,a,n;E({state:null===(t=null==e?void 0:e.metrics)||void 0===t?void 0:t.HealthState_Connector,passed:(null===(a=null==e?void 0:e.metrics)||void 0===a?void 0:a.HealthCheckPassed_Connector)||0,total:(null===(n=null==e?void 0:e.metrics)||void 0===n?void 0:n.HealthCheckTotal_Connector)||0})})),m.a.request(K.getConnectState(a)).then((function(e){var t=e||{},a=t.connectClusterCount,n=t.aliveConnectorCount,i=t.aliveTaskCount,o=t.totalConnectorCount,c=t.totalTaskCount,l=t.workerCount,s=[{title:"Connect集群数",value:Wc(a),customStyle:{marginLeft:0}},{title:"Workers",value:Wc(l)},{title:function(){return r.a.createElement("div",null,r.a.createElement("span",{style:{display:"inline-block",marginRight:"8px"}},"Connectors"),r.a.createElement(Y.a,{overlayClassName:"rebalance-tooltip",title:"conector运行数/总数"},r.a.createElement(Jc.a,null)))},value:function(){return r.a.createElement("span",null,Wc(n),"/",Wc(o))}},{title:function(){return r.a.createElement("div",null,r.a.createElement("span",{style:{display:"inline-block",marginRight:"8px"}},"Tasks"),r.a.createElement(Y.a,{overlayClassName:"rebalance-tooltip",title:"Task运行数/总数"},r.a.createElement(Jc.a,null)))},value:function(){return r.a.createElement("span",null,Wc(i),"/",Wc(c))}}];v(s)}))]).finally((function(){u(!1)}))}),[a,t]),r.a.createElement(fn,{scene:"connect",healthData:b,cardColumns:p,loading:c})},Yc=function e(t){var a=t.treeData,n=t.checkboxData,i=t.keyTrace,o=t.onKeyChange;return r.a.createElement(In.a,{tableProps:{noPagination:!0,showHeader:!1,rowKey:a.rowKey,columns:a.columns,dataSource:a.dataSource,attrs:Object.assign({showHeader:a.showHeader,rowSelection:{hideSelectAll:0!==i.length,selectedRowKeys:n.filter((function(e){return!0===e.status})).map((function(e){return e.key})),onChange:function(e){o(i,e)},getCheckboxProps:function(e){return{indeterminate:n.some((function(t){return t.key===e[a.rowKey]&&"indeterminate"===t.status}))}}}},a.dataSource.some((function(e){return e.children}))?{expandable:{childrenColumnName:"notExist",expandRowByClick:!0,expandedRowRender:function(t){var c;return(null==t?void 0:t.children)?r.a.createElement(e,{keyTrace:[].concat(ue()(i),[t[a.rowKey]]),treeData:t.children,checkboxData:null===(c=n.find((function(e){return t[a.rowKey]===e.key})))||void 0===c?void 0:c.children,onKeyChange:o}):r.a.createElement(r.a.Fragment,null)},rowExpandable:function(e){return!!(null==e?void 0:e.children)},expandIcon:function(e){var t=e.expanded,a=e.onExpand,n=e.record;return(null==n?void 0:n.children)?t?r.a.createElement(h.a,{style:{fontSize:"16px"},type:"icon-xia",onClick:function(e){a(n,e)}}):r.a.createElement(h.a,{style:{fontSize:"16px"},type:"icon-jiantou_1",onClick:function(e){a(n,e)}}):r.a.createElement(r.a.Fragment,null)}}}:{})}})},Qc=Object(n.forwardRef)((function(e,t){var a=Object(n.useState)(e.tree),i=l()(a,2),o=i[0],c=i[1],s=Object(n.useState)(),m=l()(s,2),d=m[0],f=m[1],p=function(e,t){if(0===t.length)return e;var a=e;return t.forEach((function(e){Object.values(null==a?void 0:a.children).some((function(t){return e===t.key&&(a=t,!0)}))})),a},v=function e(t,a){t.status=a,((null==t?void 0:t.children)||[]).forEach((function(t){return e(t,a)}))},g=function(e,t,a){var n,r=p(e,t);((null==r?void 0:r.children)||[]).forEach((function(e){a.includes(e.key)?v(e,!0):!0===e.status&&v(e,!1)})),r.status=!!(null==a?void 0:a.length)&&(a.length===(null===(n=null==r?void 0:r.children)||void 0===n?void 0:n.length)||"indeterminate");for(var i=1;i<t.length;i++){var o=t.slice(0,t.length-i),c=p(e,o),l=null==c?void 0:c.children.map((function(e){return!0===e.status})).filter((function(e){return e})).length;c.status=0!==l&&(l===(null==c?void 0:c.children.length)||"indeterminate")}},h=function(){var e=[];return function e(t,a){null==t||t.children.forEach((function(t){(null==t?void 0:t.children)?e(t,a):a.push(Object.assign({},t))}))}(d,e),[e,d]};return Object(n.useEffect)((function(){var e={type:void 0,key:void 0,status:!1},t=[];!function e(t,a,n,r,i){a.children=[];var o=[];t.dataSource.forEach((function(c){var l={type:c.type,key:c[t.rowKey],status:!1};a.children.push(l),c.children?e(c.children,l,n,[].concat(ue()(r),[c[t.rowKey]]),i):c.set&&o.push(c[t.rowKey])})),o.length&&i.push((function(){return g(n,r,o)}))}(o,e,e,[],t),t.forEach((function(e){return e()})),f(e)}),[o]),Object(n.useEffect)((function(){c(e.tree)}),[e.tree]),Object(n.useImperativeHandle)(t,(function(){return{getLeafCheckboxData:h}})),d?r.a.createElement(Yc,{treeData:o,checkboxData:null==d?void 0:d.children,keyTrace:[],onKeyChange:function(e,t){var a=Object(u.cloneDeep)(d);g(a,e,t),f(a)}}):r.a.createElement(r.a.Fragment,null)})),$c=Object(n.forwardRef)((function(e,t){var a=Object(n.useState)(!1),i=l()(a,2),o=i[0],c=i[1],s=Object(n.useState)(!1),u=l()(s,2),m=u[0],d=u[1],f=Object(n.useRef)(null);return Object(n.useImperativeHandle)(t,(function(){return{open:function(){return c(!0)}}})),r.a.createElement(ya.a,{className:"indicator-drawer",title:"指标筛选",width:"868px",forceRender:!0,onClose:function(){return c(!1)},visible:o,maskClosable:!1,destroyOnClose:!0,extra:r.a.createElement(la.b,null,r.a.createElement(Ht.a,{size:"small",onClick:function(){return c(!1)}},"取消"),r.a.createElement(Ht.a,{type:"primary",size:"small",loading:m,onClick:function(){var t;d(!0),e.submitCallback(null===(t=f.current)||void 0===t?void 0:t.getLeafCheckboxData()).then((function(){c(!1)})).finally((function(){d(!1)}))}},"确定"),r.a.createElement($.a,{type:"vertical"}))},r.a.createElement(Qc,Object.assign({ref:f},e)))})),Xc=Object(n.forwardRef)((function(e,t){var a=g.a.useGlobalValue(),i=l()(a,1)[0],o=e.metricType,c=e.onSelectChange,u=e.onRankChange,d=Object(s.useParams)().clusterId,f=Object(n.useState)([]),p=l()(f,2),v=p[0],h=p[1],b=Object(n.useState)([]),E=l()(b,2),y=E[0],k=E[1],N=Object(n.useState)(),O=l()(N,2),C=O[0],S=O[1],x=Object(n.useRef)(null),I=function(e){var t=[];return Object.entries(e).forEach((function(e){var a=l()(e,2),n=a[0],r=a[1];t.push(m.a.request(K.getDashboardMetricList(d,n),{method:"POST",data:{metricDetailDTOList:r}}))})),Promise.all(t)},w=function(e,t){var a=Object(wn.a)(y,e,t);k(a);var n={};a.forEach((function(e,t){var a=v.find((function(t){var a=t.name;return e===a}));if(a){var r={metric:e,rank:t,set:(null==a?void 0:a.set)||!1};n[a.type]?n[a.type].push(r):n[a.type]=[r]}})),I(n)},T=function(e){var t=function(e){var t=e.some((function(e){return null!==e.rank})),a={},n=!1,r=[];if(t){var i=e.filter((function(e){return null!==e.rank})).sort((function(e,t){return e.rank-t.rank})),o=e.filter((function(e){return null===e.rank}));(o.length||i.some((function(e,t){return e.rank!==t})))&&(n=!0),r=[].concat(ue()(i),ue()(o.sort((function(e,t){return Number(e.name>t.name)-.5}))))}else n=!0,r=e.sort((function(e,t){return e.type-t.type})).sort((function(e,t){return e.type!==t.type?1:Number(e.name>t.name)-.5}));return r.forEach((function(t,n){var r;!a[t.type]&&(a[t.type]=[]),a[t.type].push({metric:t.name,rank:n,set:(null===(r=e.find((function(e){var a=e.name;return t.name===a})))||void 0===r?void 0:r.set)||!1})})),{list:r.map((function(e){return e.name})),listInfo:a,shouldUpdate:n}}(e),a=t.list,n=t.listInfo,r=t.shouldUpdate;k(a),r&&I(n)},P=function(){Promise.all(o.map((function(e){return m.a.request(K.getDashboardMetricList(d,e))}))).then((function(e){var t=[],a={showHeader:!0,rowKey:"category",columns:[{title:"分类",dataIndex:"category"}],dataSource:[]};e.forEach((function(e,n){if(e){var r=e.filter((function(e){return e.support}));t=t.concat(r);var c={category:o[n]===j.Connect?"Connect Cluster":"Connector"},s={};if(r.forEach((function(e){var t=e.name,a=e.desc,r=e.set,c=i.getMetricDefine(o[n],t),l={type:o[n],set:r,name:t,desc:a,unit:null==c?void 0:c.unit};c.category?s[c.category]?s[c.category].push(l):s[c.category]=[l]:s.Other?s.Other.push(l):s.Other=[l]})),Object.keys(s).length>1){var u={showHeader:!1,rowKey:"category",columns:[{title:"分类",dataIndex:"category"}],dataSource:[]};Object.entries(s).forEach((function(e){var t=l()(e,2),a=t[0],n=t[1];u.dataSource.push({category:a,children:{showHeader:!0,rowKey:"name",columns:Tn,dataSource:n}})})),c.children=u}else c.children={showHeader:!0,rowKey:"name",columns:Tn,dataSource:Object.values(s)[0]||[]};a.dataSource.push(c)}})),S(a),T(ue()(t)),h(t)}))};return Object(n.useEffect)((function(){c(v)}),[v]),Object(n.useEffect)((function(){u(y)}),[y]),Object(n.useEffect)((function(){P()}),[]),Object(n.useImperativeHandle)(t,(function(){return{rankChange:w,open:function(){var e;return null===(e=x.current)||void 0===e?void 0:e.open()}}})),C&&r.a.createElement($c,{ref:x,tree:C,checkField:"set",submitCallback:function(e){var t=l()(e,1)[0],a={};t.forEach((function(e){var t=v.find((function(t){var a=t.type,n=t.name;return a===e.type&&n===e.key}));t&&t.set!==e.status&&(a[e.type]?a[e.type].push({metric:t.name,set:!t.set,rank:t.rank}):a[e.type]=[{metric:t.name,set:!t.set,rank:t.rank}])}));var n=Object.keys(a).length?I(a):Promise.resolve();return n.then((function(){return P()}),(function(){return P()})),n}})})),el=function(e,t,a,n){return new(a||(a=Promise))((function(r,i){function o(e){try{l(n.next(e))}catch(e){i(e)}}function c(e){try{l(n.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,c)}l((n=n.apply(e,t||[])).next())}))},tl=function e(t,a){for(var n,r=0;r<a.length;r++){var i=a[r];i.children&&(i.children.some((function(e){return e.key===t}))?n=i.key:e(t,i.children)&&(n=e(t,i.children)))}return n},al=function(e){var t=e.isTop,a=e.visibleChange,i=e.onChange,o=(Object(s.useParams)().clusterId,Object(n.useState)([])),c=l()(o,2),u=c[0],m=c[1],d=Object(n.useState)([]),f=l()(d,2),p=f[0],v=f[1],g=Object(n.useState)(""),h=l()(g,2),b=h[0],E=h[1],y=Object(n.useState)(!0),k=l()(y,2),N=k[0],O=k[1],C=Object(n.useState)({checked:[],halfChecked:[]}),S=l()(C,2),x=S[0],j=S[1],I=Object(n.useState)({connectClusters:[],connectors:[]}),w=l()(I,2),T=w[0],P=w[1],L=Object(n.useRef)({checked:[],halfChecked:[]}),M=Object(n.useMemo)((function(){return function e(t){return t.map((function(t){var a=t.title,n=a.indexOf(b),i=a.substring(0,n),o=a.slice(n+b.length),c=n>-1?r.a.createElement("span",null,i,r.a.createElement("span",{className:"site-tree-search-value"},b),o):r.a.createElement("span",null,a);return t.children?{title:c,key:t.key,children:e(t.children)}:{title:c,key:t.key}}))}(u)}),[u,b]);return Object(n.useEffect)((function(){t&&(j({checked:[],halfChecked:[]}),P({connectClusters:[],connectors:[]}),L.current={checked:[],halfChecked:[]})}),[t]),Object(n.useEffect)((function(){el(void 0,void 0,void 0,q.a.mark((function t(){var a;return q.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:a={},e.scopeList.connectClusters.forEach((function(e){a[e.id]={title:e.name,key:e.id,children:[]}})),e.scopeList.connectors.forEach((function(e){var t=a[e.connectClusterId];t&&t.children.push({title:e.connectorName,key:"".concat(e.connectClusterId,":").concat(e.connectorName)})})),m(Object.values(a));case 4:case"end":return t.stop()}}),t)})))}),[e.scopeList]),r.a.createElement(r.a.Fragment,null,r.a.createElement("h6",{className:"time_title"},e.title),r.a.createElement("div",{className:"custom-scope dashboard-custom-scope"},r.a.createElement("div",{style:{padding:"0 16px 12px 16px"}},r.a.createElement(W.a,{size:"small",placeholder:"请输入内容筛选",onChange:function(e){var t=e.target.value,a=[];u.forEach((function(e){var n;String(e.title).indexOf(t)>-1&&a.push(tl(e.key,u)),null===(n=e.children)||void 0===n||n.forEach((function(e){String(e.title).indexOf(t)>-1&&a.push(tl(e.key,u))}))})),a=a.filter((function(e,t,a){return e&&a.indexOf(e)===t})),v(a),E(t),O(!0)}})),r.a.createElement(Mc.a,{className:"connect-dashboard-option-tree",checkable:!0,checkStrictly:!0,treeData:M,checkedKeys:x,expandedKeys:p,autoExpandParent:N,onExpand:function(e){v(e),O(!1)},onCheck:function(e,t){var a=t.checkedNodes,n={connectClusters:[],connectors:[]};a.map((function(e){if(e.children)n.connectClusters.push(e.key);else{var t=e.key.split(":"),a=en()(t),r=a[0],i=a.slice(1);n.connectors.push({connectClusterId:Number(r),connectorName:i.join(":")})}})),P(n),j(e)}}),r.a.createElement("div",{className:"btn-con"},r.a.createElement(Ht.a,{type:"primary",size:"small",className:"btn-sure",onClick:function(){i(T,"".concat(T.connectClusters.length+T.connectors.length,"项"))},disabled:0===x.checked.length},"确定"),r.a.createElement(Ht.a,{size:"small",onClick:function(){a(!1),j(L.current)}},"取消"))))},nl=a(307),rl=a.n(nl),il=function(){return r.a.createElement("div",{style:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",height:"calc(100vh - 118px)",boxShadow:"0 2px 4px 0 rgba(0,0,0,0.01), 0 3px 6px 3px rgba(0,0,0,0.01), 0 2px 6px 0 rgba(0,0,0,0.03)",borderRadius:12,background:"#fff"}},r.a.createElement("img",{src:rl.a,style:{width:100,height:162}}),r.a.createElement("span",{style:{fontSize:13,color:"#919AAC",paddingTop:16}},"暂无数据，请先接入 Connect 集群"))},ol=function(e){var t=Object(s.useParams)().clusterId,a=Object(n.useState)(!0),i=l()(a,2),o=i[0],c=i[1],u=Object(n.useState)(!0),d=l()(u,2),f=d[0],p=d[1];return Object(n.useLayoutEffect)((function(){m.a.request(K.getConnectClusters(t)).then((function(e){(null==e?void 0:e.length)&&p(!1)})).finally((function(){return c(!1)}))}),[]),f?r.a.createElement(Q.a,{spinning:o},o?r.a.createElement("div",{style:{height:"calc(100vh - 118px)"}}):r.a.createElement(il,null)):e.children},cl=new(0,m.a.EventBus),ll=function(){var e=g.a.useGlobalValue(),t=l()(e,1)[0],a=Object(s.useParams)().clusterId,i=Object(n.useState)(!0),o=l()(i,2),c=o[0],u=o[1],d=Object(n.useState)(),f=l()(d,2),p=f[0],v=f[1],h=Object(n.useState)({}),b=l()(h,2),E=b[0],y=b[1],k=Object(n.useState)([]),N=l()(k,2),O=N[0],C=N[1],S=Object(n.useState)(12),x=l()(S,2),I=x[0],w=x[1],T=Object(n.useState)({connectClusters:[],connectors:[]}),P=l()(T,2),L=P[0],M=P[1],z=Object(n.useState)("all"),D=l()(z,2),R=D[0],F=(D[1],Object(n.useRef)(0)),B=Object(n.useRef)([]),H=Object(n.useRef)(null),A=Object(n.useRef)(null),V=function(){var e;!p.isAutoReload&&u(!0);var n=Date.now();F.current=n;var r=l()(p.rangeTime,2),i=r[0],o=r[1],c=p.scopeData.data,s=c.connectClusters,d=c.connectors,f=null===(e=null==p?void 0:p.scopeData)||void 0===e?void 0:e.isTop,v={startTime:i,endTime:o,topNu:f?p.scopeData.data:null},g=E[j.Connect]&&(f||(null==s?void 0:s.length))?m.a.post(K.getConnectClusterMetrics(a),Object.assign(Object.assign(Object.assign({},v),{metricsNames:E[j.Connect]}),f?{}:{connectClusterIdList:s})):Promise.resolve([]),h=E[j.Connectors]&&(f||(null==d?void 0:d.length))?m.a.post(K.getConnectorMetrics(a),Object.assign(Object.assign(Object.assign({},v),{metricsNames:E[j.Connectors]}),f?{}:{connectorNameList:d})):Promise.resolve([]);Promise.all([g,h]).then((function(e){var a,r;if(F.current===n){if(1===e.length||2===e.length&&e[0]&&e[1]){var i=ft(e[0],t.getMetricDefine||{},j.Connect,p.rangeTime),o=[];null===(a=E[j.Connect])||void 0===a||a.forEach((function(e){var a;if(i&&i.some((function(t){return e===t.metricName})))o.push(null);else{var n={metricName:e,metricType:j.Connect,metricUnit:(null===(a=t.getMetricDefine(j.Connect,e))||void 0===a?void 0:a.unit)||"",metricLines:[],showLegend:!1,targetUnit:void 0};o.push(n)}}));var c=ft(e[1],t.getMetricDefine||{},j.Connectors,p.rangeTime),l=[];null===(r=E[j.Connectors])||void 0===r||r.forEach((function(e){var a;if(c&&c.some((function(t){return e===t.metricName})))l.push(null);else{var n={metricName:e,metricType:j.Connectors,metricUnit:(null===(a=t.getMetricDefine(j.Connectors,e))||void 0===a?void 0:a.unit)||"",metricLines:[],showLegend:!1,targetUnit:void 0};l.push(n)}}));var s=[].concat(ue()(i),ue()(c)),m=[].concat(o,l).filter((function(e){return null!==e}));s.sort((function(e,t){return B.current.indexOf(e.metricName)-B.current.indexOf(t.metricName)})),m.sort((function(e,t){return B.current.indexOf(e.metricName)-B.current.indexOf(t.metricName)}));var d=[].concat(ue()(s),ue()(m));C("Connect"===R?d.filter((function(e){return e.metricType===j.Connect})):"Connector"===R?d.filter((function(e){return e.metricType===j.Connectors})):d)}else C([]);u(!1)}}),(function(){return F.current===n&&u(!1)}))};return Object(n.useEffect)((function(){Object.values(E).some((function(e){return e.length}))&&p&&V()}),[p,R]),Object(n.useEffect)((function(){Object.values(E).some((function(e){return e.length}))&&p?(u(!0),V()):(C([]),u(!1))}),[E]),Object(n.useEffect)((function(){var e,t;e=m.a.request(K.getConnectClusters(a)),t=m.a.request(K.getConnectors(a)),Promise.all([e,t]).then((function(e){var t=l()(e,2),a=t[0],n=t[1];M({connectClusters:a,connectors:n})}))}),[]),r.a.createElement("div",{id:"dashboard-drag-chart",className:"topic-dashboard"},r.a.createElement(Nn,{onChange:function(e){var t=e.isAutoReload,a=e.gridNum,n=e.isRelativeRangeTime,r=e.rangeTime,i=e.scopeData,o=r;a!==I?(w(a||12),cl.emit("chartResize")):(n&&(o=r.map((function(e){return e-6e4}))),v({isRelativeRangeTime:n,isAutoReload:t,rangeTime:o,scopeData:i}))},hideNodeScope:!1,openMetricFilter:function(){var e;return null===(e=H.current)||void 0===e?void 0:e.open()},nodeSelect:{name:"Connect",customContent:r.a.createElement(al,{scopeList:L,title:"请选择 Connect 范围"})}}),r.a.createElement(Xc,{ref:H,metricType:[j.Connect,j.Connectors],onSelectChange:function(e){var t={};e.forEach((function(e){var a=e.type,n=e.name;e.set&&(t[a]?t[a].push(n):t[a]=[n])})),y(t)},onRankChange:function(e){B.current=e}}),r.a.createElement(An,{busInstance:cl,loading:c,gridNum:I,data:O,autoReload:null==p?void 0:p.isAutoReload,dragCallback:function(e,t){var a,n=B.current.indexOf(O[e].metricName),r=B.current.indexOf(O[t].metricName);null===(a=H.current)||void 0===a||a.rankChange(n,r)},onExpand:function(e,t){var a=t===j.Connect?L.connectClusters.map((function(e){return e.id})):L.connectors.map((function(e){return{connectClusterId:e.connectClusterId,connectorName:e.connectorName}}));A.current.onOpen(t,e,a)}}),r.a.createElement(jn,{ref:A}))},sl=function(){var e,t,a=g.a.useGlobalValue(),n=l()(a,1)[0];return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"breadcrumb",style:{marginBottom:"10px"}},r.a.createElement(Gn.a,{breadcrumbs:[{label:"多集群管理",aHref:"/"},{label:null===(e=null==n?void 0:n.clusterInfo)||void 0===e?void 0:e.name,aHref:"/cluster/".concat(null===(t=null==n?void 0:n.clusterInfo)||void 0===t?void 0:t.id)},{label:"Connect",aHref:""}]})),r.a.createElement(ol,null,r.a.createElement(r.a.Fragment,null,r.a.createElement(Zc,null),r.a.createElement(ll,null))))},ul=a(940),ml=function(e){var t=e.record,a=e.onConfirm,i=J.a.useForm(),o=l()(i,1)[0],c=Object(n.useState)(!1),s=l()(c,2),u=s[0],f=s[1];return r.a.createElement(r.a.Fragment,null,r.a.createElement(Ht.a,{type:"link",size:"small",onClick:function(e){f(!0)}},"删除"),r.a.createElement(d.a,{className:"custom-modal",title:"确定删除此Connector吗？",centered:!0,visible:u,wrapClassName:"del-connect-modal",destroyOnClose:!0,maskClosable:!1,onOk:function(){o.validateFields().then((function(e){var n=o.getFieldsValue();n.connectClusterId=Number(t.connectClusterId),m.a.delete(K.connectorsOperates,{data:n}).then((function(e){null===e?(O.success({message:"删除成功"}),f(!1),a&&a()):O.error({message:"删除失败"})}))}))},onCancel:function(e){f(!1)},okText:"删除",okButtonProps:{danger:!0,size:"small",style:{paddingLeft:"16px",paddingRight:"16px"}},cancelButtonProps:{size:"small",style:{paddingLeft:"16px",paddingRight:"16px"}}},r.a.createElement(J.a,{form:o,labelCol:{span:6},style:{marginTop:17}},r.a.createElement(J.a.Item,{label:"ConnectorName"},t.connectorName),r.a.createElement(J.a.Item,{name:"connectorName",label:"ConnectorName",rules:[function(){return{validator:function(e,a){return a?a!==t.connectorName?Promise.reject(new Error("请输入正确的ConnectorName名称")):Promise.resolve():Promise.reject(new Error("请输入ConnectorName名称"))}}}]},r.a.createElement(W.a,{placeholder:"请输入",size:"small"})))))},dl={current:1,pageSize:10,position:"bottomRight",showSizeChanger:!0,pageSizeOptions:["10","20","50","100","200","500"]},fl=(jc={},H()(jc,"stop","暂停"),H()(jc,"restart","重启"),H()(jc,"resume","继续"),jc),pl=(Ic={},H()(Ic,"UNASSIGNED",{name:"Unassigned",color:"#556EE6",bgColor:"#EBEEFA"}),H()(Ic,"RUNNING",{name:"Running",color:"#00C0A2",bgColor:"rgba(0,192,162,0.10)"}),H()(Ic,"PAUSED",{name:"Paused",color:"#495057",bgColor:"#ECECF6"}),H()(Ic,"FAILED",{name:"Failed",color:"#F58342",bgColor:"#fef3e5"}),H()(Ic,"DESTROYED",{name:"Destroyed",color:"#FF7066",bgColor:"#fdefee"}),H()(Ic,"RESTARTING",{name:"Restarting",color:"#3991FF",bgColor:"#e9f5ff"}),Ic),vl=function(e,t){var a,n,r=null===(n=null===(a=null==e?void 0:e.latestMetrics)||void 0===a?void 0:a.metrics)||void 0===n?void 0:n[t];return void 0!==r?"TotalRecordErrors"===t?Math.round(r).toLocaleString():Number(m.a.formatAssignSize(r,"KB",r>1e3?2:3)).toLocaleString():"-"},gl=function(e,t){var a,n,i=(null===(n=null===(a=e.metricLines)||void 0===a?void 0:a.find((function(e){return e.metricName===t})))||void 0===n?void 0:n.metricPoints)||[];return i.length?r.a.createElement("div",{className:"metric-data-wrap"},r.a.createElement(Et,{width:"100%",height:30,chartData:{name:e.metricName,data:i.map((function(e){return{time:e.timeStamp,value:e.value}}))}}),r.a.createElement("span",{className:"cur-val"},vl(e,t))):r.a.createElement("span",{className:"cur-val"},vl(e,t))},hl=a(941),bl=hl.a.Step,El={basic:["name","connector.class","tasks.max","key.converter","value.converter","header.converter"],transforms:["transforms"],errorHandling:["errors.retry.timeout","errors.retry.delay.max.ms","errors.tolerance","errors.log.enable","errors.log.include.messages"]},yl=function(e){return[].concat(ue()(El.basic),ue()(El.transforms),ue()(El.errorHandling),["sink"===e?"topics":""]).filter((function(e){return e}))},kl=Object(n.createContext)({type:"create",errors:{},forms:{current:{}}});function Nl(e){var t=Object(n.useContext)(kl).forms,a=J.a.useForm(),r=l()(a,1)[0];return t.current[e]?r=t.current[e]:t.current[e]=r,[r]}var Ol,Cl,Sl=[{title:"设置插件类型",content:function(e){var t=Object(s.useParams)().clusterId,a=Nl(0),i=l()(a,1)[0],o=Object(n.useContext)(kl),c=o.type,u=o.detail,d="edit"===c,f=Object(n.useState)([]),p=l()(f,2),v=p[0],g=p[1],b=Object(n.useState)(null==u?void 0:u.connectClusterId),E=l()(b,2),y=E[0],k=E[1],N=Object(n.useState)(""),O=l()(N,2),C=O[0],S=O[1],x=Object(n.useState)([]),j=l()(x,2),I=j[0],w=j[1],T=Object(n.useState)(null==u?void 0:u.connectorClassName),P=l()(T,2),L=P[0],M=P[1],z=Object(n.useState)((null==u?void 0:u.connectorType.toLowerCase())||"source"),D=l()(z,2),R=D[0],F=D[1],B=Object(n.useState)(!1),H=l()(B,2),A=H[0],V=H[1];return Object(n.useEffect)((function(){var t;L&&(t=L,e.setSubmitLoading(!0),Promise.all([m.a.request(K.getConnectorPluginConfig(y,t)),d?m.a.request(K.getCurPluginConfig(y,u.connectorName)):void 0].filter((function(e){return e}))).then((function(e){var t=l()(e,2),a=t[0],n=t[1],r={pluginConfig:{}};a.configs.forEach((function(e){var t=e.definition;if(!yl(R).includes(t.name)){var a=r.pluginConfig,n=t.group||"Others";a[n]?a[n].push(t):a[n]=[t]}})),Object.values(r.pluginConfig).forEach((function(e){return e.sort((function(e,t){return e.orderInGroup-t.orderInGroup}))})),d&&(r.connectorConfig=n),Object.keys(r).length&&i.setFieldsValue({configs:r})})).finally((function(){return e.setSubmitLoading(!1)})))}),[L]),Object(n.useEffect)((function(){y&&(V(!0),m.a.request(K.getConnectorPlugins(y)).then((function(e){w(e)})).finally((function(){return V(!1)})))}),[y]),Object(n.useEffect)((function(){m.a.request(K.getConnectClusters(t)).then((function(e){var t=e.map((function(e){return{label:e.name||"-",value:e.id}}));g(t),i.setFieldsValue({connectClusters:t})}))}),[]),r.a.createElement("div",{style:{display:e.visible?"block":"none"}},r.a.createElement(J.a,{form:i,layout:"vertical"},r.a.createElement(J.a.Item,{name:"connectClusterId",label:"Connect 集群",rules:[{required:!0,message:"请选择 Connect 集群"}],initialValue:null==u?void 0:u.connectClusterId},r.a.createElement(oa.a,{options:v,placeholder:"请选择 Connect 集群",disabled:d})),r.a.createElement(J.a.Item,{noStyle:!0,dependencies:["connectClusterId"]},(function(e){var t=(0,e.getFieldValue)("connectClusterId");return y!==t&&i.resetFields(["connectorClassName"]),k(t),t?r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{style:{display:"flex",justifyContent:"space-between",margin:"26px 0 18px 0"}},r.a.createElement(wr,{activeKey:R,onChange:function(e){d?ie.warning("编辑状态不可修改插件"):(F(e),i.setFieldsValue({connectorType:e}),i.resetFields(["connectorClassName"]))}},r.a.createElement(wr.TabItem,{key:"source"},r.a.createElement("div",{style:{width:151,height:32,lineHeight:"32px"}},"Source"," ",r.a.createElement("span",{style:{fontSize:12}},"(数据",r.a.createElement(h.a,{type:"icon-jiantou"}),"Kafka)"))),r.a.createElement(wr.TabItem,{key:"sink"},r.a.createElement("div",{style:{width:151,height:32,lineHeight:"32px"}},"Sink"," ",r.a.createElement("span",{style:{fontSize:12}},"(Kafka",r.a.createElement(h.a,{type:"icon-jiantou"}),"数据)")))),r.a.createElement(W.a,{placeholder:"请输入插件名称",style:{width:241},onChange:function(e){S(e.target.value)}})),r.a.createElement(Wa.a,{rowKey:"className",loading:A,columns:[{title:"插件名称",dataIndex:"className",render:function(e,t){return r.a.createElement("span",null,e,(null==t?void 0:t.helpDocLink)&&r.a.createElement("span",{style:{background:"rgba(85, 110, 230, 0.1)",padding:"2px 8px",borderRadius:4,marginLeft:4,color:"#5664FF",cursor:"pointer",fontSize:12},onClick:function(){return window.open(t.helpDocLink)}},"help"))}}],dataSource:I.filter((function(e){return e.type===R&&(!C||e.className.includes(C))})),pagination:!1,rowSelection:{type:"radio",preserveSelectedRowKeys:!1,selectedRowKeys:[L],getCheckboxProps:function(e){return{disabled:d&&e.className!==L}},onChange:function(e){M(e[0]),i.setFieldsValue({connectorClassName:e[0]})}}}),r.a.createElement("div",{className:"add-container-plugin-select"},r.a.createElement(J.a.Item,{name:"connectClusters"}),r.a.createElement(J.a.Item,{name:"connectorType",initialValue:R}),r.a.createElement(J.a.Item,{name:"connectorClassName",initialValue:L,rules:[{validator:function(e,t){return t?Promise.resolve():Promise.reject("请选择 Connector 插件")}}]}),r.a.createElement(J.a.Item,{name:"configs",rules:[{validator:function(e,t){return i.getFieldValue("connectorClassName")?t?Promise.resolve():Promise.reject(d?"插件或 connector 配置获取失败":"插件配置获取失败，请重新选择插件"):Promise.resolve(!0)}}]}))):r.a.createElement(r.a.Fragment,null)}))))}},{title:"基础设置",content:function(e){var t,a=Object(s.useParams)().clusterId,i=Nl(0),o=l()(i,1)[0],c=Nl(1),u=l()(c,1)[0],d=Object(n.useState)([]),f=l()(d,2),p=f[0],v=f[1],g=Object(n.useContext)(kl),h=g.type,b=g.detail,E=g.errors,y="edit"===h,k=null===(t=o.getFieldValue("configs"))||void 0===t?void 0:t.connectorConfig;return Object(n.useEffect)((function(){m.a.request(K.getTopicMetaList(Number(a)),{method:"GET"}).then((function(e){var t=(e||[]).map((function(e){return Object.assign(Object.assign({},e),{key:e.topicName,label:e.topicName,value:e.topicName})}));v(t)}))}),[]),Object(n.useEffect)((function(){k&&u.setFieldsValue({topics:"string"==typeof k.topics?k.topics.split(",").map((function(e){return e.trim()})):void 0})}),[p,k]),Object(n.useEffect)((function(){var e=k||{};u.setFieldsValue({"connector.class":e["connector.class"]||o.getFieldValue("connectorClassName"),"tasks.max":e["tasks.max"]||1,"key.converter":e["key.converter"],"value.converter":e["value.converter"],"header.converter":e["header.converter"]})}),[k]),Object(n.useEffect)((function(){u.setFieldsValue({"connector.class":o.getFieldValue("connectorClassName")})}),[o.getFieldValue("connectorClassName")]),Object(n.useEffect)((function(){u.setFields([].concat(ue()(El.basic.map((function(e){return{name:e,errors:E[e]||[]}}))),[{name:"topics",errors:"sink"===o.getFieldValue("connectorType")&&E.topics||[]}]))}),[E]),r.a.createElement("div",{style:{display:e.visible?"block":"none"}},r.a.createElement(J.a,{form:u,layout:"vertical"},r.a.createElement(J.a.Item,{name:"name",label:"Connector 名称",validateTrigger:"onBlur",initialValue:null==b?void 0:b.connectorName,rules:[{required:!0,validator:function(e,t){return y?Promise.resolve():t?y?Promise.resolve():(null==t?void 0:t.length)>64?Promise.reject("Connector 名称长度限制在1～128字符"):new RegExp(Na).test(t)?m.a.request(K.isConnectorExist(o.getFieldValue("connectClusterId"),t)).then((function(e){var t=e||{};return(null==t?void 0:t.exist)?Promise.reject("Connector 名称重复"):Promise.resolve()}),(function(){return Promise.reject("连接超时! 请重试或检查服务")})):Promise.reject("Connector 名称支持中英文、数字、特殊字符 ! # $ % & ' ( ) * + , - . / : ; < = > ? @ [  ] ^ _ ` { | } ~"):Promise.reject("Connector 名称不能为空")}}]},r.a.createElement(W.a,{placeholder:"请输入 Connector 名称",disabled:y})),r.a.createElement(J.a.Item,{name:"connector.class"},r.a.createElement("div",{className:"connector-plugin-desc"},r.a.createElement("span",{className:"connector-plugin-title"},"Connector 插件类型"),": ",u.getFieldValue("connector.class")||"-")),r.a.createElement(J.a.Item,{name:"tasks.max",label:"最大 Task 数",tooltip:"The maximum number of tasks that should be created for this connector. The connector may create fewer tasks if it cannot achieve this level of parallelism.",rules:[{required:!0,message:"最大 Task 数不能为空"}]},r.a.createElement(Ft.a,{min:1,max:99999})),r.a.createElement(J.a.Item,{name:"key.converter",label:"Key converter class",tooltip:"Converter class used to convert between Kafka Connect format and the serialized form that is written to Kafka. This controls the format of the keys in messages written to or read from Kafka, and since this is independent of connectors it allows any connector to work with any serialization format. Examples of common formats include JSON and Avro.",rules:[{required:!1}],normalize:function(e){return e||null}},r.a.createElement(W.a,{placeholder:"请输入 Key converter class"})),r.a.createElement(J.a.Item,{name:"value.converter",label:"Value converter class",tooltip:"Converter class used to convert between Kafka Connect format and the serialized form that is written to Kafka. This controls the format of the values in messages written to or read from Kafka, and since this is independent of connectors it allows any connector to work with any serialization format. Examples of common formats include JSON and Avro.",rules:[{required:!1}],normalize:function(e){return e||null}},r.a.createElement(W.a,{placeholder:"请输入 Value converter class"})),r.a.createElement(J.a.Item,{name:"header.converter",label:"Header converter class",tooltip:"HeaderConverter class used to convert between Kafka Connect format and the serialized form that is written to Kafka. This controls the format of the header values in messages written to or read from Kafka, and since this is independent of connectors it allows any connector to work with any serialization format. Examples of common formats include JSON and Avro. By default, the SimpleHeaderConverter is used to serialize header values to strings and deserialize them by inferring the schemas.",rules:[{required:!1}],normalize:function(e){return e||null}},r.a.createElement(W.a,{placeholder:"请输入 Header converter class"})),"sink"===o.getFieldValue("connectorType")&&r.a.createElement(J.a.Item,{name:"topics",label:"Topics",tooltip:"从哪些Topic消费消息",rules:[{required:!0,message:"Topics 不能为空"}]},r.a.createElement(oa.a,{mode:"multiple",allowClear:!0,placeholder:"请选择 Topics",options:p}))))}},{title:"Transforms",content:function(e){var t,a=Nl(0),i=l()(a,1)[0],o=Nl(2),c=l()(o,1)[0],s=Object(n.useContext)(kl),u=s.type,m=s.errors,d="edit"===u,f=null===(t=i.getFieldValue("configs"))||void 0===t?void 0:t.connectorConfig;return Object(n.useLayoutEffect)((function(){if(d){var e=null==f?void 0:f.transforms,t={};if(e){var a=e.split(",").map((function(e){return e.trim()}));Object.entries(f).forEach((function(e){var n=l()(e,2),r=n[0],i=n[1];a.some((function(e){return r.includes("transforms.".concat(e))}))&&(t[r]=i)}));var n="transforms=".concat(e,"\n").concat(Object.entries(t).map((function(e){var t=l()(e,2),a=t[0],n=t[1];return"".concat(a,"=").concat(n,"\n")})));c.setFieldsValue({transforms:n})}}}),[f]),Object(n.useEffect)((function(){c.setFields([{name:"transforms",errors:m.transforms||[]}])}),[m]),r.a.createElement("div",{style:{display:e.visible?"block":"none"}},r.a.createElement(J.a,{form:c,layout:"vertical"},r.a.createElement(J.a.Item,{name:"transforms",label:r.a.createElement(r.a.Fragment,null,r.a.createElement("span",null,"Transforms"),r.a.createElement("span",{style:{background:"rgba(85, 110, 230, 0.1)",padding:"0px 8px",borderRadius:4,marginLeft:4,color:"#5664FF",cursor:"pointer",fontSize:12,height:"20px",lineHeight:"20px"},onClick:function(){return window.open("https://kafka.apache.org/documentation/#connect_transforms")}},"help")),rules:[{validator:function(e,t){return t&&t.split("\n").filter((function(e){return e})).some((function(e){return!e.includes("=")}))?Promise.reject("格式应为 key=value，使用换行符分隔"):Promise.resolve()}}]},r.a.createElement(W.a.TextArea,{rows:8,placeholder:"transforms=MakeMap, InsertSource\ntransforms.MakeMap.type=org.apache.kafka.connect.transforms.HoistField$Value\ntransforms.MakeMap.field=line\ntransforms.InsertSource.type=org.apache.kafka.connect.transforms.InsertField$Value\ntransforms.InsertSource.static.field=data_source\ntransforms.InsertSource.static.value=test-file-source"}))))}},{title:"Error Handling",content:function(e){var t,a=Nl(0),i=l()(a,1)[0],o=Nl(3),c=l()(o,1)[0],s=Object(n.useContext)(kl).errors,u=null===(t=i.getFieldValue("configs"))||void 0===t?void 0:t.connectorConfig;return Object(n.useEffect)((function(){var e=u||{};c.setFieldsValue({"errors.retry.timeout":e["errors.retry.timeout"]||0,"errors.retry.delay.max.ms":e["errors.retry.delay.max.ms"]||6e4,"errors.tolerance":e["errors.tolerance"]||"none","errors.log.enable":e["errors.log.enable"]&&!(!e["errors.log.enable"]&&"true"!==e["errors.log.enable"])||!1,"errors.log.include.messages":e["errors.log.include.messages"]&&!(!e["errors.log.include.messages"]&&"true"!==e["errors.log.include.messages"])||!1})}),[u]),Object(n.useEffect)((function(){c.setFields(El.errorHandling.map((function(e){return{name:e,errors:s[e]||[]}})))}),[s]),r.a.createElement("div",{style:{display:e.visible?"block":"none"}},r.a.createElement(J.a,{form:c,layout:"vertical"},r.a.createElement(Bt.a,{gutter:[12,0]},r.a.createElement(hn.a,{span:12},r.a.createElement(J.a.Item,{name:"errors.retry.timeout",label:"Retry Timeout for Errors",tooltip:"The maximum duration in milliseconds that a failed operation will be reattempted. The default is 0, which means no retries will be attempted. Use -1 for infinite retries."},r.a.createElement(Ft.a,{min:0,style:{width:"100%"}}))),r.a.createElement(hn.a,{span:12},r.a.createElement(J.a.Item,{name:"errors.retry.delay.max.ms",label:"Maximum Delay Between Retries for Errors",tooltip:"The maximum duration in milliseconds between consecutive retry attempts. Jitter will be added to the delay once this limit is reached to prevent thundering herd issues."},r.a.createElement(Ft.a,{min:0,style:{width:"100%"}})))),r.a.createElement(J.a.Item,{name:"errors.tolerance",label:"Error Tolerance",tooltip:"Behavior for tolerating errors during connector operation. 'none' is the default value and signals that any error will result in an immediate connector task failure; 'all' changes the behavior to skip over problematic records."},r.a.createElement(oa.a,{defaultValue:"none",options:[{value:"none",label:"none"},{value:"all",label:"all"}]})),r.a.createElement(J.a.Item,{name:"errors.log.enable",label:"Log Errors",valuePropName:"checked",tooltip:"If true, write each error and the details of the failed operation and problematic record to the Connect application log. This is 'false' by default, so that only errors that are not tolerated are reported."},r.a.createElement(pr.a,{size:"small"})),r.a.createElement(J.a.Item,{name:"errors.log.include.messages",label:"Log Error Detials",valuePropName:"checked",tooltip:"Whether to include in the log the Connect record that resulted in a failure.For sink records, the topic, partition, offset, and timestamp will be logged. For source records, the key and value (and their schemas), all headers, and the timestamp, Kafka topic, Kafka partition, source partition, and source offset will be logged. This is 'false' by default, which will prevent record keys, values, and headers from being written to log files."},r.a.createElement(pr.a,{size:"small"}))))}},{title:"高级设置",content:function(e){var t=Nl(4),a=l()(t,1)[0],i=Nl(0),o=l()(i,1)[0],c=Object(n.useContext)(kl).errors,s=o.getFieldValue("configs")||{},u=s.pluginConfig,m=s.connectorConfig,d=void 0===m?{}:m,f=Object(n.useState)([]),p=l()(f,2),v=p[0],g=p[1];return Object(n.useLayoutEffect)((function(){g(u?Object.keys(u):[])}),[u]),Object(n.useEffect)((function(){var e=[];Object.entries(c).forEach((function(t){var a=l()(t,2),n=a[0],r=a[1];yl(o.getFieldValue("connectorType")).includes(n)||e.push({name:n,errors:r})})),a.setFields(e)}),[c]),r.a.createElement("div",{style:{display:e.visible?"block":"none"}},r.a.createElement(J.a,{form:a,layout:"vertical"},u&&r.a.createElement(ha.a,{className:"add-connector-collapse",ghost:!0,activeKey:v,onChange:function(e){if(e.length<v.length){var t=v.find((function(t){return!e.includes(t)}));if(t){var n=u[t].map((function(e){return e.name}));a.validateFields(n).then((function(){g(e)}),(function(){ie.warning("收起前请先填写必填项")}))}}else g(e)}},Object.entries(u).sort((function(e,t){return Number(e[0]>t[0])-.5})).map((function(e){var t=l()(e,2),a=t[0],n=t[1];return r.a.createElement(ha.a.Panel,{className:"add-connector-collapse-panel",header:a,key:a},n.map((function(e){var t=e.name,a=e.displayName,n=e.type,i=e.required,o=e.defaultValue,c=e.documentation;return r.a.createElement(J.a.Item,{key:t,name:t,label:a,rules:[{required:i,message:i?"".concat(a," 不能为空"):""}],initialValue:(null==d?void 0:d[t])||o,normalize:function(e){return null!==o||e?e:null},tooltip:c},"config.action.reload"===t?r.a.createElement(oa.a,{defaultValue:"restart",options:[{value:"restart",label:"restart"},{value:"none",label:"none"}]}):"INT"===n.toUpperCase()||"LONG"===n.toUpperCase()?r.a.createElement(Ft.a,null):"BOOLEAN"===n.toUpperCase()?r.a.createElement(pr.a,{size:"small"}):r.a.createElement(W.a,null))})))})))))}}],xl=Object(n.forwardRef)((function(e,t){var a=Object(n.useState)(!1),i=l()(a,2),o=i[0],c=i[1],s=Object(n.useState)({}),u=l()(s,2),d=u[0],f=u[1],p=Object(n.useState)(0),v=l()(p,2),g=v[0],h=v[1],b=Object(n.useState)([1]),E=l()(b,2),y=E[0],k=E[1],N=Object(n.useState)(!1),O=l()(N,2),C=O[0],S=O[1],x=Object(n.useState)({type:void 0,errors:{}}),j=l()(x,2),I=j[0],w=j[1],T=Object(n.useRef)({}),P=function(e,t,a){k("create"===e?[1]:[1,2,3,4]),w({type:e,detail:a,errors:{}}),f(t),c(!0)},L=function(){Object.values(T.current).forEach((function(e){e.resetFields()})),T.current={},c(!1),h(0),k([])},M=function(e){C?ie.warning("加载中，请稍后重试"):e>g?y[e-1]?T.current[g].validateFields().then((function(){var t=e-1;g<t?T.current[t].validateFields().then((function(){k((function(t){var a=ue()(t);return a[e]=1,a})),h(e)})).catch((function(){h(t)})):(k((function(t){var a=ue()(t);return a[e]=1,a})),h(e))})):ie.warning("请按照顺序填写"):h(e)},z=function(e){var t=[];Object.values(T.current).forEach((function(e,a){var n=e.validateFields().then((function(e){return e})).catch((function(){return Promise.reject(a)}));t.push(n)})),Promise.all(t).then((function(t){var a=Object.assign(Object.assign(Object.assign({},t[1]),t[3]),t[4]);t[1].topics&&(a.topics=t[1].topics.join(", ")),t[2].transforms&&t[2].transforms.split("\n").filter((function(e){return e})).forEach((function(e){var t=e.split("="),n=en()(t),r=n[0],i=n.slice(1);a[r]=i.join("=")})),e({success:{connectClusterId:t[0].connectClusterId,connectorName:a.name,configs:a}})}),(function(t){e({error:t})}))};return Object(n.useImperativeHandle)(t,(function(){return{onOpen:P,onClose:L}})),r.a.createElement(ya.a,{title:"".concat("create"===I.type?"新建":"编辑"," Connector"),className:"operate-connector-drawer",width:800,visible:o,onClose:L,destroyOnClose:!0},I.type&&o&&r.a.createElement(r.a.Fragment,null,r.a.createElement(hl.a,{current:g,labelPlacement:"vertical",onChange:function(e){return M(e)}},Sl.map((function(e){var t=e.title;return r.a.createElement(bl,{key:t,title:t})}))),r.a.createElement("div",{style:{padding:"48px 24px 0px"}},r.a.createElement(kl.Provider,{value:Object.assign(Object.assign({},I),{forms:T})},Sl.map((function(e,t){return Object(n.createElement)(e.content,{visible:t===g,setSubmitLoading:S})}))),g===Sl.length-1&&r.a.createElement(gr.a,{type:"warning",message:r.a.createElement("span",null,"如果你想自定义更多配置，可以点击",r.a.createElement(Ht.a,{type:"link",onClick:function(){z((function(e){if(e.error)ie.warning("校验失败，请检查填写内容"),h(e.error);else{var t="";T.current[0].getFieldValue("connectClusters").some((function(a){a.value===e.success.connectClusterId&&(t=a.label)})),null==d||d.onOpen(I.type,t,e.success.configs),L()}}))}},"JSON 模式"),"继续补充")}),r.a.createElement("div",{className:"steps-action"},g>0&&r.a.createElement(Ht.a,{style:{margin:"0 8px"},onClick:function(){return M(g-1)}},"上一步"),g<Sl.length-1&&r.a.createElement(Ht.a,{type:"primary",loading:C,onClick:function(){return M(g+1)}},"下一步"),g===Sl.length-1&&r.a.createElement(Ht.a,{type:"primary",loading:C,onClick:function(){z((function(t){t.error?(ie.warning("校验失败，请检查填写内容"),h(t.error)):(S(!0),Object.entries(t.success.configs).forEach((function(e){var a=l()(e,2),n=a[0];null===a[1]&&delete t.success.configs[n]})),m.a.put(K.validateConnectorConfig,t.success).then((function(a){var n;if(a)if((null==a?void 0:a.errorCount)>0){var r={};null===(n=null==a?void 0:a.configs)||void 0===n||n.filter((function(e){return 0!==e.value.errors.length})).forEach((function(e){var t=e.value;t.name.includes("transforms.")?r.transforms=(r.transforms||[]).concat(t.errors):r[t.name]=t.errors})),w((function(e){return Object.assign(Object.assign({},e),{errors:r})}));var i=yl(T.current[0].getFieldValue("connectorType")),o=Object.keys(r).filter((function(e){return i.includes(e)})),c=4;o.forEach((function(e){Object.values(El).some((function(t,a){return!!t.includes(e)&&(c>a+1&&(c=a+1),!0)}))})),h(c),S(!1),ie.warning("字段校验失败，请检查")}else"create"===I.type?m.a.post(K.connectorsOperates,t.success).then((function(){ie.success("新建成功"),L(),null==e||e.refresh()})).finally((function(){return S(!1)})):m.a.put(K.updateConnectorConfig,t.success).then((function(){ie.success("编辑成功"),null==e||e.refresh(),L()})).finally((function(){return S(!1)}));else S(!1),ie.error("接口校验出错，请重新提交")}),(function(){return S(!1)})))}))}},"提交")))))})),jl=function(e){return null==e||""===e?"0":e},Il=function(e){var t=e.record,a=(Object(s.useParams)(),Object(s.useLocation)(),Object(n.useState)(!1)),i=l()(a,2),o=i[0],c=i[1],u=Object(n.useState)([]),d=l()(u,2),f=d[0],p=d[1],v=Object(n.useState)({state:ne.UNKNOWN,passed:0,total:0}),g=l()(v,2),h=g[0],b=g[1];return Object(n.useEffect)((function(){c(!0),Promise.all([m.a.post(K.getConnectDetailMetricPoints(t.connectorName,null==t?void 0:t.connectClusterId),["HealthCheckPassed","HealthCheckTotal","HealthState"]).then((function(e){var t,a,n;b({state:null===(t=null==e?void 0:e.metrics)||void 0===t?void 0:t.HealthState,passed:(null===(a=null==e?void 0:e.metrics)||void 0===a?void 0:a.HealthCheckPassed)||0,total:(null===(n=null==e?void 0:e.metrics)||void 0===n?void 0:n.HealthCheckTotal)||0})})),m.a.request(K.getConnectDetailState(t.connectorName,null==t?void 0:t.connectClusterId)).then((function(e){var t=e||{},a=t.type,n=t.aliveTaskCount,i=t.state,o=t.totalTaskCount,c=t.totalWorkerCount,l=[{title:"Type",value:function(){return r.a.createElement(r.a.Fragment,null,r.a.createElement("span",{style:{fontFamily:"HelveticaNeue-Medium",fontSize:32,color:"#212529"}},m.a.firstCharUppercase(a)||"-"))}},{title:"Status",value:function(){return r.a.createElement(r.a.Fragment,null,r.a.createElement("span",{style:{fontFamily:"HelveticaNeue-Medium",fontSize:32,color:pl[i].color}},m.a.firstCharUppercase(i)||"-"))}},{title:function(){return r.a.createElement("div",null,r.a.createElement("span",{style:{display:"inline-block",marginRight:"8px"}},"Tasks"),r.a.createElement(Y.a,{overlayClassName:"rebalance-tooltip",title:"Task运行数/总数"},r.a.createElement(Jc.a,null)))},value:function(){return r.a.createElement("span",null,jl(n),"/",jl(o))}},{title:"Workers",value:jl(c)}];p(l)}))]).finally((function(){c(!1)}))}),[t]),r.a.createElement(fn,{record:t,scene:"connector",healthData:h,cardColumns:f,showCardBg:!1,loading:o})},wl=function(e,t,a,n){return new(a||(a=Promise))((function(r,i){function o(e){try{l(n.next(e))}catch(e){i(e)}}function c(e){try{l(n.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,c)}l((n=n.apply(e,t||[])).next())}))},Tl=m.a.request,Pl=function(e){var t,a,i=e.visible,o=e.setVisible,c=e.record,s=g.a.useGlobalValue(),u=l()(s,1)[0],d=Object(n.useState)(!1),f=l()(d,2),p=f[0],v=f[1],h=Object(n.useState)([]),b=l()(h,2),E=b[0],y=b[1],k=Object(n.useState)(dl),N=l()(k,2),C=N[0],S=N[1],x=function(){return wl(void 0,void 0,void 0,q.a.mark((function e(){var t;return q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==(null===(t=null==u?void 0:u.clusterInfo)||void 0===t?void 0:t.id)){e.next=2;break}return e.abrupt("return");case 2:v(!0),Tl(K.getConnectDetailTasks(c.connectorName,c.connectClusterId)).then((function(e){y(e||[]),v(!1)})).catch((function(e){v(!1)}));case 4:case"end":return e.stop()}}),e)})))},j=m.a.useDebounce((function(e){var t={action:"restart",connectClusterId:null==c?void 0:c.connectClusterId,connectorName:null==c?void 0:c.connectorName,taskId:e};Tl(K.optionTasks(),{method:"PUT",data:t}).then((function(e){null===e?(O.success({message:"任务重试成功"}),x()):O.error({message:"任务重试失败"})}))}),500);return Object(n.useEffect)((function(){i&&c&&x()}),[i]),r.a.createElement(ya.a,{title:r.a.createElement("span",null,r.a.createElement("span",{style:{fontSize:"18px",fontFamily:"PingFangSC-Semibold",color:"#495057"}},null!==(t=c.connectorName)&&void 0!==t?t:"-")),width:1080,placement:"right",onClose:function(){o(!1),S(dl)},visible:i,className:"".concat("connect-detail","-drawer"),destroyOnClose:!0,maskClosable:!1},r.a.createElement(Il,{record:c}),r.a.createElement("div",{className:"".concat("connect-detail","-drawer-title")},"Tasks"),r.a.createElement(In.a,{key:"connector-detail-table",showQueryForm:!1,tableProps:{showHeader:!1,rowKey:"taskId",loading:p,columns:(a={retryOption:j},[{title:"Task ID",dataIndex:"taskId",key:"taskId",width:240,render:function(e,t){var a,n;return r.a.createElement("span",null,e,r.a.createElement(pn.a,{style:{background:null===(a=pl[null==t?void 0:t.state])||void 0===a?void 0:a.bgColor,color:null===(n=pl[null==t?void 0:t.state])||void 0===n?void 0:n.color,padding:"3px 6px",marginLeft:"5px"}},m.a.firstCharUppercase(null==t?void 0:t.state)))}},{title:"Worker",dataIndex:"workerId",key:"workerId",width:240},{title:"错误原因",dataIndex:"trace",key:"trace",width:400,needTooltip:!0,lineClampOne:!0},{title:"操作",dataIndex:"role",key:"role",width:100,render:function(e,t){return r.a.createElement("div",null,r.a.createElement(ul.a,{title:"是否重试当前任务？",onConfirm:function(){return null==a?void 0:a.retryOption(t.taskId)},okText:"是",cancelText:"否",overlayClassName:"connect-popconfirm"},r.a.createElement("a",null,"重试")))}}]),dataSource:E,paginationProps:Object.assign({},C),attrs:{onChange:function(e,t,a){S(e)},bordered:!1}}}))},Ll=Object(n.forwardRef)((function(e,t){var a=Object(s.useParams)().clusterId,i=Object(n.useState)(!1),o=l()(i,2),c=o[0],u=o[1],d=J.a.useForm(),f=l()(d,1)[0],p=Object(n.useState)("create"),v=l()(p,2),g=v[0],h=v[1],b=Object(n.useState)([]),E=l()(b,2),y=E[0],k=E[1],N=Object(n.useState)({}),O=l()(N,2),C=O[0],S=O[1],x=Object(n.useState)(!1),j=l()(x,2),I=j[0],w=j[1],T=function(){return m.a.request(K.getConnectClusters(a)).then((function(e){k(e.map((function(e){return{label:e.name||"-",value:e.id}})))}))},P=function(e,t,a){a&&(S(Object.assign(Object.assign({},a),{connectClusterName:t})),f.setFieldsValue({configs:JSON.stringify({connectClusterName:t,configs:a},null,2)})),h(e),u(!0)},L=function(){u(!1),f.resetFields()};return Object(n.useEffect)((function(){T()}),[]),Object(n.useImperativeHandle)(t,(function(){return{onOpen:P,onClose:L}})),r.a.createElement(ya.a,{title:"".concat("create"===g?"新建":"编辑"," Connector"),className:"operate-connector-drawer-use-json",width:800,visible:c,onClose:L,maskClosable:!1,extra:r.a.createElement("div",{className:"operate-wrap"},r.a.createElement(la.b,null,r.a.createElement(Ht.a,{size:"small",onClick:L},"取消"),r.a.createElement(Ht.a,{size:"small",type:"primary",onClick:function(){w(!0),f.validateFields().then((function(t){var a=JSON.parse(t.configs);a.connectorName=a.configs.name,a.connectClusterId=y.find((function(e){return e.label===a.connectClusterName})).value,delete a.connectClusterName,Object.entries(a.configs).forEach((function(e){var t=l()(e,2),n=t[0];null===t[1]&&delete a.configs[n]})),m.a.put(K.validateConnectorConfig,a).then((function(t){var n;if(t)if((null==t?void 0:t.errorCount)>0){var r={};null===(n=null==t?void 0:t.configs)||void 0===n||n.filter((function(e){return 0!==e.value.errors.length})).forEach((function(e){var t=e.value;t.name.includes("transforms.")?r.transforms=(r.transforms||[]).concat(t.errors):r[t.name]=t.errors})),f.setFields([{name:"configs",errors:Object.entries(r).map((function(e){var t=l()(e,2),a=t[0],n=t[1];return"".concat(a,": ").concat(n.join("; "),"\n")}))}]),w(!1)}else"create"===g?m.a.post(K.connectorsOperates,a).then((function(){ie.success("新建成功"),L(),null==e||e.refresh()})).finally((function(){return w(!1)})):m.a.put(K.updateConnectorConfig,a).then((function(){ie.success("编辑成功"),null==e||e.refresh(),L()})).finally((function(){return w(!1)}));else w(!1),X.b.error("接口校验出错，请重新提交")}),(function(){return w(!1)}))}),(function(){return w(!1)}))},loading:I},"确定"),r.a.createElement($.a,{type:"vertical"})))},r.a.createElement(J.a,{form:f,layout:"vertical"},r.a.createElement(J.a.Item,{name:"configs",validateTrigger:"onBlur",rules:[{validator:function(e,t){if(!t)return Promise.reject("配置不能为空");try{var a=JSON.parse(t);if("object"!==ga()(a))return Promise.reject("输入内容必须为 JSON");var n=-1;if(!a.connectClusterName)return Promise.reject("内容缺少 connectClusterName 字段或字段内容为空");if("edit"===g){if(a.connectClusterName!==C.connectClusterName)return Promise.reject("编辑模式下不允许修改 connectClusterName 字段")}else{if(!y.length)return T(),Promise.reject("connectClusterName 列表获取失败，请重试");var r=y.find((function(e){return e.label===a.connectClusterName}));if(!r)return Promise.reject("connectClusterName 不存在，请检查");n=r.value}return a.configs&&"object"===ga()(a.configs)?a.configs.name?"edit"===g&&a.configs.name!==C.name?Promise.reject("编辑模式下不允许修改 name 字段"):a.configs["connector.class"]?"edit"===g&&a.configs["connector.class"]!==C["connector.class"]?Promise.reject("编辑模式下不允许修改 connector.class 字段"):"create"===g?Promise.all([m.a.request(K.isConnectorExist(n,a.configs.name)),m.a.request(K.getConnectorPlugins(n))]).then((function(e){var t=l()(e,2),n=t[0],r=t[1];return(null==n?void 0:n.exist)?Promise.reject("name 与已有 Connector 重复"):r.every((function(e){return e.className!==a.configs["connector.class"]}))?Promise.reject("该 connectCluster 下不存在 connector.class 项配置的插件"):Promise.resolve()}),(function(){return Promise.reject("接口校验出错，请重试")})):Promise.resolve():Promise.reject("configs 字段下缺少 connector.class 项"):Promise.reject("configs 字段下缺少 name 项"):Promise.reject("内容缺少 configs 字段或字段格式错误")}catch(e){return Promise.reject("输入内容必须为 JSON")}}}]},c&&r.a.createElement("div",null,r.a.createElement(Ia,{resize:!0,defaultInput:f.getFieldValue("configs"),placeholder:'配置格式如下\n\n{\n  "connectClusterName": "",  // Connect Cluster 名称\n  "configs": {  // 具体配置项\n    "name": "",\n    "connector.class": "",\n    "tasks.max": 1,\n    ...\n  }\n}',onBeforeChange:function(e){f.setFieldsValue({configs:e})}})))))})),Ml=function(e,t,a,n){return new(a||(a=Promise))((function(r,i){function o(e){try{l(n.next(e))}catch(e){i(e)}}function c(e){try{l(n.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,c)}l((n=n.apply(e,t||[])).next())}))},zl=m.a.request,Dl={readRate:["SinkRecordReadRate","SourceRecordPollRate"],writeRate:["SinkRecordSendRate","SourceRecordWriteRate"],recordErrors:["TotalRecordErrors"]},Rl=function(){var e,t,a,i,o=g.a.useGlobalValue(),c=l()(o,1)[0],s=Object(n.useState)(!1),u=l()(s,2),d=u[0],f=u[1],v=Object(n.useState)(!1),b=l()(v,2),E=b[0],y=b[1],k=Object(n.useState)([]),N=l()(k,2),C=N[0],S=N[1],x=Object(n.useState)(""),j=l()(x,2),I=j[0],w=j[1],T=Object(n.useState)(dl),P=l()(T,2),L=P[0],M=P[1],z=Object(n.useState)({}),D=l()(z,2),R=D[0],F=D[1],B=Object(n.useState)(""),H=l()(B,2),A=H[0],V=H[1],_=Object(n.useState)(!0),U=l()(_,2),G=U[0],J=U[1],W=Object(n.useRef)(null),Z=Object(n.useRef)(null),Q=function(e){var t=e.pageNo,a=e.pageSize,n=(e.filters,e.sorter);return Ml(void 0,void 0,void 0,q.a.mark((function e(){var r,i,o,s,u,m,d;return q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=[Date.now()-864e5,Date.now()],s=l()(o,2),u=s[0],m=s[1],void 0!==(null===(r=null==c?void 0:c.clusterInfo)||void 0===r?void 0:r.id)){e.next=3;break}return e.abrupt("return");case 3:f(!0),d={metricLines:{aggType:"avg",endTime:m,metricsNames:["SourceRecordPollRate","SourceRecordWriteRate","SinkRecordReadRate","SinkRecordSendRate","TotalRecordErrors"],startTime:u,topNu:0},searchKeywords:I.slice(0,128),pageNo:t,pageSize:a,latestMetricNames:["SourceRecordPollRate","SourceRecordWriteRate","SinkRecordReadRate","SinkRecordSendRate","TotalRecordErrors"],sortType:(null==n?void 0:n.order)?n.order.substring(0,n.order.indexOf("end")):"desc",sortMetricNameList:Dl[null==n?void 0:n.field]||[]},zl(K.getConnectorsList(null===(i=null==c?void 0:c.clusterInfo)||void 0===i?void 0:i.id),{method:"POST",data:d}).then((function(e){var t,a,n;M({current:null===(t=e.pagination)||void 0===t?void 0:t.pageNo,pageSize:null===(a=e.pagination)||void 0===a?void 0:a.pageSize,total:null===(n=e.pagination)||void 0===n?void 0:n.total});var r=(null==e?void 0:e.bizData.map((function(e){var t;return Object.assign(Object.assign(Object.assign({},e),null===(t=null==e?void 0:e.latestMetrics)||void 0===t?void 0:t.metrics),{key:e.connectClusterName+e.connectorName})})))||[];S(r),f(!1)})).catch((function(e){f(!1)}));case 6:case"end":return e.stop()}}),e)})))},$=r.a.createElement(p.a,{className:""},r.a.createElement(p.a.Item,null,r.a.createElement("span",{onClick:function(){var e;return null===(e=Z.current)||void 0===e?void 0:e.onOpen("create")}},"JSON 新增Connector")));return Object(n.useEffect)((function(){Q({pageNo:1,pageSize:L.pageSize,sorter:R})}),[I]),r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"breadcrumb",style:{marginBottom:"10px"}},r.a.createElement(Gn.a,{breadcrumbs:[{label:"多集群管理",aHref:"/"},{label:null===(e=null==c?void 0:c.clusterInfo)||void 0===e?void 0:e.name,aHref:"/cluster/".concat(null===(t=null==c?void 0:c.clusterInfo)||void 0===t?void 0:t.id)},{label:"Connect",aHref:"/cluster/".concat(null===(a=null==c?void 0:c.clusterInfo)||void 0===a?void 0:a.id,"/connect")},{label:"Connectors",aHref:""}]})),r.a.createElement(ol,null,r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{style:{margin:"12px 0"}},r.a.createElement(Zc,{state:G})),r.a.createElement("div",{className:"custom-table-content"},r.a.createElement("div",{className:ke},r.a.createElement("div",{className:"".concat(ke,"-left")},r.a.createElement("div",{className:"".concat(ke,"-left-refresh"),onClick:function(){return Q({pageNo:L.current,pageSize:L.pageSize})}},r.a.createElement(h.a,{className:"".concat(ke,"-left-refresh-icon"),type:"icon-shuaxin1"}))),r.a.createElement("div",{className:"".concat(ke,"-right")},r.a.createElement(Jn.a,{onSearch:w,attrs:{placeholder:"请输入Connector",style:{width:"248px",borderRiadus:"8px"},maxLength:128}}),r.a.createElement("span",{className:"add-connect"},r.a.createElement(Ht.a,{className:"add-connect-btn",icon:r.a.createElement(h.a,{type:"icon-jiahao"}),type:"primary",onClick:function(){var e;return null===(e=W.current)||void 0===e?void 0:e.onOpen("create",Z.current)}},"新增Connector"),r.a.createElement(vr.a,{overlayClassName:"add-connect-dropdown-menu",overlay:$},r.a.createElement(Ht.a,{className:"add-connect-json",type:"primary"},r.a.createElement(h.a,{type:"icon-guanwangxiala"})))))),r.a.createElement(In.a,{key:"connector-table",showQueryForm:!1,tableProps:{showHeader:!1,rowKey:"key",loading:d,columns:(i={getDetailInfo:function(e){V(e),y(!0)},deleteTesk:function(){Q({pageNo:1,pageSize:L.pageSize})},optionConnect:function(e,t){var a={action:t,connectClusterId:null==e?void 0:e.connectClusterId,connectorName:null==e?void 0:e.connectorName};zl(K.connectorsOperates,{method:"PUT",data:a}).then((function(e){null===e?(O.success({message:"任务已".concat(fl[a.action]),description:"任务状态更新会有至多1min延迟"}),Q({pageNo:L.current,pageSize:L.pageSize,sorter:R}),J(!G)):O.error({message:"".concat(fl[a.action],"任务失败")})}))},editConnector:function(e){var t;null===(t=W.current)||void 0===t||t.onOpen("edit",Z.current,e)}},[{title:"Connector Name",dataIndex:"connectorName",key:"connectorName",width:160,fixed:"left",lineClampOne:!0,render:function(e,t){return e?r.a.createElement(r.a.Fragment,null,r.a.createElement(Y.a,{placement:"bottom",title:e},r.a.createElement("a",{onClick:function(){i.getDetailInfo(t)}},e))):"-"}},{title:"Connect集群",dataIndex:"connectClusterName",key:"connectClusterName",width:200,lineClampOne:!0,needTooltip:!0},{title:"State",dataIndex:"state",key:"state",width:120,render:function(e,t){var a,n,i;return e?r.a.createElement(pn.a,{style:{background:null===(a=pl[e])||void 0===a?void 0:a.bgColor,color:null===(n=pl[e])||void 0===n?void 0:n.color,padding:"3px 6px"}},null===(i=pl[e])||void 0===i?void 0:i.name):"-"}},{title:"Class",dataIndex:"connectorClassName",key:"connectorClassName",width:150,lineClampOne:!0,needTooltip:!0},{title:"Type",dataIndex:"connectorType",key:"connectorType",width:100,render:function(e,t){return m.a.firstCharUppercase(e)}},{title:"Tasks",dataIndex:"taskCount",key:"taskCount",width:100},{title:"消息读取速率(KB/s)",dataIndex:"readRate",key:"readRate",sorter:!0,width:170,render:function(e,t){return gl(t,"SINK"===t.connectorType?"SinkRecordReadRate":"SourceRecordPollRate")}},{title:"消息写入速率(KB/s)",dataIndex:"writeRate",key:"writeRate",sorter:!0,width:170,render:function(e,t){return gl(t,"SINK"===t.connectorType?"SinkRecordSendRate":"SourceRecordWriteRate")}},{title:"消息处理错误次数(次)",dataIndex:"recordErrors",key:"recordErrors",sorter:!0,width:170,render:function(e,t){return gl(t,"TotalRecordErrors")}},{title:"Topics",dataIndex:"topicNameList",key:"topicNameList",width:200,render:function(e,t){return e&&e.length>0?r.a.createElement($a,{placement:"bottom",list:e,expandTagContent:function(e){return"共有".concat(e,"个")}}):"-"}},{title:"操作",dataIndex:"options",key:"options",width:200,filterTitle:!0,fixed:"right",render:function(e,t){return r.a.createElement("div",null,r.a.createElement(ul.a,{title:"是否重启当前任务？",onConfirm:function(){return null==i?void 0:i.optionConnect(t,"restart")},okText:"是",cancelText:"否",overlayClassName:"connect-popconfirm"},r.a.createElement(Ht.a,{key:"restart",type:"link",size:"small"},"重启")),("RUNNING"===t.state||"PAUSED"===t.state)&&r.a.createElement(ul.a,{title:"是否".concat("RUNNING"===t.state?"暂停":"继续","当前任务？"),onConfirm:function(){return null==i?void 0:i.optionConnect(t,"RUNNING"===t.state?"stop":"resume")},okText:"是",cancelText:"否",overlayClassName:"connect-popconfirm"},r.a.createElement(Ht.a,{key:"stopResume",type:"link",size:"small"},"RUNNING"===t.state?"暂停":"继续")),r.a.createElement(Ht.a,{type:"link",size:"small",onClick:function(){return null==i?void 0:i.editConnector(t)}},"编辑"),r.a.createElement(ml,{record:t,onConfirm:null==i?void 0:i.deleteTesk}))}}]),dataSource:C,paginationProps:Object.assign({},L),attrs:{onChange:function(e,t,a){F(a),Q({pageNo:e.current,pageSize:e.pageSize,filters:t,sorter:a})},scroll:{x:"max-content",y:"calc(100vh - 400px)"},bordered:!1}}})))),r.a.createElement(Pl,{visible:E,setVisible:y,record:A}),r.a.createElement(xl,{ref:W,refresh:function(){return Q({pageNo:L.current,pageSize:L.pageSize,sorter:R})}}),r.a.createElement(Ll,{ref:Z,refresh:function(){return Q({pageNo:L.current,pageSize:L.pageSize,sorter:R})}}))},Fl=function(e,t,a,n){return new(a||(a=Promise))((function(r,i){function o(e){try{l(n.next(e))}catch(e){i(e)}}function c(e){try{l(n.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,c)}l((n=n.apply(e,t||[])).next())}))},Bl=m.a.request,Hl=function(){var e,t,a,i=g.a.useGlobalValue(),o=l()(i,1)[0],c=Object(n.useState)(!1),s=l()(c,2),u=s[0],m=s[1],d=Object(n.useState)([]),f=l()(d,2),p=f[0],v=f[1],b=Object(n.useState)(""),E=l()(b,2),y=E[0],k=E[1],N=Object(n.useState)(dl),O=l()(N,2),C=O[0],S=O[1],x=function(e){var t=e.pageNo,a=e.pageSize;e.filters,e.sorter;return Fl(void 0,void 0,void 0,q.a.mark((function e(){var n,r,i;return q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==(null===(n=null==o?void 0:o.clusterInfo)||void 0===n?void 0:n.id)){e.next=2;break}return e.abrupt("return");case 2:m(!0),i={searchKeywords:y.slice(0,128),pageNo:t,pageSize:a},Bl(K.getWorkersList(null===(r=null==o?void 0:o.clusterInfo)||void 0===r?void 0:r.id),{params:i}).then((function(e){var t,a,n;S({current:null===(t=e.pagination)||void 0===t?void 0:t.pageNo,pageSize:null===(a=e.pagination)||void 0===a?void 0:a.pageSize,total:null===(n=e.pagination)||void 0===n?void 0:n.total}),v((null==e?void 0:e.bizData)||[]),m(!1)})).catch((function(e){m(!1)}));case 5:case"end":return e.stop()}}),e)})))};return Object(n.useEffect)((function(){x({pageNo:1,pageSize:C.pageSize})}),[y]),r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"breadcrumb",style:{marginBottom:"10px"}},r.a.createElement(Gn.a,{breadcrumbs:[{label:"多集群管理",aHref:"/"},{label:null===(e=null==o?void 0:o.clusterInfo)||void 0===e?void 0:e.name,aHref:"/cluster/".concat(null===(t=null==o?void 0:o.clusterInfo)||void 0===t?void 0:t.id)},{label:"Connect",aHref:"/cluster/".concat(null===(a=null==o?void 0:o.clusterInfo)||void 0===a?void 0:a.id,"/connect")},{label:"Workers",aHref:""}]})),r.a.createElement(ol,null,r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{style:{margin:"12px 0"}},r.a.createElement(Zc,null)),r.a.createElement("div",{className:"custom-table-content"},r.a.createElement("div",{className:ke},r.a.createElement("div",{className:"".concat(ke,"-left")},r.a.createElement("div",{className:"".concat(ke,"-left-refresh"),onClick:function(){return x({pageNo:C.current,pageSize:C.pageSize})}},r.a.createElement(h.a,{className:"".concat(ke,"-left-refresh-icon"),type:"icon-shuaxin1"}))),r.a.createElement("div",{className:"".concat(ke,"-right")},r.a.createElement(Jn.a,{onSearch:k,attrs:{placeholder:"请输入Host",style:{width:"248px",borderRiadus:"8px"},maxLength:128}}))),r.a.createElement(In.a,{key:"workers-table",showQueryForm:!1,tableProps:{showHeader:!1,rowKey:"workers_list",loading:u,columns:[{title:"Worker Host",dataIndex:"workerHost",key:"workerHost",width:200},{title:"所属集群",dataIndex:"connectClusterName",key:"connectClusterName",width:200},{title:"Connectors",dataIndex:"connectorCount",key:"connectorCount",width:200},{title:"Tasks",dataIndex:"taskCount",key:"taskCount",width:200}],dataSource:p,paginationProps:Object.assign({},C),attrs:{onChange:function(e,t,a){x({pageNo:e.current,pageSize:e.pageSize,filters:t,sorter:a})},scroll:{y:"calc(100vh - 400px)"},bordered:!1}}})))))},Al=function(e){var t=e.record,a=e.onConfirm,i=J.a.useForm(),o=l()(i,1)[0],c=Object(n.useState)(!1),s=l()(c,2),u=s[0],f=s[1];return r.a.createElement(r.a.Fragment,null,r.a.createElement(Ht.a,{type:"link",size:"small",onClick:function(e){f(!0)}},"删除"),r.a.createElement(d.a,{className:"custom-modal",title:"确定删除此 MM2 任务吗？",centered:!0,visible:u,wrapClassName:"del-connect-modal",destroyOnClose:!0,maskClosable:!1,onOk:function(){o.validateFields().then((function(e){var n=o.getFieldsValue();n.connectClusterId=Number(t.connectClusterId),m.a.delete(K.mirrorMakerOperates,{data:n}).then((function(e){null===e?(O.success({message:"删除成功"}),f(!1),a&&a()):O.error({message:"删除失败"})}))}))},onCancel:function(e){f(!1)},okText:"删除",okButtonProps:{danger:!0,size:"small",style:{paddingLeft:"16px",paddingRight:"16px"}},cancelButtonProps:{size:"small",style:{paddingLeft:"16px",paddingRight:"16px"}}},r.a.createElement(J.a,{form:o,labelCol:{span:6},wrapperCol:{span:16},style:{marginTop:17}},r.a.createElement(J.a.Item,{label:"MM2 Name"},t.connectorName),r.a.createElement(J.a.Item,{name:"connectorName",label:"MM2 Name",rules:[function(){return{validator:function(e,a){return a?a!==t.connectorName?Promise.reject(new Error("请输入正确的MM2 Name名称")):Promise.resolve():Promise.reject(new Error("请输入MM2 Name名称"))}}}]},r.a.createElement(W.a,{placeholder:"请输入",size:"small"})))))},Vl={current:1,pageSize:10,position:"bottomRight",showSizeChanger:!0,pageSizeOptions:["10","20","50","100","200","500"]},Kl=(Ol={},H()(Ol,"stop","暂停"),H()(Ol,"restart","重启"),H()(Ol,"resume","继续"),Ol),_l=(Cl={},H()(Cl,"UNASSIGNED",{name:"Unassigned",color:"#556EE6",bgColor:"#EBEEFA"}),H()(Cl,"RUNNING",{name:"Running",color:"#00C0A2",bgColor:"rgba(0,192,162,0.10)"}),H()(Cl,"PAUSED",{name:"Paused",color:"#495057",bgColor:"#ECECF6"}),H()(Cl,"FAILED",{name:"Failed",color:"#F58342",bgColor:"#fef3e5"}),H()(Cl,"DESTROYED",{name:"Destroyed",color:"#FF7066",bgColor:"#fdefee"}),H()(Cl,"RESTARTING",{name:"Restarting",color:"#3991FF",bgColor:"#e9f5ff"}),Cl),Ul=function(e,t){var a,n,r=null===(n=null===(a=null==e?void 0:e.latestMetrics)||void 0===a?void 0:a.metrics)||void 0===n?void 0:n[t];return void 0!==r?"TotalRecordErrors"===t?Math.round(r).toLocaleString():Number(m.a.formatAssignSize(r,"KB",r>1e3?2:3)).toLocaleString():"-"},Gl=function(e,t){var a,n,i=(null===(n=null===(a=e.metricLines)||void 0===a?void 0:a.find((function(e){return e.metricName===t})))||void 0===n?void 0:n.metricPoints)||[];return i.length?r.a.createElement("div",{className:"metric-data-wrap"},r.a.createElement(Et,{width:"100%",height:30,chartData:{name:e.metricName,data:i.map((function(e){return{time:e.timeStamp,value:e.value}}))}}),r.a.createElement("span",{className:"cur-val"},Ul(e,t))):r.a.createElement("span",{className:"cur-val"},Ul(e,t))},ql=function(e){var t=g.a.useGlobalValue(),a=l()(t,1)[0],n=[{title:"MM2 Name",dataIndex:"connectorName",key:"connectorName",width:160,fixed:"left",lineClampOne:!0,render:function(t,a){return t?r.a.createElement(r.a.Fragment,null,r.a.createElement(Y.a,{placement:"bottom",title:t},r.a.createElement("a",{onClick:function(){e.getDetailInfo(a)}},t))):"-"}},{title:"Connect集群",dataIndex:"connectClusterName",key:"connectClusterName",width:200,lineClampOne:!0,needTooltip:!0},{title:"State",dataIndex:"state",key:"state",width:120,render:function(e,t){var a,n,i;return e?r.a.createElement(pn.a,{style:{background:null===(a=_l[e])||void 0===a?void 0:a.bgColor,color:null===(n=_l[e])||void 0===n?void 0:n.color,padding:"3px 6px"}},null===(i=_l[e])||void 0===i?void 0:i.name):"-"}},{title:r.a.createElement("span",null,"集群（源"," ",r.a.createElement("span",null,r.a.createElement(h.a,{type:"icon-jiantou"}))," ","目标）"),dataIndex:"destKafkaClusterName",key:"destKafkaClusterName",width:200,render:function(e,t){return t.sourceKafkaClusterName&&t.destKafkaClusterName?r.a.createElement("span",null,r.a.createElement("span",null,t.sourceKafkaClusterName," "),r.a.createElement(h.a,{type:"icon-jiantou"}),r.a.createElement("span",null," ",e)):"-"}},{title:"Tasks",dataIndex:"taskCount",key:"taskCount",width:100},{title:"复制流量速率",dataIndex:"byteRate",key:"byteRate",sorter:!0,width:170,render:function(e,t){return Gl(t,"ByteRate")}},{title:"消息复制速率",dataIndex:"recordRate",key:"recordRate",sorter:!0,width:170,render:function(e,t){return Gl(t,"RecordRate")}},{title:"最大延迟",dataIndex:"replicationLatencyMsMax",key:"replicationLatencyMsMax",sorter:!0,width:170,render:function(e,t){return Gl(t,"ReplicationLatencyMsMax")}}];return a.hasPermission&&n.push({title:"操作",dataIndex:"options",key:"options",width:200,filterTitle:!0,fixed:"right",render:function(t,n){return r.a.createElement("div",null,a.hasPermission(V.MM2_STOP_RESUME)&&("RUNNING"===n.state||"PAUSED"===n.state)&&r.a.createElement(ul.a,{title:"是否".concat("RUNNING"===n.state?"暂停":"继续","当前任务？"),onConfirm:function(){return null==e?void 0:e.optionConnect(n,"RUNNING"===n.state?"stop":"resume")},okText:"是",cancelText:"否",overlayClassName:"connect-popconfirm"},r.a.createElement(Ht.a,{key:"stopResume",type:"link",size:"small"},"RUNNING"===n.state?"暂停":"继续")),a.hasPermission(V.MM2_RESTART)?r.a.createElement(ul.a,{title:"是否重启当前任务？",onConfirm:function(){return null==e?void 0:e.optionConnect(n,"restart")},okText:"是",cancelText:"否",overlayClassName:"connect-popconfirm"},r.a.createElement(Ht.a,{key:"restart",type:"link",size:"small"},"重启")):r.a.createElement(r.a.Fragment,null),a.hasPermission(V.MM2_CHANGE_CONFIG)?n.sourceKafkaClusterId?r.a.createElement(Ht.a,{type:"link",size:"small",onClick:function(){return null==e?void 0:e.editConnector(n)}},"编辑"):r.a.createElement(Y.a,{title:"非本平台创建的任务无法编辑"},r.a.createElement(Ht.a,{type:"link",disabled:!0,size:"small"},"编辑")):r.a.createElement(r.a.Fragment,null),a.hasPermission(V.MM2_DELETE)?r.a.createElement(Al,{record:n,onConfirm:null==e?void 0:e.deleteTesk}):r.a.createElement(r.a.Fragment,null))}}),n},Jl=function(e){return null==e||""===e?"0":e},Wl=function(e){var t=e.state,a=Object(s.useParams)().clusterId,i=Object(n.useState)(!1),o=l()(i,2),c=o[0],u=o[1],d=Object(n.useState)([]),f=l()(d,2),p=f[0],v=f[1],g=Object(n.useState)({state:ne.UNKNOWN,passed:0,total:0}),h=l()(g,2),b=h[0],E=h[1];return Object(n.useEffect)((function(){u(!0),Promise.all([m.a.post(K.getMetricPointsLatest(Number(a)),["HealthCheckPassed_MirrorMaker","HealthCheckTotal_MirrorMaker","HealthState_MirrorMaker"]).then((function(e){var t,a,n;E({state:null===(t=null==e?void 0:e.metrics)||void 0===t?void 0:t.HealthState_MirrorMaker,passed:(null===(a=null==e?void 0:e.metrics)||void 0===a?void 0:a.HealthCheckPassed_MirrorMaker)||0,total:(null===(n=null==e?void 0:e.metrics)||void 0===n?void 0:n.HealthCheckTotal_MirrorMaker)||0})})),m.a.request(K.getMirrorMakerState(a)).then((function(e){var t=e||{},a=t.mirrorMakerCount,n=t.aliveConnectorCount,i=t.aliveTaskCount,o=t.totalConnectorCount,c=t.totalTaskCount,l=t.workerCount,s=[{title:"MM2s",value:Jl(a),customStyle:{marginLeft:0}},{title:"Workers",value:Jl(l)},{title:function(){return r.a.createElement("div",null,r.a.createElement("span",{style:{display:"inline-block",marginRight:"8px"}},"Connectors"),r.a.createElement(Y.a,{overlayClassName:"rebalance-tooltip",title:"conector运行数/总数"},r.a.createElement(Jc.a,null)))},value:function(){return r.a.createElement("span",null,Jl(n),"/",Jl(o))}},{title:function(){return r.a.createElement("div",null,r.a.createElement("span",{style:{display:"inline-block",marginRight:"8px"}},"Tasks"),r.a.createElement(Y.a,{overlayClassName:"rebalance-tooltip",title:"Task运行数/总数"},r.a.createElement(Jc.a,null)))},value:function(){return r.a.createElement("span",null,Jl(i),"/",Jl(c))}}];v(s)}))]).finally((function(){u(!1)}))}),[a,t]),r.a.createElement(fn,{scene:"mm2",healthData:b,cardColumns:p,loading:c})},Zl=function(e,t,a,n){return new(a||(a=Promise))((function(r,i){function o(e){try{l(n.next(e))}catch(e){i(e)}}function c(e){try{l(n.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,c)}l((n=n.apply(e,t||[])).next())}))},Yl=hl.a.Step,Ql={sourceConfigs:["sync.topic.configs.enabled","sync.topic.configs.interval.seconds","sync.topic.acls.enabled","sync.topic.acls.interval.seconds","refresh.topics.enabled","refresh.topics.interval.seconds","refresh.groups.enabled","refresh.groups.interval.seconds","replication.policy.separator","replication.policy.class","topics"],checkpointConfig:["emit.checkpoints.enabled","emit.checkpoints.interval.seconds","checkpoints.topic.replication.factor"],heartbeatConfig:["heartbeats.topic.replication.factor","emit.heartbeats.interval.seconds"]},$l=Object(n.createContext)({type:"create",errors:{},forms:{current:{}}});function Xl(e){var t=Object(n.useContext)($l).forms,a=J.a.useForm(),r=l()(a,1)[0];return t.current[e]?r=t.current[e]:t.current[e]=r,[r]}var es=[{title:"步骤一",content:function(e){var t=Object(s.useParams)().clusterId,a=Xl(0),i=l()(a,1)[0],o=Object(n.useState)([]),c=l()(o,2),u=c[0],d=c[1],f=Object(n.useState)(!1),p=l()(f,2),v=p[0],g=p[1],b=Object(n.useState)(t),E=l()(b,2),y=E[0],k=E[1],N=Object(n.useContext)($l),O=N.type,C=N.detail,S=N.setSourceKafkaClusterId,x=N.setBootstrapServers,j=N.setSourceDetailConfigs,I=N.setCheckoutPointDetailConfigs,w="edit"===O,T=Object(n.useState)(!1),P=l()(T,2),L=P[0],M=P[1],z=Object(n.useState)([]),D=l()(z,2),R=D[0],F=D[1],B=Object(n.useState)([]),H=l()(B,2),A=H[0],V=H[1],_=Object(n.useState)([]),U=l()(_,2),G=U[0],q=U[1],Z=Object(n.useState)([]),Y=l()(Z,2),$=Y[0],X=Y[1],ee=Object(n.useState)([]),te=l()(ee,2),ae=te[0],ne=te[1],re=Object(n.useState)({}),ie=l()(re,2),oe=ie[0],ce=ie[1],le=Object(n.useState)(null),se=l()(le,2),ue=se[0],me=se[1],de=function(e){F(e)},fe=function(t){Promise.all([m.a.request(K.getConnectorPluginConfig(t,"org.apache.kafka.connect.mirror.MirrorSourceConnector")),m.a.request(K.getConnectorPluginConfig(t,"org.apache.kafka.connect.mirror.MirrorCheckpointConnector")),w?m.a.request(K.getMirrorMakerConfig(t,C.connectorName)):void 0].filter((function(e){return e}))).then((function(e){var t,a,n=w&&e.length>1?null==e?void 0:e[2]:[];null==n||n.forEach((function(e){"org.apache.kafka.connect.mirror.MirrorCheckpointConnector"===e["connector.class"]?(a=e,I(e)):"org.apache.kafka.connect.mirror.MirrorSourceConnector"===e["connector.class"]&&(t=e,j(e),k(t["source.cluster.alias"]))}));var r={},i=[];null==e||e[0].configs.forEach((function(e){var a=e.definition;Ql.sourceConfigs.includes(a.name)&&(w&&t[a.name]?"topics"===a.name?(r[a.name]=R||t[a.name],".*"===t[a.name]&&R.length<1?i.push({name:"priority",value:"allTopic"}):(i.push({name:"topics",value:R.length>0?R:t[a.name].split(",")},{name:"priority",value:"givenTopic"}),R.length<1&&F(t[a.name].split(",")))):(r[a.name]=t[a.name],i.push({name:a.name,value:t[a.name]||null})):"topics"===a.name?(r.topics=R||a.defaultValue.split(","),".*"===a.defaultValue&&R.length<1?i.push({name:"priority",value:"allTopic"}):i.push({name:"topics",value:R||a.defaultValue},{name:"priority",value:"givenTopic"})):(r[a.name]=a.defaultValue,i.push({name:a.name,value:a.defaultValue||null})))})),null==e||e[1].configs.forEach((function(e){var t=e.definition;Ql.checkpointConfig.includes(t.name)&&(w&&a[t.name]?(r[t.name]=a[t.name],i.push({name:t.name,value:a[t.name]||null})):(r[t.name]=t.defaultValue,i.push({name:t.name,value:t.defaultValue||null})))})),ce(r),ne(i)})).finally((function(){return e.setSubmitLoading(!1)}))};Object(n.useEffect)((function(){m.a.request(K.getConnectClusters(t)).then((function(e){var t=e.map((function(e){return{label:e.name||"-",value:e.id}}));V(t)})),m.a.request(K.getSourceKafkaClusterBasic).then((function(e){X(e||[]);var a=e.filter((function(e){return e.id!==+t})).map((function(e){return{label:e.name||"-",value:e.id}}));q(a)}))}),[]),Object(n.useEffect)((function(){!function(e){g(!0),m.a.request(K.getTopicMetaList(Number(e))).then((function(e){var t=(e||[]).map((function(e){return Object.assign(Object.assign({},e),{key:e.topicName,label:e.topicName,value:e.topicName,title:e.topicName})}));d(t)})).finally((function(){g(!1)}))}(y)}),[y]),Object(n.useEffect)((function(){i.resetFields(Ql.sourceConfigs),i.setFields(ae)}),[ae]),Object(n.useEffect)((function(){var e,t=$.length&&(null===(e=$.find((function(e){return e.id===ue})))||void 0===e?void 0:e.bootstrapServers);x(t)}),[ue]),Object(n.useEffect)((function(){i.setFieldsValue({topics:R})}),[R]),Object(n.useEffect)((function(){w&&fe(C.connectClusterId);var e=w?C:{"sync.topic.configs.enabled":!1,"sync.topic.configs.interval.seconds":0,"sync.topic.acls.enabled":!1,"sync.topic.acls.interval.seconds":600,"refresh.topics.enabled":!1,"refresh.topics.interval.seconds":600,"refresh.groups.enabled":!1,"refresh.groups.interval.seconds":600,"emit.checkpoints.enabled":!1,"emit.checkpoints.interval.seconds":60,"checkpoints.topic.replication.factor":!1,"replication.policy.separator":"."};i.setFieldsValue(e),ce((function(t){return Object.assign(Object.assign({},t),e)}))}),[w,C]);return r.a.createElement("div",{style:{display:e.visible?"block":"none"}},r.a.createElement(J.a,{form:i,layout:"vertical"},r.a.createElement(J.a.Item,{name:"name",label:"MM2任务名称",validateTrigger:"onBlur",initialValue:null==C?void 0:C.connectorName,rules:[{required:!0,validator:function(e,t){return w?Promise.resolve():t?(null==t?void 0:t.length)>64?Promise.reject("MM2任务名称长度限制在1～64字符"):new RegExp(Na).test(t)?Promise.resolve():Promise.reject("MM2 名称支持中英文、数字、特殊字符 ! # $ % & ' ( ) * + , - . / : ; < = > ? @ [  ] ^ _ ` { | } ~"):Promise.reject("MM2任务名称不能为空")}}]},r.a.createElement(W.a,{placeholder:"请输入 MM2 名称",disabled:w})),r.a.createElement(J.a.Item,{name:"sourceKafkaClusterId",label:"Source Kafka 集群",tooltip:"Converter class used to convert between Kafka Connect format and the serialized form that is written to Kafka. This controls the format of the keys in messages written to or read from Kafka, and since this is independent of connectors it allows any connector to work with any serialization format. Examples of common formats include JSON and Avro.",rules:[{required:!0}]},r.a.createElement(oa.a,{placeholder:"请选择 Source Kafka 集群",options:G,showSearch:!0,filterOption:function(e,t){var a;return(null!==(a=null==t?void 0:t.label)&&void 0!==a?a:"").toLowerCase().includes(e.toLowerCase())},onChange:function(e,t){me(e),S(null==t?void 0:t.value),k(null==t?void 0:t.value)}})),r.a.createElement(J.a.Item,{label:"选择Topic",name:"priority",initialValue:"allTopic",rules:[{required:!0}]},r.a.createElement(ba.a.Group,null,r.a.createElement(ba.a,{value:"allTopic"},"应用于所有Topic"),r.a.createElement(ba.a,{value:"givenTopic"},"应用于特定Topic"))),r.a.createElement(J.a.Item,{className:"clear-topic-minHeight",dependencies:["priority"],style:{marginBottom:0,minHeight:0}},(function(e){return"givenTopic"===(0,e.getFieldValue)("priority")?r.a.createElement(J.a.Item,{name:"topics",label:"",rules:[{required:!1,message:"请选择!"}]},r.a.createElement(Q.a,{spinning:v},r.a.createElement(Mi.a,{dataSource:u,titles:["待选Topic","已选Topic"],customHeader:!0,showSelectedCount:!0,locale:{itemUnit:"",itemsUnit:""},showSearch:!0,filterOption:function(e,t){return t.topicName.indexOf(e)>-1},targetKeys:R,onChange:de,render:function(e){return e.title},suffix:r.a.createElement(h.a,{type:"icon-fangdajing"})}))):null})),r.a.createElement(J.a.Item,{name:"connectClusterId",label:"Connect 集群",tooltip:"Converter class used to convert between Kafka Connect format and the serialized form that is written to Kafka. This controls the format of the keys in messages written to or read from Kafka, and since this is independent of connectors it allows any connector to work with any serialization format. Examples of common formats include JSON and Avro.",rules:[{required:!0}]},r.a.createElement(oa.a,{onChange:function(e){e&&fe(e)},allowClear:!0,placeholder:"请选择 Connect 集群",options:A})),!L&&r.a.createElement("div",{className:"add-mm2-config-title",onClick:function(){return M(!0)}},r.a.createElement("span",{className:"add-mm2-config-title-text"},"高级配置"),r.a.createElement(h.a,{className:"add-mm2-config-title-icon",type:"icon-a-xialaIcon"})),r.a.createElement("div",{style:{display:L?"block":"none"}},r.a.createElement("div",{className:"add-mm2-flex-layout"},r.a.createElement("div",{className:"add-mm2-flex-layout-item"},r.a.createElement(J.a.Item,{className:"senior-config-left",name:"sync.topic.configs.enabled",label:"sync.topic.configs.enabled",tooltip:"whether to replicate topic configurations from the source cluster.",labelAlign:"right",labelCol:{span:19},valuePropName:"checked"},r.a.createElement(pr.a,{size:"small",onChange:function(e){return ce((function(t){return Object.assign(Object.assign({},t),{"sync.topic.configs.enabled":e})}))}})),oe["sync.topic.configs.enabled"]?r.a.createElement(J.a.Item,{name:"sync.topic.configs.interval.seconds",label:"sync.topic.configs.interval.seconds",labelAlign:"right",labelCol:{span:17}},r.a.createElement(Ft.a,{defaultValue:600,size:"small",min:1,max:99999})):null),r.a.createElement("div",{className:"add-mm2-flex-layout-item"},r.a.createElement(J.a.Item,{className:"senior-config-left",name:"sync.topic.acls.enabled",label:"sync.topic.acls.enabled",tooltip:"whether to sync ACLs from the source cluster.",labelAlign:"right",labelCol:{span:19},valuePropName:"checked"},r.a.createElement(pr.a,{size:"small",onChange:function(e){return ce((function(t){return Object.assign(Object.assign({},t),{"sync.topic.acls.enabled":e})}))}})),oe["sync.topic.acls.enabled"]?r.a.createElement(J.a.Item,{name:"sync.topic.acls.interval.seconds",label:"sync.topic.acls.interval.seconds",labelAlign:"right",labelCol:{span:17}},r.a.createElement(Ft.a,{defaultValue:600,size:"small",min:1,max:99999})):null),r.a.createElement("div",{className:"add-mm2-flex-layout-item"},r.a.createElement(J.a.Item,{className:"senior-config-left",name:"refresh.topics.enabled",label:"refresh.topics.enabled",tooltip:"whether to check for new topics in the source cluster periodically.",labelAlign:"right",labelCol:{span:19},valuePropName:"checked"},r.a.createElement(pr.a,{size:"small",onChange:function(e){return ce((function(t){return Object.assign(Object.assign({},t),{"refresh.topics.enabled":e})}))}})),oe["refresh.topics.enabled"]?r.a.createElement(J.a.Item,{name:"refresh.topics.interval.seconds",label:"refresh.topics.interval.seconds",tooltip:"frequency of checking for new topics in the source cluster; lower values than the default may lead to performance degradation",labelAlign:"right",labelCol:{span:17}},r.a.createElement(Ft.a,{defaultValue:600,size:"small",min:1,max:99999})):null),r.a.createElement("div",{className:"add-mm2-flex-layout-item"},r.a.createElement(J.a.Item,{className:"senior-config-left",name:"refresh.groups.enabled",label:"refresh.groups.enabled",tooltip:"whether to check for new consumer groups in the source cluster periodically.",labelAlign:"right",labelCol:{span:19},valuePropName:"checked"},r.a.createElement(pr.a,{size:"small",onChange:function(e){return ce((function(t){return Object.assign(Object.assign({},t),{"refresh.groups.enabled":e})}))}})),oe["refresh.groups.enabled"]?r.a.createElement(J.a.Item,{name:"refresh.groups.interval.seconds",label:"refresh.groups.interval.seconds",tooltip:"frequency of checking for new consumer groups in the source cluster; lower values than the default may lead to performance degradation",labelAlign:"right",labelCol:{span:17}},r.a.createElement(Ft.a,{defaultValue:600,size:"small",min:1,max:99999})):null),r.a.createElement("div",{className:"add-mm2-flex-layout-item"},r.a.createElement(J.a.Item,{className:"senior-config-left",name:"emit.checkpoints.enabled",label:"emit.checkpoints.enabled",tooltip:"whether to emit MirrorMaker's consumer offsets periodically.",labelAlign:"right",labelCol:{span:19},valuePropName:"checked"},r.a.createElement(pr.a,{size:"small",onChange:function(e){return ce((function(t){return Object.assign(Object.assign({},t),{"emit.checkpoints.enabled":e})}))}})),oe["emit.checkpoints.enabled"]?r.a.createElement("div",null,r.a.createElement(J.a.Item,{name:"emit.checkpoints.interval.seconds",label:"emit.checkpoints.interval.seconds",tooltip:"frequency at which checkpoints are emitted",labelAlign:"right",labelCol:{span:17}},r.a.createElement(Ft.a,{defaultValue:60,size:"small",min:1,max:99999})),r.a.createElement(J.a.Item,{name:"checkpoints.topic.replication.factor",label:"checkpoints.topic.replication.factor",tooltip:"replication factor of MirrorMaker's internal checkpoints topics",labelAlign:"right",labelCol:{span:17}},r.a.createElement(Ft.a,{defaultValue:3,size:"small",min:1,max:99999}))):null)),r.a.createElement(J.a.Item,{name:"replication.policy.class",label:"replication.policy.class",tooltip:"Behavior for tolerating errors during connector operation. 'none' is the default value and signals that any error will result in an immediate connector task failure; 'all' changes the behavior to skip over problematic records."},r.a.createElement(oa.a,{options:[{value:"org.apache.kafka.connect.mirror.DefaultReplicationPolicy",label:"org.apache.kafka.connect.mirror.DefaultReplicationPolicy"},{value:"org.apache.kafka.connect.mirror.IdentityReplicationPolicy",label:"org.apache.kafka.connect.mirror.IdentityReplicationPolicy"}]})),r.a.createElement(J.a.Item,{name:"replication.policy.separator",label:"replication.policy.separator",rules:[{required:!1}],normalize:function(e){return e||null}},r.a.createElement(W.a,{defaultValue:".",placeholder:"请输入 Key converter class"}))),L&&r.a.createElement("div",{className:"add-mm2-config-title",onClick:function(){return M(!1)}},r.a.createElement("span",{className:"add-mm2-config-title-text"},"收起"),r.a.createElement(h.a,{type:"icon-a-xialaIcon"}))))}},{title:"步骤二",content:function(e){var t=Object(s.useParams)().clusterId,a=Xl(1),i=l()(a,1)[0],o=Xl(0),c=l()(o,1)[0].getFieldValue("connectClusterId"),u=Object(n.useState)([]),d=l()(u,2),f=(d[0],d[1],Object(n.useContext)($l)),p=f.type,v=f.detail,g=(f.errors,f.setHeartbeatDetailConfigs),h="edit"===p,b=Object(n.useState)(!1),E=l()(b,2),y=E[0],k=E[1],N=Object(n.useState)(!0),O=l()(N,2),C=(O[0],O[1],Object(n.useState)(!1)),S=l()(C,2),x=S[0],j=S[1],I=Object(n.useState)([]),w=l()(I,2),T=w[0],P=w[1],L=Object(n.useState)([]),M=l()(L,2),z=M[0],D=M[1],R=Object(n.useState)({}),F=l()(R,2),B=F[0],H=F[1];return Object(n.useEffect)((function(){i.resetFields(Ql.sourceConfigs),i.setFields(z)}),[z]),Object(n.useEffect)((function(){c?function(e){Zl(void 0,void 0,void 0,q.a.mark((function t(){var a,n,r,i,o;return q.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a={},n=[],t.next=4,m.a.request(K.getConnectorPluginConfig(e,"org.apache.kafka.connect.mirror.MirrorHeartbeatConnector"));case 4:if(r=t.sent,!h){t.next=11;break}return t.next=8,m.a.request(K.getMirrorMakerConfig(e,v.connectorName));case 8:t.t0=t.sent,t.next=12;break;case 11:t.t0=void 0;case 12:null==(i=t.t0)||i.forEach((function(e){"org.apache.kafka.connect.mirror.MirrorCheckpointConnector"===e["connector.class"]&&(o=e,g(e))})),null==r||r.configs.forEach((function(e){var t=e.definition;Ql.heartbeatConfig.includes(t.name)&&(h&&o[t.name]?(a[t.name]=o[t.name],n.push({name:t.name,value:o[t.name]||null})):(a[t.name]=t.defaultValue,n.push({name:t.name,value:t.defaultValue||null})))})),(a["heartbeats.topic.replication.factor"]||a["emit.heartbeats.interval.seconds"])&&(a.heartbeat=!0,n.push({name:"heartbeat",value:!0})),H(a),D(n);case 18:case"end":return t.stop()}}),t)})))}(c):i.setFieldsValue({groupOffset:!1,heartbeat:!0,"offset-syncs.topic.replication.factor":3,"sync.group.offsets.interval.seconds":60,"heartbeats.topic.replication.factor":3,"emit.heartbeats.interval.seconds":1})}),[c]),Object(n.useEffect)((function(){y&&(j(!0),m.a.request(K.getGroupBasic(t)).then((function(e){P(e||[])})).finally((function(){j(!1)})))}),[y]),r.a.createElement("div",{style:{display:e.visible?"block":"none"}},r.a.createElement(J.a,{form:i,layout:"horizontal",colon:!1},r.a.createElement(J.a.Item,{className:"custom-form-item-36",name:"groupOffset",label:"是否同步 Group Offset",tooltip:"whether to check for new consumer groups in the source cluster periodically.",valuePropName:"checked"},r.a.createElement(pr.a,{onChange:function(e){return k(e)},size:"small"})),y&&r.a.createElement("div",{className:"custom-form-item-27"},r.a.createElement(J.a.Item,{name:"offset-syncs.topic.replication.factor",label:"offset-syncs.topic.replication.factor"},r.a.createElement(Ft.a,{min:1,max:99999,size:"small"})),r.a.createElement(J.a.Item,{name:"sync.group.offsets.interval.seconds",label:"sync.group.offsets.interval.seconds"},r.a.createElement(Ft.a,{min:1,max:99999,size:"small"})),r.a.createElement(Wa.a,{className:"group-offset-table",rowKey:"key",pagination:!1,columns:[{title:"ConsumerGroup",dataIndex:"groupName",key:"groupName",width:200,lineClampOne:!0,needTooltip:!0},{title:"Topic",dataIndex:"topicName",key:"topicName",width:200,lineClampOne:!0,needTooltip:!0},{title:"状态",dataIndex:"state",key:"state",width:60,lineClampOne:!0,needTooltip:!0}],dataSource:T,loading:x})),r.a.createElement(J.a.Item,{className:"custom-form-item-36",name:"heartbeat",label:"是否开启心跳",tooltip:"whether to check for new consumer groups in the source cluster periodically.",valuePropName:"checked"},r.a.createElement(pr.a,{onChange:function(e){return H((function(t){return Object.assign(Object.assign({},t),{heartbeat:e})}))},size:"small"})),B.heartbeat?r.a.createElement("div",{className:"custom-form-item-27"},r.a.createElement(J.a.Item,{name:"heartbeats.topic.replication.factor",label:"heartbeats.topic.replication.factor",labelCol:{span:9}},r.a.createElement(Ft.a,{min:1,max:99999,size:"small"})),r.a.createElement(J.a.Item,{name:"emit.heartbeats.interval.seconds",label:"emit.heartbeats.interval.seconds",labelCol:{span:9}},r.a.createElement(Ft.a,{min:1,max:99999,size:"small"}))):null))}}],ts=Object(n.forwardRef)((function(e,t){var a=Object(n.useState)(!1),i=l()(a,2),o=i[0],c=i[1],s=Object(n.useState)({}),u=l()(s,2),d=u[0],f=u[1],p=Object(n.useState)(0),v=l()(p,2),g=v[0],h=v[1],b=Object(n.useState)([1]),E=l()(b,2),y=E[0],k=E[1],N=Object(n.useState)(!1),O=l()(N,2),C=O[0],S=O[1],x=Object(n.useState)({type:void 0,errors:{}}),j=l()(x,2),I=j[0],w=j[1],T=Object(n.useRef)({}),P=Object(n.useState)(""),L=l()(P,2),M=L[0],z=L[1],D=Object(n.useState)(null),R=l()(D,2),F=R[0],B=R[1],H=Object(n.useState)({}),A=l()(H,2),V=A[0],_=A[1],U=Object(n.useState)({}),G=l()(U,2),q=G[0],J=G[1],W=Object(n.useState)({}),Z=l()(W,2),Y=Z[0],Q=Z[1],$=function(e,t,a){k("create"===e?[1]:[1,2,3,4]),w({type:e,detail:a,errors:{}}),f(t),c(!0)},X=function(){Object.values(T.current).forEach((function(e){e.resetFields()})),T.current={},c(!1),h(0),k([])},ee=function(e){C?ie.warning("加载中，请稍后重试"):e>g?y[e-1]?T.current[g].validateFields().then((function(){var t=e-1;g<t?T.current[t].validateFields().then((function(){k((function(t){var a=ue()(t);return a[e]=1,a})),h(e)})).catch((function(){h(t)})):(k((function(t){var a=ue()(t);return a[e]=1,a})),h(e))})):ie.warning("请按照顺序填写"):h(e)},te=function(e){var t=[];Object.values(T.current).forEach((function(e,a){var n=e.validateFields().then((function(e){return e})).catch((function(){return Promise.reject(a)}));t.push(n)})),Promise.all(t).then((function(t){var a=Object.assign(Object.assign({},t[0]),t[1]),n=I.detail,r=a["emit.checkpoints.enabled"]&&Object.assign(Object.assign({},q),{"connector.class":"org.apache.kafka.connect.mirror.MirrorCheckpointConnector","emit.checkpoints.enabled":a["emit.checkpoints.enabled"],"emit.checkpoints.interval.seconds":a["emit.checkpoints.interval.seconds"],"checkpoints.topic.replication.factor":a["checkpoints.topic.replication.factor"],"source.cluster.alias":M||t[0].sourceKafkaClusterId,name:(null==n?void 0:n.checkpointConnector)||a.name,"source.cluster.bootstrap.servers":F||(null==q?void 0:q["source.cluster.bootstrap.servers"])}),i=a.heartbeat&&Object.assign(Object.assign({},Y),{"connector.class":"org.apache.kafka.connect.mirror.MirrorHeartbeatConnector","heartbeats.topic.replication.factor":a["heartbeats.topic.replication.factor"],"emit.heartbeats.interval.seconds":a["emit.heartbeats.interval.seconds"],"source.cluster.alias":M||t[0].sourceKafkaClusterId,name:(null==n?void 0:n.heartbeatConnector)||a.name,"source.cluster.bootstrap.servers":F||(null==Y?void 0:Y["source.cluster.bootstrap.servers"])}),o=Object.assign(Object.assign({},V),{"connector.class":"org.apache.kafka.connect.mirror.MirrorSourceConnector","sync.topic.configs.enabled":a["sync.topic.configs.enabled"],"sync.topic.configs.interval.seconds":a["sync.topic.configs.interval.seconds"],"sync.topic.acls.enabled":a["sync.topic.acls.enabled"],"sync.topic.acls.interval.seconds":a["sync.topic.acls.interval.seconds"],"refresh.topics.enabled":a["refresh.topics.enabled"],"refresh.topics.interval.seconds":a["refresh.topics.interval.seconds"],"refresh.groups.enabled":a["refresh.groups.enabled"],"refresh.groups.interval.seconds":a["refresh.groups.interval.seconds"],"replication.policy.class":a["replication.policy.class"],"replication.policy.separator":a["replication.policy.separator"],topics:"givenTopic"===a.priority?a.topics.join():".*","source.cluster.alias":M||t[0].sourceKafkaClusterId,name:a.name,"source.cluster.bootstrap.servers":F||(null==V?void 0:V["source.cluster.bootstrap.servers"])});e({success:{connectClusterId:t[0].connectClusterId,connectorName:a.name,sourceKafkaClusterId:t[0].sourceKafkaClusterId,configs:o,heartbeatConnectorConfigs:i||void 0,checkpointConnectorConfigs:r||void 0}})}),(function(t){e({error:t})}))};return Object(n.useImperativeHandle)(t,(function(){return{onOpen:$,onClose:X}})),r.a.createElement(ya.a,{title:"".concat("create"===I.type?"新增":"编辑"," MM2"),className:"operate-connector-drawer",width:700,visible:o,onClose:X,destroyOnClose:!0},I.type&&o&&r.a.createElement(r.a.Fragment,null,r.a.createElement(hl.a,{className:"mirror-maker-steps",current:g,labelPlacement:"vertical",onChange:function(e){return ee(e)}},es.map((function(e){var t=e.title;return r.a.createElement(Yl,{key:t,title:t})}))),r.a.createElement("div",{style:{padding:"48px 18px 0px"}},r.a.createElement($l.Provider,{value:Object.assign(Object.assign({},I),{forms:T,setSourceKafkaClusterId:z,setBootstrapServers:B,setSourceDetailConfigs:_,setCheckoutPointDetailConfigs:J,setHeartbeatDetailConfigs:Q})},es.map((function(e,t){return Object(n.createElement)(e.content,{visible:t===g,setSubmitLoading:S})}))),g===es.length-1&&r.a.createElement(gr.a,{type:"warning",message:r.a.createElement("span",null,"如果你想自定义更多配置，可以点击",r.a.createElement(Ht.a,{type:"link",onClick:function(){te((function(e){e.error?(ie.warning("校验失败，请检查填写内容"),h(e.error)):(null==d||d.onOpen(I.type,e.success),X())}))}},"JSON 模式"),"继续补充")}),r.a.createElement("div",{className:"steps-action"},g>0&&r.a.createElement(Ht.a,{style:{margin:"0 8px"},onClick:function(){return ee(g-1)}},"上一步"),g<es.length-1&&r.a.createElement(Ht.a,{type:"primary",loading:C,onClick:function(){return ee(g+1)}},"下一步"),g===es.length-1&&r.a.createElement(Ht.a,{type:"primary",loading:C,onClick:function(){te((function(t){t.error?(ie.warning("校验失败，请检查填写内容"),h(t.error)):(S(!0),Object.entries(t.success).forEach((function(e){var a=l()(e,2),n=a[0];null===a[1]&&delete t.success[n]})),m.a.put(K.validateMM2Config,t.success).then((function(a){var n;if(a)if((null==a?void 0:a.errorCount)>0){var r={};null===(n=null==a?void 0:a.configs)||void 0===n||n.filter((function(e){return 0!==e.value.errors.length})).forEach((function(e){var t=e.value;t.name.includes("transforms.")?r.transforms=(r.transforms||[]).concat(t.errors):r[t.name]=t.errors})),w((function(e){return Object.assign(Object.assign({},e),{errors:r})})),S(!1),ie.warning("字段校验失败，请检查")}else"create"===I.type?m.a.post(K.mirrorMakerOperates,t.success).then((function(){ie.success("新建成功"),X(),null==e||e.refresh()})).finally((function(){return S(!1)})):m.a.put(K.updateMM2Config,t.success).then((function(){ie.success("编辑成功"),null==e||e.refresh(),X()})).finally((function(){return S(!1)}));else S(!1),ie.error("接口校验出错，请重新提交")}),(function(){return S(!1)})))}))}},"提交")))))})),as=function(e){return null==e||""===e?"0":e},ns=function(e){var t=e.record,a=e.tabSelectType,i=(Object(s.useParams)(),Object(s.useLocation)(),Object(n.useState)(!1)),o=l()(i,2),c=o[0],u=o[1],d=Object(n.useState)([]),f=l()(d,2),p=f[0],v=f[1],g=Object(n.useState)({state:ne.UNKNOWN,passed:0,total:0}),h=l()(g,2),b=h[0],E=h[1],y=function(e){return m.a.request(K.getConnectDetailState(e,null==t?void 0:t.connectClusterId)).then((function(e){var t=e||{},a=(t.type,t.aliveTaskCount),n=t.state,i=t.totalTaskCount,o=t.totalWorkerCount,c=[{title:"Status",value:function(){return r.a.createElement(r.a.Fragment,null,r.a.createElement("span",{style:{fontFamily:"HelveticaNeue-Medium",fontSize:32,color:pl[n].color}},m.a.firstCharUppercase(n)||"-"))}},{title:function(){return r.a.createElement("div",null,r.a.createElement("span",{style:{display:"inline-block",marginRight:"8px"}},"Tasks"),r.a.createElement(Y.a,{overlayClassName:"rebalance-tooltip",title:"Task运行数/总数"},r.a.createElement(Jc.a,null)))},value:function(){return r.a.createElement("span",null,as(a),"/",as(i))}},{title:"Workers",value:as(o)}];v(c)}))};return Object(n.useEffect)((function(){u(!0);var e,n="MirrorCheckpoint"===a&&t.checkpointConnector?y(t.checkpointConnector):"MirrorHeatbeat"===a&&t.heartbeatConnector?y(t.heartbeatConnector):"MirrorSource"===a&&t.connectorName?y(t.connectorName):void v([{title:"Status",value:function(){return r.a.createElement("span",null,"-")}},{title:function(){return r.a.createElement("div",null,r.a.createElement("span",{style:{display:"inline-block",marginRight:"8px"}},"Tasks"),r.a.createElement(Y.a,{overlayClassName:"rebalance-tooltip",title:"Task运行数/总数"},r.a.createElement(Jc.a,null)))},value:function(){return r.a.createElement("span",null,"-/-")}},{title:"Workers",value:function(){return r.a.createElement("span",null,"-")}}]);Promise.all([(e=t.connectorName,m.a.post(K.getMirrorMakerMetricPoints(e,null==t?void 0:t.connectClusterId),["HealthState","HealthCheckPassed","HealthCheckTotal"]).then((function(e){var t,a,n;E({state:null===(t=null==e?void 0:e.metrics)||void 0===t?void 0:t.HealthState,passed:(null===(a=null==e?void 0:e.metrics)||void 0===a?void 0:a.HealthCheckPassed)||0,total:(null===(n=null==e?void 0:e.metrics)||void 0===n?void 0:n.HealthCheckTotal)||0})}))),n]).finally((function(){u(!1)}))}),[t,a]),r.a.createElement(fn,{record:t,scene:"mm2",healthData:b,cardColumns:p,showCardBg:!1,loading:c})},rs=function(e,t,a,n){return new(a||(a=Promise))((function(r,i){function o(e){try{l(n.next(e))}catch(e){i(e)}}function c(e){try{l(n.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,c)}l((n=n.apply(e,t||[])).next())}))},is=ka.a.TabPane,os=m.a.request,cs=function(e){var t,a=e.loading,i=e.retryOption,o=e.data,c=Object(n.useState)(Vl),s=l()(c,2),u=s[0],d=s[1];return r.a.createElement(Q.a,{spinning:a},o.length?r.a.createElement(In.a,{key:"mm2-detail-table",showQueryForm:!1,tableProps:{showHeader:!1,rowKey:"taskId",columns:(t={retryOption:i},[{title:"Task ID",dataIndex:"taskId",key:"taskId",width:240,render:function(e,t){var a,n;return r.a.createElement("span",null,e,r.a.createElement(pn.a,{style:{background:null===(a=_l[null==t?void 0:t.state])||void 0===a?void 0:a.bgColor,color:null===(n=_l[null==t?void 0:t.state])||void 0===n?void 0:n.color,padding:"3px 6px",marginLeft:"5px"}},m.a.firstCharUppercase(null==t?void 0:t.state)))}},{title:"Worker",dataIndex:"workerId",key:"workerId",width:240},{title:"错误原因",dataIndex:"trace",key:"trace",width:400,needTooltip:!0,lineClampOne:!0},{title:"操作",dataIndex:"role",key:"role",width:100,render:function(e,a){return r.a.createElement("div",null,r.a.createElement(ul.a,{title:"是否重试当前任务？",onConfirm:function(){return null==t?void 0:t.retryOption(a.taskId)},okText:"是",cancelText:"否",overlayClassName:"connect-popconfirm"},r.a.createElement("a",null,"重试")))}}]),dataSource:o,paginationProps:Object.assign({},u),attrs:{onChange:function(e,t,a){d(e)},bordered:!1}}}):r.a.createElement(Ea.a,{description:"暂无数据",image:Ea.a.PRESENTED_IMAGE_CUSTOM,style:{padding:"100px 0"}}))},ls=function(e){var t,a=e.visible,i=e.setVisible,o=e.record,c=g.a.useGlobalValue(),s=l()(c,1)[0],u=Object(n.useState)(!1),m=l()(u,2),d=m[0],f=m[1],p=Object(n.useState)([]),v=l()(p,2),h=v[0],b=v[1],E=Object(n.useState)("MirrorSource"),y=l()(E,2),k=y[0],N=y[1],C={MirrorSource:function(){return rs(void 0,void 0,void 0,q.a.mark((function e(){var t;return q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==(null===(t=null==s?void 0:s.clusterInfo)||void 0===t?void 0:t.id)){e.next=2;break}return e.abrupt("return");case 2:b([]),f(!0),o.connectorName?os(K.getConnectDetailTasks(o.connectorName,o.connectClusterId)).then((function(e){b(e||[]),f(!1)})).catch((function(e){f(!1)})):f(!1);case 5:case"end":return e.stop()}}),e)})))},MirrorCheckpoint:function(){return rs(void 0,void 0,void 0,q.a.mark((function e(){var t;return q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==(null===(t=null==s?void 0:s.clusterInfo)||void 0===t?void 0:t.id)){e.next=2;break}return e.abrupt("return");case 2:b([]),f(!0),o.checkpointConnector?os(K.getConnectDetailTasks(o.checkpointConnector,o.connectClusterId)).then((function(e){b(e||[]),f(!1)})).catch((function(e){f(!1)})):f(!1);case 5:case"end":return e.stop()}}),e)})))},MirrorHeatbeat:function(){return rs(void 0,void 0,void 0,q.a.mark((function e(){var t;return q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==(null===(t=null==s?void 0:s.clusterInfo)||void 0===t?void 0:t.id)){e.next=2;break}return e.abrupt("return");case 2:b([]),f(!0),o.heartbeatConnector?os(K.getConnectDetailTasks(o.heartbeatConnector,o.connectClusterId)).then((function(e){b(e||[]),f(!1)})).catch((function(e){f(!1)})):f(!1);case 5:case"end":return e.stop()}}),e)})))}},S=function(e){var t={action:"restart",connectClusterId:null==o?void 0:o.connectClusterId,connectorName:null==o?void 0:o.connectorName,taskId:e};os(K.optionTasks(),{method:"PUT",data:t}).then((function(e){null===e?(O.success({message:"任务重试成功"}),C[k]()):O.error({message:"任务重试失败"})}))};return Object(n.useEffect)((function(){a&&o&&C[k]()}),[a,k]),r.a.createElement(ya.a,{title:r.a.createElement("span",null,r.a.createElement("span",{style:{fontSize:"18px",fontFamily:"PingFangSC-Semibold",color:"#495057"}},null!==(t=o.connectorName)&&void 0!==t?t:"-")),width:1080,placement:"right",onClose:function(){i(!1),N("MirrorSource")},visible:a,className:"".concat("mm2-detail","-drawer"),destroyOnClose:!0,maskClosable:!1},r.a.createElement(ns,{record:o,tabSelectType:k}),r.a.createElement(ka.a,{className:"custom_tabs_class",defaultActiveKey:"Configuration",onChange:function(e){N(e)},destroyInactiveTabPane:!0},r.a.createElement(is,{tab:"MirrorSource",key:"MirrorSource"},r.a.createElement(cs,{loading:d,retryOption:S,data:h})),r.a.createElement(is,{tab:"MirrorCheckpoint",key:"MirrorCheckpoint"},r.a.createElement(cs,{loading:d,retryOption:S,data:h})),r.a.createElement(is,{tab:"MirrorHeatbeat",key:"MirrorHeatbeat"},r.a.createElement(cs,{loading:d,retryOption:S,data:h}))))},ss=Object(n.forwardRef)((function(e,t){var a=Object(n.useState)(!1),i=l()(a,2),o=i[0],c=i[1],s=J.a.useForm(),u=l()(s,1)[0],d=Object(n.useState)("create"),f=l()(d,2),p=f[0],v=f[1],g=Object(n.useState)({}),h=l()(g,2),b=h[0],E=h[1],y=Object(n.useState)(!1),k=l()(y,2),N=k[0],O=k[1],C=function(e,t){t&&(E(Object.assign({},t)),u.setFieldsValue({configs:JSON.stringify(t,null,2)})),v(e),c(!0)},S=function(){c(!1),u.resetFields()};return Object(n.useImperativeHandle)(t,(function(){return{onOpen:C,onClose:S}})),r.a.createElement(ya.a,{title:"".concat("create"===p?"新增":"编辑"," MM2"),className:"operate-connector-drawer-use-json",width:800,visible:o,onClose:S,maskClosable:!1,extra:r.a.createElement("div",{className:"operate-wrap"},r.a.createElement(la.b,null,r.a.createElement(Ht.a,{size:"small",onClick:S},"取消"),r.a.createElement(Ht.a,{size:"small",type:"primary",onClick:function(){O(!0),u.validateFields().then((function(t){var a=JSON.parse(t.configs);Object.entries(a.configs).forEach((function(e){var t=l()(e,2),n=t[0];null===t[1]&&delete a.configs[n]})),m.a.put(K.validateMM2Config,a).then((function(t){var n;if(t)if((null==t?void 0:t.errorCount)>0){var r={};null===(n=null==t?void 0:t.configs)||void 0===n||n.filter((function(e){return 0!==e.value.errors.length})).forEach((function(e){var t=e.value;t.name.includes("transforms.")?r.transforms=(r.transforms||[]).concat(t.errors):r[t.name]=t.errors})),u.setFields([{name:"configs",errors:Object.entries(r).map((function(e){var t=l()(e,2),a=t[0],n=t[1];return"".concat(a,": ").concat(n.join("; "),"\n")}))}]),O(!1)}else"create"===p?m.a.post(K.mirrorMakerOperates,a).then((function(){ie.success("新建成功"),S(),null==e||e.refresh()})).finally((function(){return O(!1)})):m.a.put(K.updateMM2Config,a).then((function(){ie.success("编辑成功"),null==e||e.refresh(),S()})).finally((function(){return O(!1)}));else O(!1),X.b.error("接口校验出错，请重新提交")}),(function(){return O(!1)}))}),(function(){return O(!1)}))},loading:N},"确定"),r.a.createElement($.a,{type:"vertical"})))},r.a.createElement(J.a,{form:u,layout:"vertical"},r.a.createElement(J.a.Item,{name:"configs",validateTrigger:"onBlur",rules:[{validator:function(e,t){if(!t)return Promise.reject("配置不能为空");try{var a=JSON.parse(t);return"object"!==ga()(a)?Promise.reject("输入内容必须为 JSON"):a.connectorName?"edit"===p&&a.connectorName!==b.connectorName?Promise.reject("编辑模式下不允许修改 MM2任务名称 字段"):a.connectClusterId?a.sourceKafkaClusterId?a.configs&&"object"===ga()(a.configs)?a.configs.topics?Promise.resolve():Promise.reject("configs 字段下缺少 topics 项"):Promise.reject("内容缺少 configs 字段或字段格式错误"):Promise.reject("内容缺少 sourceKafkaClusterId 字段或字段内容为空"):Promise.reject("内容缺少 connectClusterId 字段或字段内容为空"):Promise.reject("内容缺少 MM2任务名称 字段或字段内容为空")}catch(e){return Promise.reject("输入内容必须为 JSON")}}}]},o&&r.a.createElement("div",null,r.a.createElement(Ia,{resize:!0,defaultInput:u.getFieldValue("configs"),placeholder:'配置格式如下\n\n{\n  "connectClusterId": 1, // ConnectID\n  "connectorName": "", // MM2 名称\n  "sourceKafkaClusterId": 1, // SourceKafka集群 ID\n  "configs": { // Source 相关配置\n    "name": "", // MM2 名称\n    "source.cluster.alias": "", // SourceKafka集群 ID\n    ...\n  },\n  "heartbeatConnectorConfigs": {  // Heartbeat 相关配置\n    "name": "", // Heartbeat 对应的Connector名称\n    "source.cluster.alias": "", // SourceKafka集群 ID\n    ...\n  },\n  "checkpointConnectorConfigs": { // Checkpoint 相关配置\n    "name": "", // Checkpoint 对应的Connector名称\n    "source.cluster.alias": "", // SourceKafka集群 ID\n    ...\n  }\n}',onBeforeChange:function(e){u.setFieldsValue({configs:e})}})))))})),us=function(e,t,a,n){return new(a||(a=Promise))((function(r,i){function o(e){try{l(n.next(e))}catch(e){i(e)}}function c(e){try{l(n.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,c)}l((n=n.apply(e,t||[])).next())}))},ms=m.a.request,ds={byteRate:["ByteRate"],recordRate:["RecordRate"],replicationLatencyMsMax:["ReplicationLatencyMsMax"]},fs=function(){return r.a.createElement("div",{style:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",height:"calc(100vh - 118px)",boxShadow:"0 2px 4px 0 rgba(0,0,0,0.01), 0 3px 6px 3px rgba(0,0,0,0.01), 0 2px 6px 0 rgba(0,0,0,0.03)",borderRadius:12,background:"#fff"}},r.a.createElement("img",{src:rl.a,style:{width:100,height:162}}),r.a.createElement("span",{style:{fontSize:13,color:"#919AAC",paddingTop:16}},"暂无数据，请先创建 MM2 任务"))},ps=function(e){var t=Object(s.useParams)().clusterId,a=Object(n.useState)(!0),i=l()(a,2),o=i[0],c=i[1],u=Object(n.useState)(!0),d=l()(u,2),f=d[0],p=d[1];return Object(n.useLayoutEffect)((function(){m.a.request(K.getMirrorMakerMetadata(t)).then((function(e){(null==e?void 0:e.length)&&p(!1)})).finally((function(){return c(!1)}))}),[]),f?r.a.createElement(Q.a,{spinning:o},o?r.a.createElement("div",{style:{height:"calc(100vh - 118px)"}}):r.a.createElement(fs,null)):e.children},vs=[{path:"/",exact:!0,component:Ua,commonRoute:U,noSider:!0},{path:"/cluster/:clusterId",component:ic,commonRoute:Ja,noSider:!1,children:[{path:"cluster",exact:!0,component:ic,noSider:!1},{path:"broker",exact:!0,component:qn,noSider:!1},{path:"broker/list",exact:!0,component:lr,noSider:!1},{path:"broker/controller-changelog",exact:!0,component:mr,noSider:!1},{path:"topic",exact:!0,component:fr,noSider:!1},{path:"topic/list",exact:!0,component:Vi,noSider:!1},void 0,void 0,{path:"consumers",exact:!0,component:to,noSider:!1},void 0,{path:"operation/jobs",exact:!0,component:_o,noSider:!1},{path:"zookeeper",exact:!0,component:qc,noSider:!1},{path:"zookeeper/servers",exact:!0,component:Gc,noSider:!1},{path:"connect",exact:!0,component:sl,noSider:!1},{path:"connect/connectors",exact:!0,component:Rl,noSider:!1},{path:"connect/workers",exact:!0,component:Hl,noSider:!1},{path:"replication",exact:!0,component:function(){var e,t,a=g.a.useGlobalValue(),n=l()(a,1)[0];return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"breadcrumb",style:{marginBottom:"10px"}},r.a.createElement(Gn.a,{breadcrumbs:[{label:"多集群管理",aHref:"/"},{label:null===(e=null==n?void 0:n.clusterInfo)||void 0===e?void 0:e.name,aHref:"/cluster/".concat(null===(t=null==n?void 0:n.clusterInfo)||void 0===t?void 0:t.id)},{label:"Replication",aHref:""}]})),r.a.createElement(ps,null,r.a.createElement(r.a.Fragment,null,r.a.createElement(Wl,null),r.a.createElement(Un,{type:j.MM2}))))},noSider:!1},{path:"replication/mirror-maker",exact:!0,component:function(){var e,t,a,i=g.a.useGlobalValue(),o=l()(i,1)[0],c=Object(n.useState)(!1),s=l()(c,2),u=s[0],m=s[1],d=Object(n.useState)(!1),f=l()(d,2),v=f[0],b=f[1],E=Object(n.useState)([]),y=l()(E,2),k=y[0],N=y[1],C=Object(n.useState)(""),S=l()(C,2),x=S[0],j=S[1],I=Object(n.useState)(Vl),w=l()(I,2),T=w[0],P=w[1],L=Object(n.useState)({}),M=l()(L,2),z=M[0],D=M[1],R=Object(n.useState)(""),F=l()(R,2),B=F[0],H=F[1],A=Object(n.useState)(!0),_=l()(A,2),U=_[0],G=_[1],J=Object(n.useRef)(null),W=Object(n.useRef)(null),Z=function(e){var t=e.pageNo,a=e.pageSize,n=(e.filters,e.sorter);return us(void 0,void 0,void 0,q.a.mark((function e(){var r,i,c,s,u,d,f;return q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(c=[Date.now()-864e5,Date.now()],s=l()(c,2),u=s[0],d=s[1],void 0!==(null===(r=null==o?void 0:o.clusterInfo)||void 0===r?void 0:r.id)){e.next=3;break}return e.abrupt("return");case 3:m(!0),f={metricLines:{aggType:"avg",endTime:d,metricsNames:["ByteRate","RecordRate","ReplicationLatencyMsMax"],startTime:u,topNu:0},searchKeywords:x.slice(0,128),pageNo:t,pageSize:a,latestMetricNames:["ByteRate","RecordRate","ReplicationLatencyMsMax"],sortType:(null==n?void 0:n.order)?n.order.substring(0,n.order.indexOf("end")):"desc",sortMetricNameList:ds[null==n?void 0:n.field]||[]},ms(K.getMirrorMakerList(null===(i=null==o?void 0:o.clusterInfo)||void 0===i?void 0:i.id),{method:"POST",data:f}).then((function(e){var t,a,n;P({current:null===(t=e.pagination)||void 0===t?void 0:t.pageNo,pageSize:null===(a=e.pagination)||void 0===a?void 0:a.pageSize,total:null===(n=e.pagination)||void 0===n?void 0:n.total});var r=(null==e?void 0:e.bizData.map((function(e){var t;return Object.assign(Object.assign(Object.assign({},e),null===(t=null==e?void 0:e.latestMetrics)||void 0===t?void 0:t.metrics),{key:e.connectClusterName+e.connectorName})})))||[];N(r),m(!1)})).catch((function(e){m(!1)}));case 6:case"end":return e.stop()}}),e)})))},Y=r.a.createElement(p.a,{className:""},r.a.createElement(p.a.Item,null,r.a.createElement("span",{onClick:function(){var e;return null===(e=W.current)||void 0===e?void 0:e.onOpen("create")}},"JSON 新增MM2")));return Object(n.useEffect)((function(){Z({pageNo:1,pageSize:T.pageSize,sorter:z})}),[x]),r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"breadcrumb",style:{marginBottom:"10px"}},r.a.createElement(Gn.a,{breadcrumbs:[{label:"多集群管理",aHref:"/"},{label:null===(e=null==o?void 0:o.clusterInfo)||void 0===e?void 0:e.name,aHref:"/cluster/".concat(null===(t=null==o?void 0:o.clusterInfo)||void 0===t?void 0:t.id)},{label:"Replication",aHref:"/cluster/".concat(null===(a=null==o?void 0:o.clusterInfo)||void 0===a?void 0:a.id,"/replication")},{label:"Mirror Maker",aHref:""}]})),r.a.createElement("div",{style:{margin:"12px 0"}},r.a.createElement(Wl,{state:U})),r.a.createElement("div",{className:"custom-table-content"},r.a.createElement("div",{className:ke},r.a.createElement("div",{className:"".concat(ke,"-left")},r.a.createElement("div",{className:"".concat(ke,"-left-refresh"),onClick:function(){return Z({pageNo:T.current,pageSize:T.pageSize})}},r.a.createElement(h.a,{className:"".concat(ke,"-left-refresh-icon"),type:"icon-shuaxin1"}))),r.a.createElement("div",{className:"".concat(ke,"-right")},r.a.createElement(Jn.a,{onSearch:j,attrs:{placeholder:"请输入MM2 Name",style:{width:"248px",borderRiadus:"8px"},maxLength:128}}),o.hasPermission&&o.hasPermission(V.MM2_ADD)?r.a.createElement("span",{className:"add-connect"},r.a.createElement(Ht.a,{className:"add-connect-btn",icon:r.a.createElement(h.a,{type:"icon-jiahao"}),type:"primary",onClick:function(){var e;return null===(e=J.current)||void 0===e?void 0:e.onOpen("create",W.current)}},"新增MM2"),r.a.createElement(vr.a,{overlayClassName:"add-connect-dropdown-menu",overlay:Y},r.a.createElement(Ht.a,{className:"add-connect-json",type:"primary"},r.a.createElement(h.a,{type:"icon-guanwangxiala"})))):r.a.createElement(r.a.Fragment,null))),r.a.createElement(In.a,{key:"mirror-maker-table",showQueryForm:!1,tableProps:{showHeader:!1,rowKey:"key",loading:u,columns:ql({getDetailInfo:function(e){H(e),b(!0)},deleteTesk:function(){Z({pageNo:1,pageSize:T.pageSize})},optionConnect:function(e,t){m(!0);var a={action:t,connectClusterId:null==e?void 0:e.connectClusterId,connectorName:null==e?void 0:e.connectorName};ms(K.mirrorMakerOperates,{method:"PUT",data:a}).then((function(e){null===e?(O.success({message:"任务已".concat(Kl[a.action]),description:"任务状态更新会有至多1min延迟"}),Z({pageNo:T.current,pageSize:T.pageSize,sorter:z}),G(!U)):O.error({message:"".concat(Kl[a.action],"任务失败")})})).catch((function(e){m(!1)}))},editConnector:function(e){var t;null===(t=J.current)||void 0===t||t.onOpen("edit",W.current,e)}}),dataSource:k,paginationProps:Object.assign({},T),attrs:{onChange:function(e,t,a){D(a),Z({pageNo:e.current,pageSize:e.pageSize,filters:t,sorter:a})},scroll:{x:"max-content",y:"calc(100vh - 400px)"},bordered:!1}}})),r.a.createElement(ls,{visible:v,setVisible:b,record:B}),r.a.createElement(ts,{ref:J,refresh:function(){return Z({pageNo:T.current,pageSize:T.pageSize,sorter:z})}}),r.a.createElement(ss,{ref:W,refresh:function(){return Z({pageNo:T.current,pageSize:T.pageSize,sorter:z})}}))},noSider:!1},{path:"security/acls",exact:!0,component:pc,noSider:!1},{path:"security/users",exact:!0,component:Cc,noSider:!1},{path:"*",component:function(){return gs}}].filter((function(e){return e}))}],gs=r.a.createElement(s.Redirect,{to:"/404"}),hs=function(e){return"/"===e[e.length-1]&&(e=e.substring(0,e.length-1)),e},bs=function(){return r.a.createElement("div",{style:{height:"100%",display:"flex",justifyContent:"center",alignItems:"center"}},r.a.createElement(Q.a,{spinning:!0}))},Es=function(){var e,t=Object(s.useHistory)(),a=Object(s.useLocation)().pathname,i=g.a.useGlobalValue(),o=l()(i,1)[0],c=vs.filter((function(e){return e.noSider}))||[],u=(null===(e=window.location.pathname.split("/"))||void 0===e?void 0:e[1])!==Ct,m=c.findIndex((function(e){return e.path===hs(a)}))>-1,d=Object(n.useState)(!(u||m)),p=l()(d,2),v=p[0],h=p[1],b=Object(n.useState)(St()),E=l()(b,2),y=E[0],k=E[1],N=function(e){var a;e.includes("zookeeper")&&(null===(a=o.clusterInfo)||void 0===a?void 0:a.runState)===Ae.Raft&&t.replace("/404")},C=Object(n.useCallback)((function(e){var t,a=!1;return"string"==typeof e?a=null===(t=o.hasPermission)||void 0===t?void 0:t.call(o,e):e.forEach((function(e){var t;(null===(t=o.hasPermission)||void 0===t?void 0:t.call(o,e))&&(a=!0)})),a}),[o.hasPermission]),S=Object(n.useCallback)((function(e,a){var n=e.includes(":clusterId")&&!o.clusterInfo,i="function"!=typeof o.hasPermission,c="function"!=typeof o.getMetricDefine;return n||i||c?Promise.reject(r.a.createElement(bs,null)):a?o.hasPermission(a)?(N(e),Promise.resolve(!0)):(O.error({message:"您没有权限访问当前页面"}),t.replace("/403"),Promise.reject(!1)):(N(e),Promise.resolve(!0))}),[o.clusterInfo,o.hasPermission,o.getMetricDefine]);return Object(n.useEffect)((function(){var e,t,n,r=(null===(e=window.location.pathname.split("/"))||void 0===e?void 0:e[1])!==Ct,i=c.findIndex((function(e){return e.path===hs(a)}))>-1;if(h(!r&&!i),a.startsWith("/cluster")||"/"===a){var l=a.split("/")[2];l!==(null===(t=o.clusterInfo)||void 0===t?void 0:t.id)&&k(St(l,"/"===a||null===(n=o.clusterInfo)||void 0===n?void 0:n.runState))}}),[a,o.clusterInfo]),r.a.createElement("div",{id:"sub-system",style:{display:"flex"}},v&&r.a.createElement(f.a.Sider,{width:200,theme:"light",systemKey:Ct,prefixCls:"dcd-two-columns",menuConf:y,permissionPoints:C}),r.a.createElement(f.a.Content,null,r.a.createElement(ra.a,{routeList:vs,beforeEach:S,noMatch:function(){return a.startsWith("/config")?r.a.createElement(r.a.Fragment,null):gs}})))},ys={"zh-CN":{dantd:b.a,intl:"zh-CN",intlMessages:xt},en:{dantd:E.a,intl:"en",intlMessages:{yes:"yes",no:"no",login:"Login",logout:"Logout",register:"Register","login.title":"Login","login.ldap":"Use LDAP"}}},ks=Rt.feConfig,Ns=Rt.systemsConfig,Os=r.a.createContext("zh"),Cs=(Os.Provider,Os.Consumer,function(){m.a.request(K.logout,{method:"POST"}).then((function(e){window.location.href="/login"})),localStorage.removeItem("userInfo")}),Ss=function(){var e=Object(n.useState)(!1),t=l()(e,2),a=t[0],i=t[1],o=Object(n.useState)(""),c=l()(o,2),s=c[0],u=c[1];return Object(n.useLayoutEffect)((function(){return C.on("licenseError",(function(e){!a&&i(!0),u(e)})),function(){C.removeAll("licenseError")}}),[]),r.a.createElement(d.a,{visible:a,centered:!0,width:400,zIndex:10001,title:r.a.createElement(r.a.Fragment,null,r.a.createElement(h.a,{type:"icon-yichang",style:{marginRight:10,fontSize:18}}),"许可证限制"),footer:null,onCancel:function(){return i(!1)}},r.a.createElement("div",{style:{margin:"0 28px",lineHeight:"24px"}},r.a.createElement("div",null,s,"，",r.a.createElement("a",null,"前往帮助文档"))))},xs=function(e){var t,a=Object(s.useLocation)().pathname,i=Object(s.useHistory)(),o=localStorage.getItem("userInfo"),c=Object(n.useState)(""),u=l()(c,2),d=u[0],g=u[1],b=Object(n.useState)(),E=l()(b,2),k=E[0],N=E[1];return Object(n.useEffect)((function(){a.startsWith("/config")?g("config"):g("cluster")}),[a]),Object(n.useEffect)((function(){m.a.request(K.getVersionInfo()).then((function(e){N(e)}))}),[]),r.a.createElement(f.a.Container,{headerProps:{title:r.a.createElement("div",{style:{cursor:"pointer"}},r.a.createElement("img",{className:"header-logo",src:Xt.a})),username:o?null===(t=JSON.parse(o))||void 0===t?void 0:t.userName:"",icon:r.a.createElement(y.a,null),quickEntries:[{icon:r.a.createElement(h.a,{type:"icon-duojiqunguanli"}),txt:"多集群管理",ident:"",active:"cluster"===d},{icon:r.a.createElement(h.a,{type:"icon-xitongguanli"}),txt:"系统管理",ident:"config",active:"config"===d}],isFixed:!1,userDropMenuItems:[r.a.createElement(p.a.Item,{key:0},r.a.createElement("a",{href:"https://github.com/didi/KnowStreaming/releases",rel:"noreferrer",target:"_blank"},"版本: ",null==k?void 0:k["git.build.version"])),r.a.createElement(p.a.Item,{key:1,onClick:Cs},"登出")],onChangeLanguage:e.setlanguage,onClickQuickEntry:function(e){i.push({pathname:"/"+(e.ident||"")})},onClickMain:function(){i.push("/")}},onMount:function(e){!function(){var e=window.location.pathname,t=e.split("/"),a=Ns.filter((function(e){return e.ident===(null==t?void 0:t[1])}));["/404","/500","/403"].indexOf(e)<-1&&(null==t?void 0:t[1])&&!a.length&&(window.location.href="/404")}(),function(e){var t=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;e.forEach((function(e){return It(t,void 0,void 0,q.a.mark((function t(){var r,i,o,c=this;return q.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r=e.ident,i=e.matchPath,o=e.production.index,jt.registerApplication(r,(function(){return It(c,void 0,void 0,q.a.mark((function t(){var a,i,c,l,s,u,m,d=this;return q.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a="".concat(o,"?q=").concat((new Date).getTime()),!/.+html$/.test(o)){t.next=5;break}return t.next=4,Tt(o,e.production.publicPath);case 4:a=t.sent;case 5:return t.next=7,fetch(a).then((function(e){return e.json()}));case 7:if(i=t.sent,c={},!i){t.next=20;break}return t.next=12,zt(e,i,".js");case 12:return t.next=14,Mt(e,i,".js");case 14:return l=t.sent,t.next=17,System.import(l);case 17:c=t.sent,t.next=21;break;case 20:c=i;case 21:return u=(s=c).mount,m=s.unmount,u.unshift((function(){return It(d,void 0,void 0,q.a.mark((function t(){return q.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!i){t.next=3;break}return t.next=3,zt(e,i,".css");case 3:return t.abrupt("return",Promise.resolve());case 4:case"end":return t.stop()}}),t)})))})),n&&u.unshift((function(){return It(d,void 0,void 0,q.a.mark((function e(){return q.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n(),e.abrupt("return",Promise.resolve());case 2:case"end":return e.stop()}}),e)})))})),m.unshift((function(){return Lt(r),Promise.resolve()})),t.abrupt("return",c);case 26:case"end":return t.stop()}}),t)})))}),(function(e){return Pt(e,r,i)}),Object.assign(Object.assign({},wt),a));case 3:case"end":return t.stop()}}),t)})))})),jt.start()}(Ns,Object.assign(Object.assign({},e),{getLicenseInfo:ye,licenseEventBus:C}),(function(){}))}},r.a.createElement(r.a.Fragment,null,r.a.createElement(s.Switch,null,r.a.createElement(s.Route,{path:"/403",exact:!0,component:P}),r.a.createElement(s.Route,{path:"/404",exact:!0,component:z}),r.a.createElement(s.Route,{path:"/500",exact:!0,component:v.a}),r.a.createElement(s.Route,{render:function(){return r.a.createElement(r.a.Fragment,null,"cluster"===d&&r.a.createElement(Es,null),r.a.createElement("div",{id:"ks-layout-container"}))}})),r.a.createElement(Ss,null)))};function js(){var e=Object(n.useState)(navigator.language.substr(0,2)),t=l()(e,2),a=t[0],i=t[1],o=Object(u.get)(ys[a],"intlMessages",xt),c=Object(n.useState)(ks||{}),m=l()(c,1)[0],d=Object(u.get)(ys["zh-CN"],"intl","zh-CN"),f=Object(u.get)(ys["zh-CN"],"dantd",b.a),p=Object(u.get)(m,"title");return p&&(document.title=p),Object(n.useEffect)((function(){window.postMessage({type:"language",value:a},window.location.origin)}),[a]),r.a.createElement(r.a.Fragment,null,r.a.createElement(g.a,{intlProvider:{locale:d,messages:o},antdProvider:{locale:f},store:!0},r.a.createElement(s.BrowserRouter,{basename:""},r.a.createElement(s.Switch,null,r.a.createElement(s.Route,{path:"/login",component:na}),r.a.createElement(s.Route,{path:"/no-license",exact:!0,component:F}),r.a.createElement(s.Route,{render:function(){return r.a.createElement(xs,{setlanguage:i})}})))))}o.a.render(r.a.createElement(js,null),document.getElementById("layout"))}})}));